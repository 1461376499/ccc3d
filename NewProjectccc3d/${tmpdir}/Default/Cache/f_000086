(function (global, factory) {
  if (typeof define === "function" && define.amd) {
    define(["exports", "../core/math/index.js", "../core/math/bits.js", "./enum.js"], factory);
  } else if (typeof exports !== "undefined") {
    factory(exports, require("../core/math/index.js"), require("../core/math/bits.js"), require("./enum.js"));
  } else {
    var mod = {
      exports: {}
    };
    factory(mod.exports, global.index, global.bits, global._enum);
    global.particleGeneralFunction = mod.exports;
  }
})(typeof globalThis !== "undefined" ? globalThis : typeof self !== "undefined" ? self : this, function (_exports, _index, _bits, _enum) {
  "use strict";

  Object.defineProperty(_exports, "__esModule", {
    value: true
  });
  _exports.calculateTransform = calculateTransform;
  _exports.fixedAngleUnitVector2 = fixedAngleUnitVector2;
  _exports.randomUnitVector2 = randomUnitVector2;
  _exports.randomUnitVector = randomUnitVector;
  _exports.randomPointInUnitSphere = randomPointInUnitSphere;
  _exports.randomPointBetweenSphere = randomPointBetweenSphere;
  _exports.randomPointInUnitCircle = randomPointInUnitCircle;
  _exports.randomPointBetweenCircle = randomPointBetweenCircle;
  _exports.randomPointBetweenCircleAtFixedAngle = randomPointBetweenCircleAtFixedAngle;
  _exports.randomPointInCube = randomPointInCube;
  _exports.randomPointBetweenCube = randomPointBetweenCube;
  _exports.randomSortArray = randomSortArray;
  _exports.randomSign = randomSign;
  _exports.particleEmitZAxis = void 0;

  /**
   * @hidden
   */
  var particleEmitZAxis = new _index.Vec3(0, 0, -1);
  _exports.particleEmitZAxis = particleEmitZAxis;

  function calculateTransform(systemSpace, moduleSpace, worldTransform, outQuat) {
    if (moduleSpace !== systemSpace) {
      if (systemSpace === _enum.Space.World) {
        _index.Mat4.getRotation(outQuat, worldTransform);
      } else {
        _index.Mat4.invert(worldTransform, worldTransform);

        _index.Mat4.getRotation(outQuat, worldTransform);
      }

      return true;
    } else {
      _index.Quat.set(outQuat, 0, 0, 0, 1);

      return false;
    }
  }

  function fixedAngleUnitVector2(out, theta) {
    _index.Vec2.set(out, Math.cos(theta), Math.sin(theta));
  }

  function randomUnitVector2(out) {
    var a = (0, _index.randomRange)(0, 2 * Math.PI);
    var x = Math.cos(a);
    var y = Math.sin(a);

    _index.Vec2.set(out, x, y);
  }

  function randomUnitVector(out) {
    var z = (0, _index.randomRange)(-1, 1);
    var a = (0, _index.randomRange)(0, 2 * Math.PI);
    var r = Math.sqrt(1 - z * z);
    var x = r * Math.cos(a);
    var y = r * Math.sin(a);

    _index.Vec3.set(out, x, y, z);
  }

  function randomPointInUnitSphere(out) {
    randomUnitVector(out);

    _index.Vec3.multiplyScalar(out, out, (0, _index.random)());
  }

  function randomPointBetweenSphere(out, minRadius, maxRadius) {
    randomUnitVector(out);

    _index.Vec3.multiplyScalar(out, out, minRadius + (maxRadius - minRadius) * (0, _index.random)());
  }

  function randomPointInUnitCircle(out) {
    randomUnitVector2(out);
    out.z = 0;

    _index.Vec3.multiplyScalar(out, out, (0, _index.random)());
  }

  function randomPointBetweenCircle(out, minRadius, maxRadius) {
    randomUnitVector2(out);
    out.z = 0;

    _index.Vec3.multiplyScalar(out, out, minRadius + (maxRadius - minRadius) * (0, _index.random)());
  }

  function randomPointBetweenCircleAtFixedAngle(out, minRadius, maxRadius, theta) {
    fixedAngleUnitVector2(out, theta);
    out.z = 0;

    _index.Vec3.multiplyScalar(out, out, minRadius + (maxRadius - minRadius) * (0, _index.random)());
  }

  function randomPointInCube(out, extents) {
    _index.Vec3.set(out, (0, _index.randomRange)(-extents.x, extents.x), (0, _index.randomRange)(-extents.y, extents.y), (0, _index.randomRange)(-extents.z, extents.z));
  }

  function randomPointBetweenCube(out, minBox, maxBox) {
    var subscript = ['x', 'y', 'z'];
    var edge = (0, _index.randomRangeInt)(0, 3);

    for (var i = 0; i < 3; i++) {
      if (i === edge) {
        out[subscript[i]] = (0, _index.randomRange)(-maxBox[subscript[i]], maxBox[subscript[i]]);
        continue;
      }

      var x = (0, _index.random)() * 2 - 1;

      if (x < 0) {
        out[subscript[i]] = -minBox[subscript[i]] + x * (maxBox[subscript[i]] - minBox[subscript[i]]);
      } else {
        out[subscript[i]] = minBox[subscript[i]] + x * (maxBox[subscript[i]] - minBox[subscript[i]]);
      }
    }
  } // Fisherâ€“Yates shuffle


  function randomSortArray(arr) {
    for (var i = 0; i < arr.length; i++) {
      var transpose = i + (0, _index.randomRangeInt)(0, arr.length - i);
      var val = arr[transpose];
      arr[transpose] = arr[i];
      arr[i] = val;
    }
  }

  function randomSign() {
    var sgn = (0, _index.randomRange)(-1, 1);

    if (sgn === 0) {
      sgn++;
    }

    return (0, _bits.sign)(sgn);
  }
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkY6L2plbmtpbnMvd29ya3NwYWNlL0NyZWF0b3JfM0QvZWRpdG9yLTNkL3Jlc291cmNlcy8zZC9lbmdpbmUvY29jb3MvcGFydGljbGUvcGFydGljbGUtZ2VuZXJhbC1mdW5jdGlvbi50cyJdLCJuYW1lcyI6WyJwYXJ0aWNsZUVtaXRaQXhpcyIsIlZlYzMiLCJjYWxjdWxhdGVUcmFuc2Zvcm0iLCJzeXN0ZW1TcGFjZSIsIm1vZHVsZVNwYWNlIiwid29ybGRUcmFuc2Zvcm0iLCJvdXRRdWF0IiwiU3BhY2UiLCJXb3JsZCIsIk1hdDQiLCJnZXRSb3RhdGlvbiIsImludmVydCIsIlF1YXQiLCJzZXQiLCJmaXhlZEFuZ2xlVW5pdFZlY3RvcjIiLCJvdXQiLCJ0aGV0YSIsIlZlYzIiLCJNYXRoIiwiY29zIiwic2luIiwicmFuZG9tVW5pdFZlY3RvcjIiLCJhIiwiUEkiLCJ4IiwieSIsInJhbmRvbVVuaXRWZWN0b3IiLCJ6IiwiciIsInNxcnQiLCJyYW5kb21Qb2ludEluVW5pdFNwaGVyZSIsIm11bHRpcGx5U2NhbGFyIiwicmFuZG9tUG9pbnRCZXR3ZWVuU3BoZXJlIiwibWluUmFkaXVzIiwibWF4UmFkaXVzIiwicmFuZG9tUG9pbnRJblVuaXRDaXJjbGUiLCJyYW5kb21Qb2ludEJldHdlZW5DaXJjbGUiLCJyYW5kb21Qb2ludEJldHdlZW5DaXJjbGVBdEZpeGVkQW5nbGUiLCJyYW5kb21Qb2ludEluQ3ViZSIsImV4dGVudHMiLCJyYW5kb21Qb2ludEJldHdlZW5DdWJlIiwibWluQm94IiwibWF4Qm94Iiwic3Vic2NyaXB0IiwiZWRnZSIsImkiLCJyYW5kb21Tb3J0QXJyYXkiLCJhcnIiLCJsZW5ndGgiLCJ0cmFuc3Bvc2UiLCJ2YWwiLCJyYW5kb21TaWduIiwic2duIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTs7O0FBUU8sTUFBTUEsaUJBQWlCLEdBQUcsSUFBSUMsV0FBSixDQUFTLENBQVQsRUFBWSxDQUFaLEVB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QUFDSDtBQUNKO0FBQ0osRyxDQUVEOzs7QUFDTyxXQUFTQyxlQUFULENBQTBCQyxHQUExQixFQUFzQztBQUN6QyxTQUFLLElBQUlGLENBQUMsR0FBRyxDQUFiLEVBQWdCQSxDQUFDLEdBQUdFLEdBQUcsQ0FBQ0MsTUFBeEIsRUFBZ0NILENBQUMsRUFBakMsRUFBcUM7QUFDakMsVUFBTUksU0FBUyxHQUFHSixDQUFDLEdBQUcsMkJBQWUsQ0FBZixFQUFrQkUsR0FBRyxDQUFDQyxNQUFKLEdBQWFILENBQS9CLENBQXRCO0FBQ0EsVUFBTUssR0FBRyxHQUFHSCxHQUFHLENBQUNFLFNBQUQsQ0FBZjtBQUNBRixNQUFBQSxHQUFHLENBQUNFLFNBQUQsQ0FBSCxHQUFpQkYsR0FBRyxDQUFDRixDQUFELENBQXBCO0FBQ0FFLE1BQUFBLEdBQUcsQ0FBQ0YsQ0FBRCxDQUFILEdBQVNLLEdBQVQ7QUFDSDtBQUNKOztBQUVNLFdBQVNDLFVBQVQsR0FBdUI7QUFDMUIsUUFBSUMsR0FBRyxHQUFHLHdCQUFZLENBQUMsQ0FBYixFQUFnQixDQUFoQixDQUFWOztBQUNBLFFBQUlBLEdBQUcsS0FBSyxDQUFaLEVBQWU7QUFDWEEsTUFBQUEsR0FBRztBQUNOOztBQUNELFdBQU8sZ0JBQUtBLEdBQUwsQ0FBUDtBQUNIIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXHJcbiAqIEBoaWRkZW5cclxuICovXHJcblxyXG5pbXBvcnQgeyBNYXQ0LCBRdWF0LCByYW5kb20sIHJhbmRvbVJhbmdlLCByYW5kb21SYW5nZUludCwgVmVjMiwgVmVjMyB9IGZyb20gJy4uL2NvcmUvbWF0aCc7XHJcbmltcG9ydCB7IHNpZ24gfSBmcm9tICcuLi9jb3JlL21hdGgvYml0cyc7XHJcbmltcG9ydCB7IFNwYWNlIH0gZnJvbSAnLi9lbnVtJztcclxuXHJcbmV4cG9ydCBjb25zdCBwYXJ0aWNsZUVtaXRaQXhpcyA9IG5ldyBWZWMzKDAsIDAsIC0xKTtcclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBjYWxjdWxhdGVUcmFuc2Zvcm0gKHN5c3RlbVNwYWNlOiBudW1iZXIsIG1vZHVsZVNwYWNlOiBudW1iZXIsIHdvcmxkVHJhbnNmb3JtOiBNYXQ0LCBvdXRRdWF0OiBRdWF0KSB7XHJcbiAgICBpZiAobW9kdWxlU3BhY2UgIT09IHN5c3RlbVNwYWNlKSB7XHJcbiAgICAgICAgaWYgKHN5c3RlbVNwYWNlID09PSBTcGFjZS5Xb3JsZCkge1xyXG4gICAgICAgICAgICBNYXQ0LmdldFJvdGF0aW9uKG91dFF1YXQsIHdvcmxkVHJhbnNmb3JtKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIE1hdDQuaW52ZXJ0KHdvcmxkVHJhbnNmb3JtLCB3b3JsZFRyYW5zZm9ybSk7XHJcbiAgICAgICAgICAgIE1hdDQuZ2V0Um90YXRpb24ob3V0UXVhdCwgd29ybGRUcmFuc2Zvcm0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICAgIFF1YXQuc2V0KG91dFF1YXQsIDAsIDAsIDAsIDEpO1xyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGZpeGVkQW5nbGVVbml0VmVjdG9yMiAob3V0OiBWZWMyIHwgVmVjMywgdGhldGE6IG51bWJlcikge1xyXG4gICAgVmVjMi5zZXQob3V0LCBNYXRoLmNvcyh0aGV0YSksIE1hdGguc2luKHRoZXRhKSk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiByYW5kb21Vbml0VmVjdG9yMiAob3V0OiBWZWMyIHwgVmVjMykge1xyXG4gICAgY29uc3QgYSA9IHJhbmRvbVJhbmdlKDAsIDIgKiBNYXRoLlBJKTtcclxuICAgIGNvbnN0IHggPSBNYXRoLmNvcyhhKTtcclxuICAgIGNvbnN0IHkgPSBNYXRoLnNpbihhKTtcclxuICAgIFZlYzIuc2V0KG91dCwgeCwgeSk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiByYW5kb21Vbml0VmVjdG9yIChvdXQ6IFZlYzMpIHtcclxuICAgIGNvbnN0IHogPSByYW5kb21SYW5nZSgtMSwgMSk7XHJcbiAgICBjb25zdCBhID0gcmFuZG9tUmFuZ2UoMCwgMiAqIE1hdGguUEkpO1xyXG4gICAgY29uc3QgciA9IE1hdGguc3FydCgxIC0geiAqIHopO1xyXG4gICAgY29uc3QgeCA9IHIgKiBNYXRoLmNvcyhhKTtcclxuICAgIGNvbnN0IHkgPSByICogTWF0aC5zaW4oYSk7XHJcbiAgICBWZWMzLnNldChvdXQsIHgsIHksIHopO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gcmFuZG9tUG9pbnRJblVuaXRTcGhlcmUgKG91dDogVmVjMykge1xyXG4gICAgcmFuZG9tVW5pdFZlY3RvcihvdXQpO1xyXG4gICAgVmVjMy5tdWx0aXBseVNjYWxhcihvdXQsIG91dCwgcmFuZG9tKCkpO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gcmFuZG9tUG9pbnRCZXR3ZWVuU3BoZXJlIChvdXQ6IFZlYzMsIG1pblJhZGl1czogbnVtYmVyLCBtYXhSYWRpdXM6IG51bWJlcikge1xyXG4gICAgcmFuZG9tVW5pdFZlY3RvcihvdXQpO1xyXG4gICAgVmVjMy5tdWx0aXBseVNjYWxhcihvdXQsIG91dCwgbWluUmFkaXVzICsgKG1heFJhZGl1cyAtIG1pblJhZGl1cykgKiByYW5kb20oKSk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiByYW5kb21Qb2ludEluVW5pdENpcmNsZSAob3V0OiBWZWMzKSB7XHJcbiAgICByYW5kb21Vbml0VmVjdG9yMihvdXQpO1xyXG4gICAgb3V0LnogPSAwO1xyXG4gICAgVmVjMy5tdWx0aXBseVNjYWxhcihvdXQsIG91dCwgcmFuZG9tKCkpO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gcmFuZG9tUG9pbnRCZXR3ZWVuQ2lyY2xlIChvdXQ6IFZlYzMsIG1pblJhZGl1czogbnVtYmVyLCBtYXhSYWRpdXM6IG51bWJlcikge1xyXG4gICAgcmFuZG9tVW5pdFZlY3RvcjIob3V0KTtcclxuICAgIG91dC56ID0gMDtcclxuICAgIFZlYzMubXVsdGlwbHlTY2FsYXIob3V0LCBvdXQsIG1pblJhZGl1cyArIChtYXhSYWRpdXMgLSBtaW5SYWRpdXMpICogcmFuZG9tKCkpO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gcmFuZG9tUG9pbnRCZXR3ZWVuQ2lyY2xlQXRGaXhlZEFuZ2xlIChvdXQ6IFZlYzMsIG1pblJhZGl1czogbnVtYmVyLCBtYXhSYWRpdXM6IG51bWJlciwgdGhldGE6IG51bWJlcikge1xyXG4gICAgZml4ZWRBbmdsZVVuaXRWZWN0b3IyKG91dCwgdGhldGEpO1xyXG4gICAgb3V0LnogPSAwO1xyXG4gICAgVmVjMy5tdWx0aXBseVNjYWxhcihvdXQsIG91dCwgbWluUmFkaXVzICsgKG1heFJhZGl1cyAtIG1pblJhZGl1cykgKiByYW5kb20oKSk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiByYW5kb21Qb2ludEluQ3ViZSAob3V0OiBWZWMzLCBleHRlbnRzOiBWZWMzKSB7XHJcbiAgICBWZWMzLnNldChvdXQsXHJcbiAgICAgICAgcmFuZG9tUmFuZ2UoLWV4dGVudHMueCwgZXh0ZW50cy54KSxcclxuICAgICAgICByYW5kb21SYW5nZSgtZXh0ZW50cy55LCBleHRlbnRzLnkpLFxyXG4gICAgICAgIHJhbmRvbVJhbmdlKC1leHRlbnRzLnosIGV4dGVudHMueikpO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gcmFuZG9tUG9pbnRCZXR3ZWVuQ3ViZSAob3V0OiBWZWMzLCBtaW5Cb3g6IFZlYzMsIG1heEJveDogVmVjMykge1xyXG4gICAgY29uc3Qgc3Vic2NyaXB0ID0gWyd4JywgJ3knLCAneiddO1xyXG4gICAgY29uc3QgZWRnZSA9IHJhbmRvbVJhbmdlSW50KDAsIDMpO1xyXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCAzOyBpKyspIHtcclxuICAgICAgICBpZiAoaSA9PT0gZWRnZSkge1xyXG4gICAgICAgICAgICBvdXRbc3Vic2NyaXB0W2ldXSA9IHJhbmRvbVJhbmdlKC1tYXhCb3hbc3Vic2NyaXB0W2ldXSwgbWF4Qm94W3N1YnNjcmlwdFtpXV0pO1xyXG4gICAgICAgICAgICBjb250aW51ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3QgeCA9IHJhbmRvbSgpICogMiAtIDE7XHJcbiAgICAgICAgaWYgKHggPCAwKSB7XHJcbiAgICAgICAgICAgIG91dFtzdWJzY3JpcHRbaV1dID0gLW1pbkJveFtzdWJzY3JpcHRbaV1dICsgeCAqIChtYXhCb3hbc3Vic2NyaXB0W2ldXSAtIG1pbkJveFtzdWJzY3JpcHRbaV1dKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIG91dFtzdWJzY3JpcHRbaV1dID0gbWluQm94W3N1YnNjcmlwdFtpXV0gKyB4ICogKG1heEJveFtzdWJzY3JpcHRbaV1dIC0gbWluQm94W3N1YnNjcmlwdFtpXV0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG5cclxuLy8gRmlzaGVy4oCTWWF0ZXMgc2h1ZmZsZVxyXG5leHBvcnQgZnVuY3Rpb24gcmFuZG9tU29ydEFycmF5IChhcnI6IGFueVtdKSB7XHJcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGFyci5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgIGNvbnN0IHRyYW5zcG9zZSA9IGkgKyByYW5kb21SYW5nZUludCgwLCBhcnIubGVuZ3RoIC0gaSk7XHJcbiAgICAgICAgY29uc3QgdmFsID0gYXJyW3RyYW5zcG9zZV07XHJcbiAgICAgICAgYXJyW3RyYW5zcG9zZV0gPSBhcnJbaV07XHJcbiAgICAgICAgYXJyW2ldID0gdmFsO1xyXG4gICAgfVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gcmFuZG9tU2lnbiAoKSB7XHJcbiAgICBsZXQgc2duID0gcmFuZG9tUmFuZ2UoLTEsIDEpO1xyXG4gICAgaWYgKHNnbiA9PT0gMCkge1xyXG4gICAgICAgIHNnbisrO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHNpZ24oc2duKTtcclxufVxyXG4iXX0=