(function (global, factory) {
  if (typeof define === "function" && define.amd) {
    define(["exports", "../component.js", "../../data/class-decorator.js", "../../platform/event-manager/event-enum.js", "../../math/index.js", "../../geometry/index.js", "../../default-constants.js"], factory);
  } else if (typeof exports !== "undefined") {
    factory(exports, require("../component.js"), require("../../data/class-decorator.js"), require("../../platform/event-manager/event-enum.js"), require("../../math/index.js"), require("../../geometry/index.js"), require("../../default-constants.js"));
  } else {
    var mod = {
      exports: {}
    };
    factory(mod.exports, global.component, global.classDecorator, global.eventEnum, global.index, global.index, global.defaultConstants);
    global.uiTransformComponent = mod.exports;
  }
})(typeof globalThis !== "undefined" ? globalThis : typeof self !== "undefined" ? self : this, function (_exports, _component, _classDecorator, _eventEnum, _index, _index2, _defaultConstants) {
  "use strict";

  Object.defineProperty(_exports, "__esModule", {
    value: true
  });
  _exports.UITransformComponent = void 0;

  var _dec, _dec2, _dec3, _dec4, _dec5, _dec6, _dec7, _class, _class2, _descriptor, _descriptor2, _descriptor3, _class3, _temp;

  function _typeof(obj) { "@babel/helpers - typeof"; if (typeof Symbol === "function" && typeof Symbol.iterator === "symbol") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }; } return _typeof(obj); }

  function _createForOfIteratorHelper(o) { if (typeof Symbol === "undefined" || o[Symbol.iterator] == null) { if (Array.isArray(o) || (o = _unsupportedIterableToArray(o))) { var i = 0; var F = function F() {}; return { s: F, n: function n() { if (i >= o.length) return { done: true }; return { done: false, value: o[i++] }; }, e: function e(_e) { throw _e; }, f: F }; } throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); } var it, normalCompletion = true, didErr = false, err; return { s: function s() { it = o[Symbol.iterator](); }, n: function n() { var step = it.next(); normalCompletion = step.done; return step; }, e: function e(_e2) { didErr = true; err = _e2; }, f: function f() { try { if (!normalCompletion && it["return"] != null) it["return"](); } finally { if (didErr) throw err; } } }; }

  function _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(n); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }

  function _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }

  function _initializerDefineProperty(target, property, descriptor, context) { if (!descriptor) return; Object.defineProperty(target, property, { enumerable: descriptor.enumerable, configurable: descriptor.configurable, writable: descriptor.writable, value: descriptor.initializer ? descriptor.initializer.call(context) : void 0 }); }

  function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

  function _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }

  function _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }

  function _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === "object" || typeof call === "function")) { return call; } return _assertThisInitialized(self); }

  function _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }

  function _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return self; }

  function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); if (superClass) _setPrototypeOf(subClass, superClass); }

  function _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }

  function _initializerWarningHelper(descriptor, context) { throw new Error('Decorating class property failed. Please ensure that ' + 'proposal-class-properties is enabled and runs after the decorators transform.'); }

  function _applyDecoratedDescriptor(target, property, decorators, descriptor, context) { var desc = {}; Object.keys(descriptor).forEach(function (key) { desc[key] = descriptor[key]; }); desc.enumerable = !!desc.enumerable; desc.configurable = !!desc.configurable; if ('value' in desc || desc.initializer) { desc.writable = true; } desc = decorators.slice().reverse().reduce(function (desc, decorator) { return decorator(target, property, desc) || desc; }, desc); if (context && desc.initializer !== void 0) { desc.value = desc.initializer ? desc.initializer.call(context) : void 0; desc.initializer = undefined; } if (desc.initializer === void 0) { Object.defineProperty(target, property, desc); desc = null; } return desc; }

  var _vec2a = new _index.Vec2();

  var _vec2b = new _index.Vec2();

  var _mat4_temp = new _index.Mat4();

  var _matrix = new _index.Mat4();

  var _worldMatrix = new _index.Mat4();

  var _zeroMatrix = new _index.Mat4(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0);

  var _rect = new _index.Rect();
  /**
   * @en
   * The component of transform in UI.
   *
   * @zh
   * UI 变换组件。
   */


  var UITransformComponent = (_dec = (0, _classDecorator.ccclass)('cc.UITransformComponent'), _dec2 = (0, _classDecorator.help)('i18n:cc.UITransformComponent'), _dec3 = (0, _classDecorator.executionOrder)(110), _dec4 = (0, _classDecorator.menu)('UI/UITransform'), _dec5 = (0, _classDecorator.property)({
    displayOrder: 0,
    tooltip: '内容尺寸'
  }), _dec6 = (0, _classDecorator.property)({
    displayOrder: 1,
    tooltip: '锚点位置'
  }), _dec7 = (0, _classDecorator.property)({
    tooltip: '渲染排序优先级'
  }), _dec(_class = _dec2(_class = _dec3(_class = _dec4(_class = (0, _classDecorator.executeInEditMode)(_class = (_class2 = (_temp = _class3 = /*#__PURE__*/function (_Component) {
    _inherits(UITransformComponent, _Component);

    function UITransformComponent() {
      var _getPrototypeOf2;

      var _this;

      _classCallCheck(this, UITransformComponent);

      for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {
        args[_key] = arguments[_key];
      }

      _this = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(UITransformComponent)).call.apply(_getPrototypeOf2, [this].concat(args)));

      _initializerDefineProperty(_this, "_priority", _descriptor, _assertThisInitialized(_this));

      _this._canvas = null;

      _initializerDefineProperty(_this, "_contentSize", _descriptor2, _assertThisInitialized(_this));

      _initializerDefineProperty(_this, "_anchorPoint", _descriptor3, _assertThisInitialized(_this));

      return _this;
    }

    _createClass(UITransformComponent, [{
      key: "__preload",
      value: function __preload() {
        this.node._uiProps.uiTransformComp = this;
      }
    }, {
      key: "onEnable",
      value: function onEnable() {
        this._updateVisibility();

        this.node.on(_eventEnum.SystemEventType.PARENT_CHANGED, this._parentChanged, this);

        this._sortSiblings();
      }
    }, {
      key: "onDisable",
      value: function onDisable() {
        this.node.off(_eventEnum.SystemEventType.PARENT_CHANGED, this._parentChanged, this);
        this._canvas = null;
      }
    }, {
      key: "onDestroy",
      value: function onDestroy() {
        this.node._uiProps.uiTransformComp = null;
      }
      /**
       * @en
       * Sets the untransformed size of the node.<br/>
       * The contentSize remains the same no matter if the node is scaled or rotated.<br/>
       * All nodes have a size. Layer and Scene have the same size of the screen.
       *
       * @zh
       * 设置节点原始大小，不受该节点是否被缩放或者旋转的影响。
       *
       * @param size - 节点内容变换的尺寸或者宽度。
       * @param height - 节点内容未变换的高度。
       * @example
       * ```typescript
       * node.setContentSize(cc.size(100, 100));
       * node.setContentSize(100, 100);
       * ```
       */

    }, {
      key: "setContentSize",
      value: function setContentSize(size, height) {
        var locContentSize = this._contentSize;
        var clone;

        if (height === undefined) {
          size = size;

          if (size.width === locContentSize.width && size.height === locContentSize.height) {
            return;
          }

          if (_defaultConstants.EDITOR) {
            clone = new _index.Size(this._contentSize);
          }

          locContentSize.width = size.width;
          locContentSize.height = size.height;
        } else {
          if (size === locContentSize.width && height === locContentSize.height) {
            return;
          }

          if (_defaultConstants.EDITOR) {
            clone = new _index.Size(this._contentSize);
          }

          locContentSize.width = size;
          locContentSize.height = height;
        }

        if (_defaultConstants.EDITOR) {
          // @ts-ignore
          this.node.emit(_eventEnum.SystemEventType.SIZE_CHANGED, clone);
        } else {
          this.node.emit(_eventEnum.SystemEventType.SIZE_CHANGED);
        }
      }
      /**
       * @en
       * Sets the anchor point in percent. <br/>
       * anchor point is the point around which all transformations and positioning manipulations take place. <br/>
       * It's like a pin in the node where it is "attached" to its parent. <br/>
       * The anchorPoint is normalized, like a percentage. (0,0) means the bottom-left corner and (1,1) means the top-right corner.<br/>
       * But you can use values higher than (1,1) and lower than (0,0) too.<br/>
       * The default anchor point is (0.5,0.5), so it starts at the center of the node.
       *
       * @zh
       * 设置锚点的百分比。<br>
       * 锚点应用于所有变换和坐标点的操作，它就像在节点上连接其父节点的大头针。<br>
       * 锚点是标准化的，就像百分比一样。(0，0) 表示左下角，(1，1) 表示右上角。<br>
       * 但是你可以使用比（1，1）更高的值或者比（0，0）更低的值。<br>
       * 默认的锚点是（0.5，0.5），因此它开始于节点的中心位置。<br>
       * 注意：Creator 中的锚点仅用于定位所在的节点，子节点的定位不受影响。
       *
       * @param point - 节点锚点或节点 x 轴锚。
       * @param y - 节点 y 轴锚。
       * @example
       * ```typescript
       * node.setAnchorPoint(cc.v2(1, 1));
       * node.setAnchorPoint(1, 1);
       * ```
       */

    }, {
      key: "setAnchorPoint",
      value: function setAnchorPoint(point, y) {
        var locAnchorPoint = this._anchorPoint;

        if (y === undefined) {
          point = point;

          if (point.x === locAnchorPoint.x && point.y === locAnchorPoint.y) {
            return;
          }

          locAnchorPoint.x = point.x;
          locAnchorPoint.y = point.y;
        } else {
          if (point === locAnchorPoint.x && y === locAnchorPoint.y) {
            return;
          }

          locAnchorPoint.x = point;
          locAnchorPoint.y = y;
        } // this.setLocalDirty(LocalDirtyFlag.POSITION);
        // if (this._eventMask & ANCHOR_ON) {


        this.node.emit(_eventEnum.SystemEventType.ANCHOR_CHANGED, this._anchorPoint); // }
      }
      /**
       * @zh
       * 当前节点的点击计算。
       *
       * @param point - 屏幕点。
       * @param listener - 事件监听器。
       */

    }, {
      key: "isHit",
      value: function isHit(point, listener) {
        var w = this._contentSize.width;
        var h = this._contentSize.height;
        var cameraPt = _vec2a;
        var testPt = _vec2b;
        var canvas = this._canvas;

        if (!canvas) {
          return;
        } // 将一个摄像机坐标系下的点转换到世界坐标系下


        canvas.node.getWorldRT(_mat4_temp);
        var m12 = _mat4_temp.m12;
        var m13 = _mat4_temp.m13;
        var center = cc.visibleRect.center;
        _mat4_temp.m12 = center.x - (_mat4_temp.m00 * m12 + _mat4_temp.m04 * m13);
        _mat4_temp.m13 = center.y - (_mat4_temp.m01 * m12 + _mat4_temp.m05 * m13);

        _index.Mat4.invert(_mat4_temp, _mat4_temp);

        _index.Vec2.transformMat4(cameraPt, point, _mat4_temp);

        this.node.getWorldMatrix(_worldMatrix);

        _index.Mat4.invert(_mat4_temp, _worldMatrix);

        if (_index.Mat4.strictEquals(_mat4_temp, _zeroMatrix)) {
          return false;
        }

        _index.Vec2.transformMat4(testPt, cameraPt, _mat4_temp);

        testPt.x += this._anchorPoint.x * w;
        testPt.y += this._anchorPoint.y * h;

        if (testPt.x >= 0 && testPt.y >= 0 && testPt.x <= w && testPt.y <= h) {
          if (listener && listener.mask) {
            var mask = listener.mask;
            var parent = this.node; // find mask parent, should hit test it

            for (var i = 0; parent && i < mask.index; ++i, parent = parent.parent) {}

            if (parent === mask.node) {
              var comp = parent.getComponent(cc.MaskComponent);
              return comp && comp.enabledInHierarchy ? comp.isHit(cameraPt) : true;
            } else {
              listener.mask = null;
              return true;
            }
          } else {
            return true;
          }
        } else {
          return false;
        }
      }
      /**
       * @en
       * Converts a Point to node (local) space coordinates.
       *
       * @zh
       * 将一个 UI 节点世界坐标系下点转换到另一个 UI 节点 (局部) 空间坐标系，这个坐标系以锚点为原点。
       * 非 UI 节点转换到 UI 节点(局部) 空间坐标系，请走 CameraComponent 的 `convertToUINode`。
       *
       * @param worldPoint - 世界坐标点。
       * @param out - 转换后坐标。
       * @returns - 返回与目标节点的相对位置。
       * @example
       * ```typescript
       * const newVec3 = uiTransform.convertToNodeSpaceAR(cc.v3(100, 100, 0));
       * ```
       */

    }, {
      key: "convertToNodeSpaceAR",
      value: function convertToNodeSpaceAR(worldPoint, out) {
        this.node.getWorldMatrix(_worldMatrix);

        _index.Mat4.invert(_mat4_temp, _worldMatrix);

        if (!out) {
          out = new _index.Vec3();
        }

        return _index.Vec3.transformMat4(out, worldPoint, _mat4_temp);
      }
      /**
       * @en
       * Converts a Point in node coordinates to world space coordinates.
       *
       * @zh
       * 将距当前节点坐标系下的一个点转换到世界坐标系。
       *
       * @param nodePoint - 节点坐标。
       * @param out - 转换后坐标。
       * @returns - 返回 UI 世界坐标系。
       * @example
       * ```typescript
       * const newVec3 = uiTransform.convertToWorldSpaceAR(3(100, 100, 0));
       * ```
       */

    }, {
      key: "convertToWorldSpaceAR",
      value: function convertToWorldSpaceAR(nodePoint, out) {
        this.node.getWorldMatrix(_worldMatrix);

        if (!out) {
          out = new _index.Vec3();
        }

        return _index.Vec3.transformMat4(out, nodePoint, _worldMatrix);
      }
      /**
       * @en
       * Returns a "local" axis aligned bounding box of the node. <br/>
       * The returned box is relative only to its parent.
       *
       * @zh
       * 返回父节坐标系下的轴向对齐的包围盒。
       *
       * @return - 节点大小的包围盒
       * @example
       * ```typescript
       * const boundingBox = uiTransform.getBoundingBox();
       * ```
       */

    }, {
      key: "getBoundingBox",
      value: function getBoundingBox() {
        _index.Mat4.fromRTS(_matrix, this.node.getRotation(), this.node.getPosition(), this.node.getScale());

        var width = this._contentSize.width;
        var height = this._contentSize.height;
        var rect = new _index.Rect(-this._anchorPoint.x * width, -this._anchorPoint.y * height, width, height);
        rect.transformMat4(_matrix);
        return rect;
      }
      /**
       * @en
       * Returns a "world" axis aligned bounding box of the node.<br/>
       * The bounding box contains self and active children's world bounding box.
       *
       * @zh
       * 返回节点在世界坐标系下的对齐轴向的包围盒（AABB）。
       * 该边框包含自身和已激活的子节点的世界边框。
       *
       * @returns - 返回世界坐标系下包围盒。
       * @example
       * ```typescript
       * const newRect = uiTransform.getBoundingBoxToWorld();
       * ```
       */

    }, {
      key: "getBoundingBoxToWorld",
      value: function getBoundingBoxToWorld() {
        if (this.node.parent) {
          this.node.parent.getWorldMatrix(_worldMatrix);
          return this.getBoundingBoxTo(_worldMatrix);
        } else {
          return this.getBoundingBox();
        }
      }
      /**
       * @en
       * Returns the minimum bounding box containing the current bounding box and its child nodes.
       *
       * @zh
       * 返回包含当前包围盒及其子节点包围盒的最小包围盒。
       *
       * @param parentMat - 父节点矩阵。
       * @returns
       */

    }, {
      key: "getBoundingBoxTo",
      value: function getBoundingBoxTo(parentMat) {
        _index.Mat4.fromRTS(_matrix, this.node.getRotation(), this.node.getPosition(), this.node.getScale());

        var width = this._contentSize.width;
        var height = this._contentSize.height;
        var rect = new _index.Rect(-this._anchorPoint.x * width, -this._anchorPoint.y * height, width, height);

        _index.Mat4.multiply(_worldMatrix, parentMat, _matrix);

        rect.transformMat4(_worldMatrix); // query child's BoundingBox

        if (!this.node.children) {
          return rect;
        }

        var locChildren = this.node.children;

        var _iterator = _createForOfIteratorHelper(locChildren),
            _step;

        try {
          for (_iterator.s(); !(_step = _iterator.n()).done;) {
            var child = _step.value;

            if (child && child.active) {
              var uiTransform = child.getComponent(UITransformComponent);

              if (uiTransform) {
                var childRect = uiTransform.getBoundingBoxTo(parentMat);

                if (childRect) {
                  _index.Rect.union(rect, rect, childRect);
                }
              }
            }
          }
        } catch (err) {
          _iterator.e(err);
        } finally {
          _iterator.f();
        }

        return rect;
      }
      /**
       * @en
       * Compute the corresponding aabb in world space for raycast.
       *
       * @zh
       * 计算出此 UI_2D 节点在世界空间下的 aabb 包围盒
       */

    }, {
      key: "getComputeAABB",
      value: function getComputeAABB(out) {
        var width = this._contentSize.width;
        var height = this._contentSize.height;

        _rect.set(-this._anchorPoint.x * width, -this._anchorPoint.y * height, width, height);

        _rect.transformMat4(this.node.worldMatrix);

        var px = _rect.x + _rect.width * 0.5;
        var py = _rect.y + _rect.height * 0.5;
        ;
        var pz = this.node.worldPosition.z;
        var w = _rect.width / 2;
        var h = _rect.height / 2;
        var l = 0.001;

        if (out != null) {
          _index2.aabb.set(out, px, py, pz, w, h, l);
        } else {
          return new _index2.aabb(px, py, pz, w, h, l);
        }
      }
    }, {
      key: "_updateVisibility",
      value: function _updateVisibility() {
        var parent = this.node; // 获取被渲染相机的 visibility

        while (parent) {
          if (parent) {
            var canvasComp = parent.getComponent('cc.CanvasComponent');

            if (canvasComp) {
              this._canvas = canvasComp;
              break;
            }
          } // @ts-ignore


          parent = parent.parent;
        }
      }
    }, {
      key: "_parentChanged",
      value: function _parentChanged(node) {
        if (this._canvas && this._canvas.node === this.node) {
          return;
        }

        this._sortSiblings();
      }
    }, {
      key: "_sortSiblings",
      value: function _sortSiblings() {
        var siblings = this.node.parent && this.node.parent.children;

        if (siblings) {
          siblings.sort(function (a, b) {
            var aComp = a._uiProps.uiTransformComp;
            var bComp = b._uiProps.uiTransformComp;
            var ca = aComp ? aComp.priority : 0;
            var cb = bComp ? bComp.priority : 0;
            var diff = ca - cb;

            if (diff === 0) {
              return a.getSiblingIndex() - b.getSiblingIndex();
            }

            return diff;
          });

          this.node.parent._updateSiblingIndex();
        }
      }
    }, {
      key: "contentSize",

      /**
       * @en
       * Size of the UI node.
       *
       * @zh
       * 内容尺寸。
       */
      get: function get() {
        return this._contentSize;
      },
      set: function set(value) {
        if (this._contentSize.equals(value)) {
          return;
        }

        var clone;

        if (_defaultConstants.EDITOR) {
          clone = new _index.Size(this._contentSize);
        }

        this._contentSize.set(value);

        if (_defaultConstants.EDITOR) {
          // @ts-ignore
          this.node.emit(_eventEnum.SystemEventType.SIZE_CHANGED, clone);
        } else {
          this.node.emit(_eventEnum.SystemEventType.SIZE_CHANGED);
        }
      }
    }, {
      key: "width",
      get: function get() {
        return this._contentSize.width;
      },
      set: function set(value) {
        if (this._contentSize.width === value) {
          return;
        }

        var clone;

        if (_defaultConstants.EDITOR) {
          clone = new _index.Size(this._contentSize);
        }

        this._contentSize.width = value;

        if (_defaultConstants.EDITOR) {
          // @ts-ignore
          this.node.emit(_eventEnum.SystemEventType.SIZE_CHANGED, clone);
        } else {
          this.node.emit(_eventEnum.SystemEventType.SIZE_CHANGED);
        }
      }
    }, {
      key: "height",
      get: function get() {
        return this._contentSize.height;
      },
      set: function set(value) {
        if (this.contentSize.height === value) {
          return;
        }

        var clone;

        if (_defaultConstants.EDITOR) {
          clone = new _index.Size(this._contentSize);
        }

        this._contentSize.height = value;

        if (_defaultConstants.EDITOR) {
          // @ts-ignore
          this.node.emit(_eventEnum.SystemEventType.SIZE_CHANGED, clone);
        } else {
          this.node.emit(_eventEnum.SystemEventType.SIZE_CHANGED);
        }
      }
      /**
       * @en
       * Anchor point of the UI node.
       *
       * @zh
       * 锚点位置。
       */

    }, {
      key: "anchorPoint",
      get: function get() {
        return this._anchorPoint;
      },
      set: function set(value) {
        if (this._anchorPoint.equals(value)) {
          return;
        }

        this._anchorPoint.set(value);

        this.node.emit(_eventEnum.SystemEventType.ANCHOR_CHANGED, this._anchorPoint);
      }
    }, {
      key: "anchorX",
      get: function get() {
        return this._anchorPoint.x;
      },
      set: function set(value) {
        if (this._anchorPoint.x === value) {
          return;
        }

        this._anchorPoint.x = value;
        this.node.emit(_eventEnum.SystemEventType.ANCHOR_CHANGED, this._anchorPoint);
      }
    }, {
      key: "anchorY",
      get: function get() {
        return this._anchorPoint.y;
      },
      set: function set(value) {
        if (this._anchorPoint.y === value) {
          return;
        }

        this._anchorPoint.y = value;
        this.node.emit(_eventEnum.SystemEventType.ANCHOR_CHANGED, this._anchorPoint);
      }
      /**
       * @en
       * Render sequence.
       * Note: UI rendering is only about priority.
       *
       * @zh
       * 渲染先后顺序，按照广度渲染排列，按同级节点下进行一次排列。
       */

    }, {
      key: "priority",
      get: function get() {
        return this._priority;
      },
      set: function set(value) {
        if (this._priority === value) {
          return;
        }

        if (this._canvas && this._canvas.node === this.node) {
          cc.warn(9200);
          return;
        }

        this._priority = value;

        this._sortSiblings();
      }
    }, {
      key: "visibility",

      /**
       * @zh
       * 查找被渲染相机。
       */
      get: function get() {
        if (!this._canvas) {
          return -1;
        }

        return this._canvas.visibility;
      }
    }]);

    return UITransformComponent;
  }(_component.Component), _class3.EventType = _eventEnum.SystemEventType, _temp), (_applyDecoratedDescriptor(_class2.prototype, "contentSize", [_dec5], Object.getOwnPropertyDescriptor(_class2.prototype, "contentSize"), _class2.prototype), _applyDecoratedDescriptor(_class2.prototype, "anchorPoint", [_dec6], Object.getOwnPropertyDescriptor(_class2.prototype, "anchorPoint"), _class2.prototype), _applyDecoratedDescriptor(_class2.prototype, "priority", [_dec7], Object.getOwnPropertyDescriptor(_class2.prototype, "priority"), _class2.prototype), _descriptor = _applyDecoratedDescriptor(_class2.prototype, "_priority", [_classDecorator.property], {
    configurable: true,
    enumerable: true,
    writable: true,
    initializer: function initializer() {
      return 0;
    }
  }), _descriptor2 = _applyDecoratedDescriptor(_class2.prototype, "_contentSize", [_classDecorator.property], {
    configurable: true,
    enumerable: true,
    writable: true,
    initializer: function initializer() {
      return new _index.Size(100, 100);
    }
  }), _descriptor3 = _applyDecoratedDescriptor(_class2.prototype, "_anchorPoint", [_classDecorator.property], {
    configurable: true,
    enumerable: true,
    writable: true,
    initializer: function initializer() {
      return new _index.Vec2(0.5, 0.5);
    }
  })), _class2)) || _class) || _class) || _class) || _class) || _class);
  _exports.UITransformComponent = UITransformComponent;
  cc.UITransformComponent = UITransformComponent;
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkY6L2plbmtpbnMvd29ya3NwYWNlL0NyZWF0b3JfM0QvZWRpdG9yLTNkL3Jlc291cmNlcy8zZC9lbmdpbmUvY29jb3MvY29yZS9jb21wb25lbnRzL3VpLWJhc2UvdWktdHJhbnNmb3JtLWNvbXBvbmVudC50cyJdLCJuYW1lcyI6WyJfdmVjMmEiLCJWZWMyIiwiX3ZlYzJiIiwiX21hdDRfdGVtcCIsIk1hdDQiLCJfbWF0cml4IiwiX3dvcmxkTWF0cml4IiwiX3plcm9NYXRyaXgiLCJfcmVjdCIsIlJlY3QiLCJVSVRyYW5zZm9ybUNvbXBvbmVudCIsImRpc3BsYXlPcmRlciIsInRvb2x0aXAiLCJleGVjdXRlSW5FZGl0TW9kZSIsIl9jYW52YXMiLCJub2RlIiwiX3VpUHJvcHMiLCJ1aVRyYW5zZm9ybUNvbXAiLCJfdXBkYXRlVmlzaWJpbGl0eSIsIm9uIiwiU3lzdGVtRXZlbnRUeXBlIiwiUEFSRU5UX0NIQU5HRUQiLCJfcGFyZW50Q2hhbmdlZCIsIl9zb3J0U2libGluZ3MiLCJvZmYiLCJzaXplIiwiaGVpZ2h0IiwibG9jQ29udGVudFNpemUiLCJfY29udGVudFNpemUiLCJjbG9uZSIsInVuZGVmaW5lZCIsIndpZHRoIiwiRURJVE9SIiwiU2l6ZSIsImVtaXQiLCJTSVpFX0NIQU5HRUQiLCJwb2ludCIsInkiLCJsb2NBbmNob3JQb2ludCIsIl9hbmNob3JQb2ludCIsIngiLCJBTkNIT1JfQ0hBTkdFRCIsImxpc3RlbmVyIiwidyIsImgiLCJjYW1lcmFQdCIsInRlc3RQdCIsImNhbnZhcyIsImdldFdvcmxkUlQiLCJtMTIiLCJtMTMiLCJjZW50ZXIiLCJjYyIsInZpc2libGVSZWN0IiwibTAwIiwibTA0IiwibTAxIiwibTA1IiwiaW52ZXJ0IiwidHJhbnNmb3JtTWF0NCIsImdldFdvcmxkTWF0cml4Iiwic3RyaWN0RXF1YWxzIiwibWFzayIsInBhcmVudCIsImkiLCJpbmRleCIsImNvbXAiLCJnZXRDb21wb25lbnQiLCJNYXNrQ29tcG9uZW50IiwiZW5hYmxlZEluSGllcmFyY2h5IiwiaXNIaXQiLCJ3b3JsZFBvaW50Iiwib3V0IiwiVmVjMyIsIm5vZGVQb2ludCIsImZyb21SVFMiLCJnZXRSb3RhdGlvbiIsImdldFBvc2l0aW9uIiwiZ2V0U2NhbGUiLCJyZWN0IiwiZ2V0Qm91bmRpbmdCb3hUbyIsImdldEJvdW5kaW5nQm94IiwicGFyZW50TWF0IiwibXVsdGlwbHkiLCJjaGlsZHJlbiIsImxvY0NoaWxkcmVuIiwiY2hpbGQiLCJhY3RpdmUiLCJ1aVRyYW5zZm9ybSIsImNoaWxkUmVjdCIsInVuaW9uIiwic2V0Iiwid29ybGRNYXRyaXgiLCJweCIsInB5IiwicHoiLCJ3b3JsZFBvc2l0aW9uIiwieiIsImwiLCJhYWJiIiwiY2FudmFzQ29tcCIsInNpYmxpbmdzIiwic29ydCIsImEiLCJiIiwiYUNvbXAiLCJiQ29tcCIsImNhIiwicHJpb3JpdHkiLCJjYiIsImRpZmYiLCJnZXRTaWJsaW5nSW5kZXgiLCJfdXBkYXRlU2libGluZ0luZGV4IiwidmFsdWUiLCJlcXVhbHMiLCJjb250ZW50U2l6ZSIsIl9wcmlvcml0eSIsIndhcm4iLCJ2aXNpYmlsaXR5IiwiQ29tcG9uZW50IiwiRXZlbnRUeXBlIiwicHJvcGVydHkiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUF1Q0EsTUFBTUEsTUFBTSxHQUFHLElBQUlDLFdBQUosRUFBZjs7QUFDQSxNQUFNQyxNQUFNLEdBQUcsSUFBSUQsV0FBSixFQUFmOztBQUNBLE1BQU1FLFVBQVUsR0FBRyxJQUFJQyxXQUFKLEVBQW5COztBQUNBLE1BQU1DLE9BQU8sR0FBRyxJQUFJRCxXQUFKLEVBQWhCOztBQUNBLE1BQU1FLFlBQVksR0FBRyxJQUFJRixXQUFKLEVBQXJCOztBQUNBLE1BQU1HLFdBQVcsR0FBRyxJQUFJSCxXQUFKLENBQVMsQ0FBVCxFQUFZLENBQVosRUFBZSxDQUFmLEVBQWtCLENBQWxCLEVBQXFCLENBQXJCLEVBQXdCLENBQXhCLEVBQTJC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LGNBQS9CLEVBQStDLEtBQUtGLFlBQXBEO0FBQ0g7QUFFRDs7Ozs7Ozs7Ozs7MEJBV2U7QUFDWCxlQUFPLEtBQUs2RSxTQUFaO0FBQ0gsTzt3QkFFWUgsSyxFQUFPO0FBQ2hCLFlBQUksS0FBS0csU0FBTCxLQUFtQkgsS0FBdkIsRUFBOEI7QUFDMUI7QUFDSDs7QUFFRCxZQUFJLEtBQUtuRyxPQUFMLElBQWdCLEtBQUtBLE9BQUwsQ0FBYUMsSUFBYixLQUFzQixLQUFLQSxJQUEvQyxFQUFxRDtBQUNqRHFDLFVBQUFBLEVBQUUsQ0FBQ2lFLElBQUgsQ0FBUSxJQUFSO0FBQ0E7QUFDSDs7QUFFRCxhQUFLRCxTQUFMLEdBQWlCSCxLQUFqQjs7QUFDQSxhQUFLMUYsYUFBTDtBQUNIOzs7O0FBS0Q7Ozs7MEJBSWtCO0FBQ2QsWUFBSSxDQUFDLEtBQUtULE9BQVYsRUFBbUI7QUFDZixpQkFBTyxDQUFDLENBQVI7QUFDSDs7QUFFRCxlQUFPLEtBQUtBLE9BQUwsQ0FBYXdHLFVBQXBCO0FBQ0g7Ozs7SUFqTHFDQyxvQixXQW1MeEJDLFMsR0FBWXBHLDBCLGtpQkFmekJxRyx3Qjs7Ozs7YUFDcUIsQzs7bUZBa0JyQkEsd0I7Ozs7O2FBQ3dCLElBQUl4RixXQUFKLENBQVMsR0FBVCxFQUFjLEdBQWQsQzs7bUZBQ3hCd0Ysd0I7Ozs7O2FBQ3dCLElBQUl4SCxXQUFKLENBQVMsR0FBVCxFQUFjLEdBQWQsQzs7OztBQW1aN0JtRCxFQUFBQSxFQUFFLENBQUMxQyxvQkFBSCxHQUEwQkEsb0JBQTFCIiwic291cmNlc0NvbnRlbnQiOlsiLypcclxuIENvcHlyaWdodCAoYykgMjAxNy0yMDE5IFhpYW1lbiBZYWppIFNvZnR3YXJlIENvLiwgTHRkLlxyXG5cclxuIGh0dHA6Ly93d3cuY29jb3MuY29tXHJcblxyXG4gUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGEgY29weVxyXG4gb2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBlbmdpbmUgc291cmNlIGNvZGUgKHRoZSBcIlNvZnR3YXJlXCIpLCBhIGxpbWl0ZWQsXHJcbiB3b3JsZHdpZGUsIHJveWFsdHktZnJlZSwgbm9uLWFzc2lnbmFibGUsIHJldm9jYWJsZSBhbmQgbm9uLWV4Y2x1c2l2ZSBsaWNlbnNlXHJcbiB0byB1c2UgQ29jb3MgQ3JlYXRvciBzb2xlbHkgdG8gZGV2ZWxvcCBnYW1lcyBvbiB5b3VyIHRhcmdldCBwbGF0Zm9ybXMuIFlvdSBzaGFsbFxyXG4gbm90IHVzZSBDb2NvcyBDcmVhdG9yIHNvZnR3YXJlIGZvciBkZXZlbG9waW5nIG90aGVyIHNvZnR3YXJlIG9yIHRvb2xzIHRoYXQnc1xyXG4gdXNlZCBmb3IgZGV2ZWxvcGluZyBnYW1lcy4gWW91IGFyZSBub3QgZ3JhbnRlZCB0byBwdWJsaXNoLCBkaXN0cmlidXRlLFxyXG4gc3VibGljZW5zZSwgYW5kL29yIHNlbGwgY29waWVzIG9mIENvY29zIENyZWF0b3IuXHJcblxyXG4gVGhlIHNvZnR3YXJlIG9yIHRvb2xzIGluIHRoaXMgTGljZW5zZSBBZ3JlZW1lbnQgYXJlIGxpY2Vuc2VkLCBub3Qgc29sZC5cclxuIFhpYW1lbiBZYWppIFNvZnR3YXJlIENvLiwgTHRkLiByZXNlcnZlcyBhbGwgcmlnaHRzIG5vdCBleHByZXNzbHkgZ3JhbnRlZCB0byB5b3UuXHJcblxyXG4gVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEIFwiQVMgSVNcIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUyBPUlxyXG4gSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFksXHJcbiBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEVcclxuIEFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sIERBTUFHRVMgT1IgT1RIRVJcclxuIExJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HIEZST00sXHJcbiBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElOXHJcbiBUSEUgU09GVFdBUkUuXHJcbiovXHJcblxyXG4vKipcclxuICogQGNhdGVnb3J5IHVpXHJcbiAqL1xyXG5cclxuaW1wb3J0IHsgQ29tcG9uZW50IH0gZnJvbSAnLi4vY29tcG9uZW50JztcclxuaW1wb3J0IHsgY2NjbGFzcywgaGVscCwgZXhlY3V0ZUluRWRpdE1vZGUsIGV4ZWN1dGlvbk9yZGVyLCBtZW51LCBwcm9wZXJ0eSB9IGZyb20gJy4uLy4uL2RhdGEvY2xhc3MtZGVjb3JhdG9yJztcclxuaW1wb3J0IHsgU3lzdGVtRXZlbnRUeXBlIH0gZnJvbSAnLi4vLi4vcGxhdGZvcm0vZXZlbnQtbWFuYWdlci9ldmVudC1lbnVtJztcclxuaW1wb3J0IHsgRXZlbnRMaXN0ZW5lciwgSUxpc3RlbmVyTWFzayB9IGZyb20gJy4uLy4uL3BsYXRmb3JtL2V2ZW50LW1hbmFnZXIvZXZlbnQtbGlzdGVuZXInO1xyXG5pbXBvcnQgeyBNYXQ0LCBSZWN0LCBTaXplLCBWZWMyLCBWZWMzIH0gZnJvbSAnLi4vLi4vbWF0aCc7XHJcbmltcG9ydCB7IGFhYmIgfSBmcm9tICcuLi8uLi9nZW9tZXRyeSc7XHJcbmltcG9ydCB7IENhbnZhc0NvbXBvbmVudCB9IGZyb20gJy4vY2FudmFzLWNvbXBvbmVudCc7XHJcbmltcG9ydCB7IE5vZGUgfSBmcm9tICcuLi8uLi9zY2VuZS1ncmFwaCc7XHJcbmltcG9ydCB7IEVESVRPUiB9IGZyb20gJ2ludGVybmFsOmNvbnN0YW50cyc7XHJcblxyXG5jb25zdCBfdmVjMmEgPSBuZXcgVmVjMigpO1xyXG5jb25zdCBfdmVjMmIgPSBuZXcgVmVjMigpO1xyXG5jb25zdCBfbWF0NF90ZW1wID0gbmV3IE1hdDQoKTtcclxuY29uc3QgX21hdHJpeCA9IG5ldyBNYXQ0KCk7XHJcbmNvbnN0IF93b3JsZE1hdHJpeCA9IG5ldyBNYXQ0KCk7XHJcbmNvbnN0IF96ZXJvTWF0cml4ID0gbmV3IE1hdDQoMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCk7XHJcbmNvbnN0IF9yZWN0ID0gbmV3IFJlY3QoKTtcclxuLyoqXHJcbiAqIEBlblxyXG4gKiBUaGUgY29tcG9uZW50IG9mIHRyYW5zZm9ybSBpbiBVSS5cclxuICpcclxuICogQHpoXHJcbiAqIFVJIOWPmOaNoue7hOS7tuOAglxyXG4gKi9cclxuQGNjY2xhc3MoJ2NjLlVJVHJhbnNmb3JtQ29tcG9uZW50JylcclxuQGhlbHAoJ2kxOG46Y2MuVUlUcmFuc2Zvcm1Db21wb25lbnQnKVxyXG5AZXhlY3V0aW9uT3JkZXIoMTEwKVxyXG5AbWVudSgnVUkvVUlUcmFuc2Zvcm0nKVxyXG5AZXhlY3V0ZUluRWRpdE1vZGVcclxuZXhwb3J0IGNsYXNzIFVJVHJhbnNmb3JtQ29tcG9uZW50IGV4dGVuZHMgQ29tcG9uZW50IHtcclxuXHJcbiAgICAvKipcclxuICAgICAqIEBlblxyXG4gICAgICogU2l6ZSBvZiB0aGUgVUkgbm9kZS5cclxuICAgICAqXHJcbiAgICAgKiBAemhcclxuICAgICAqIOWGheWuueWwuuWvuOOAglxyXG4gICAgICovXHJcbiAgICBAcHJvcGVydHkoe1xyXG4gICAgICAgIGRpc3BsYXlPcmRlcjogMCxcclxuICAgICAgICB0b29sdGlwOiflhoXlrrnlsLrlr7gnLFxyXG4gICAgfSlcclxuICAgIC8vIEBjb25zdGdldFxyXG4gICAgZ2V0IGNvbnRlbnRTaXplICgpOiBSZWFkb25seTxTaXplPiB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2NvbnRlbnRTaXplO1xyXG4gICAgfVxyXG5cclxuICAgIHNldCBjb250ZW50U2l6ZSAodmFsdWUpIHtcclxuICAgICAgICBpZiAodGhpcy5fY29udGVudFNpemUuZXF1YWxzKHZhbHVlKSkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBsZXQgY2xvbmU6IFNpemU7XHJcbiAgICAgICAgaWYgKEVESVRPUikge1xyXG4gICAgICAgICAgICBjbG9uZSA9IG5ldyBTaXplKHRoaXMuX2NvbnRlbnRTaXplKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuX2NvbnRlbnRTaXplLnNldCh2YWx1ZSk7XHJcbiAgICAgICAgaWYgKEVESVRPUikge1xyXG4gICAgICAgICAgICAvLyBAdHMtaWdub3JlXHJcbiAgICAgICAgICAgIHRoaXMubm9kZS5lbWl0KFN5c3RlbUV2ZW50VHlwZS5TSVpFX0NIQU5HRUQsIGNsb25lKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLm5vZGUuZW1pdChTeXN0ZW1FdmVudFR5cGUuU0laRV9DSEFOR0VEKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgfVxyXG5cclxuICAgIGdldCB3aWR0aCAoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2NvbnRlbnRTaXplLndpZHRoO1xyXG4gICAgfVxyXG5cclxuICAgIHNldCB3aWR0aCAodmFsdWUpIHtcclxuICAgICAgICBpZiAodGhpcy5fY29udGVudFNpemUud2lkdGggPT09IHZhbHVlKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGxldCBjbG9uZTogU2l6ZTtcclxuICAgICAgICBpZiAoRURJVE9SKSB7XHJcbiAgICAgICAgICAgIGNsb25lID0gbmV3IFNpemUodGhpcy5fY29udGVudFNpemUpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5fY29udGVudFNpemUud2lkdGggPSB2YWx1ZTtcclxuICAgICAgICBpZiAoRURJVE9SKSB7XHJcbiAgICAgICAgICAgIC8vIEB0cy1pZ25vcmVcclxuICAgICAgICAgICAgdGhpcy5ub2RlLmVtaXQoU3lzdGVtRXZlbnRUeXBlLlNJWkVfQ0hBTkdFRCwgY2xvbmUpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMubm9kZS5lbWl0KFN5c3RlbUV2ZW50VHlwZS5TSVpFX0NIQU5HRUQpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBnZXQgaGVpZ2h0ICgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fY29udGVudFNpemUuaGVpZ2h0O1xyXG4gICAgfVxyXG5cclxuICAgIHNldCBoZWlnaHQgKHZhbHVlKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuY29udGVudFNpemUuaGVpZ2h0ID09PSB2YWx1ZSkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBsZXQgY2xvbmU6IFNpemU7XHJcbiAgICAgICAgaWYgKEVESVRPUikge1xyXG4gICAgICAgICAgICBjbG9uZSA9IG5ldyBTaXplKHRoaXMuX2NvbnRlbnRTaXplKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuX2NvbnRlbnRTaXplLmhlaWdodCA9IHZhbHVlO1xyXG4gICAgICAgIGlmIChFRElUT1IpIHtcclxuICAgICAgICAgICAgLy8gQHRzLWlnbm9yZVxyXG4gICAgICAgICAgICB0aGlzLm5vZGUuZW1pdChTeXN0ZW1FdmVudFR5cGUuU0laRV9DSEFOR0VELCBjbG9uZSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5ub2RlLmVtaXQoU3lzdGVtRXZlbnRUeXBlLlNJWkVfQ0hBTkdFRCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogQGVuXHJcbiAgICAgKiBBbmNob3IgcG9pbnQgb2YgdGhlIFVJIG5vZGUuXHJcbiAgICAgKlxyXG4gICAgICogQHpoXHJcbiAgICAgKiDplJrngrnkvY3nva7jgIJcclxuICAgICAqL1xyXG4gICAgQHByb3BlcnR5KHtcclxuICAgICAgICBkaXNwbGF5T3JkZXI6IDEsXHJcbiAgICAgICAgdG9vbHRpcDon6ZSa54K55L2N572uJyxcclxuICAgIH0pXHJcbiAgICAvLyBAY29uc3RnZXRcclxuICAgIGdldCBhbmNob3JQb2ludCAoKTogUmVhZG9ubHk8VmVjMj4ge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9hbmNob3JQb2ludDtcclxuICAgIH1cclxuXHJcbiAgICBzZXQgYW5jaG9yUG9pbnQgKHZhbHVlKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuX2FuY2hvclBvaW50LmVxdWFscyh2YWx1ZSkpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5fYW5jaG9yUG9pbnQuc2V0KHZhbHVlKTtcclxuICAgICAgICB0aGlzLm5vZGUuZW1pdChTeXN0ZW1FdmVudFR5cGUuQU5DSE9SX0NIQU5HRUQsIHRoaXMuX2FuY2hvclBvaW50KTtcclxuICAgIH1cclxuXHJcbiAgICBnZXQgYW5jaG9yWCAoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2FuY2hvclBvaW50Lng7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0IGFuY2hvclggKHZhbHVlKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuX2FuY2hvclBvaW50LnggPT09IHZhbHVlKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuX2FuY2hvclBvaW50LnggPSB2YWx1ZTtcclxuICAgICAgICB0aGlzLm5vZGUuZW1pdChTeXN0ZW1FdmVudFR5cGUuQU5DSE9SX0NIQU5HRUQsIHRoaXMuX2FuY2hvclBvaW50KTtcclxuICAgIH1cclxuXHJcbiAgICBnZXQgYW5jaG9yWSAoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2FuY2hvclBvaW50Lnk7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0IGFuY2hvclkgKHZhbHVlKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuX2FuY2hvclBvaW50LnkgPT09IHZhbHVlKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuX2FuY2hvclBvaW50LnkgPSB2YWx1ZTtcclxuICAgICAgICB0aGlzLm5vZGUuZW1pdChTeXN0ZW1FdmVudFR5cGUuQU5DSE9SX0NIQU5HRUQsIHRoaXMuX2FuY2hvclBvaW50KTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEBlblxyXG4gICAgICogUmVuZGVyIHNlcXVlbmNlLlxyXG4gICAgICogTm90ZTogVUkgcmVuZGVyaW5nIGlzIG9ubHkgYWJvdXQgcHJpb3JpdHkuXHJcbiAgICAgKlxyXG4gICAgICogQHpoXHJcbiAgICAgKiDmuLLmn5PlhYjlkI7pobrluo/vvIzmjInnhaflub/luqbmuLLmn5PmjpLliJfvvIzmjInlkIznuqfoioLngrnkuIvov5vooYzkuIDmrKHmjpLliJfjgIJcclxuICAgICAqL1xyXG4gICAgQHByb3BlcnR5KHtcclxuICAgICAgICB0b29sdGlwOiAn5riy5p+T5o6S5bqP5LyY5YWI57qnJ1xyXG4gICAgfSlcclxuICAgIGdldCBwcmlvcml0eSgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fcHJpb3JpdHk7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0IHByaW9yaXR5KHZhbHVlKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuX3ByaW9yaXR5ID09PSB2YWx1ZSkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodGhpcy5fY2FudmFzICYmIHRoaXMuX2NhbnZhcy5ub2RlID09PSB0aGlzLm5vZGUpIHtcclxuICAgICAgICAgICAgY2Mud2Fybig5MjAwKTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5fcHJpb3JpdHkgPSB2YWx1ZTtcclxuICAgICAgICB0aGlzLl9zb3J0U2libGluZ3MoKTtcclxuICAgIH1cclxuXHJcbiAgICBAcHJvcGVydHlcclxuICAgIHByb3RlY3RlZCBfcHJpb3JpdHkgPSAwO1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogQHpoXHJcbiAgICAgKiDmn6Xmib7ooqvmuLLmn5Pnm7jmnLrjgIJcclxuICAgICAqL1xyXG4gICAgZ2V0IHZpc2liaWxpdHkgKCkge1xyXG4gICAgICAgIGlmICghdGhpcy5fY2FudmFzKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAtMTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiB0aGlzLl9jYW52YXMudmlzaWJpbGl0eTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgc3RhdGljIEV2ZW50VHlwZSA9IFN5c3RlbUV2ZW50VHlwZTtcclxuXHJcbiAgICBwdWJsaWMgX2NhbnZhczogQ2FudmFzQ29tcG9uZW50IHwgbnVsbCA9IG51bGw7XHJcblxyXG4gICAgQHByb3BlcnR5XHJcbiAgICBwcm90ZWN0ZWQgX2NvbnRlbnRTaXplID0gbmV3IFNpemUoMTAwLCAxMDApO1xyXG4gICAgQHByb3BlcnR5XHJcbiAgICBwcm90ZWN0ZWQgX2FuY2hvclBvaW50ID0gbmV3IFZlYzIoMC41LCAwLjUpO1xyXG5cclxuICAgIHB1YmxpYyBfX3ByZWxvYWQgKCkge1xyXG4gICAgICAgIHRoaXMubm9kZS5fdWlQcm9wcy51aVRyYW5zZm9ybUNvbXAgPSB0aGlzO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBvbkVuYWJsZSgpe1xyXG4gICAgICAgIHRoaXMuX3VwZGF0ZVZpc2liaWxpdHkoKTtcclxuXHJcbiAgICAgICAgdGhpcy5ub2RlLm9uKFN5c3RlbUV2ZW50VHlwZS5QQVJFTlRfQ0hBTkdFRCwgdGhpcy5fcGFyZW50Q2hhbmdlZCwgdGhpcyk7XHJcblxyXG4gICAgICAgIHRoaXMuX3NvcnRTaWJsaW5ncygpO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBvbkRpc2FibGUoKXtcclxuICAgICAgICB0aGlzLm5vZGUub2ZmKFN5c3RlbUV2ZW50VHlwZS5QQVJFTlRfQ0hBTkdFRCwgdGhpcy5fcGFyZW50Q2hhbmdlZCwgdGhpcyk7XHJcbiAgICAgICAgdGhpcy5fY2FudmFzID0gbnVsbDtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgb25EZXN0cm95ICgpIHtcclxuICAgICAgICB0aGlzLm5vZGUuX3VpUHJvcHMudWlUcmFuc2Zvcm1Db21wID0gbnVsbDtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEBlblxyXG4gICAgICogU2V0cyB0aGUgdW50cmFuc2Zvcm1lZCBzaXplIG9mIHRoZSBub2RlLjxici8+XHJcbiAgICAgKiBUaGUgY29udGVudFNpemUgcmVtYWlucyB0aGUgc2FtZSBubyBtYXR0ZXIgaWYgdGhlIG5vZGUgaXMgc2NhbGVkIG9yIHJvdGF0ZWQuPGJyLz5cclxuICAgICAqIEFsbCBub2RlcyBoYXZlIGEgc2l6ZS4gTGF5ZXIgYW5kIFNjZW5lIGhhdmUgdGhlIHNhbWUgc2l6ZSBvZiB0aGUgc2NyZWVuLlxyXG4gICAgICpcclxuICAgICAqIEB6aFxyXG4gICAgICog6K6+572u6IqC54K55Y6f5aeL5aSn5bCP77yM5LiN5Y+X6K+l6IqC54K55piv5ZCm6KKr57yp5pS+5oiW6ICF5peL6L2s55qE5b2x5ZON44CCXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIHNpemUgLSDoioLngrnlhoXlrrnlj5jmjaLnmoTlsLrlr7jmiJbogIXlrr3luqbjgIJcclxuICAgICAqIEBwYXJhbSBoZWlnaHQgLSDoioLngrnlhoXlrrnmnKrlj5jmjaLnmoTpq5jluqbjgIJcclxuICAgICAqIEBleGFtcGxlXHJcbiAgICAgKiBgYGB0eXBlc2NyaXB0XHJcbiAgICAgKiBub2RlLnNldENvbnRlbnRTaXplKGNjLnNpemUoMTAwLCAxMDApKTtcclxuICAgICAqIG5vZGUuc2V0Q29udGVudFNpemUoMTAwLCAxMDApO1xyXG4gICAgICogYGBgXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBzZXRDb250ZW50U2l6ZSAoc2l6ZTogU2l6ZSB8IG51bWJlciwgaGVpZ2h0PzogbnVtYmVyKSB7XHJcbiAgICAgICAgY29uc3QgbG9jQ29udGVudFNpemUgPSB0aGlzLl9jb250ZW50U2l6ZTtcclxuICAgICAgICBsZXQgY2xvbmU6IFNpemU7XHJcbiAgICAgICAgaWYgKGhlaWdodCA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgIHNpemUgPSBzaXplIGFzIFNpemU7XHJcbiAgICAgICAgICAgIGlmICgoc2l6ZS53aWR0aCA9PT0gbG9jQ29udGVudFNpemUud2lkdGgpICYmIChzaXplLmhlaWdodCA9PT0gbG9jQ29udGVudFNpemUuaGVpZ2h0KSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAoRURJVE9SKSB7XHJcbiAgICAgICAgICAgICAgICBjbG9uZSA9IG5ldyBTaXplKHRoaXMuX2NvbnRlbnRTaXplKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgbG9jQ29udGVudFNpemUud2lkdGggPSBzaXplLndpZHRoO1xyXG4gICAgICAgICAgICBsb2NDb250ZW50U2l6ZS5oZWlnaHQgPSBzaXplLmhlaWdodDtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBpZiAoKHNpemUgPT09IGxvY0NvbnRlbnRTaXplLndpZHRoKSAmJiAoaGVpZ2h0ID09PSBsb2NDb250ZW50U2l6ZS5oZWlnaHQpKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmIChFRElUT1IpIHtcclxuICAgICAgICAgICAgICAgIGNsb25lID0gbmV3IFNpemUodGhpcy5fY29udGVudFNpemUpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBsb2NDb250ZW50U2l6ZS53aWR0aCA9IHNpemUgYXMgbnVtYmVyO1xyXG4gICAgICAgICAgICBsb2NDb250ZW50U2l6ZS5oZWlnaHQgPSBoZWlnaHQ7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoRURJVE9SKSB7XHJcbiAgICAgICAgICAgIC8vIEB0cy1pZ25vcmVcclxuICAgICAgICAgICAgdGhpcy5ub2RlLmVtaXQoU3lzdGVtRXZlbnRUeXBlLlNJWkVfQ0hBTkdFRCwgY2xvbmUpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMubm9kZS5lbWl0KFN5c3RlbUV2ZW50VHlwZS5TSVpFX0NIQU5HRUQpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEBlblxyXG4gICAgICogU2V0cyB0aGUgYW5jaG9yIHBvaW50IGluIHBlcmNlbnQuIDxici8+XHJcbiAgICAgKiBhbmNob3IgcG9pbnQgaXMgdGhlIHBvaW50IGFyb3VuZCB3aGljaCBhbGwgdHJhbnNmb3JtYXRpb25zIGFuZCBwb3NpdGlvbmluZyBtYW5pcHVsYXRpb25zIHRha2UgcGxhY2UuIDxici8+XHJcbiAgICAgKiBJdCdzIGxpa2UgYSBwaW4gaW4gdGhlIG5vZGUgd2hlcmUgaXQgaXMgXCJhdHRhY2hlZFwiIHRvIGl0cyBwYXJlbnQuIDxici8+XHJcbiAgICAgKiBUaGUgYW5jaG9yUG9pbnQgaXMgbm9ybWFsaXplZCwgbGlrZSBhIHBlcmNlbnRhZ2UuICgwLDApIG1lYW5zIHRoZSBib3R0b20tbGVmdCBjb3JuZXIgYW5kICgxLDEpIG1lYW5zIHRoZSB0b3AtcmlnaHQgY29ybmVyLjxici8+XHJcbiAgICAgKiBCdXQgeW91IGNhbiB1c2UgdmFsdWVzIGhpZ2hlciB0aGFuICgxLDEpIGFuZCBsb3dlciB0aGFuICgwLDApIHRvby48YnIvPlxyXG4gICAgICogVGhlIGRlZmF1bHQgYW5jaG9yIHBvaW50IGlzICgwLjUsMC41KSwgc28gaXQgc3RhcnRzIGF0IHRoZSBjZW50ZXIgb2YgdGhlIG5vZGUuXHJcbiAgICAgKlxyXG4gICAgICogQHpoXHJcbiAgICAgKiDorr7nva7plJrngrnnmoTnmb7liIbmr5TjgII8YnI+XHJcbiAgICAgKiDplJrngrnlupTnlKjkuo7miYDmnInlj5jmjaLlkozlnZDmoIfngrnnmoTmk43kvZzvvIzlroPlsLHlg4/lnKjoioLngrnkuIrov57mjqXlhbbniLboioLngrnnmoTlpKflpLTpkojjgII8YnI+XHJcbiAgICAgKiDplJrngrnmmK/moIflh4bljJbnmoTvvIzlsLHlg4/nmb7liIbmr5TkuIDmoLfjgIIoMO+8jDApIOihqOekuuW3puS4i+inku+8jCgx77yMMSkg6KGo56S65Y+z5LiK6KeS44CCPGJyPlxyXG4gICAgICog5L2G5piv5L2g5Y+v5Lul5L2/55So5q+U77yIMe+8jDHvvInmm7Tpq5jnmoTlgLzmiJbogIXmr5TvvIgw77yMMO+8ieabtOS9jueahOWAvOOAgjxicj5cclxuICAgICAqIOm7mOiupOeahOmUmueCueaYr++8iDAuNe+8jDAuNe+8ie+8jOWboOatpOWug+W8gOWni+S6juiKgueCueeahOS4reW/g+S9jee9ruOAgjxicj5cclxuICAgICAqIOazqOaEj++8mkNyZWF0b3Ig5Lit55qE6ZSa54K55LuF55So5LqO5a6a5L2N5omA5Zyo55qE6IqC54K577yM5a2Q6IqC54K555qE5a6a5L2N5LiN5Y+X5b2x5ZON44CCXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIHBvaW50IC0g6IqC54K56ZSa54K55oiW6IqC54K5IHgg6L206ZSa44CCXHJcbiAgICAgKiBAcGFyYW0geSAtIOiKgueCuSB5IOi9tOmUmuOAglxyXG4gICAgICogQGV4YW1wbGVcclxuICAgICAqIGBgYHR5cGVzY3JpcHRcclxuICAgICAqIG5vZGUuc2V0QW5jaG9yUG9pbnQoY2MudjIoMSwgMSkpO1xyXG4gICAgICogbm9kZS5zZXRBbmNob3JQb2ludCgxLCAxKTtcclxuICAgICAqIGBgYFxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgc2V0QW5jaG9yUG9pbnQgKHBvaW50OiBWZWMyIHwgbnVtYmVyLCB5PzogbnVtYmVyKSB7XHJcbiAgICAgICAgY29uc3QgbG9jQW5jaG9yUG9pbnQgPSB0aGlzLl9hbmNob3JQb2ludDtcclxuICAgICAgICBpZiAoeSA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgIHBvaW50ID0gcG9pbnQgYXMgVmVjMjtcclxuICAgICAgICAgICAgaWYgKChwb2ludC54ID09PSBsb2NBbmNob3JQb2ludC54KSAmJiAocG9pbnQueSA9PT0gbG9jQW5jaG9yUG9pbnQueSkpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBsb2NBbmNob3JQb2ludC54ID0gcG9pbnQueDtcclxuICAgICAgICAgICAgbG9jQW5jaG9yUG9pbnQueSA9IHBvaW50Lnk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgaWYgKChwb2ludCA9PT0gbG9jQW5jaG9yUG9pbnQueCkgJiYgKHkgPT09IGxvY0FuY2hvclBvaW50LnkpKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgbG9jQW5jaG9yUG9pbnQueCA9IHBvaW50IGFzIG51bWJlcjtcclxuICAgICAgICAgICAgbG9jQW5jaG9yUG9pbnQueSA9IHk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyB0aGlzLnNldExvY2FsRGlydHkoTG9jYWxEaXJ0eUZsYWcuUE9TSVRJT04pO1xyXG4gICAgICAgIC8vIGlmICh0aGlzLl9ldmVudE1hc2sgJiBBTkNIT1JfT04pIHtcclxuICAgICAgICB0aGlzLm5vZGUuZW1pdChTeXN0ZW1FdmVudFR5cGUuQU5DSE9SX0NIQU5HRUQsIHRoaXMuX2FuY2hvclBvaW50KTtcclxuXHJcbiAgICAgICAgLy8gfVxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogQHpoXHJcbiAgICAgKiDlvZPliY3oioLngrnnmoTngrnlh7vorqHnrpfjgIJcclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gcG9pbnQgLSDlsY/luZXngrnjgIJcclxuICAgICAqIEBwYXJhbSBsaXN0ZW5lciAtIOS6i+S7tuebkeWQrOWZqOOAglxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgaXNIaXQgKHBvaW50OiBWZWMyLCBsaXN0ZW5lcj86IEV2ZW50TGlzdGVuZXIpIHtcclxuICAgICAgICBjb25zdCB3ID0gdGhpcy5fY29udGVudFNpemUud2lkdGg7XHJcbiAgICAgICAgY29uc3QgaCA9IHRoaXMuX2NvbnRlbnRTaXplLmhlaWdodDtcclxuICAgICAgICBjb25zdCBjYW1lcmFQdCA9IF92ZWMyYTtcclxuICAgICAgICBjb25zdCB0ZXN0UHQgPSBfdmVjMmI7XHJcblxyXG4gICAgICAgIGNvbnN0IGNhbnZhcyA9IHRoaXMuX2NhbnZhcztcclxuICAgICAgICBpZiAoIWNhbnZhcykge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyDlsIbkuIDkuKrmkYTlg4/mnLrlnZDmoIfns7vkuIvnmoTngrnovazmjaLliLDkuJbnlYzlnZDmoIfns7vkuItcclxuICAgICAgICBjYW52YXMubm9kZS5nZXRXb3JsZFJUKF9tYXQ0X3RlbXApO1xyXG4gICAgICAgIGNvbnN0IG0xMiA9IF9tYXQ0X3RlbXAubTEyO1xyXG4gICAgICAgIGNvbnN0IG0xMyA9IF9tYXQ0X3RlbXAubTEzO1xyXG4gICAgICAgIGNvbnN0IGNlbnRlciA9IGNjLnZpc2libGVSZWN0LmNlbnRlcjtcclxuICAgICAgICBfbWF0NF90ZW1wLm0xMiA9IGNlbnRlci54IC0gKF9tYXQ0X3RlbXAubTAwICogbTEyICsgX21hdDRfdGVtcC5tMDQgKiBtMTMpO1xyXG4gICAgICAgIF9tYXQ0X3RlbXAubTEzID0gY2VudGVyLnkgLSAoX21hdDRfdGVtcC5tMDEgKiBtMTIgKyBfbWF0NF90ZW1wLm0wNSAqIG0xMyk7XHJcbiAgICAgICAgTWF0NC5pbnZlcnQoX21hdDRfdGVtcCwgX21hdDRfdGVtcCk7XHJcbiAgICAgICAgVmVjMi50cmFuc2Zvcm1NYXQ0KGNhbWVyYVB0LCBwb2ludCwgX21hdDRfdGVtcCk7XHJcblxyXG4gICAgICAgIHRoaXMubm9kZS5nZXRXb3JsZE1hdHJpeChfd29ybGRNYXRyaXgpO1xyXG4gICAgICAgIE1hdDQuaW52ZXJ0KF9tYXQ0X3RlbXAsIF93b3JsZE1hdHJpeCk7XHJcbiAgICAgICAgaWYgKE1hdDQuc3RyaWN0RXF1YWxzKF9tYXQ0X3RlbXAsIF96ZXJvTWF0cml4KSkge1xyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFZlYzIudHJhbnNmb3JtTWF0NCh0ZXN0UHQsIGNhbWVyYVB0LCBfbWF0NF90ZW1wKTtcclxuICAgICAgICB0ZXN0UHQueCArPSB0aGlzLl9hbmNob3JQb2ludC54ICogdztcclxuICAgICAgICB0ZXN0UHQueSArPSB0aGlzLl9hbmNob3JQb2ludC55ICogaDtcclxuXHJcbiAgICAgICAgaWYgKHRlc3RQdC54ID49IDAgJiYgdGVzdFB0LnkgPj0gMCAmJiB0ZXN0UHQueCA8PSB3ICYmIHRlc3RQdC55IDw9IGgpIHtcclxuICAgICAgICAgICAgaWYgKGxpc3RlbmVyICYmIGxpc3RlbmVyLm1hc2spIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IG1hc2sgPSBsaXN0ZW5lci5tYXNrIGFzIElMaXN0ZW5lck1hc2s7XHJcbiAgICAgICAgICAgICAgICBsZXQgcGFyZW50OiBhbnkgPSB0aGlzLm5vZGU7XHJcbiAgICAgICAgICAgICAgICAvLyBmaW5kIG1hc2sgcGFyZW50LCBzaG91bGQgaGl0IHRlc3QgaXRcclxuICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBwYXJlbnQgJiYgaSA8IG1hc2suaW5kZXg7ICsraSwgcGFyZW50ID0gcGFyZW50LnBhcmVudCkge1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKHBhcmVudCA9PT0gbWFzay5ub2RlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY29tcCA9IHBhcmVudC5nZXRDb21wb25lbnQoY2MuTWFza0NvbXBvbmVudCk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIChjb21wICYmIGNvbXAuZW5hYmxlZEluSGllcmFyY2h5KSA/IGNvbXAuaXNIaXQoY2FtZXJhUHQpIDogdHJ1ZTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbGlzdGVuZXIubWFzayA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBAZW5cclxuICAgICAqIENvbnZlcnRzIGEgUG9pbnQgdG8gbm9kZSAobG9jYWwpIHNwYWNlIGNvb3JkaW5hdGVzLlxyXG4gICAgICpcclxuICAgICAqIEB6aFxyXG4gICAgICog5bCG5LiA5LiqIFVJIOiKgueCueS4lueVjOWdkOagh+ezu+S4i+eCuei9rOaNouWIsOWPpuS4gOS4qiBVSSDoioLngrkgKOWxgOmDqCkg56m66Ze05Z2Q5qCH57O777yM6L+Z5Liq5Z2Q5qCH57O75Lul6ZSa54K55Li65Y6f54K544CCXHJcbiAgICAgKiDpnZ4gVUkg6IqC54K56L2s5o2i5YiwIFVJIOiKgueCuSjlsYDpg6gpIOepuumXtOWdkOagh+ezu++8jOivt+i1sCBDYW1lcmFDb21wb25lbnQg55qEIGBjb252ZXJ0VG9VSU5vZGVg44CCXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIHdvcmxkUG9pbnQgLSDkuJbnlYzlnZDmoIfngrnjgIJcclxuICAgICAqIEBwYXJhbSBvdXQgLSDovazmjaLlkI7lnZDmoIfjgIJcclxuICAgICAqIEByZXR1cm5zIC0g6L+U5Zue5LiO55uu5qCH6IqC54K555qE55u45a+55L2N572u44CCXHJcbiAgICAgKiBAZXhhbXBsZVxyXG4gICAgICogYGBgdHlwZXNjcmlwdFxyXG4gICAgICogY29uc3QgbmV3VmVjMyA9IHVpVHJhbnNmb3JtLmNvbnZlcnRUb05vZGVTcGFjZUFSKGNjLnYzKDEwMCwgMTAwLCAwKSk7XHJcbiAgICAgKiBgYGBcclxuICAgICAqL1xyXG4gICAgcHVibGljIGNvbnZlcnRUb05vZGVTcGFjZUFSICh3b3JsZFBvaW50OiBWZWMzLCBvdXQ/OiBWZWMzKSB7XHJcbiAgICAgICAgdGhpcy5ub2RlLmdldFdvcmxkTWF0cml4KF93b3JsZE1hdHJpeCk7XHJcbiAgICAgICAgTWF0NC5pbnZlcnQoX21hdDRfdGVtcCwgX3dvcmxkTWF0cml4KTtcclxuICAgICAgICBpZiAoIW91dCkge1xyXG4gICAgICAgICAgICBvdXQgPSBuZXcgVmVjMygpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIFZlYzMudHJhbnNmb3JtTWF0NChvdXQsIHdvcmxkUG9pbnQsIF9tYXQ0X3RlbXApO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogQGVuXHJcbiAgICAgKiBDb252ZXJ0cyBhIFBvaW50IGluIG5vZGUgY29vcmRpbmF0ZXMgdG8gd29ybGQgc3BhY2UgY29vcmRpbmF0ZXMuXHJcbiAgICAgKlxyXG4gICAgICogQHpoXHJcbiAgICAgKiDlsIbot53lvZPliY3oioLngrnlnZDmoIfns7vkuIvnmoTkuIDkuKrngrnovazmjaLliLDkuJbnlYzlnZDmoIfns7vjgIJcclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gbm9kZVBvaW50IC0g6IqC54K55Z2Q5qCH44CCXHJcbiAgICAgKiBAcGFyYW0gb3V0IC0g6L2s5o2i5ZCO5Z2Q5qCH44CCXHJcbiAgICAgKiBAcmV0dXJucyAtIOi/lOWbniBVSSDkuJbnlYzlnZDmoIfns7vjgIJcclxuICAgICAqIEBleGFtcGxlXHJcbiAgICAgKiBgYGB0eXBlc2NyaXB0XHJcbiAgICAgKiBjb25zdCBuZXdWZWMzID0gdWlUcmFuc2Zvcm0uY29udmVydFRvV29ybGRTcGFjZUFSKDMoMTAwLCAxMDAsIDApKTtcclxuICAgICAqIGBgYFxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgY29udmVydFRvV29ybGRTcGFjZUFSIChub2RlUG9pbnQ6IFZlYzMsIG91dD86IFZlYzMpIHtcclxuICAgICAgICB0aGlzLm5vZGUuZ2V0V29ybGRNYXRyaXgoX3dvcmxkTWF0cml4KTtcclxuICAgICAgICBpZiAoIW91dCkge1xyXG4gICAgICAgICAgICBvdXQgPSBuZXcgVmVjMygpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIFZlYzMudHJhbnNmb3JtTWF0NChvdXQsIG5vZGVQb2ludCwgX3dvcmxkTWF0cml4KTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEBlblxyXG4gICAgICogUmV0dXJucyBhIFwibG9jYWxcIiBheGlzIGFsaWduZWQgYm91bmRpbmcgYm94IG9mIHRoZSBub2RlLiA8YnIvPlxyXG4gICAgICogVGhlIHJldHVybmVkIGJveCBpcyByZWxhdGl2ZSBvbmx5IHRvIGl0cyBwYXJlbnQuXHJcbiAgICAgKlxyXG4gICAgICogQHpoXHJcbiAgICAgKiDov5Tlm57niLboioLlnZDmoIfns7vkuIvnmoTovbTlkJHlr7npvZDnmoTljIXlm7Tnm5LjgIJcclxuICAgICAqXHJcbiAgICAgKiBAcmV0dXJuIC0g6IqC54K55aSn5bCP55qE5YyF5Zu055uSXHJcbiAgICAgKiBAZXhhbXBsZVxyXG4gICAgICogYGBgdHlwZXNjcmlwdFxyXG4gICAgICogY29uc3QgYm91bmRpbmdCb3ggPSB1aVRyYW5zZm9ybS5nZXRCb3VuZGluZ0JveCgpO1xyXG4gICAgICogYGBgXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBnZXRCb3VuZGluZ0JveCAoKSB7XHJcbiAgICAgICAgTWF0NC5mcm9tUlRTKF9tYXRyaXgsIHRoaXMubm9kZS5nZXRSb3RhdGlvbigpLCB0aGlzLm5vZGUuZ2V0UG9zaXRpb24oKSwgdGhpcy5ub2RlLmdldFNjYWxlKCkpO1xyXG4gICAgICAgIGNvbnN0IHdpZHRoID0gdGhpcy5fY29udGVudFNpemUud2lkdGg7XHJcbiAgICAgICAgY29uc3QgaGVpZ2h0ID0gdGhpcy5fY29udGVudFNpemUuaGVpZ2h0O1xyXG4gICAgICAgIGNvbnN0IHJlY3QgPSBuZXcgUmVjdChcclxuICAgICAgICAgICAgLXRoaXMuX2FuY2hvclBvaW50LnggKiB3aWR0aCxcclxuICAgICAgICAgICAgLXRoaXMuX2FuY2hvclBvaW50LnkgKiBoZWlnaHQsXHJcbiAgICAgICAgICAgIHdpZHRoLFxyXG4gICAgICAgICAgICBoZWlnaHQpO1xyXG4gICAgICAgIHJlY3QudHJhbnNmb3JtTWF0NChfbWF0cml4KTtcclxuICAgICAgICByZXR1cm4gcmVjdDtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEBlblxyXG4gICAgICogUmV0dXJucyBhIFwid29ybGRcIiBheGlzIGFsaWduZWQgYm91bmRpbmcgYm94IG9mIHRoZSBub2RlLjxici8+XHJcbiAgICAgKiBUaGUgYm91bmRpbmcgYm94IGNvbnRhaW5zIHNlbGYgYW5kIGFjdGl2ZSBjaGlsZHJlbidzIHdvcmxkIGJvdW5kaW5nIGJveC5cclxuICAgICAqXHJcbiAgICAgKiBAemhcclxuICAgICAqIOi/lOWbnuiKgueCueWcqOS4lueVjOWdkOagh+ezu+S4i+eahOWvuem9kOi9tOWQkeeahOWMheWbtOebku+8iEFBQkLvvInjgIJcclxuICAgICAqIOivpei+ueahhuWMheWQq+iHqui6q+WSjOW3sua/gOa0u+eahOWtkOiKgueCueeahOS4lueVjOi+ueahhuOAglxyXG4gICAgICpcclxuICAgICAqIEByZXR1cm5zIC0g6L+U5Zue5LiW55WM5Z2Q5qCH57O75LiL5YyF5Zu055uS44CCXHJcbiAgICAgKiBAZXhhbXBsZVxyXG4gICAgICogYGBgdHlwZXNjcmlwdFxyXG4gICAgICogY29uc3QgbmV3UmVjdCA9IHVpVHJhbnNmb3JtLmdldEJvdW5kaW5nQm94VG9Xb3JsZCgpO1xyXG4gICAgICogYGBgXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBnZXRCb3VuZGluZ0JveFRvV29ybGQgKCkge1xyXG4gICAgICAgIGlmICh0aGlzLm5vZGUucGFyZW50KSB7XHJcbiAgICAgICAgICAgIHRoaXMubm9kZS5wYXJlbnQuZ2V0V29ybGRNYXRyaXgoX3dvcmxkTWF0cml4KTtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0Qm91bmRpbmdCb3hUbyhfd29ybGRNYXRyaXgpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmdldEJvdW5kaW5nQm94KCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogQGVuXHJcbiAgICAgKiBSZXR1cm5zIHRoZSBtaW5pbXVtIGJvdW5kaW5nIGJveCBjb250YWluaW5nIHRoZSBjdXJyZW50IGJvdW5kaW5nIGJveCBhbmQgaXRzIGNoaWxkIG5vZGVzLlxyXG4gICAgICpcclxuICAgICAqIEB6aFxyXG4gICAgICog6L+U5Zue5YyF5ZCr5b2T5YmN5YyF5Zu055uS5Y+K5YW25a2Q6IqC54K55YyF5Zu055uS55qE5pyA5bCP5YyF5Zu055uS44CCXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIHBhcmVudE1hdCAtIOeItuiKgueCueefqemYteOAglxyXG4gICAgICogQHJldHVybnNcclxuICAgICAqL1xyXG4gICAgcHVibGljIGdldEJvdW5kaW5nQm94VG8gKHBhcmVudE1hdDogTWF0NCkge1xyXG4gICAgICAgIE1hdDQuZnJvbVJUUyhfbWF0cml4LCB0aGlzLm5vZGUuZ2V0Um90YXRpb24oKSwgdGhpcy5ub2RlLmdldFBvc2l0aW9uKCksIHRoaXMubm9kZS5nZXRTY2FsZSgpKTtcclxuICAgICAgICBjb25zdCB3aWR0aCA9IHRoaXMuX2NvbnRlbnRTaXplLndpZHRoO1xyXG4gICAgICAgIGNvbnN0IGhlaWdodCA9IHRoaXMuX2NvbnRlbnRTaXplLmhlaWdodDtcclxuICAgICAgICBjb25zdCByZWN0ID0gbmV3IFJlY3QoXHJcbiAgICAgICAgICAgIC10aGlzLl9hbmNob3JQb2ludC54ICogd2lkdGgsXHJcbiAgICAgICAgICAgIC10aGlzLl9hbmNob3JQb2ludC55ICogaGVpZ2h0LFxyXG4gICAgICAgICAgICB3aWR0aCxcclxuICAgICAgICAgICAgaGVpZ2h0KTtcclxuXHJcbiAgICAgICAgTWF0NC5tdWx0aXBseShfd29ybGRNYXRyaXgsIHBhcmVudE1hdCwgX21hdHJpeCk7XHJcbiAgICAgICAgcmVjdC50cmFuc2Zvcm1NYXQ0KF93b3JsZE1hdHJpeCk7XHJcblxyXG4gICAgICAgIC8vIHF1ZXJ5IGNoaWxkJ3MgQm91bmRpbmdCb3hcclxuICAgICAgICBpZiAoIXRoaXMubm9kZS5jaGlsZHJlbikge1xyXG4gICAgICAgICAgICByZXR1cm4gcmVjdDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IGxvY0NoaWxkcmVuID0gdGhpcy5ub2RlLmNoaWxkcmVuO1xyXG4gICAgICAgIGZvciAoY29uc3QgY2hpbGQgb2YgbG9jQ2hpbGRyZW4pIHtcclxuICAgICAgICAgICAgaWYgKGNoaWxkICYmIGNoaWxkLmFjdGl2ZSkge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgdWlUcmFuc2Zvcm0gPSBjaGlsZC5nZXRDb21wb25lbnQoVUlUcmFuc2Zvcm1Db21wb25lbnQpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHVpVHJhbnNmb3JtKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY2hpbGRSZWN0ID0gdWlUcmFuc2Zvcm0uZ2V0Qm91bmRpbmdCb3hUbyhwYXJlbnRNYXQpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChjaGlsZFJlY3QpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgUmVjdC51bmlvbihyZWN0LCByZWN0LCBjaGlsZFJlY3QpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHJlY3Q7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBAZW5cclxuICAgICAqIENvbXB1dGUgdGhlIGNvcnJlc3BvbmRpbmcgYWFiYiBpbiB3b3JsZCBzcGFjZSBmb3IgcmF5Y2FzdC5cclxuICAgICAqXHJcbiAgICAgKiBAemhcclxuICAgICAqIOiuoeeul+WHuuatpCBVSV8yRCDoioLngrnlnKjkuJbnlYznqbrpl7TkuIvnmoQgYWFiYiDljIXlm7Tnm5JcclxuICAgICAqL1xyXG4gICAgcHVibGljIGdldENvbXB1dGVBQUJCIChvdXQ/OiBhYWJiKSB7XHJcbiAgICAgICAgY29uc3Qgd2lkdGggPSB0aGlzLl9jb250ZW50U2l6ZS53aWR0aDtcclxuICAgICAgICBjb25zdCBoZWlnaHQgPSB0aGlzLl9jb250ZW50U2l6ZS5oZWlnaHQ7XHJcbiAgICAgICAgX3JlY3Quc2V0KFxyXG4gICAgICAgICAgICAtdGhpcy5fYW5jaG9yUG9pbnQueCAqIHdpZHRoLFxyXG4gICAgICAgICAgICAtdGhpcy5fYW5jaG9yUG9pbnQueSAqIGhlaWdodCxcclxuICAgICAgICAgICAgd2lkdGgsXHJcbiAgICAgICAgICAgIGhlaWdodCk7XHJcbiAgICAgICAgX3JlY3QudHJhbnNmb3JtTWF0NCh0aGlzLm5vZGUud29ybGRNYXRyaXgpO1xyXG4gICAgICAgIGNvbnN0IHB4ID0gX3JlY3QueCArIF9yZWN0LndpZHRoICogMC41O1xyXG4gICAgICAgIGNvbnN0IHB5ID0gX3JlY3QueSArIF9yZWN0LmhlaWdodCAqIDAuNTs7XHJcbiAgICAgICAgY29uc3QgcHogPSB0aGlzLm5vZGUud29ybGRQb3NpdGlvbi56O1xyXG4gICAgICAgIGNvbnN0IHcgPSBfcmVjdC53aWR0aCAvIDI7XHJcbiAgICAgICAgY29uc3QgaCA9IF9yZWN0LmhlaWdodCAvIDI7XHJcbiAgICAgICAgY29uc3QgbCA9IDAuMDAxO1xyXG4gICAgICAgIGlmIChvdXQgIT0gbnVsbCkge1xyXG4gICAgICAgICAgICBhYWJiLnNldChvdXQsIHB4LCBweSwgcHosIHcsIGgsIGwpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgYWFiYihweCwgcHksIHB6LCB3LCBoLCBsKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIF91cGRhdGVWaXNpYmlsaXR5KCkge1xyXG4gICAgICAgIGxldCBwYXJlbnQgPSB0aGlzLm5vZGU7XHJcbiAgICAgICAgLy8g6I635Y+W6KKr5riy5p+T55u45py655qEIHZpc2liaWxpdHlcclxuICAgICAgICB3aGlsZSAocGFyZW50KSB7XHJcbiAgICAgICAgICAgIGlmIChwYXJlbnQpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGNhbnZhc0NvbXAgPSBwYXJlbnQuZ2V0Q29tcG9uZW50KCdjYy5DYW52YXNDb21wb25lbnQnKSBhcyBDYW52YXNDb21wb25lbnQ7XHJcbiAgICAgICAgICAgICAgICBpZiAoY2FudmFzQ29tcCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2NhbnZhcyA9IGNhbnZhc0NvbXA7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIEB0cy1pZ25vcmVcclxuICAgICAgICAgICAgcGFyZW50ID0gcGFyZW50LnBhcmVudDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJvdGVjdGVkIF9wYXJlbnRDaGFuZ2VkKG5vZGU6IE5vZGUpIHtcclxuICAgICAgICBpZiAodGhpcy5fY2FudmFzICYmIHRoaXMuX2NhbnZhcy5ub2RlID09PSB0aGlzLm5vZGUpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5fc29ydFNpYmxpbmdzKCk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJvdGVjdGVkIF9zb3J0U2libGluZ3MoKSB7XHJcbiAgICAgICAgY29uc3Qgc2libGluZ3MgPSB0aGlzLm5vZGUucGFyZW50ICYmIHRoaXMubm9kZS5wYXJlbnQuY2hpbGRyZW4gYXMgTXV0YWJsZTxOb2RlW10+O1xyXG4gICAgICAgIGlmIChzaWJsaW5ncykge1xyXG4gICAgICAgICAgICBzaWJsaW5ncy5zb3J0KChhLCBiKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBhQ29tcCA9IGEuX3VpUHJvcHMudWlUcmFuc2Zvcm1Db21wO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgYkNvbXAgPSBiLl91aVByb3BzLnVpVHJhbnNmb3JtQ29tcDtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGNhID0gYUNvbXAgPyBhQ29tcC5wcmlvcml0eSA6IDA7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBjYiA9IGJDb21wID8gYkNvbXAucHJpb3JpdHkgOiAwO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgZGlmZiA9IGNhIC0gY2I7XHJcbiAgICAgICAgICAgICAgICBpZiAoZGlmZiA9PT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBhLmdldFNpYmxpbmdJbmRleCgpIC0gYi5nZXRTaWJsaW5nSW5kZXgoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHJldHVybiBkaWZmO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMubm9kZS5wYXJlbnQhLl91cGRhdGVTaWJsaW5nSW5kZXgoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuXHJcbmNjLlVJVHJhbnNmb3JtQ29tcG9uZW50ID0gVUlUcmFuc2Zvcm1Db21wb25lbnQ7XHJcbiJdfQ==