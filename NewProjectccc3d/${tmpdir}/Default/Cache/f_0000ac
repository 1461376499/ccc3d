(function (global, factory) {
  if (typeof define === "function" && define.amd) {
    define(["exports", "../../math/index.js", "../../math/rect.js", "../macro.js", "../sys.js", "./event-manager.js", "./events.js", "./touch.js", "../../default-constants.js"], factory);
  } else if (typeof exports !== "undefined") {
    factory(exports, require("../../math/index.js"), require("../../math/rect.js"), require("../macro.js"), require("../sys.js"), require("./event-manager.js"), require("./events.js"), require("./touch.js"), require("../../default-constants.js"));
  } else {
    var mod = {
      exports: {}
    };
    factory(mod.exports, global.index, global.rect, global.macro, global.sys, global.eventManager, global.events, global.touch, global.defaultConstants);
    global.inputManager = mod.exports;
  }
})(typeof globalThis !== "undefined" ? globalThis : typeof self !== "undefined" ? self : this, function (_exports, _index4, _rect, _macro, _sys, _eventManager, _events, _touch, _defaultConstants) {
  "use strict";

  Object.defineProperty(_exports, "__esModule", {
    value: true
  });
  _exports.default = _exports.Acceleration = void 0;
  _eventManager = _interopRequireDefault(_eventManager);

  function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

  function _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }

  function _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }

  function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

  var TOUCH_TIMEOUT = _macro.macro.TOUCH_TIMEOUT;
  var PORTRAIT = 0;
  var LANDSCAPE_LEFT = -90;
  var PORTRAIT_UPSIDE_DOWN = 180;
  var LANDSCAPE_RIGHT = 90;

  var _didAccelerateFun;

  var _vec2 = new _index4.Vec2();

  var _preLocation = new _index4.Vec2();

  /**
   * @en the device accelerometer reports values for each axis in units of g-force.
   * @zh 设备重力传感器传递的各个轴的数据。
   */
  var Acceleration = function Acceleration() {
    var x = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 0;
    var y = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;
    var z = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;
    var timestamp = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 0;

    _classCallCheck(this, Acceleration);

    this.x = void 0;
    this.y = void 0;
    this.z = void 0;
    this.timestamp = void 0;
    this.x = x;
    this.y = y;
    this.z = z;
    this.timestamp = timestamp;
  };

  _exports.Acceleration = Acceleration;
  cc.internal.Acceleration = Acceleration;
  /**
   *  This class manages all events of input. include: touch, mouse, accelerometer, keyboard
   */

  var InputManager = /*#__PURE__*/function () {
    function InputManager() {
      _classCallCheck(this, InputManager);

      this._mousePressed = false;
      this._isRegisterEvent = false;
      this._preTouchPoint = new _index4.Vec2();
      this._prevMousePoint = new _index4.Vec2();
      this._preTouchPool = [];
      this._preTouchPoolPointer = 0;
      this._touches = [];
      this._touchesIntegerDict = {};
      this._indexBitsUsed = 0;
      this._maxTouches = 8;
      this._accelEnabled = false;
      this._accelInterval = 1 / 5;
      this._accelMinus = 1;
      this._accelCurTime = 0;
      this._acceleration = null;
      this._accelDeviceEvent = null;
      this._glView = null;
      this._pointLocked = false;
    }

    _createClass(InputManager, [{
      key: "handleTouchesBegin",
      value: function handleTouchesBegin(touches) {
        var handleTouches = [];
        var locTouchIntDict = this._touchesIntegerDict;

        for (var i = 0; i < touches.length; ++i) {
          var touch = touches[i];
          var touchID = touch.getID();

          if (touchID === null) {
            continue;
          }

          var _index = locTouchIntDict[touchID];

          if (_index === undefined) {
            var unusedIndex = this._getUnUsedIndex();

            if (unusedIndex === -1) {
              cc.logID(2300, unusedIndex);
              continue;
            } // curTouch = this._touches[unusedIndex] = touch;


            touch.getLocation(_vec2);
            var curTouch = new _touch.Touch(_vec2.x, _vec2.y, touchID);
            this._touches[unusedIndex] = curTouch;
            touch.getPreviousLocation(_vec2);
            curTouch.setPrevPoint(_vec2);
            locTouchIntDict[touchID] = unusedIndex;
            handleTouches.push(curTouch);
          }
        }

        if (handleTouches.length > 0) {
          // this._glView!._convertTouchesWithScale(handleTouches);
          var touchEvent = new _events.EventTouch(handleTouches, false, _events.EventTouch.BEGAN);

          _eventManager.default.dispatchEvent(touchEvent);
        }
      }
    }, {
      key: "handleTouchesMove",
      value: function handleTouchesMove(touches) {
        var handleTouches = [];
        var locTouches = this._touches;

        for (var i = 0; i < touches.length; ++i) {
          var touch = touches[i];
          var touchID = touch.getID();

          if (touchID === null) {
            continue;
          }

          var _index2 = this._touchesIntegerDict[touchID];

          if (_index2 === undefined) {
            // cc.log("if the index doesn't exist, it is an error");
            continue;
          }

          if (locTouches[_index2]) {
            touch.getLocation(_vec2);

            locTouches[_index2].setPoint(_vec2);

            touch.getPreviousLocation(_vec2);

            locTouches[_index2].setPrevPoint(_vec2);

            handleTouches.push(locTouches[_index2]);
          }
        }

        if (handleTouches.length > 0) {
          // this._glView!._convertTouchesWithScale(handleTouches);
          var touchEvent = new _events.EventTouch(handleTouches, false, _events.EventTouch.MOVED);

          _eventManager.default.dispatchEvent(touchEvent);
        }
      }
    }, {
      key: "handleTouchesEnd",
      value: function handleTouchesEnd(touches) {
        var handleTouches = this.getSetOfTouchesEndOrCancel(touches);

        if (handleTouches.length > 0) {
          // this._glView!._convertTouchesWithScale(handleTouches);
          var touchEvent = new _events.EventTouch(handleTouches, false, _events.EventTouch.ENDED);

          _eventManager.default.dispatchEvent(touchEvent);
        }

        this._preTouchPool.length = 0;
      }
    }, {
      key: "handleTouchesCancel",
      value: function handleTouchesCancel(touches) {
        var handleTouches = this.getSetOfTouchesEndOrCancel(touches);

        if (handleTouches.length > 0) {
          // this._glView!._convertTouchesWithScale(handleTouches);
          var touchEvent = new _events.EventTouch(handleTouches, false, _events.EventTouch.CANCELLED);

          _eventManager.default.dispatchEvent(touchEvent);
        }

        this._preTouchPool.length = 0;
      }
    }, {
      key: "getSetOfTouchesEndOrCancel",
      value: function getSetOfTouchesEndOrCancel(touches) {
        var handleTouches = [];
        var locTouches = this._touches;
        var locTouchesIntDict = this._touchesIntegerDict;

        for (var i = 0; i < touches.length; ++i) {
          var touch = touches[i];
          var touchID = touch.getID();

          if (touchID === null) {
            continue;
          }

          var _index3 = locTouchesIntDict[touchID];

          if (_index3 === undefined) {
            // cc.log("if the index doesn't exist, it is an error");
            continue;
          }

          if (locTouches[_index3]) {
            touch.getLocation(_vec2);

            locTouches[_index3].setPoint(_vec2);

            touch.getPreviousLocation(_vec2);

            locTouches[_index3].setPrevPoint(_vec2);

            handleTouches.push(locTouches[_index3]);

            this._removeUsedIndexBit(_index3);

            delete locTouchesIntDict[touchID];
          }
        }

        return handleTouches;
      }
    }, {
      key: "getHTMLElementPosition",
      value: function getHTMLElementPosition(element) {
        if (_sys.sys.platform === _sys.sys.WECHAT_GAME) {
          return {
            left: 0,
            top: 0,
            width: window.innerWidth,
            height: window.innerHeight
          };
        }

        var docElem = document.documentElement;
        var leftOffset = _sys.sys.os === _sys.sys.OS_IOS && _sys.sys.isBrowser ? window.screenLeft : window.pageXOffset;
        leftOffset -= docElem.clientLeft;
        var topOffset = _sys.sys.os === _sys.sys.OS_IOS && _sys.sys.isBrowser ? window.screenTop : window.pageYOffset;
        topOffset -= docElem.clientTop;

        if (element.getBoundingClientRect) {
          var box = element.getBoundingClientRect();
          return {
            left: box.left + leftOffset,
            top: box.top + topOffset,
            width: box.width,
            height: box.height
          };
        } else {
          if (element instanceof HTMLCanvasElement) {
            return {
              left: leftOffset,
              top: topOffset,
              width: element.width,
              height: element.height
            };
          } else {
            return {
              left: leftOffset,
              top: topOffset,
              width: parseInt(element.style.width || '0', undefined),
              height: parseInt(element.style.height || '0', undefined)
            };
          }
        }
      }
    }, {
      key: "getPreTouch",
      value: function getPreTouch(touch) {
        var preTouch = null;
        var locPreTouchPool = this._preTouchPool;
        var id = touch.getID();

        for (var i = locPreTouchPool.length - 1; i >= 0; i--) {
          if (locPreTouchPool[i].getID() === id) {
            preTouch = locPreTouchPool[i];
            break;
          }
        }

        if (!preTouch) {
          preTouch = touch;
        }

        return preTouch;
      }
    }, {
      key: "setPreTouch",
      value: function setPreTouch(touch) {
        var find = false;
        var locPreTouchPool = this._preTouchPool;
        var id = touch.getID();

        for (var i = locPreTouchPool.length - 1; i >= 0; i--) {
          if (locPreTouchPool[i].getID() === id) {
            locPreTouchPool[i] = touch;
            find = true;
            break;
          }
        }

        if (!find) {
          if (locPreTouchPool.length <= 50) {
            locPreTouchPool.push(touch);
          } else {
            locPreTouchPool[this._preTouchPoolPointer] = touch;
            this._preTouchPoolPointer = (this._preTouchPoolPointer + 1) % 50;
          }
        }
      }
    }, {
      key: "getTouchByXY",
      value: function getTouchByXY(event, tx, ty, pos) {
        var locPreTouch = this._preTouchPoint;

        var location = this._glView.convertToLocationInView(tx, ty, pos);

        if (this._pointLocked) {
          location.x = locPreTouch.x + event.movementX;
          location.y = locPreTouch.y - event.movementY;
        }

        var touch = new _touch.Touch(location.x, location.y, 0);
        touch.setPrevPoint(locPreTouch.x, locPreTouch.y);
        locPreTouch.x = location.x;
        locPreTouch.y = location.y;
        return touch;
      }
    }, {
      key: "getMouseEvent",
      value: function getMouseEvent(location, pos, eventType) {
        var locPreMouse = this._prevMousePoint;
        var mouseEvent = new _events.EventMouse(eventType, false, locPreMouse);
        locPreMouse.x = location.x;
        locPreMouse.y = location.y; // this._glView!._convertMouseToLocationInView(locPreMouse, pos);

        this._glView._convertMouseToLocation(locPreMouse, pos);

        mouseEvent.setLocation(locPreMouse.x, locPreMouse.y);
        return mouseEvent;
      }
    }, {
      key: "getPointByEvent",
      value: function getPointByEvent(event, pos) {
        if (event.pageX != null) {
          // not avalable in <= IE8
          return {
            x: event.pageX,
            y: event.pageY
          };
        }

        if (_sys.sys.platform === _sys.sys.WECHAT_GAME) {
          pos.left = 0;
          pos.top = 0;
        } else {
          pos.left -= document.body.scrollLeft;
          pos.top -= document.body.scrollTop;
        }

        return {
          x: event.clientX,
          y: event.clientY
        };
      }
    }, {
      key: "getTouchesByEvent",
      value: function getTouchesByEvent(event, position) {
        var touches = [];
        var locView = this._glView;
        var locPreTouch = this._preTouchPoint;
        var length = event.changedTouches.length;

        for (var i = 0; i < length; i++) {
          // const changedTouch = event.changedTouches.item(i);
          var changedTouch = event.changedTouches[i];

          if (!changedTouch) {
            continue;
          }

          var _location = void 0;

          if (_sys.sys.BROWSER_TYPE_FIREFOX === _sys.sys.browserType) {
            _location = locView.convertToLocationInView(changedTouch.pageX, changedTouch.pageY, position, _vec2);
          } else {
            _location = locView.convertToLocationInView(changedTouch.clientX, changedTouch.clientY, position, _vec2);
          }

          var touch = void 0;

          if (changedTouch.identifier != null) {
            touch = new _touch.Touch(_location.x, _location.y, changedTouch.identifier); // use Touch Pool

            this.getPreTouch(touch).getLocation(_preLocation);
            touch.setPrevPoint(_preLocation.x, _preLocation.y);
            this.setPreTouch(touch);
          } else {
            touch = new _touch.Touch(_location.x, _location.y);
            touch.setPrevPoint(locPreTouch.x, locPreTouch.y);
          }

          locPreTouch.x = _location.x;
          locPreTouch.y = _location.y;
          touches.push(touch);
        }

        return touches;
      }
    }, {
      key: "registerSystemEvent",
      value: function registerSystemEvent(element) {
        if (this._isRegisterEvent || !element) {
          return;
        }

        this._glView = cc.view;
        var prohibition = _sys.sys.isMobile;
        var supportMouse = ('mouse' in _sys.sys.capabilities);
        var supportTouches = ('touches' in _sys.sys.capabilities);

        if (_sys.sys.platform === _sys.sys.WECHAT_GAME) {
          prohibition = false;
          supportTouches = true;
          supportMouse = false;
        } // Register mouse events.


        if (supportMouse) {
          this._registerMouseEvents(element, prohibition);
        } // Register mouse pointer events.


        if (window.navigator.msPointerEnabled) {
          this._registerMousePointerEvents(element);
        } // Register touch events.


        if (supportTouches) {
          this._registerTouchEvents(element);
        } // Register keyboard events.


        if (cc.sys.browserType !== cc.sys.BROWSER_TYPE_WECHAT_GAME_SUB) {
          this._registerKeyboardEvent();
        }

        this._isRegisterEvent = true;
      }
      /**
       * Whether enable accelerometer event.
       */

    }, {
      key: "setAccelerometerEnabled",
      value: function setAccelerometerEnabled(isEnable) {
        if (this._accelEnabled === isEnable) {
          return;
        }

        this._accelEnabled = isEnable;
        var scheduler = cc.director.getScheduler();
        scheduler.enableForTarget(this);

        if (this._accelEnabled) {
          this._registerAccelerometerEvent();

          this._accelCurTime = 0;
          scheduler.scheduleUpdate(this);
        } else {
          this._unregisterAccelerometerEvent();

          this._accelCurTime = 0;
          scheduler.unscheduleUpdate(this);
        }

        if (_defaultConstants.JSB || _defaultConstants.RUNTIME_BASED) {
          // @ts-ignore
          jsb.device.setMotionEnabled(isEnable);
        }
      }
    }, {
      key: "didAccelerate",
      value: function didAccelerate(eventData) {
        if (!this._accelEnabled) {
          return;
        }

        var mAcceleration = this._acceleration;
        var x = 0;
        var y = 0;
        var z = 0; // TODO
        // @ts-ignore

        if (this._accelDeviceEvent === window.DeviceMotionEvent) {
          var deviceMotionEvent = eventData;
          var eventAcceleration = deviceMotionEvent.accelerationIncludingGravity;

          if (eventAcceleration) {
            x = this._accelMinus * (eventAcceleration.x || 0) * 0.1;
            y = this._accelMinus * (eventAcceleration.y || 0) * 0.1;
            z = (eventAcceleration.z || 0) * 0.1;
          }
        } else {
          var deviceOrientationEvent = eventData;
          x = (deviceOrientationEvent.gamma || 0) / 90 * 0.981;
          y = -((deviceOrientationEvent.beta || 0) / 90) * 0.981;
          z = (deviceOrientationEvent.alpha || 0) / 90 * 0.981;
        }

        if (cc.view._isRotated) {
          var tmp = x;
          x = -y;
          y = tmp;
        }

        mAcceleration.x = x;
        mAcceleration.y = y;
        mAcceleration.z = z;
        mAcceleration.timestamp = eventData.timeStamp || Date.now();
        var tmpX = mAcceleration.x;

        if (window.orientation === LANDSCAPE_RIGHT) {
          mAcceleration.x = -mAcceleration.y;
          mAcceleration.y = tmpX;
        } else if (window.orientation === LANDSCAPE_LEFT) {
          mAcceleration.x = mAcceleration.y;
          mAcceleration.y = -tmpX;
        } else if (window.orientation === PORTRAIT_UPSIDE_DOWN) {
          mAcceleration.x = -mAcceleration.x;
          mAcceleration.y = -mAcceleration.y;
        } // fix android acc values are opposite


        if (cc.sys.os === cc.sys.OS_ANDROID && cc.sys.browserType !== cc.sys.BROWSER_TYPE_MOBILE_QQ) {
          mAcceleration.x = -mAcceleration.x;
          mAcceleration.y = -mAcceleration.y;
        }
      }
    }, {
      key: "update",
      value: function update(dt) {
        if (this._accelCurTime > this._accelInterval) {
          this._accelCurTime -= this._accelInterval;

          _eventManager.default.dispatchEvent(new _events.EventAcceleration(this._acceleration));
        }

        this._accelCurTime += dt;
      }
      /**
       * set accelerometer interval value
       * @method setAccelerometerInterval
       * @param {Number} interval
       */

    }, {
      key: "setAccelerometerInterval",
      value: function setAccelerometerInterval(interval) {
        if (this._accelInterval !== interval) {
          this._accelInterval = interval;

          if (_defaultConstants.JSB || _defaultConstants.RUNTIME_BASED) {
            // @ts-ignore
            if (jsb.device && jsb.device.setMotionInterval) {
              jsb.device.setMotionInterval(interval);
            }
          }
        }
      }
    }, {
      key: "_getUnUsedIndex",
      value: function _getUnUsedIndex() {
        var temp = this._indexBitsUsed;
        var now = cc.director.getCurrentTime();

        for (var i = 0; i < this._maxTouches; i++) {
          if (!(temp & 0x00000001)) {
            this._indexBitsUsed |= 1 << i;
            return i;
          } else {
            var touch = this._touches[i];

            if (now - touch.lastModified > TOUCH_TIMEOUT) {
              this._removeUsedIndexBit(i);

              var touchID = touch.getID();

              if (touchID !== null) {
                delete this._touchesIntegerDict[touchID];
              }

              return i;
            }
          }

          temp >>= 1;
        } // all bits are used


        return -1;
      }
    }, {
      key: "_removeUsedIndexBit",
      value: function _removeUsedIndexBit(index) {
        if (index < 0 || index >= this._maxTouches) {
          return;
        }

        var temp = 1 << index;
        temp = ~temp;
        this._indexBitsUsed &= temp;
      }
    }, {
      key: "_registerMouseEvents",
      value: function _registerMouseEvents(element, prohibition) {
        // HACK
        //  - At the same time to trigger the ontouch event and onmouse event
        //  - The function will execute 2 times
        // The known browser:
        //  liebiao
        //  miui
        //  WECHAT
        this._registerPointerLockEvent();

        if (!prohibition) {
          this._registerWindowMouseEvents(element);
        }

        this._registerElementMouseEvents(element, prohibition);
      }
    }, {
      key: "_registerPointerLockEvent",
      value: function _registerPointerLockEvent() {
        var _this = this;

        var lockChangeAlert = function lockChangeAlert() {
          var canvas = cc.game.canvas; // @ts-ignore

          if (document.pointerLockElement === canvas || document.mozPointerLockElement === canvas) {
            _this._pointLocked = true;
          } else {
            _this._pointLocked = false;
          }
        };

        if ('onpointerlockchange' in document) {
          document.addEventListener('pointerlockchange', lockChangeAlert, false);
        } else if ('onmozpointerlockchange' in document) {
          // @ts-ignore
          document.addEventListener('mozpointerlockchange', lockChangeAlert, false);
        }
      }
    }, {
      key: "_registerWindowMouseEvents",
      value: function _registerWindowMouseEvents(element) {
        var _this2 = this;

        window.addEventListener('mousedown', function () {
          _this2._mousePressed = true;
        }, false);
        window.addEventListener('mouseup', function (event) {
          if (!_this2._mousePressed) {
            return;
          }

          _this2._mousePressed = false;

          var position = _this2.getHTMLElementPosition(element);

          var location = _this2.getPointByEvent(event, position);

          var positionRect = (0, _rect.rect)(position.left, position.top, position.width, position.height);

          if (!positionRect.contains(new _index4.Vec2(location.x, location.y))) {
            _this2.handleTouchesEnd([_this2.getTouchByXY(event, location.x, location.y, position)]);

            var _mouseEvent = _this2.getMouseEvent(location, position, _events.EventMouse.UP);

            _mouseEvent.setButton(event.button);

            _eventManager.default.dispatchEvent(_mouseEvent);
          }
        }, false);
      }
    }, {
      key: "_registerElementMouseEvents",
      value: function _registerElementMouseEvents(element, prohibition) {
        var _this3 = this;

        // Register canvas mouse events.
        var listenDOMMouseEvent = function listenDOMMouseEvent(eventName, type, handler) {
          element.addEventListener(eventName, function (event) {
            var pos = _this3.getHTMLElementPosition(element);

            var location = _this3.getPointByEvent(event, pos);

            var mouseEvent = _this3.getMouseEvent(location, pos, type);

            mouseEvent.setButton(event.button);
            handler(event, mouseEvent, location, pos);

            _eventManager.default.dispatchEvent(mouseEvent);

            event.stopPropagation();
            event.preventDefault();
          });
        };

        if (!prohibition) {
          listenDOMMouseEvent('mousedown', _events.EventMouse.DOWN, function (event, mouseEvent, location, pos) {
            _this3._mousePressed = true;

            _this3.handleTouchesBegin([_this3.getTouchByXY(event, location.x, location.y, pos)]);

            element.focus();
          });
          listenDOMMouseEvent('mouseup', _events.EventMouse.UP, function (event, mouseEvent, location, pos) {
            _this3._mousePressed = false;

            _this3.handleTouchesEnd([_this3.getTouchByXY(event, location.x, location.y, pos)]);
          });
          listenDOMMouseEvent('mousemove', _events.EventMouse.MOVE, function (event, mouseEvent, location, pos) {
            _this3.handleTouchesMove([_this3.getTouchByXY(event, location.x, location.y, pos)]);

            if (!_this3._mousePressed) {
              mouseEvent.setButton(_events.EventMouse.BUTTON_MISSING);
            }

            if (event.movementX !== undefined && event.movementY !== undefined) {
              mouseEvent.movementX = event.movementX;
              mouseEvent.movementY = event.movementY;
            }
          });
        } // @ts-ignore


        listenDOMMouseEvent('mousewheel', _events.EventMouse.SCROLL, function (event, mouseEvent, location, pos) {
          mouseEvent.setScrollData(0, event.wheelDelta);
        });
        /* firefox fix */
        // @ts-ignore

        listenDOMMouseEvent('DOMMouseScroll', _events.EventMouse.SCROLL, function (event, mouseEvent, location, pos) {
          mouseEvent.setScrollData(0, event.detail * -120);
        });
      }
    }, {
      key: "_registerMousePointerEvents",
      value: function _registerMousePointerEvents(element) {
        var _this4 = this;

        var _pointerEventsMap = {
          MSPointerDown: this.handleTouchesBegin,
          MSPointerMove: this.handleTouchesMove,
          MSPointerUp: this.handleTouchesEnd,
          MSPointerCancel: this.handleTouchesCancel
        }; // tslint:disable-next-line: forin

        var _loop = function _loop(eventName) {
          var touchEvent = _pointerEventsMap[eventName]; // @ts-ignore

          element.addEventListener(eventName, function (event) {
            var pos = _this4.getHTMLElementPosition(element);

            pos.left -= document.documentElement.scrollLeft;
            pos.top -= document.documentElement.scrollTop;
            touchEvent.call(_this4, [_this4.getTouchByXY(event, event.clientX, event.clientY, pos)]);
            event.stopPropagation();
          }, false);
        };

        for (var eventName in _pointerEventsMap) {
          _loop(eventName);
        }
      }
    }, {
      key: "_registerTouchEvents",
      value: function _registerTouchEvents(element) {
        if (cc.sys.browserType === cc.sys.BROWSER_TYPE_WECHAT_GAME_SUB) {
          this._registerWXGameTouchEvents(element);
        } else {
          this._registerHTMLTouchEvents(element);
        }
      }
    }, {
      key: "_registerWXGameTouchEvents",
      value: function _registerWXGameTouchEvents(element) {
        var _this5 = this;

        var makeTouchListener = function makeTouchListener(touchesHandler) {
          return function (event) {
            var pos = _this5.getHTMLElementPosition(element);

            var body = document.body;
            pos.left -= body.scrollLeft || 0;
            pos.top -= body.scrollTop || 0;
            touchesHandler(_this5.getTouchesByEvent(event, pos));
          };
        };

        wx.onTouchStart(makeTouchListener(function (touchesToHandle) {
          _this5.handleTouchesBegin(touchesToHandle);
        }));
        wx.onTouchEnd(makeTouchListener(function (touchesToHandle) {
          _this5.handleTouchesEnd(touchesToHandle);
        }));
        wx.onTouchMove(makeTouchListener(function (touchesToHandle) {
          _this5.handleTouchesMove(touchesToHandle);
        }));
        wx.onTouchCancel(makeTouchListener(function (touchesToHandle) {
          _this5.handleTouchesCancel(touchesToHandle);
        }));
      }
    }, {
      key: "_registerHTMLTouchEvents",
      value: function _registerHTMLTouchEvents(element) {
        var _this6 = this;

        var makeTouchListener = function makeTouchListener(touchesHandler) {
          return function (event) {
            if (!event.changedTouches) {
              return;
            }

            var pos = _this6.getHTMLElementPosition(element);

            var body = document.body;
            pos.left -= body.scrollLeft || 0;
            pos.top -= body.scrollTop || 0;
            touchesHandler(_this6.getTouchesByEvent(event, pos));
            event.stopPropagation();
            event.preventDefault();
          };
        };

        element.addEventListener('touchstart', makeTouchListener(function (touchesToHandle) {
          _this6.handleTouchesBegin(touchesToHandle);

          if (_sys.sys.platform !== _sys.sys.WECHAT_GAME) {
            element.focus();
          }
        }), false);
        element.addEventListener('touchmove', makeTouchListener(function (touchesToHandle) {
          _this6.handleTouchesMove(touchesToHandle);
        }), false);
        element.addEventListener('touchend', makeTouchListener(function (touchesToHandle) {
          _this6.handleTouchesEnd(touchesToHandle);
        }), false);
        element.addEventListener('touchcancel', makeTouchListener(function (touchesToHandle) {
          _this6.handleTouchesCancel(touchesToHandle);
        }), false);
      }
    }, {
      key: "_registerKeyboardEvent",
      value: function _registerKeyboardEvent() {
        var canvas = cc.game.canvas;
        canvas.addEventListener('keydown', function (event) {
          _eventManager.default.dispatchEvent(new _events.EventKeyboard(event, true));

          event.stopPropagation();
          event.preventDefault();
        }, false);
        canvas.addEventListener('keyup', function (event) {
          _eventManager.default.dispatchEvent(new _events.EventKeyboard(event, false));

          event.stopPropagation();
          event.preventDefault();
        }, false);
      }
    }, {
      key: "_registerAccelerometerEvent",
      value: function _registerAccelerometerEvent() {
        var _this7 = this;

        this._acceleration = new Acceleration(); // TODO
        // @ts-ignore

        this._accelDeviceEvent = window.DeviceMotionEvent || window.DeviceOrientationEvent; // TODO fix DeviceMotionEvent bug on QQ Browser version 4.1 and below.

        if (cc.sys.browserType === cc.sys.BROWSER_TYPE_MOBILE_QQ) {
          // TODO
          // @ts-ignore
          this._accelDeviceEvent = window.DeviceOrientationEvent;
        }

        var _deviceEventType = // TODO
        // @ts-ignore
        this._accelDeviceEvent === window.DeviceMotionEvent ? 'devicemotion' : 'deviceorientation'; // @ts-ignore


        _didAccelerateFun = function _didAccelerateFun() {
          return _this7.didAccelerate.apply(_this7, arguments);
        };

        window.addEventListener(_deviceEventType, _didAccelerateFun, false);
      }
    }, {
      key: "_unregisterAccelerometerEvent",
      value: function _unregisterAccelerometerEvent() {
        var _deviceEventType = // TODO
        // @ts-ignore
        this._accelDeviceEvent === window.DeviceMotionEvent ? 'devicemotion' : 'deviceorientation';

        if (_didAccelerateFun) {
          window.removeEventListener(_deviceEventType, _didAccelerateFun, false);
        }
      }
    }]);

    return InputManager;
  }();

  var inputManager = new InputManager();
  var _default = inputManager;
  _exports.default = _default;
  cc.internal.inputManager = inputManager;
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkY6L2plbmtpbnMvd29ya3NwYWNlL0NyZWF0b3JfM0QvZWRpdG9yLTNkL3Jlc291cmNlcy8zZC9lbmdpbmUvY29jb3MvY29yZS9wbGF0Zm9ybS9ldmVudC1tYW5hZ2VyL2lucHV0LW1hbmFnZXIudHMiXSwibmFtZXMiOlsiVE9VQ0hfVElNRU9VVCIsIm1hY3JvIiwiUE9SVFJBSVQiLCJMQU5EU0NBUEVfTEVGVCIsIlBPUlRSQUlUX1VQU0lERV9ET1dOIiwiTEFORFNDQVBFX1JJR0hUIiwiX2RpZEFjY2VsZXJhdGVGdW4iLCJfdmVjMiIsIlZlYzIiLCJfcHJlTG9jYXRpb24iLCJBY2NlbGVyYXRpb24iLCJ4IiwieSIsInoiLCJ0aW1lc3RhbXAiLCJjYyIsImludGVybmFsIiwiSW5wdXRNYW5hZ2VyIiwiX21vdXNlUHJlc3NlZCIsIl9pc1JlZ2lzdGVyRXZlbnQiLCJfcHJlVG91Y2hQb2ludCIsIl9wcmV2TW91c2VQb2ludCIsIl9wcmVUb3VjaFBvb2wiLCJfcHJlVG91Y2hQb29sUG9pbnRlciIsIl90b3VjaGVzIiwiX3RvdWNoZXNJbnRlZ2VyRGljdCIsIl9pbmRleEJpdHNVc2VkIiwiX21heFRvdWNoZXMiLCJfYWNjZWxFbmFibGVkIiwiX2FjY2VsSW50ZXJ2YWwiLCJfYWNjZWxNaW51cyIsIl9hY2NlbEN1clRpbWUiLCJfYWNjZWxlcmF0aW9uIiwiX2FjY2VsRGV2aWNlRXZlbnQiLCJfZ2xWaWV3IiwiX3BvaW50TG9ja2VkIiwidG91Y2hlcyIsImhhbmRsZVRvdWNoZXMiLCJsb2NUb3VjaEludERpY3QiLCJpIiwibGVuZ3RoIiwidG91Y2giLCJ0b3VjaElEIiwiZ2V0SUQiLCJpbmRleCIsInVuZGVmaW5lZCIsInVudXNlZEluZGV4IiwiX2dldFVuVXNlZEluZGV4IiwibG9nSUQiLCJnZXRMb2NhdGlvbiIsImN1clRvdWNoIiwiVG91Y2giLCJnZXRQcmV2aW91c0xvY2F0aW9uIiwic2V0UHJldlBvaW50IiwicHVzaCIsInRvdWNoRXZlbnQiLCJFdmVudFRvdWNoIiwiQkVHQU4iLCJldmVudE1hbmFnZXIiLCJkaXNwYXRjaEV2ZW50IiwibG9jVG91Y2hlcyIsInNldFBvaW50IiwiTU9WRUQiLCJnZXRTZXRPZlRvdWNoZXNFbmRPckNhbmNlbCIsIkVOREVEIiwiQ0FOQ0VMTEVEIiwibG9jVG91Y2hlc0ludERpY3QiLCJfcmVtb3ZlVXNlZEluZGV4Qml0IiwiZWxlbWVudCIsInN5cyIsInBsYXRmb3JtIiwiV0VDSEFUX0dBTUUiLCJsZWZ0IiwidG9wIiwid2lkdGgiLCJ3aW5kb3ciLCJpbm5lcldpZHRoIiwiaGVpZ2h0IiwiaW5uZXJIZWlnaHQiLCJkb2NFbGVtIiwiZG9jdW1lbnQiLCJkb2N1bWVudEVsZW1lbnQiLCJsZWZ0T2Zmc2V0Iiwib3MiLCJPU19JT1MiLCJpc0Jyb3dzZXIiLCJzY3JlZW5MZWZ0IiwicGFnZVhPZmZzZXQiLCJjbGllbnRMZWZ0IiwidG9wT2Zmc2V0Iiwic2NyZWVuVG9wIiwicGFnZVlPZmZzZXQiLCJjbGllbnRUb3AiLCJnZXRCb3VuZGluZ0NsaWVudFJlY3QiLCJib3giLCJIVE1MQ2FudmFzRWxlbWVudCIsInBhcnNlSW50Iiwic3R5bGUiLCJwcmVUb3VjaCIsImxvY1ByZVRvdWNoUG9vbCIsImlkIiwiZmluZCIsImV2ZW50IiwidHgiLCJ0eSIsInBvcyIsImxvY1ByZVRvdWNoIiwibG9jYXRpb24iLCJjb252ZXJ0VG9Mb2NhdGlvbkluVmlldyIsIm1vdmVtZW50WCIsIm1vdmVtZW50WSIsImV2ZW50VHlwZSIsImxvY1ByZU1vdXNlIiwibW91c2VFdmVudCIsIkV2ZW50TW91c2UiLCJfY29udmVydE1vdXNlVG9Mb2NhdGlvbiIsInNldExvY2F0aW9uIiwicGFnZVgiLCJwYWdlWSIsImJvZHkiLCJzY3JvbGxMZWZ0Iiwic2Nyb2xsVG9wIiwiY2xpZW50WCIsImNsaWVudFkiLCJwb3NpdGlvbiIsImxvY1ZpZXciLCJjaGFuZ2VkVG91Y2hlcyIsImNoYW5nZWRUb3VjaCIsIkJST1dTRVJfVFlQRV9GSVJFRk9YIiwiYnJvd3NlclR5cGUiLCJpZGVudGlmaWVyIiwiZ2V0UHJlVG91Y2giLCJzZXRQcmVUb3VjaCIsInZpZXciLCJwcm9oaWJpdGlvbiIsImlzTW9iaWxlIiwic3VwcG9ydE1vdXNlIiwiY2FwYWJpbGl0aWVzIiwic3VwcG9ydFRvdWNoZXMiLCJfcmVnaXN0ZXJNb3VzZUV2ZW50cyIsIm5hdmlnYXRvciIsIm1zUG9pbnRlckVuYWJsZWQiLCJfcmVnaXN0ZXJNb3VzZVBvaW50ZXJFdmVudHMiLCJfcmVnaXN0ZXJUb3VjaEV2ZW50cyIsIkJST1dTRVJfVFlQRV9XRUNIQVRfR0FNRV9TVUIiLCJfcmVnaXN0ZXJLZXlib2FyZEV2ZW50IiwiaXNFbmFibGUiLCJzY2hlZHVsZXIiLCJkaXJlY3RvciIsImdldFNjaGVkdWxlciIsImVuYWJsZUZvclRhcmdldCIsIl9yZWdpc3RlckFjY2VsZXJvbWV0ZXJFdmVudCIsInNjaGVkdWxlVXBkYXRlIiwiX3VucmVnaXN0ZXJBY2NlbGVyb21ldGVyRXZlbnQiLCJ1bnNjaGVkdWxlVXBkYXRlIiwiSlNCIiwiUlVOVElNRV9CQVNFRCIsImpzYiIsImRldmljZSIsInNldE1vdGlvbkVuYWJsZWQiLCJldmVudERhdGEiLCJtQWNjZWxlcmF0aW9uIiwiRGV2aWNlTW90aW9uRXZlbnQiLCJkZXZpY2VNb3Rpb25FdmVudCIsImV2ZW50QWNjZWxlcmF0aW9uIiwiYWNjZWxlcmF0aW9uSW5jbHVkaW5nR3Jhdml0eSIsImRldmljZU9yaWVudGF0aW9uRXZlbnQiLCJnYW1tYSIsImJldGEiLCJhbHBoYSIsIl9pc1JvdGF0ZWQiLCJ0bXAiLCJ0aW1lU3RhbXAiLCJEYXRlIiwibm93IiwidG1wWCIsIm9yaWVudGF0aW9uIiwiT1NfQU5EUk9JRCIsIkJST1dTRVJfVFlQRV9NT0JJTEVfUVEiLCJkdCIsIkV2ZW50QWNjZWxlcmF0aW9uIiwiaW50ZXJ2YWwiLCJzZXRNb3Rpb25JbnRlcnZhbCIsInRlbXAiLCJnZXRDdXJyZW50VGltZSIsImxhc3RNb2RpZmllZCIsIl9yZWdpc3RlclBvaW50ZXJMb2NrRXZlbnQiLCJfcmVnaXN0ZXJXaW5kb3dNb3VzZUV2ZW50cyIsIl9yZWdpc3RlckVsZW1lbnRNb3VzZUV2ZW50cyIsImxvY2tDaGFuZ2VBbGVydCIsImNhbnZhcyIsImdhbWUiLCJwb2ludGVyTG9ja0VsZW1lbnQiLCJtb3pQb2ludGVyTG9ja0VsZW1lbnQiLCJhZGRFdmVudExpc3RlbmVyIiwiZ2V0SFRNTEVsZW1lbnRQb3NpdGlvbiIsImdldFBvaW50QnlFdmVudCIsInBvc2l0aW9uUmVjdCIsImNvbnRhaW5zIiwiaGFuZGxlVG91Y2hlc0VuZCIsImdldFRvdWNoQnlYWSIsImdldE1vdXNlRXZlbnQiLCJVUCIsInNldEJ1dHRvbiIsImJ1dHRvbiIsImxpc3RlbkRPTU1vdXNlRXZlbnQiLCJldmVudE5hbWUiLCJ0eXBlIiwiaGFuZGxlciIsInN0b3BQcm9wYWdhdGlvbiIsInByZXZlbnREZWZhdWx0IiwiRE9XTiIsImhhbmRsZVRvdWNoZXNCZWdpbiIsImZvY3VzIiwiTU9WRSIsImhhbmRsZVRvdWNoZXNNb3ZlIiwiQlVUVE9OX01JU1NJTkciLCJTQ1JPTEwiLCJzZXRTY3JvbGxEYXRhIiwid2hlZWxEZWx0YSIsImRldGFpbCIsIl9wb2ludGVyRXZlbnRzTWFwIiwiTVNQb2ludGVyRG93biIsIk1TUG9pbnRlck1vdmUiLCJNU1BvaW50ZXJVcCIsIk1TUG9pbnRlckNhbmNlbCIsImhhbmRsZVRvdWNoZXNDYW5jZWwiLCJjYWxsIiwiX3JlZ2lzdGVyV1hHYW1lVG91Y2hFdmVudHMiLCJfcmVnaXN0ZXJIVE1MVG91Y2hFdmVudHMiLCJtYWtlVG91Y2hMaXN0ZW5lciIsInRvdWNoZXNIYW5kbGVyIiwiZ2V0VG91Y2hlc0J5RXZlbnQiLCJ3eCIsIm9uVG91Y2hTdGFydCIsInRvdWNoZXNUb0hhbmRsZSIsIm9uVG91Y2hFbmQiLCJvblRvdWNoTW92ZSIsIm9uVG91Y2hDYW5jZWwiLCJFdmVudEtleWJvYXJkIiwiRGV2aWNlT3JpZW50YXRpb25FdmVudCIsIl9kZXZpY2VFdmVudFR5cGUiLCJkaWRBY2NlbGVyYXRlIiwicmVt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QzNPLGlCQUExQyxFQUE2RCxLQUE3RDtBQUNIOzs7c0RBRXdDO0FBQ3JDLFlBQU0yTyxnQkFBZ0IsR0FDbEI7QUFDQTtBQUNBLGFBQUtoTixpQkFBTCxLQUEyQjBDLE1BQU0sQ0FBQ3VGLGlCQUFsQyxHQUFzRCxjQUF0RCxHQUF1RSxtQkFIM0U7O0FBSUEsWUFBSTVKLGlCQUFKLEVBQXVCO0FBQ25CcUUsVUFBQUEsTUFBTSxDQUFDd0ssbUJBQVAsQ0FBMkJGLGdCQUEzQixFQUE2QzNPLGlCQUE3QyxFQUFnRSxLQUFoRTtBQUNIO0FBQ0o7Ozs7OztBQUdMLE1BQU04TyxZQUFZLEdBQUcsSUFBSW5PLFlBQUosRUFBckI7aUJBRWVtTyxZOztBQUVmck8sRUFBQUEsRUFBRSxDQUFDQyxRQUFILENBQVlvTyxZQUFaLEdBQTJCQSxZQUEzQiIsInNvdXJjZXNDb250ZW50IjpbIi8qXHJcbiBDb3B5cmlnaHQgKGMpIDIwMTEtMjAxMiBjb2NvczJkLXgub3JnXHJcbiBDb3B5cmlnaHQgKGMpIDIwMTMtMjAxNiBDaHVrb25nIFRlY2hub2xvZ2llcyBJbmMuXHJcbiBDb3B5cmlnaHQgKGMpIDIwMTctMjAxOCBYaWFtZW4gWWFqaSBTb2Z0d2FyZSBDby4sIEx0ZC5cclxuXHJcbiBodHRwOi8vd3d3LmNvY29zMmQteC5vcmdcclxuXHJcbiBQZXJtaXNzaW9uIGlzIGhlcmVieSBncmFudGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbiBvYnRhaW5pbmcgYSBjb3B5XHJcbiBvZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZSBcIlNvZnR3YXJlXCIpLCB0byBkZWFsXHJcbiBpbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzXHJcbiB0byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsXHJcbiBjb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXNcclxuIGZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6XHJcblxyXG4gVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUgaW5jbHVkZWQgaW5cclxuIGFsbCBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLlxyXG5cclxuIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCBcIkFTIElTXCIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsIEVYUFJFU1MgT1JcclxuIElNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZLFxyXG4gRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5EIE5PTklORlJJTkdFTUVOVC4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFXHJcbiBBVVRIT1JTIE9SIENPUFlSSUdIVCBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9SIE9USEVSXHJcbiBMSUFCSUxJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBUT1JUIE9SIE9USEVSV0lTRSwgQVJJU0lORyBGUk9NLFxyXG4gT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgU09GVFdBUkUgT1IgVEhFIFVTRSBPUiBPVEhFUiBERUFMSU5HUyBJTlxyXG4gVEhFIFNPRlRXQVJFLlxyXG4qL1xyXG5cclxuLyoqXHJcbiAqIEBoaWRkZW5cclxuICovXHJcblxyXG5pbXBvcnQgeyBWZWMyIH0gZnJvbSAnLi4vLi4vbWF0aC9pbmRleCc7XHJcbmltcG9ydCB7IHJlY3QgfSBmcm9tICcuLi8uLi9tYXRoL3JlY3QnO1xyXG5pbXBvcnQgeyBtYWNybyB9IGZyb20gJy4uL21hY3JvJztcclxuaW1wb3J0IHsgc3lzIH0gZnJvbSAnLi4vc3lzJztcclxuaW1wb3J0IGV2ZW50TWFuYWdlciBmcm9tICcuL2V2ZW50LW1hbmFnZXInO1xyXG5pbXBvcnQgeyBFdmVudEFjY2VsZXJhdGlvbiwgRXZlbnRLZXlib2FyZCwgRXZlbnRNb3VzZSwgRXZlbnRUb3VjaCB9IGZyb20gJy4vZXZlbnRzJztcclxuaW1wb3J0IHsgVG91Y2ggfSBmcm9tICcuL3RvdWNoJztcclxuaW1wb3J0IHsgSlNCLCBSVU5USU1FX0JBU0VEIH0gZnJvbSAnaW50ZXJuYWw6Y29uc3RhbnRzJztcclxuXHJcbmNvbnN0IFRPVUNIX1RJTUVPVVQgPSBtYWNyby5UT1VDSF9USU1FT1VUO1xyXG5cclxuY29uc3QgUE9SVFJBSVQgPSAwO1xyXG5jb25zdCBMQU5EU0NBUEVfTEVGVCA9IC05MDtcclxuY29uc3QgUE9SVFJBSVRfVVBTSURFX0RPV04gPSAxODA7XHJcbmNvbnN0IExBTkRTQ0FQRV9SSUdIVCA9IDkwO1xyXG5cclxubGV0IF9kaWRBY2NlbGVyYXRlRnVuO1xyXG5cclxuY29uc3QgX3ZlYzIgPSBuZXcgVmVjMigpO1xyXG5jb25zdCBfcHJlTG9jYXRpb24gPSBuZXcgVmVjMigpO1xyXG5cclxuaW50ZXJmYWNlIElIVE1MRWxlbWVudFBvc2l0aW9uIHtcclxuICAgIGxlZnQ6IG51bWJlcjtcclxuICAgIHRvcDogbnVtYmVyO1xyXG4gICAgd2lkdGg6IG51bWJlcjtcclxuICAgIGhlaWdodDogbnVtYmVyO1xyXG59XHJcblxyXG5pbnRlcmZhY2UgSVZpZXcge1xyXG4gICAgY29udmVydFRvTG9jYXRpb25JblZpZXcgKHR4OiBudW1iZXIsIHR5OiBudW1iZXIsIGVsZW1lbnRQb3NpdGlvbjogSUhUTUxFbGVtZW50UG9zaXRpb24sIG91dD86IFZlYzIpOiBWZWMyO1xyXG5cclxuICAgIF9jb252ZXJ0TW91c2VUb0xvY2F0aW9uIChwb2ludDogVmVjMiwgZWxlbWVudFBvc2l0aW9uOiBJSFRNTEVsZW1lbnRQb3NpdGlvbik6IHZvaWQ7XHJcbiAgICAvLyBfY29udmVydE1vdXNlVG9Mb2NhdGlvbkluVmlldyAocG9pbnQ6IFZlYzIsIGVsZW1lbnRQb3NpdGlvbjogSUhUTUxFbGVtZW50UG9zaXRpb24pOiB2b2lkO1xyXG5cclxuICAgIC8vIF9jb252ZXJ0VG91Y2hlc1dpdGhTY2FsZSAodG91Y2hlczogVG91Y2hbXSk6IHZvaWQ7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBAZW4gdGhlIGRldmljZSBhY2NlbGVyb21ldGVyIHJlcG9ydHMgdmFsdWVzIGZvciBlYWNoIGF4aXMgaW4gdW5pdHMgb2YgZy1mb3JjZS5cclxuICogQHpoIOiuvuWkh+mHjeWKm+S8oOaEn+WZqOS8oOmAkueahOWQhOS4qui9tOeahOaVsOaNruOAglxyXG4gKi9cclxuZXhwb3J0IGNsYXNzIEFjY2VsZXJhdGlvbiB7XHJcbiAgICBwdWJsaWMgeDogbnVtYmVyO1xyXG4gICAgcHVibGljIHk6IG51bWJlcjtcclxuICAgIHB1YmxpYyB6OiBudW1iZXI7XHJcbiAgICBwdWJsaWMgdGltZXN0YW1wOiBudW1iZXI7XHJcbiAgICBjb25zdHJ1Y3RvciAoeCA9IDAsIHkgPSAwLCB6ID0gMCwgdGltZXN0YW1wID0gMCkge1xyXG4gICAgICAgIHRoaXMueCA9IHg7XHJcbiAgICAgICAgdGhpcy55ID0geTtcclxuICAgICAgICB0aGlzLnogPSB6O1xyXG4gICAgICAgIHRoaXMudGltZXN0YW1wID0gdGltZXN0YW1wO1xyXG4gICAgfVxyXG59XHJcbmNjLmludGVybmFsLkFjY2VsZXJhdGlvbiA9IEFjY2VsZXJhdGlvbjtcclxuXHJcbi8qKlxyXG4gKiAgVGhpcyBjbGFzcyBtYW5hZ2VzIGFsbCBldmVudHMgb2YgaW5wdXQuIGluY2x1ZGU6IHRvdWNoLCBtb3VzZSwgYWNjZWxlcm9tZXRlciwga2V5Ym9hcmRcclxuICovXHJcbmNsYXNzIElucHV0TWFuYWdlciB7XHJcbiAgICBwcml2YXRlIF9tb3VzZVByZXNzZWQgPSBmYWxzZTtcclxuXHJcbiAgICBwcml2YXRlIF9pc1JlZ2lzdGVyRXZlbnQgPSBmYWxzZTtcclxuXHJcbiAgICBwcml2YXRlIF9wcmVUb3VjaFBvaW50ID0gbmV3IFZlYzIoKTtcclxuICAgIHByaXZhdGUgX3ByZXZNb3VzZVBvaW50ID0gbmV3IFZlYzIoKTtcclxuXHJcbiAgICBwcml2YXRlIF9wcmVUb3VjaFBvb2w6IFRvdWNoW10gPSBbXTtcclxuICAgIHByaXZhdGUgX3ByZVRvdWNoUG9vbFBvaW50ZXIgPSAwO1xyXG5cclxuICAgIHByaXZhdGUgX3RvdWNoZXM6IFRvdWNoW10gPSBbXTtcclxuICAgIHByaXZhdGUgX3RvdWNoZXNJbnRlZ2VyRGljdDogeyBbaW5kZXg6IG51bWJlcl06IG51bWJlciB8IHVuZGVmaW5lZDsgfSA9IHsgfTtcclxuXHJcbiAgICBwcml2YXRlIF9pbmRleEJpdHNVc2VkID0gMDtcclxuICAgIHByaXZhdGUgX21heFRvdWNoZXMgPSA4O1xyXG5cclxuICAgIHByaXZhdGUgX2FjY2VsRW5hYmxlZCA9IGZhbHNlO1xyXG4gICAgcHJpdmF0ZSBfYWNjZWxJbnRlcnZhbCA9IDEgLyA1O1xyXG4gICAgcHJpdmF0ZSBfYWNjZWxNaW51cyA9IDE7XHJcbiAgICBwcml2YXRlIF9hY2NlbEN1clRpbWUgPSAwO1xyXG4gICAgcHJpdmF0ZSBfYWNjZWxlcmF0aW9uOiBBY2NlbGVyYXRpb24gfCBudWxsID0gbnVsbDtcclxuICAgIHByaXZhdGUgX2FjY2VsRGV2aWNlRXZlbnQgPSBudWxsO1xyXG5cclxuICAgIHByaXZhdGUgX2dsVmlldzogSVZpZXcgfCBudWxsID0gbnVsbDtcclxuXHJcbiAgICBwcml2YXRlIF9wb2ludExvY2tlZCA9IGZhbHNlO1xyXG5cclxuICAgIHB1YmxpYyBoYW5kbGVUb3VjaGVzQmVnaW4gKHRvdWNoZXM6IFRvdWNoW10pIHtcclxuICAgICAgICBjb25zdCBoYW5kbGVUb3VjaGVzOiBUb3VjaFtdID0gW107XHJcbiAgICAgICAgY29uc3QgbG9jVG91Y2hJbnREaWN0ID0gdGhpcy5fdG91Y2hlc0ludGVnZXJEaWN0O1xyXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdG91Y2hlcy5sZW5ndGg7ICsraSkge1xyXG4gICAgICAgICAgICBjb25zdCB0b3VjaCA9IHRvdWNoZXNbaV07XHJcbiAgICAgICAgICAgIGNvbnN0IHRvdWNoSUQgPSB0b3VjaC5nZXRJRCgpO1xyXG4gICAgICAgICAgICBpZiAodG91Y2hJRCA9PT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgY29udGludWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY29uc3QgaW5kZXggPSBsb2NUb3VjaEludERpY3RbdG91Y2hJRF07XHJcbiAgICAgICAgICAgIGlmIChpbmRleCA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCB1bnVzZWRJbmRleCA9IHRoaXMuX2dldFVuVXNlZEluZGV4KCk7XHJcbiAgICAgICAgICAgICAgICBpZiAodW51c2VkSW5kZXggPT09IC0xKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2MubG9nSUQoMjMwMCwgdW51c2VkSW5kZXgpO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgLy8gY3VyVG91Y2ggPSB0aGlzLl90b3VjaGVzW3VudXNlZEluZGV4XSA9IHRvdWNoO1xyXG4gICAgICAgICAgICAgICAgdG91Y2guZ2V0TG9jYXRpb24oX3ZlYzIpO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgY3VyVG91Y2ggPSBuZXcgVG91Y2goX3ZlYzIueCwgX3ZlYzIueSwgdG91Y2hJRCk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl90b3VjaGVzW3VudXNlZEluZGV4XSA9IGN1clRvdWNoO1xyXG4gICAgICAgICAgICAgICAgdG91Y2guZ2V0UHJldmlvdXNMb2NhdGlvbihfdmVjMik7XHJcbiAgICAgICAgICAgICAgICBjdXJUb3VjaC5zZXRQcmV2UG9pbnQoX3ZlYzIpO1xyXG4gICAgICAgICAgICAgICAgbG9jVG91Y2hJbnREaWN0W3RvdWNoSURdID0gdW51c2VkSW5kZXg7XHJcbiAgICAgICAgICAgICAgICBoYW5kbGVUb3VjaGVzLnB1c2goY3VyVG91Y2gpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChoYW5kbGVUb3VjaGVzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgLy8gdGhpcy5fZ2xWaWV3IS5fY29udmVydFRvdWNoZXNXaXRoU2NhbGUoaGFuZGxlVG91Y2hlcyk7XHJcbiAgICAgICAgICAgIGNvbnN0IHRvdWNoRXZlbnQgPSBuZXcgRXZlbnRUb3VjaChoYW5kbGVUb3VjaGVzLCBmYWxzZSwgRXZlbnRUb3VjaC5CRUdBTik7XHJcbiAgICAgICAgICAgIGV2ZW50TWFuYWdlci5kaXNwYXRjaEV2ZW50KHRvdWNoRXZlbnQpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgaGFuZGxlVG91Y2hlc01vdmUgKHRvdWNoZXM6IFRvdWNoW10pIHtcclxuICAgICAgICBjb25zdCBoYW5kbGVUb3VjaGVzOiBUb3VjaFtdID0gW107XHJcbiAgICAgICAgY29uc3QgbG9jVG91Y2hlcyA9IHRoaXMuX3RvdWNoZXM7XHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0b3VjaGVzLmxlbmd0aDsgKytpKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHRvdWNoID0gdG91Y2hlc1tpXTtcclxuICAgICAgICAgICAgY29uc3QgdG91Y2hJRCA9IHRvdWNoLmdldElEKCk7XHJcbiAgICAgICAgICAgIGlmICh0b3VjaElEID09PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICBjb250aW51ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjb25zdCBpbmRleCA9IHRoaXMuX3RvdWNoZXNJbnRlZ2VyRGljdFt0b3VjaElEXTtcclxuICAgICAgICAgICAgaWYgKGluZGV4ID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgIC8vIGNjLmxvZyhcImlmIHRoZSBpbmRleCBkb2Vzbid0IGV4aXN0LCBpdCBpcyBhbiBlcnJvclwiKTtcclxuICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChsb2NUb3VjaGVzW2luZGV4XSkge1xyXG4gICAgICAgICAgICAgICAgdG91Y2guZ2V0TG9jYXRpb24oX3ZlYzIpO1xyXG4gICAgICAgICAgICAgICAgbG9jVG91Y2hlc1tpbmRleF0uc2V0UG9pbnQoX3ZlYzIpO1xyXG4gICAgICAgICAgICAgICAgdG91Y2guZ2V0UHJldmlvdXNMb2NhdGlvbihfdmVjMik7XHJcbiAgICAgICAgICAgICAgICBsb2NUb3VjaGVzW2luZGV4XS5zZXRQcmV2UG9pbnQoX3ZlYzIpO1xyXG4gICAgICAgICAgICAgICAgaGFuZGxlVG91Y2hlcy5wdXNoKGxvY1RvdWNoZXNbaW5kZXhdKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoaGFuZGxlVG91Y2hlcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgIC8vIHRoaXMuX2dsVmlldyEuX2NvbnZlcnRUb3VjaGVzV2l0aFNjYWxlKGhhbmRsZVRvdWNoZXMpO1xyXG4gICAgICAgICAgICBjb25zdCB0b3VjaEV2ZW50ID0gbmV3IEV2ZW50VG91Y2goaGFuZGxlVG91Y2hlcywgZmFsc2UsIEV2ZW50VG91Y2guTU9WRUQpO1xyXG4gICAgICAgICAgICBldmVudE1hbmFnZXIuZGlzcGF0Y2hFdmVudCh0b3VjaEV2ZW50KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGhhbmRsZVRvdWNoZXNFbmQgKHRvdWNoZXM6IFRvdWNoW10pIHtcclxuICAgICAgICBjb25zdCBoYW5kbGVUb3VjaGVzID0gdGhpcy5nZXRTZXRPZlRvdWNoZXNFbmRPckNhbmNlbCh0b3VjaGVzKTtcclxuICAgICAgICBpZiAoaGFuZGxlVG91Y2hlcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgIC8vIHRoaXMuX2dsVmlldyEuX2NvbnZlcnRUb3VjaGVzV2l0aFNjYWxlKGhhbmRsZVRvdWNoZXMpO1xyXG4gICAgICAgICAgICBjb25zdCB0b3VjaEV2ZW50ID0gbmV3IEV2ZW50VG91Y2goaGFuZGxlVG91Y2hlcywgZmFsc2UsIEV2ZW50VG91Y2guRU5ERUQpO1xyXG4gICAgICAgICAgICBldmVudE1hbmFnZXIuZGlzcGF0Y2hFdmVudCh0b3VjaEV2ZW50KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5fcHJlVG91Y2hQb29sLmxlbmd0aCA9IDA7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGhhbmRsZVRvdWNoZXNDYW5jZWwgKHRvdWNoZXM6IFRvdWNoW10pIHtcclxuICAgICAgICBjb25zdCBoYW5kbGVUb3VjaGVzID0gdGhpcy5nZXRTZXRPZlRvdWNoZXNFbmRPckNhbmNlbCh0b3VjaGVzKTtcclxuICAgICAgICBpZiAoaGFuZGxlVG91Y2hlcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgIC8vIHRoaXMuX2dsVmlldyEuX2NvbnZlcnRUb3VjaGVzV2l0aFNjYWxlKGhhbmRsZVRvdWNoZXMpO1xyXG4gICAgICAgICAgICBjb25zdCB0b3VjaEV2ZW50ID0gbmV3IEV2ZW50VG91Y2goaGFuZGxlVG91Y2hlcywgZmFsc2UsIEV2ZW50VG91Y2guQ0FOQ0VMTEVEKTtcclxuICAgICAgICAgICAgZXZlbnRNYW5hZ2VyLmRpc3BhdGNoRXZlbnQodG91Y2hFdmVudCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuX3ByZVRvdWNoUG9vbC5sZW5ndGggPSAwO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBnZXRTZXRPZlRvdWNoZXNFbmRPckNhbmNlbCAodG91Y2hlczogVG91Y2hbXSkge1xyXG4gICAgICAgIGNvbnN0IGhhbmRsZVRvdWNoZXM6IFRvdWNoW10gPSBbXTtcclxuICAgICAgICBjb25zdCBsb2NUb3VjaGVzID0gdGhpcy5fdG91Y2hlcztcclxuICAgICAgICBjb25zdCBsb2NUb3VjaGVzSW50RGljdCA9IHRoaXMuX3RvdWNoZXNJbnRlZ2VyRGljdDtcclxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRvdWNoZXMubGVuZ3RoOyArK2kpIHtcclxuICAgICAgICAgICAgY29uc3QgdG91Y2ggPSB0b3VjaGVzW2ldO1xyXG4gICAgICAgICAgICBjb25zdCB0b3VjaElEID0gdG91Y2guZ2V0SUQoKTtcclxuICAgICAgICAgICAgaWYgKHRvdWNoSUQgPT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNvbnN0IGluZGV4ID0gbG9jVG91Y2hlc0ludERpY3RbdG91Y2hJRF07XHJcbiAgICAgICAgICAgIGlmIChpbmRleCA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBjYy5sb2coXCJpZiB0aGUgaW5kZXggZG9lc24ndCBleGlzdCwgaXQgaXMgYW4gZXJyb3JcIik7XHJcbiAgICAgICAgICAgICAgICBjb250aW51ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAobG9jVG91Y2hlc1tpbmRleF0pIHtcclxuICAgICAgICAgICAgICAgIHRvdWNoLmdldExvY2F0aW9uKF92ZWMyKTtcclxuICAgICAgICAgICAgICAgIGxvY1RvdWNoZXNbaW5kZXhdLnNldFBvaW50KF92ZWMyKTtcclxuICAgICAgICAgICAgICAgIHRvdWNoLmdldFByZXZpb3VzTG9jYXRpb24oX3ZlYzIpO1xyXG4gICAgICAgICAgICAgICAgbG9jVG91Y2hlc1tpbmRleF0uc2V0UHJldlBvaW50KF92ZWMyKTtcclxuICAgICAgICAgICAgICAgIGhhbmRsZVRvdWNoZXMucHVzaChsb2NUb3VjaGVzW2luZGV4XSk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9yZW1vdmVVc2VkSW5kZXhCaXQoaW5kZXgpO1xyXG4gICAgICAgICAgICAgICAgZGVsZXRlIGxvY1RvdWNoZXNJbnREaWN0W3RvdWNoSURdO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBoYW5kbGVUb3VjaGVzO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBnZXRIVE1MRWxlbWVudFBvc2l0aW9uIChlbGVtZW50OiBIVE1MRWxlbWVudCk6IElIVE1MRWxlbWVudFBvc2l0aW9uIHtcclxuICAgICAgICBpZiAoc3lzLnBsYXRmb3JtID09PSBzeXMuV0VDSEFUX0dBTUUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgIGxlZnQ6IDAsXHJcbiAgICAgICAgICAgICAgICB0b3A6IDAsXHJcbiAgICAgICAgICAgICAgICB3aWR0aDogd2luZG93LmlubmVyV2lkdGgsXHJcbiAgICAgICAgICAgICAgICBoZWlnaHQ6IHdpbmRvdy5pbm5lckhlaWdodCxcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IGRvY0VsZW0gPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQ7XHJcbiAgICAgICAgbGV0IGxlZnRPZmZzZXQgPSBzeXMub3MgPT09IHN5cy5PU19JT1MgJiYgc3lzLmlzQnJvd3NlciA/IHdpbmRvdy5zY3JlZW5MZWZ0IDogd2luZG93LnBhZ2VYT2Zmc2V0O1xyXG4gICAgICAgIGxlZnRPZmZzZXQgLT0gZG9jRWxlbS5jbGllbnRMZWZ0O1xyXG4gICAgICAgIGxldCB0b3BPZmZzZXQgPSBzeXMub3MgPT09IHN5cy5PU19JT1MgJiYgc3lzLmlzQnJvd3NlciA/IHdpbmRvdy5zY3JlZW5Ub3AgOiB3aW5kb3cucGFnZVlPZmZzZXQ7XHJcbiAgICAgICAgdG9wT2Zmc2V0IC09IGRvY0VsZW0uY2xpZW50VG9wO1xyXG4gICAgICAgIGlmIChlbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCkge1xyXG4gICAgICAgICAgICBjb25zdCBib3ggPSBlbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xyXG4gICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgbGVmdDogYm94LmxlZnQgKyBsZWZ0T2Zmc2V0LFxyXG4gICAgICAgICAgICAgICAgdG9wOiBib3gudG9wICsgdG9wT2Zmc2V0LFxyXG4gICAgICAgICAgICAgICAgd2lkdGg6IGJveC53aWR0aCxcclxuICAgICAgICAgICAgICAgIGhlaWdodDogYm94LmhlaWdodCxcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBpZiAoZWxlbWVudCBpbnN0YW5jZW9mIEhUTUxDYW52YXNFbGVtZW50KSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGxlZnQ6IGxlZnRPZmZzZXQsXHJcbiAgICAgICAgICAgICAgICAgICAgdG9wOiB0b3BPZmZzZXQsXHJcbiAgICAgICAgICAgICAgICAgICAgd2lkdGg6IGVsZW1lbnQud2lkdGgsXHJcbiAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiBlbGVtZW50LmhlaWdodCxcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGxlZnQ6IGxlZnRPZmZzZXQsXHJcbiAgICAgICAgICAgICAgICAgICAgdG9wOiB0b3BPZmZzZXQsXHJcbiAgICAgICAgICAgICAgICAgICAgd2lkdGg6IHBhcnNlSW50KGVsZW1lbnQuc3R5bGUud2lkdGggfHwgJzAnLCB1bmRlZmluZWQpLFxyXG4gICAgICAgICAgICAgICAgICAgIGhlaWdodDogcGFyc2VJbnQoZWxlbWVudC5zdHlsZS5oZWlnaHQgfHwgJzAnLCB1bmRlZmluZWQpLFxyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgZ2V0UHJlVG91Y2ggKHRvdWNoOiBUb3VjaCkge1xyXG4gICAgICAgIGxldCBwcmVUb3VjaDogVG91Y2ggfCBudWxsID0gbnVsbDtcclxuICAgICAgICBjb25zdCBsb2NQcmVUb3VjaFBvb2wgPSB0aGlzLl9wcmVUb3VjaFBvb2w7XHJcbiAgICAgICAgY29uc3QgaWQgPSB0b3VjaC5nZXRJRCgpO1xyXG4gICAgICAgIGZvciAobGV0IGkgPSBsb2NQcmVUb3VjaFBvb2wubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHtcclxuICAgICAgICAgICAgaWYgKGxvY1ByZVRvdWNoUG9vbFtpXS5nZXRJRCgpID09PSBpZCkge1xyXG4gICAgICAgICAgICAgICAgcHJlVG91Y2ggPSBsb2NQcmVUb3VjaFBvb2xbaV07XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoIXByZVRvdWNoKSB7XHJcbiAgICAgICAgICAgIHByZVRvdWNoID0gdG91Y2g7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBwcmVUb3VjaDtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgc2V0UHJlVG91Y2ggKHRvdWNoOiBUb3VjaCkge1xyXG4gICAgICAgIGxldCBmaW5kID0gZmFsc2U7XHJcbiAgICAgICAgY29uc3QgbG9jUHJlVG91Y2hQb29sID0gdGhpcy5fcHJlVG91Y2hQb29sO1xyXG4gICAgICAgIGNvbnN0IGlkID0gdG91Y2guZ2V0SUQoKTtcclxuICAgICAgICBmb3IgKGxldCBpID0gbG9jUHJlVG91Y2hQb29sLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7XHJcbiAgICAgICAgICAgIGlmIChsb2NQcmVUb3VjaFBvb2xbaV0uZ2V0SUQoKSA9PT0gaWQpIHtcclxuICAgICAgICAgICAgICAgIGxvY1ByZVRvdWNoUG9vbFtpXSA9IHRvdWNoO1xyXG4gICAgICAgICAgICAgICAgZmluZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoIWZpbmQpIHtcclxuICAgICAgICAgICAgaWYgKGxvY1ByZVRvdWNoUG9vbC5sZW5ndGggPD0gNTApIHtcclxuICAgICAgICAgICAgICAgIGxvY1ByZVRvdWNoUG9vbC5wdXNoKHRvdWNoKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGxvY1ByZVRvdWNoUG9vbFt0aGlzLl9wcmVUb3VjaFBvb2xQb2ludGVyXSA9IHRvdWNoO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fcHJlVG91Y2hQb29sUG9pbnRlciA9ICh0aGlzLl9wcmVUb3VjaFBvb2xQb2ludGVyICsgMSkgJSA1MDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgZ2V0VG91Y2hCeVhZIChldmVudDogTW91c2VFdmVudCwgdHg6IG51bWJlciwgdHk6IG51bWJlciwgcG9zOiBJSFRNTEVsZW1lbnRQb3NpdGlvbikge1xyXG4gICAgICAgIGNvbnN0IGxvY1ByZVRvdWNoID0gdGhpcy5fcHJlVG91Y2hQb2ludDtcclxuICAgICAgICBjb25zdCBsb2NhdGlvbiA9IHRoaXMuX2dsVmlldyEuY29udmVydFRvTG9jYXRpb25JblZpZXcodHgsIHR5LCBwb3MpO1xyXG4gICAgICAgIGlmICh0aGlzLl9wb2ludExvY2tlZCkge1xyXG4gICAgICAgICAgICBsb2NhdGlvbi54ID0gbG9jUHJlVG91Y2gueCArIGV2ZW50Lm1vdmVtZW50WDtcclxuICAgICAgICAgICAgbG9jYXRpb24ueSA9IGxvY1ByZVRvdWNoLnkgLSBldmVudC5tb3ZlbWVudFk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IHRvdWNoID0gbmV3IFRvdWNoKGxvY2F0aW9uLngsICBsb2NhdGlvbi55LCAwKTtcclxuICAgICAgICB0b3VjaC5zZXRQcmV2UG9pbnQobG9jUHJlVG91Y2gueCwgbG9jUHJlVG91Y2gueSk7XHJcbiAgICAgICAgbG9jUHJlVG91Y2gueCA9IGxvY2F0aW9uLng7XHJcbiAgICAgICAgbG9jUHJlVG91Y2gueSA9IGxvY2F0aW9uLnk7XHJcbiAgICAgICAgcmV0dXJuIHRvdWNoO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBnZXRNb3VzZUV2ZW50IChcclxuICAgICAgICBsb2NhdGlvbjogeyB4OiBudW1iZXI7IHk6IG51bWJlcjsgfSwgcG9zOiBJSFRNTEVsZW1lbnRQb3NpdGlvbiwgZXZlbnRUeXBlOiBudW1iZXIpOiBFdmVudE1vdXNlIFxyXG4gICAge1xyXG4gICAgICAgIGNvbnN0IGxvY1ByZU1vdXNlID0gdGhpcy5fcHJldk1vdXNlUG9pbnQ7XHJcbiAgICAgICAgY29uc3QgbW91c2VFdmVudCA9IG5ldyBFdmVudE1vdXNlKGV2ZW50VHlwZSwgZmFsc2UsIGxvY1ByZU1vdXNlKTtcclxuICAgICAgICBsb2NQcmVNb3VzZS54ID0gbG9jYXRpb24ueDtcclxuICAgICAgICBsb2NQcmVNb3VzZS55ID0gbG9jYXRpb24ueTtcclxuICAgICAgICAvLyB0aGlzLl9nbFZpZXchLl9jb252ZXJ0TW91c2VUb0xvY2F0aW9uSW5WaWV3KGxvY1ByZU1vdXNlLCBwb3MpO1xyXG4gICAgICAgIHRoaXMuX2dsVmlldyEuX2NvbnZlcnRNb3VzZVRvTG9jYXRpb24obG9jUHJlTW91c2UsIHBvcyk7XHJcbiAgICAgICAgbW91c2VFdmVudC5zZXRMb2NhdGlvbihsb2NQcmVNb3VzZS54LCBsb2NQcmVNb3VzZS55KTtcclxuICAgICAgICByZXR1cm4gbW91c2VFdmVudDtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgZ2V0UG9pbnRCeUV2ZW50IChldmVudDogTW91c2VFdmVudCwgcG9zOiBJSFRNTEVsZW1lbnRQb3NpdGlvbikge1xyXG4gICAgICAgIGlmIChldmVudC5wYWdlWCAhPSBudWxsKSB7ICAvLyBub3QgYXZhbGFibGUgaW4gPD0gSUU4XHJcbiAgICAgICAgICAgIHJldHVybiB7eDogZXZlbnQucGFnZVgsIHk6IGV2ZW50LnBhZ2VZfTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChzeXMucGxhdGZvcm0gPT09IHN5cy5XRUNIQVRfR0FNRSkge1xyXG4gICAgICAgICAgICBwb3MubGVmdCA9IDA7XHJcbiAgICAgICAgICAgIHBvcy50b3AgPSAwO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHBvcy5sZWZ0IC09IGRvY3VtZW50LmJvZHkuc2Nyb2xsTGVmdDtcclxuICAgICAgICAgICAgcG9zLnRvcCAtPSBkb2N1bWVudC5ib2R5LnNjcm9sbFRvcDtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHt4OiBldmVudC5jbGllbnRYLCB5OiBldmVudC5jbGllbnRZfTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgZ2V0VG91Y2hlc0J5RXZlbnQgKGV2ZW50OiBUb3VjaEV2ZW50LCBwb3NpdGlvbjogSUhUTUxFbGVtZW50UG9zaXRpb24pIHtcclxuICAgICAgICBjb25zdCB0b3VjaGVzOiBUb3VjaFtdID0gW107XHJcbiAgICAgICAgY29uc3QgbG9jVmlldyA9IHRoaXMuX2dsVmlldztcclxuICAgICAgICBjb25zdCBsb2NQcmVUb3VjaCA9IHRoaXMuX3ByZVRvdWNoUG9pbnQ7XHJcblxyXG4gICAgICAgIGNvbnN0IGxlbmd0aCA9IGV2ZW50LmNoYW5nZWRUb3VjaGVzLmxlbmd0aDtcclxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIC8vIGNvbnN0IGNoYW5nZWRUb3VjaCA9IGV2ZW50LmNoYW5nZWRUb3VjaGVzLml0ZW0oaSk7XHJcbiAgICAgICAgICAgIGNvbnN0IGNoYW5nZWRUb3VjaCA9IGV2ZW50LmNoYW5nZWRUb3VjaGVzW2ldO1xyXG4gICAgICAgICAgICBpZiAoIWNoYW5nZWRUb3VjaCkge1xyXG4gICAgICAgICAgICAgICAgY29udGludWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgbGV0IGxvY2F0aW9uO1xyXG4gICAgICAgICAgICBpZiAoc3lzLkJST1dTRVJfVFlQRV9GSVJFRk9YID09PSBzeXMuYnJvd3NlclR5cGUpIHtcclxuICAgICAgICAgICAgICAgIGxvY2F0aW9uID0gbG9jVmlldyEuY29udmVydFRvTG9jYXRpb25JblZpZXcoXHJcbiAgICAgICAgICAgICAgICAgICAgY2hhbmdlZFRvdWNoLnBhZ2VYLCBjaGFuZ2VkVG91Y2gucGFnZVksIHBvc2l0aW9uLCBfdmVjMik7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBsb2NhdGlvbiA9IGxvY1ZpZXchLmNvbnZlcnRUb0xvY2F0aW9uSW5WaWV3KFxyXG4gICAgICAgICAgICAgICAgICAgIGNoYW5nZWRUb3VjaC5jbGllbnRYLCBjaGFuZ2VkVG91Y2guY2xpZW50WSwgcG9zaXRpb24sIF92ZWMyKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBsZXQgdG91Y2g6IFRvdWNoO1xyXG4gICAgICAgICAgICBpZiAoY2hhbmdlZFRvdWNoLmlkZW50aWZpZXIgIT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgdG91Y2ggPSBuZXcgVG91Y2gobG9jYXRpb24ueCwgbG9jYXRpb24ueSwgY2hhbmdlZFRvdWNoLmlkZW50aWZpZXIpO1xyXG4gICAgICAgICAgICAgICAgLy8gdXNlIFRvdWNoIFBvb2xcclxuICAgICAgICAgICAgICAgIHRoaXMuZ2V0UHJlVG91Y2godG91Y2gpLmdldExvY2F0aW9uKF9wcmVMb2NhdGlvbik7XHJcbiAgICAgICAgICAgICAgICB0b3VjaC5zZXRQcmV2UG9pbnQoX3ByZUxvY2F0aW9uLngsIF9wcmVMb2NhdGlvbi55KTtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2V0UHJlVG91Y2godG91Y2gpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdG91Y2ggPSBuZXcgVG91Y2gobG9jYXRpb24ueCwgbG9jYXRpb24ueSk7XHJcbiAgICAgICAgICAgICAgICB0b3VjaC5zZXRQcmV2UG9pbnQobG9jUHJlVG91Y2gueCwgbG9jUHJlVG91Y2gueSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgbG9jUHJlVG91Y2gueCA9IGxvY2F0aW9uLng7XHJcbiAgICAgICAgICAgIGxvY1ByZVRvdWNoLnkgPSBsb2NhdGlvbi55O1xyXG4gICAgICAgICAgICB0b3VjaGVzLnB1c2godG91Y2gpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdG91Y2hlcztcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgcmVnaXN0ZXJTeXN0ZW1FdmVudCAoZWxlbWVudDogSFRNTEVsZW1lbnQgfCBudWxsKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuX2lzUmVnaXN0ZXJFdmVudCB8fCAhZWxlbWVudCkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLl9nbFZpZXcgPSBjYy52aWV3O1xyXG5cclxuICAgICAgICBsZXQgcHJvaGliaXRpb24gPSBzeXMuaXNNb2JpbGU7XHJcbiAgICAgICAgbGV0IHN1cHBvcnRNb3VzZSA9ICgnbW91c2UnIGluIHN5cy5jYXBhYmlsaXRpZXMpO1xyXG4gICAgICAgIGxldCBzdXBwb3J0VG91Y2hlcyA9ICgndG91Y2hlcycgaW4gc3lzLmNhcGFiaWxpdGllcyk7XHJcbiAgICAgICAgaWYgKHN5cy5wbGF0Zm9ybSA9PT0gc3lzLldFQ0hBVF9HQU1FKSB7XHJcbiAgICAgICAgICAgIHByb2hpYml0aW9uID0gZmFsc2U7XHJcbiAgICAgICAgICAgIHN1cHBvcnRUb3VjaGVzID0gdHJ1ZTtcclxuICAgICAgICAgICAgc3VwcG9ydE1vdXNlID0gZmFsc2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBSZWdpc3RlciBtb3VzZSBldmVudHMuXHJcbiAgICAgICAgaWYgKHN1cHBvcnRNb3VzZSkge1xyXG4gICAgICAgICAgICB0aGlzLl9yZWdpc3Rlck1vdXNlRXZlbnRzKGVsZW1lbnQsIHByb2hpYml0aW9uKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIFJlZ2lzdGVyIG1vdXNlIHBvaW50ZXIgZXZlbnRzLlxyXG4gICAgICAgIGlmICh3aW5kb3cubmF2aWdhdG9yLm1zUG9pbnRlckVuYWJsZWQpIHtcclxuICAgICAgICAgICAgdGhpcy5fcmVnaXN0ZXJNb3VzZVBvaW50ZXJFdmVudHMoZWxlbWVudCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBSZWdpc3RlciB0b3VjaCBldmVudHMuXHJcbiAgICAgICAgaWYgKHN1cHBvcnRUb3VjaGVzKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX3JlZ2lzdGVyVG91Y2hFdmVudHMoZWxlbWVudCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBSZWdpc3RlciBrZXlib2FyZCBldmVudHMuXHJcbiAgICAgICAgaWYgKGNjLnN5cy5icm93c2VyVHlwZSAhPT0gY2Muc3lzLkJST1dTRVJfVFlQRV9XRUNIQVRfR0FNRV9TVUIpIHtcclxuICAgICAgICAgICAgdGhpcy5fcmVnaXN0ZXJLZXlib2FyZEV2ZW50KCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLl9pc1JlZ2lzdGVyRXZlbnQgPSB0cnVlO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogV2hldGhlciBlbmFibGUgYWNjZWxlcm9tZXRlciBldmVudC5cclxuICAgICAqL1xyXG4gICAgcHVibGljIHNldEFjY2VsZXJvbWV0ZXJFbmFibGVkIChpc0VuYWJsZTogYm9vbGVhbikge1xyXG4gICAgICAgIGlmICh0aGlzLl9hY2NlbEVuYWJsZWQgPT09IGlzRW5hYmxlKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuX2FjY2VsRW5hYmxlZCA9IGlzRW5hYmxlO1xyXG4gICAgICAgIGNvbnN0IHNjaGVkdWxlciA9IGNjLmRpcmVjdG9yLmdldFNjaGVkdWxlcigpO1xyXG4gICAgICAgIHNjaGVkdWxlci5lbmFibGVGb3JUYXJnZXQodGhpcyk7XHJcbiAgICAgICAgaWYgKHRoaXMuX2FjY2VsRW5hYmxlZCkge1xyXG4gICAgICAgICAgICB0aGlzLl9yZWdpc3RlckFjY2VsZXJvbWV0ZXJFdmVudCgpO1xyXG4gICAgICAgICAgICB0aGlzLl9hY2NlbEN1clRpbWUgPSAwO1xyXG4gICAgICAgICAgICBzY2hlZHVsZXIuc2NoZWR1bGVVcGRhdGUodGhpcyk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5fdW5yZWdpc3RlckFjY2VsZXJvbWV0ZXJFdmVudCgpO1xyXG4gICAgICAgICAgICB0aGlzLl9hY2NlbEN1clRpbWUgPSAwO1xyXG4gICAgICAgICAgICBzY2hlZHVsZXIudW5zY2hlZHVsZVVwZGF0ZSh0aGlzKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChKU0IgfHwgUlVOVElNRV9CQVNFRCkge1xyXG4gICAgICAgICAgICAvLyBAdHMtaWdub3JlXHJcbiAgICAgICAgICAgIGpzYi5kZXZpY2Uuc2V0TW90aW9uRW5hYmxlZChpc0VuYWJsZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBkaWRBY2NlbGVyYXRlIChldmVudERhdGE6IERldmljZU1vdGlvbkV2ZW50IHwgRGV2aWNlT3JpZW50YXRpb25FdmVudCkge1xyXG4gICAgICAgIGlmICghdGhpcy5fYWNjZWxFbmFibGVkKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IG1BY2NlbGVyYXRpb24gPSB0aGlzLl9hY2NlbGVyYXRpb24hO1xyXG5cclxuICAgICAgICBsZXQgeCA9IDA7XHJcbiAgICAgICAgbGV0IHkgPSAwO1xyXG4gICAgICAgIGxldCB6ID0gMDtcclxuXHJcbiAgICAgICAgLy8gVE9ET1xyXG4gICAgICAgIC8vIEB0cy1pZ25vcmVcclxuICAgICAgICBpZiAodGhpcy5fYWNjZWxEZXZpY2VFdmVudCA9PT0gd2luZG93LkRldmljZU1vdGlvbkV2ZW50KSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGRldmljZU1vdGlvbkV2ZW50ID0gZXZlbnREYXRhIGFzIERldmljZU1vdGlvbkV2ZW50O1xyXG4gICAgICAgICAgICBjb25zdCBldmVudEFjY2VsZXJhdGlvbiA9IGRldmljZU1vdGlvbkV2ZW50LmFjY2VsZXJhdGlvbkluY2x1ZGluZ0dyYXZpdHk7XHJcbiAgICAgICAgICAgIGlmIChldmVudEFjY2VsZXJhdGlvbikge1xyXG4gICAgICAgICAgICAgICAgeCA9IHRoaXMuX2FjY2VsTWludXMgKiAoZXZlbnRBY2NlbGVyYXRpb24ueCB8fCAwKSAqIDAuMTtcclxuICAgICAgICAgICAgICAgIHkgPSB0aGlzLl9hY2NlbE1pbnVzICogKGV2ZW50QWNjZWxlcmF0aW9uLnkgfHwgMCkgKiAwLjE7XHJcbiAgICAgICAgICAgICAgICB6ID0gKGV2ZW50QWNjZWxlcmF0aW9uLnogfHwgMCkgKiAwLjE7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBjb25zdCBkZXZpY2VPcmllbnRhdGlvbkV2ZW50ID0gZXZlbnREYXRhIGFzIERldmljZU9yaWVudGF0aW9uRXZlbnQ7XHJcbiAgICAgICAgICAgIHggPSAoKGRldmljZU9yaWVudGF0aW9uRXZlbnQuZ2FtbWEgfHwgMCkgLyA5MCkgKiAwLjk4MTtcclxuICAgICAgICAgICAgeSA9IC0oKGRldmljZU9yaWVudGF0aW9uRXZlbnQuYmV0YSB8fCAwKSAvIDkwKSAqIDAuOTgxO1xyXG4gICAgICAgICAgICB6ID0gKChkZXZpY2VPcmllbnRhdGlvbkV2ZW50LmFscGhhIHx8IDApIC8gOTApICogMC45ODE7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoY2Mudmlldy5faXNSb3RhdGVkKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHRtcCA9IHg7XHJcbiAgICAgICAgICAgIHggPSAteTtcclxuICAgICAgICAgICAgeSA9IHRtcDtcclxuICAgICAgICB9XHJcbiAgICAgICAgbUFjY2VsZXJhdGlvbi54ID0geDtcclxuICAgICAgICBtQWNjZWxlcmF0aW9uLnkgPSB5O1xyXG4gICAgICAgIG1BY2NlbGVyYXRpb24ueiA9IHo7XHJcblxyXG4gICAgICAgIG1BY2NlbGVyYXRpb24udGltZXN0YW1wID0gZXZlbnREYXRhLnRpbWVTdGFtcCB8fCBEYXRlLm5vdygpO1xyXG5cclxuICAgICAgICBjb25zdCB0bXBYID0gbUFjY2VsZXJhdGlvbi54O1xyXG4gICAgICAgIGlmICh3aW5kb3cub3JpZW50YXRpb24gPT09IExBTkRTQ0FQRV9SSUdIVCkge1xyXG4gICAgICAgICAgICBtQWNjZWxlcmF0aW9uLnggPSAtbUFjY2VsZXJhdGlvbi55O1xyXG4gICAgICAgICAgICBtQWNjZWxlcmF0aW9uLnkgPSB0bXBYO1xyXG4gICAgICAgIH0gZWxzZSBpZiAod2luZG93Lm9yaWVudGF0aW9uID09PSBMQU5EU0NBUEVfTEVGVCkge1xyXG4gICAgICAgICAgICBtQWNjZWxlcmF0aW9uLnggPSBtQWNjZWxlcmF0aW9uLnk7XHJcbiAgICAgICAgICAgIG1BY2NlbGVyYXRpb24ueSA9IC10bXBYO1xyXG4gICAgICAgIH0gZWxzZSBpZiAod2luZG93Lm9yaWVudGF0aW9uID09PSBQT1JUUkFJVF9VUFNJREVfRE9XTikge1xyXG4gICAgICAgICAgICBtQWNjZWxlcmF0aW9uLnggPSAtbUFjY2VsZXJhdGlvbi54O1xyXG4gICAgICAgICAgICBtQWNjZWxlcmF0aW9uLnkgPSAtbUFjY2VsZXJhdGlvbi55O1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyBmaXggYW5kcm9pZCBhY2MgdmFsdWVzIGFyZSBvcHBvc2l0ZVxyXG4gICAgICAgIGlmIChjYy5zeXMub3MgPT09IGNjLnN5cy5PU19BTkRST0lEICYmXHJcbiAgICAgICAgICAgIGNjLnN5cy5icm93c2VyVHlwZSAhPT0gY2Muc3lzLkJST1dTRVJfVFlQRV9NT0JJTEVfUVEpIHtcclxuICAgICAgICAgICAgbUFjY2VsZXJhdGlvbi54ID0gLW1BY2NlbGVyYXRpb24ueDtcclxuICAgICAgICAgICAgbUFjY2VsZXJhdGlvbi55ID0gLW1BY2NlbGVyYXRpb24ueTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHVwZGF0ZSAoZHQ6IG51bWJlcikge1xyXG4gICAgICAgIGlmICh0aGlzLl9hY2NlbEN1clRpbWUgPiB0aGlzLl9hY2NlbEludGVydmFsKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX2FjY2VsQ3VyVGltZSAtPSB0aGlzLl9hY2NlbEludGVydmFsO1xyXG4gICAgICAgICAgICBldmVudE1hbmFnZXIuZGlzcGF0Y2hFdmVudChuZXcgRXZlbnRBY2NlbGVyYXRpb24odGhpcy5fYWNjZWxlcmF0aW9uISkpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLl9hY2NlbEN1clRpbWUgKz0gZHQ7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBzZXQgYWNjZWxlcm9tZXRlciBpbnRlcnZhbCB2YWx1ZVxyXG4gICAgICogQG1ldGhvZCBzZXRBY2NlbGVyb21ldGVySW50ZXJ2YWxcclxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSBpbnRlcnZhbFxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgc2V0QWNjZWxlcm9tZXRlckludGVydmFsIChpbnRlcnZhbCkge1xyXG4gICAgICAgIGlmICh0aGlzLl9hY2NlbEludGVydmFsICE9PSBpbnRlcnZhbCkge1xyXG4gICAgICAgICAgICB0aGlzLl9hY2NlbEludGVydmFsID0gaW50ZXJ2YWw7XHJcblxyXG4gICAgICAgICAgICBpZiAoSlNCIHx8IFJVTlRJTUVfQkFTRUQpIHtcclxuICAgICAgICAgICAgICAgIC8vIEB0cy1pZ25vcmVcclxuICAgICAgICAgICAgICAgIGlmIChqc2IuZGV2aWNlICYmIGpzYi5kZXZpY2Uuc2V0TW90aW9uSW50ZXJ2YWwpIHtcclxuICAgICAgICAgICAgICAgICAgICBqc2IuZGV2aWNlLnNldE1vdGlvbkludGVydmFsKGludGVydmFsKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIF9nZXRVblVzZWRJbmRleCAoKSB7XHJcbiAgICAgICAgbGV0IHRlbXAgPSB0aGlzLl9pbmRleEJpdHNVc2VkO1xyXG4gICAgICAgIGNvbnN0IG5vdyA9IGNjLmRpcmVjdG9yLmdldEN1cnJlbnRUaW1lKCk7XHJcblxyXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5fbWF4VG91Y2hlczsgaSsrKSB7XHJcbiAgICAgICAgICAgIGlmICghKHRlbXAgJiAweDAwMDAwMDAxKSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5faW5kZXhCaXRzVXNlZCB8PSAoMSA8PCBpKTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgdG91Y2ggPSB0aGlzLl90b3VjaGVzW2ldO1xyXG4gICAgICAgICAgICAgICAgaWYgKG5vdyAtIHRvdWNoLmxhc3RNb2RpZmllZCA+IFRPVUNIX1RJTUVPVVQpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9yZW1vdmVVc2VkSW5kZXhCaXQoaSk7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgdG91Y2hJRCA9IHRvdWNoLmdldElEKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRvdWNoSUQgIT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIHRoaXMuX3RvdWNoZXNJbnRlZ2VyRGljdFt0b3VjaElEXTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGVtcCA+Pj0gMTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIGFsbCBiaXRzIGFyZSB1c2VkXHJcbiAgICAgICAgcmV0dXJuIC0xO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgX3JlbW92ZVVzZWRJbmRleEJpdCAoaW5kZXgpIHtcclxuICAgICAgICBpZiAoaW5kZXggPCAwIHx8IGluZGV4ID49IHRoaXMuX21heFRvdWNoZXMpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgbGV0IHRlbXAgPSAxIDw8IGluZGV4O1xyXG4gICAgICAgIHRlbXAgPSB+dGVtcDtcclxuICAgICAgICB0aGlzLl9pbmRleEJpdHNVc2VkICY9IHRlbXA7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBfcmVnaXN0ZXJNb3VzZUV2ZW50cyAoZWxlbWVudDogSFRNTEVsZW1lbnQsIHByb2hpYml0aW9uOiBib29sZWFuKSB7XHJcbiAgICAgICAgLy8gSEFDS1xyXG4gICAgICAgIC8vICAtIEF0IHRoZSBzYW1lIHRpbWUgdG8gdHJpZ2dlciB0aGUgb250b3VjaCBldmVudCBhbmQgb25tb3VzZSBldmVudFxyXG4gICAgICAgIC8vICAtIFRoZSBmdW5jdGlvbiB3aWxsIGV4ZWN1dGUgMiB0aW1lc1xyXG4gICAgICAgIC8vIFRoZSBrbm93biBicm93c2VyOlxyXG4gICAgICAgIC8vICBsaWViaWFvXHJcbiAgICAgICAgLy8gIG1pdWlcclxuICAgICAgICAvLyAgV0VDSEFUXHJcbiAgICAgICAgdGhpcy5fcmVnaXN0ZXJQb2ludGVyTG9ja0V2ZW50KCk7XHJcbiAgICAgICAgaWYgKCFwcm9oaWJpdGlvbikge1xyXG4gICAgICAgICAgICB0aGlzLl9yZWdpc3RlcldpbmRvd01vdXNlRXZlbnRzKGVsZW1lbnQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLl9yZWdpc3RlckVsZW1lbnRNb3VzZUV2ZW50cyhlbGVtZW50LCBwcm9oaWJpdGlvbik7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBfcmVnaXN0ZXJQb2ludGVyTG9ja0V2ZW50ICgpIHtcclxuICAgICAgICBjb25zdCBsb2NrQ2hhbmdlQWxlcnQgPSAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGNhbnZhcyA9IGNjLmdhbWUuY2FudmFzO1xyXG4gICAgICAgICAgICAvLyBAdHMtaWdub3JlXHJcbiAgICAgICAgICAgIGlmIChkb2N1bWVudC5wb2ludGVyTG9ja0VsZW1lbnQgPT09IGNhbnZhcyB8fCBkb2N1bWVudC5tb3pQb2ludGVyTG9ja0VsZW1lbnQgPT09IGNhbnZhcyl7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9wb2ludExvY2tlZCA9IHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9wb2ludExvY2tlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgICAgICBpZiAoJ29ucG9pbnRlcmxvY2tjaGFuZ2UnIGluIGRvY3VtZW50KSB7XHJcbiAgICAgICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ3BvaW50ZXJsb2NrY2hhbmdlJywgbG9ja0NoYW5nZUFsZXJ0LCBmYWxzZSk7XHJcbiAgICAgICAgfSBlbHNlIGlmICgnb25tb3pwb2ludGVybG9ja2NoYW5nZScgaW4gZG9jdW1lbnQpIHtcclxuICAgICAgICAgICAgLy8gQHRzLWlnbm9yZVxyXG4gICAgICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdtb3pwb2ludGVybG9ja2NoYW5nZScsIGxvY2tDaGFuZ2VBbGVydCwgZmFsc2UpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIF9yZWdpc3RlcldpbmRvd01vdXNlRXZlbnRzIChlbGVtZW50OiBIVE1MRWxlbWVudCkge1xyXG4gICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWRvd24nLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuX21vdXNlUHJlc3NlZCA9IHRydWU7XHJcbiAgICAgICAgfSwgZmFsc2UpO1xyXG4gICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdtb3VzZXVwJywgKGV2ZW50OiBNb3VzZUV2ZW50KSA9PiB7XHJcbiAgICAgICAgICAgIGlmICghdGhpcy5fbW91c2VQcmVzc2VkKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5fbW91c2VQcmVzc2VkID0gZmFsc2U7XHJcbiAgICAgICAgICAgIGNvbnN0IHBvc2l0aW9uID0gdGhpcy5nZXRIVE1MRWxlbWVudFBvc2l0aW9uKGVsZW1lbnQpO1xyXG4gICAgICAgICAgICBjb25zdCBsb2NhdGlvbiA9IHRoaXMuZ2V0UG9pbnRCeUV2ZW50KGV2ZW50LCBwb3NpdGlvbik7XHJcbiAgICAgICAgICAgIGNvbnN0IHBvc2l0aW9uUmVjdCA9IHJlY3QocG9zaXRpb24ubGVmdCwgcG9zaXRpb24udG9wLCBwb3NpdGlvbi53aWR0aCwgcG9zaXRpb24uaGVpZ2h0KTtcclxuICAgICAgICAgICAgaWYgKCFwb3NpdGlvblJlY3QuY29udGFpbnMobmV3IFZlYzIobG9jYXRpb24ueCwgbG9jYXRpb24ueSkpKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZVRvdWNoZXNFbmQoW3RoaXMuZ2V0VG91Y2hCeVhZKGV2ZW50LCBsb2NhdGlvbi54LCBsb2NhdGlvbi55LCBwb3NpdGlvbildKTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IG1vdXNlRXZlbnQgPSB0aGlzLmdldE1vdXNlRXZlbnQobG9jYXRpb24sIHBvc2l0aW9uLCBFdmVudE1vdXNlLlVQKTtcclxuICAgICAgICAgICAgICAgIG1vdXNlRXZlbnQuc2V0QnV0dG9uKGV2ZW50LmJ1dHRvbik7XHJcbiAgICAgICAgICAgICAgICBldmVudE1hbmFnZXIuZGlzcGF0Y2hFdmVudChtb3VzZUV2ZW50KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0sIGZhbHNlKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIF9yZWdpc3RlckVsZW1lbnRNb3VzZUV2ZW50cyAoZWxlbWVudDogSFRNTEVsZW1lbnQsIHByb2hpYml0aW9uOiBib29sZWFuKSB7XHJcbiAgICAgICAgLy8gUmVnaXN0ZXIgY2FudmFzIG1vdXNlIGV2ZW50cy5cclxuICAgICAgICB0eXBlIEhhbmRsZXIgPSAoXHJcbiAgICAgICAgICAgIGV2ZW50OiBNb3VzZUV2ZW50LFxyXG4gICAgICAgICAgICBtb3VzZUV2ZW50OiBFdmVudE1vdXNlLFxyXG4gICAgICAgICAgICBsb2NhdGlvbjogeyB4OiBudW1iZXI7IHk6IG51bWJlcjsgfSxcclxuICAgICAgICAgICAgZWxlbWVudFBvc2l0aW9uOiBJSFRNTEVsZW1lbnRQb3NpdGlvbixcclxuICAgICAgICApID0+IHZvaWQ7XHJcblxyXG4gICAgICAgIHR5cGUgTW91c2VFdmVudE5hbWVzID0gJ21vdXNlZG93bicgfCAnbW91c2V1cCcgfCAnbW91c2Vtb3ZlJztcclxuXHJcbiAgICAgICAgY29uc3QgbGlzdGVuRE9NTW91c2VFdmVudCA9IChldmVudE5hbWU6IE1vdXNlRXZlbnROYW1lcywgdHlwZTogbnVtYmVyLCBoYW5kbGVyOiBIYW5kbGVyKSA9PiB7XHJcbiAgICAgICAgICAgIGVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihldmVudE5hbWUsIChldmVudCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgcG9zID0gdGhpcy5nZXRIVE1MRWxlbWVudFBvc2l0aW9uKGVsZW1lbnQpO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgbG9jYXRpb24gPSB0aGlzLmdldFBvaW50QnlFdmVudChldmVudCwgcG9zKTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IG1vdXNlRXZlbnQgPSB0aGlzLmdldE1vdXNlRXZlbnQobG9jYXRpb24sIHBvcywgdHlwZSk7XHJcbiAgICAgICAgICAgICAgICBtb3VzZUV2ZW50LnNldEJ1dHRvbihldmVudC5idXR0b24pO1xyXG5cclxuICAgICAgICAgICAgICAgIGhhbmRsZXIoZXZlbnQsIG1vdXNlRXZlbnQsIGxvY2F0aW9uLCBwb3MpO1xyXG5cclxuICAgICAgICAgICAgICAgIGV2ZW50TWFuYWdlci5kaXNwYXRjaEV2ZW50KG1vdXNlRXZlbnQpO1xyXG4gICAgICAgICAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBpZiAoIXByb2hpYml0aW9uKSB7XHJcbiAgICAgICAgICAgIGxpc3RlbkRPTU1vdXNlRXZlbnQoJ21vdXNlZG93bicsIEV2ZW50TW91c2UuRE9XTiwgKGV2ZW50LCBtb3VzZUV2ZW50LCBsb2NhdGlvbiwgcG9zKSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9tb3VzZVByZXNzZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5oYW5kbGVUb3VjaGVzQmVnaW4oW3RoaXMuZ2V0VG91Y2hCeVhZKGV2ZW50LCBsb2NhdGlvbi54LCBsb2NhdGlvbi55LCBwb3MpXSk7XHJcbiAgICAgICAgICAgICAgICBlbGVtZW50LmZvY3VzKCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgbGlzdGVuRE9NTW91c2VFdmVudCgnbW91c2V1cCcsIEV2ZW50TW91c2UuVVAsIChldmVudCwgbW91c2VFdmVudCwgbG9jYXRpb24sIHBvcykgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fbW91c2VQcmVzc2VkID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZVRvdWNoZXNFbmQoW3RoaXMuZ2V0VG91Y2hCeVhZKGV2ZW50LCBsb2NhdGlvbi54LCBsb2NhdGlvbi55LCBwb3MpXSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgbGlzdGVuRE9NTW91c2VFdmVudCgnbW91c2Vtb3ZlJywgRXZlbnRNb3VzZS5NT1ZFLCAoZXZlbnQsIG1vdXNlRXZlbnQsIGxvY2F0aW9uLCBwb3MpID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMuaGFuZGxlVG91Y2hlc01vdmUoW3RoaXMuZ2V0VG91Y2hCeVhZKGV2ZW50LCBsb2NhdGlvbi54LCBsb2NhdGlvbi55LCBwb3MpXSk7XHJcbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuX21vdXNlUHJlc3NlZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIG1vdXNlRXZlbnQuc2V0QnV0dG9uKEV2ZW50TW91c2UuQlVUVE9OX01JU1NJTkcpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKGV2ZW50Lm1vdmVtZW50WCAhPT0gdW5kZWZpbmVkICYmIGV2ZW50Lm1vdmVtZW50WSAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbW91c2VFdmVudC5tb3ZlbWVudFggPSBldmVudC5tb3ZlbWVudFg7XHJcbiAgICAgICAgICAgICAgICAgICAgbW91c2VFdmVudC5tb3ZlbWVudFkgPSBldmVudC5tb3ZlbWVudFk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gQHRzLWlnbm9yZVxyXG4gICAgICAgIGxpc3RlbkRPTU1vdXNlRXZlbnQoJ21vdXNld2hlZWwnLCBFdmVudE1vdXNlLlNDUk9MTCwgKGV2ZW50LCBtb3VzZUV2ZW50LCBsb2NhdGlvbiwgcG9zKSA9PiB7XHJcbiAgICAgICAgICAgIG1vdXNlRXZlbnQuc2V0U2Nyb2xsRGF0YSgwLCBldmVudC53aGVlbERlbHRhKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgLyogZmlyZWZveCBmaXggKi9cclxuICAgICAgICAvLyBAdHMtaWdub3JlXHJcbiAgICAgICAgbGlzdGVuRE9NTW91c2VFdmVudCgnRE9NTW91c2VTY3JvbGwnLCBFdmVudE1vdXNlLlNDUk9MTCwgKGV2ZW50LCBtb3VzZUV2ZW50LCBsb2NhdGlvbiwgcG9zKSA9PiB7XHJcbiAgICAgICAgICAgIG1vdXNlRXZlbnQuc2V0U2Nyb2xsRGF0YSgwLCBldmVudC5kZXRhaWwgKiAtMTIwKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIF9yZWdpc3Rlck1vdXNlUG9pbnRlckV2ZW50cyAoZWxlbWVudDogSFRNTEVsZW1lbnQpIHtcclxuICAgICAgICBjb25zdCBfcG9pbnRlckV2ZW50c01hcCA9IHtcclxuICAgICAgICAgICAgTVNQb2ludGVyRG93biAgICAgOiB0aGlzLmhhbmRsZVRvdWNoZXNCZWdpbixcclxuICAgICAgICAgICAgTVNQb2ludGVyTW92ZSAgICAgOiB0aGlzLmhhbmRsZVRvdWNoZXNNb3ZlLFxyXG4gICAgICAgICAgICBNU1BvaW50ZXJVcCAgICAgICA6IHRoaXMuaGFuZGxlVG91Y2hlc0VuZCxcclxuICAgICAgICAgICAgTVNQb2ludGVyQ2FuY2VsICAgOiB0aGlzLmhhbmRsZVRvdWNoZXNDYW5jZWwsXHJcbiAgICAgICAgfTtcclxuICAgICAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6IGZvcmluXHJcbiAgICAgICAgZm9yIChjb25zdCBldmVudE5hbWUgaW4gX3BvaW50ZXJFdmVudHNNYXApIHtcclxuICAgICAgICAgICAgY29uc3QgdG91Y2hFdmVudCA9IF9wb2ludGVyRXZlbnRzTWFwW2V2ZW50TmFtZV07XHJcbiAgICAgICAgICAgIC8vIEB0cy1pZ25vcmVcclxuICAgICAgICAgICAgZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKGV2ZW50TmFtZSBhcyBNU1BvaW50ZXJFdmVudE5hbWVzLCAoZXZlbnQ6IE1TUG9pbnRlckV2ZW50KSA9PiB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBwb3MgPSB0aGlzLmdldEhUTUxFbGVtZW50UG9zaXRpb24oZWxlbWVudCk7XHJcbiAgICAgICAgICAgICAgICBwb3MubGVmdCAtPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsTGVmdDtcclxuICAgICAgICAgICAgICAgIHBvcy50b3AgLT0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnNjcm9sbFRvcDtcclxuICAgICAgICAgICAgICAgIHRvdWNoRXZlbnQuY2FsbCh0aGlzLCBbdGhpcy5nZXRUb3VjaEJ5WFkoZXZlbnQsIGV2ZW50LmNsaWVudFgsIGV2ZW50LmNsaWVudFksIHBvcyldKTtcclxuICAgICAgICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gICAgICAgICAgICB9LCBmYWxzZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgX3JlZ2lzdGVyVG91Y2hFdmVudHMgKGVsZW1lbnQ6IEhUTUxFbGVtZW50KSB7XHJcbiAgICAgICAgaWYgKGNjLnN5cy5icm93c2VyVHlwZSA9PT0gY2Muc3lzLkJST1dTRVJfVFlQRV9XRUNIQVRfR0FNRV9TVUIpIHtcclxuICAgICAgICAgICAgdGhpcy5fcmVnaXN0ZXJXWEdhbWVUb3VjaEV2ZW50cyhlbGVtZW50KTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLl9yZWdpc3RlckhUTUxUb3VjaEV2ZW50cyhlbGVtZW50KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBfcmVnaXN0ZXJXWEdhbWVUb3VjaEV2ZW50cyAoZWxlbWVudDogSFRNTEVsZW1lbnQpIHtcclxuICAgICAgICBjb25zdCBtYWtlVG91Y2hMaXN0ZW5lciA9ICh0b3VjaGVzSGFuZGxlcjogKHRvdWNoZXNUb0hhbmRsZTogYW55KSA9PiB2b2lkKSA9PiB7XHJcbiAgICAgICAgICAgIHJldHVybiAoZXZlbnQ6IFRvdWNoRXZlbnQpID0+IHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHBvcyA9IHRoaXMuZ2V0SFRNTEVsZW1lbnRQb3NpdGlvbihlbGVtZW50KTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGJvZHkgPSBkb2N1bWVudC5ib2R5O1xyXG4gICAgICAgICAgICAgICAgcG9zLmxlZnQgLT0gYm9keS5zY3JvbGxMZWZ0IHx8IDA7XHJcbiAgICAgICAgICAgICAgICBwb3MudG9wIC09IGJvZHkuc2Nyb2xsVG9wIHx8IDA7XHJcbiAgICAgICAgICAgICAgICB0b3VjaGVzSGFuZGxlcih0aGlzLmdldFRvdWNoZXNCeUV2ZW50KGV2ZW50LCBwb3MpKTtcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB3eC5vblRvdWNoU3RhcnQobWFrZVRvdWNoTGlzdGVuZXIoKHRvdWNoZXNUb0hhbmRsZSkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLmhhbmRsZVRvdWNoZXNCZWdpbih0b3VjaGVzVG9IYW5kbGUpO1xyXG4gICAgICAgIH0pKTtcclxuICAgICAgICB3eC5vblRvdWNoRW5kKG1ha2VUb3VjaExpc3RlbmVyKCh0b3VjaGVzVG9IYW5kbGUpID0+IHtcclxuICAgICAgICAgICAgdGhpcy5oYW5kbGVUb3VjaGVzRW5kKHRvdWNoZXNUb0hhbmRsZSk7XHJcbiAgICAgICAgfSkpO1xyXG4gICAgICAgIHd4Lm9uVG91Y2hNb3ZlKG1ha2VUb3VjaExpc3RlbmVyKCh0b3VjaGVzVG9IYW5kbGUpID0+IHtcclxuICAgICAgICAgICAgdGhpcy5oYW5kbGVUb3VjaGVzTW92ZSh0b3VjaGVzVG9IYW5kbGUpO1xyXG4gICAgICAgIH0pKTtcclxuICAgICAgICB3eC5vblRvdWNoQ2FuY2VsKG1ha2VUb3VjaExpc3RlbmVyKCh0b3VjaGVzVG9IYW5kbGUpID0+IHtcclxuICAgICAgICAgICAgdGhpcy5oYW5kbGVUb3VjaGVzQ2FuY2VsKHRvdWNoZXNUb0hhbmRsZSk7XHJcbiAgICAgICAgfSkpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgX3JlZ2lzdGVySFRNTFRvdWNoRXZlbnRzIChlbGVtZW50OiBIVE1MRWxlbWVudCkge1xyXG4gICAgICAgIGNvbnN0IG1ha2VUb3VjaExpc3RlbmVyID0gKHRvdWNoZXNIYW5kbGVyOiAodG91Y2hlc1RvSGFuZGxlOiBhbnkpID0+IHZvaWQpID0+IHtcclxuICAgICAgICAgICAgcmV0dXJuIChldmVudDogVG91Y2hFdmVudCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKCFldmVudC5jaGFuZ2VkVG91Y2hlcykge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGNvbnN0IHBvcyA9IHRoaXMuZ2V0SFRNTEVsZW1lbnRQb3NpdGlvbihlbGVtZW50KTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGJvZHkgPSBkb2N1bWVudC5ib2R5O1xyXG4gICAgICAgICAgICAgICAgcG9zLmxlZnQgLT0gYm9keS5zY3JvbGxMZWZ0IHx8IDA7XHJcbiAgICAgICAgICAgICAgICBwb3MudG9wIC09IGJvZHkuc2Nyb2xsVG9wIHx8IDA7XHJcbiAgICAgICAgICAgICAgICB0b3VjaGVzSGFuZGxlcih0aGlzLmdldFRvdWNoZXNCeUV2ZW50KGV2ZW50LCBwb3MpKTtcclxuICAgICAgICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNoc3RhcnQnLCBtYWtlVG91Y2hMaXN0ZW5lcigodG91Y2hlc1RvSGFuZGxlKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuaGFuZGxlVG91Y2hlc0JlZ2luKHRvdWNoZXNUb0hhbmRsZSk7XHJcbiAgICAgICAgICAgIGlmIChzeXMucGxhdGZvcm0gIT09IHN5cy5XRUNIQVRfR0FNRSkge1xyXG4gICAgICAgICAgICAgICAgZWxlbWVudC5mb2N1cygpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSksIGZhbHNlKTtcclxuXHJcbiAgICAgICAgZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCd0b3VjaG1vdmUnLCBtYWtlVG91Y2hMaXN0ZW5lcigodG91Y2hlc1RvSGFuZGxlKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuaGFuZGxlVG91Y2hlc01vdmUodG91Y2hlc1RvSGFuZGxlKTtcclxuICAgICAgICB9KSwgZmFsc2UpO1xyXG5cclxuICAgICAgICBlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNoZW5kJywgbWFrZVRvdWNoTGlzdGVuZXIoKHRvdWNoZXNUb0hhbmRsZSkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLmhhbmRsZVRvdWNoZXNFbmQodG91Y2hlc1RvSGFuZGxlKTtcclxuICAgICAgICB9KSwgZmFsc2UpO1xyXG5cclxuICAgICAgICBlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNoY2FuY2VsJywgbWFrZVRvdWNoTGlzdGVuZXIoKHRvdWNoZXNUb0hhbmRsZSkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLmhhbmRsZVRvdWNoZXNDYW5jZWwodG91Y2hlc1RvSGFuZGxlKTtcclxuICAgICAgICB9KSwgZmFsc2UpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgX3JlZ2lzdGVyS2V5Ym9hcmRFdmVudCAoKSB7XHJcbiAgICAgICAgY29uc3QgY2FudmFzID0gY2MuZ2FtZS5jYW52YXMgYXMgSFRNTENhbnZhc0VsZW1lbnQ7XHJcbiAgICAgICAgY2FudmFzLmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCAoZXZlbnQ6IEtleWJvYXJkRXZlbnQpID0+IHtcclxuICAgICAgICAgICAgZXZlbnRNYW5hZ2VyLmRpc3BhdGNoRXZlbnQobmV3IEV2ZW50S2V5Ym9hcmQoZXZlbnQsIHRydWUpKTtcclxuICAgICAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgfSwgZmFsc2UpO1xyXG4gICAgICAgIGNhbnZhcy5hZGRFdmVudExpc3RlbmVyKCdrZXl1cCcsIChldmVudDogS2V5Ym9hcmRFdmVudCkgPT4ge1xyXG4gICAgICAgICAgICBldmVudE1hbmFnZXIuZGlzcGF0Y2hFdmVudChuZXcgRXZlbnRLZXlib2FyZChldmVudCwgZmFsc2UpKTtcclxuICAgICAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgfSwgZmFsc2UpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgX3JlZ2lzdGVyQWNjZWxlcm9tZXRlckV2ZW50ICgpIHtcclxuICAgICAgICB0aGlzLl9hY2NlbGVyYXRpb24gPSBuZXcgQWNjZWxlcmF0aW9uKCk7XHJcbiAgICAgICAgLy8gVE9ET1xyXG4gICAgICAgIC8vIEB0cy1pZ25vcmVcclxuICAgICAgICB0aGlzLl9hY2NlbERldmljZUV2ZW50ID0gd2luZG93LkRldmljZU1vdGlvbkV2ZW50IHx8IHdpbmRvdy5EZXZpY2VPcmllbnRhdGlvbkV2ZW50O1xyXG5cclxuICAgICAgICAvLyBUT0RPIGZpeCBEZXZpY2VNb3Rpb25FdmVudCBidWcgb24gUVEgQnJvd3NlciB2ZXJzaW9uIDQuMSBhbmQgYmVsb3cuXHJcbiAgICAgICAgaWYgKGNjLnN5cy5icm93c2VyVHlwZSA9PT0gY2Muc3lzLkJST1dTRVJfVFlQRV9NT0JJTEVfUVEpIHtcclxuICAgICAgICAgICAgLy8gVE9ET1xyXG4gICAgICAgIC8vIEB0cy1pZ25vcmVcclxuICAgICAgICAgICAgdGhpcy5fYWNjZWxEZXZpY2VFdmVudCA9IHdpbmRvdy5EZXZpY2VPcmllbnRhdGlvbkV2ZW50O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgX2RldmljZUV2ZW50VHlwZSA9XHJcbiAgICAgICAgICAgIC8vIFRPRE9cclxuICAgICAgICAgICAgLy8gQHRzLWlnbm9yZVxyXG4gICAgICAgICAgICB0aGlzLl9hY2NlbERldmljZUV2ZW50ID09PSB3aW5kb3cuRGV2aWNlTW90aW9uRXZlbnQgPyAnZGV2aWNlbW90aW9uJyA6ICdkZXZpY2VvcmllbnRhdGlvbic7XHJcblxyXG4gICAgICAgIC8vIEB0cy1pZ25vcmVcclxuICAgICAgICBfZGlkQWNjZWxlcmF0ZUZ1biA9ICguLi5hcmdzOiBhbnlbXSkgPT4gdGhpcy5kaWRBY2NlbGVyYXRlKC4uLmFyZ3MpO1xyXG4gICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKF9kZXZpY2VFdmVudFR5cGUsIF9kaWRBY2NlbGVyYXRlRnVuLCBmYWxzZSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBfdW5yZWdpc3RlckFjY2VsZXJvbWV0ZXJFdmVudCAoKSB7XHJcbiAgICAgICAgY29uc3QgX2RldmljZUV2ZW50VHlwZSA9XHJcbiAgICAgICAgICAgIC8vIFRPRE9cclxuICAgICAgICAgICAgLy8gQHRzLWlnbm9yZVxyXG4gICAgICAgICAgICB0aGlzLl9hY2NlbERldmljZUV2ZW50ID09PSB3aW5kb3cuRGV2aWNlTW90aW9uRXZlbnQgPyAnZGV2aWNlbW90aW9uJyA6ICdkZXZpY2VvcmllbnRhdGlvbic7XHJcbiAgICAgICAgaWYgKF9kaWRBY2NlbGVyYXRlRnVuKSB7XHJcbiAgICAgICAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKF9kZXZpY2VFdmVudFR5cGUsIF9kaWRBY2NlbGVyYXRlRnVuLCBmYWxzZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcblxyXG5jb25zdCBpbnB1dE1hbmFnZXIgPSBuZXcgSW5wdXRNYW5hZ2VyKCk7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBpbnB1dE1hbmFnZXI7XHJcblxyXG5jYy5pbnRlcm5hbC5pbnB1dE1hbmFnZXIgPSBpbnB1dE1hbmFnZXI7XHJcbiJdfQ==