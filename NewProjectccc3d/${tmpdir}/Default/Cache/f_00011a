(function (global, factory) {
  if (typeof define === "function" && define.amd) {
    define(["exports", "../../../core/math/index.js"], factory);
  } else if (typeof exports !== "undefined") {
    factory(exports, require("../../../core/math/index.js"));
  } else {
    var mod = {
      exports: {}
    };
    factory(mod.exports, global.index);
    global.simple = mod.exports;
  }
})(typeof globalThis !== "undefined" ? globalThis : typeof self !== "undefined" ? self : this, function (_exports, _index) {
  "use strict";

  Object.defineProperty(_exports, "__esModule", {
    value: true
  });
  _exports.simple = void 0;

  /*
   Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.
  
   https://www.cocos.com/
  
   Permission is hereby granted, free of charge, to any person obtaining a copy
   of this software and associated engine source code (the "Software"), a limited,
   worldwide, royalty-free, non-assignable, revocable and non-exclusive license
   to use Cocos Creator solely to develop games on your target platforms. You shall
   not use Cocos Creator software for developing other software or tools that's
   used for developing games. You are not granted to publish, distribute,
   sublicense, and/or sell copies of Cocos Creator.
  
   The software or tools in this License Agreement are licensed, not sold.
   Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.
  
   THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
   IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
   FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
   AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
   LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
   OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
   THE SOFTWARE.
  */

  /**
   * UI 组装器
   * @category ui-assembler
   */
  var vec3_temps = [];

  for (var i = 0; i < 4; i++) {
    vec3_temps.push(new _index.Vec3());
  }
  /**
   * simple 组装器
   * 可通过 cc.UI.simple 获取该组装器。
   */


  var simple = {
    createData: function createData(sprite) {
      var renderData = sprite.requestRenderData();
      renderData.dataLength = 4;
      renderData.vertexCount = 4;
      renderData.indiceCount = 6;
      renderData.vData = new Float32Array(4 * 9);
      return renderData;
    },
    updateRenderData: function updateRenderData(sprite) {
      var frame = sprite.spriteFrame; // TODO: Material API design and export from editor could affect the material activation process
      // need to update the logic here
      // if (frame) {
      //     if (!frame._original && dynamicAtlasManager) {
      //         dynamicAtlasManager.insertSpriteFrame(frame);
      //     }
      //     if (sprite._material._texture !== frame._texture) {
      //         sprite._activateMaterial();
      //     }
      // }

      var renderData = sprite.renderData;

      if (renderData && frame) {
        if (renderData.vertDirty) {
          this.updateVerts(sprite);
        }

        if (renderData.uvDirty) {
          this.updateUvs(sprite);
        }
      }
    },
    fillBuffers: function fillBuffers(sprite, renderer) {
      if (sprite === null) {
        return;
      } // const buffer: MeshBuffer = renderer.createBuffer(
      //     sprite.renderData!.vertexCount,
      //     sprite.renderData!.indiceCount,
      // );
      // const commitBuffer: IUIRenderData = renderer.createUIRenderData();


      var datas = sprite.renderData.datas;
      var node = sprite.node;
      var buffer = renderer.currBufferBatch;
      var vertexOffset = buffer.byteOffset >> 2;
      var indiceOffset = buffer.indiceOffset;
      var vertexId = buffer.vertexOffset;
      var isRecreate = buffer.request();

      if (!isRecreate) {
        buffer = renderer.currBufferBatch;
        vertexOffset = 0;
        indiceOffset = 0;
        vertexId = 0;
      } // buffer data may be reallocated, need get reference after request.


      var vbuf = buffer.vData;
      var ibuf = buffer.iData;
      var vData = sprite.renderData.vData;
      var data0 = datas[0];
      var data3 = datas[3];
      var matrix = node.worldMatrix;
      var a = matrix.m00;
      var b = matrix.m01;
      var c = matrix.m04;
      var d = matrix.m05;
      var tx = matrix.m12;
      var ty = matrix.m13;
      var vl = data0.x;
      var vr = data3.x;
      var vb = data0.y;
      var vt = data3.y;
      var al = a * vl;
      var ar = a * vr;
      var bl = b * vl;
      var br = b * vr;
      var cb = c * vb;
      var ct = c * vt;
      var db = d * vb;
      var dt = d * vt; // left bottom

      vData[0] = al + cb + tx;
      vData[1] = bl + db + ty; // right bottom

      vData[9] = ar + cb + tx;
      vData[10] = br + db + ty; // left top

      vData[18] = al + ct + tx;
      vData[19] = bl + dt + ty; // right top

      vData[27] = ar + ct + tx;
      vData[28] = br + dt + ty;
      vbuf.set(vData, vertexOffset); // fill index data

      ibuf[indiceOffset++] = vertexId;
      ibuf[indiceOffset++] = vertexId + 1;
      ibuf[indiceOffset++] = vertexId + 2;
      ibuf[indiceOffset++] = vertexId + 2;
      ibuf[indiceOffset++] = vertexId + 1;
      ibuf[indiceOffset++] = vertexId + 3;
    },
    updateVerts: function updateVerts(sprite) {
      var renderData = sprite.renderData;

      if (!renderData) {
        return;
      }

      var node = sprite.node;
      var datas = renderData.datas;
      var cw = node.width;
      var ch = node.height;
      var appx = node.anchorX * cw;
      var appy = node.anchorY * ch;
      var l = 0;
      var b = 0;
      var r = 0;
      var t = 0;

      if (sprite.trim) {
        l = -appx;
        b = -appy;
        r = cw - appx;
        t = ch - appy;
      } else {
        var frame = sprite.spriteFrame;
        var originSize = frame.getOriginalSize();
        var rect = frame.getRect();
        var ow = originSize.width;
        var oh = originSize.height;
        var rw = rect.width;
        var rh = rect.height;
        var offset = frame.getOffset();
        var scaleX = cw / ow;
        var scaleY = ch / oh;
        var trimLeft = offset.x + (ow - rw) / 2;
        var trimRight = offset.x - (ow - rw) / 2;
        var trimBottom = offset.y + (oh - rh) / 2;
        var trimTop = offset.y - (oh - rh) / 2;
        l = trimLeft * scaleX - appx;
        b = trimBottom * scaleY - appy;
        r = cw + trimRight * scaleX - appx;
        t = ch + trimTop * scaleY - appy;
      }

      datas[0].x = l;
      datas[0].y = b;
      datas[0].z = 0; // datas[1].x = r;
      // datas[1].y = b;
      // datas[2].x = l;
      // datas[2].y = t;

      datas[3].x = r;
      datas[3].y = t;
      datas[3].z = 0;
      renderData.vertDirty = false;
    },
    updateUvs: function updateUvs(sprite) {
      var renderData = sprite.renderData;
      var vData = renderData.vData;
      var uv = sprite.spriteFrame.uv;
      vData[3] = uv[0];
      vData[4] = uv[1];
      vData[12] = uv[2];
      vData[13] = uv[3];
      vData[21] = uv[4];
      vData[22] = uv[5];
      vData[30] = uv[6];
      vData[31] = uv[7];
      renderData.uvDirty = false;
    },
    updateColor: function updateColor(sprite) {
      var vData = sprite.renderData.vData;
      var colorOffset = 5;
      var color = sprite.color;
      var colorr = color.r / 255;
      var colorg = color.g / 255;
      var colorb = color.b / 255;
      var colora = color.a / 255;

      for (var _i = 0; _i < 4; _i++) {
        vData[colorOffset] = colorr;
        vData[colorOffset + 1] = colorg;
        vData[colorOffset + 2] = colorb;
        vData[colorOffset + 3] = colora;
        colorOffset += 9;
      }
    }
  };
  _exports.simple = simple;
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkY6L2plbmtpbnMvd29ya3NwYWNlL0NyZWF0b3JfM0QvZWRpdG9yLTNkL3Jlc291cmNlcy8zZC9lbmdpbmUvY29jb3MvdWkvYXNzZW1ibGVyL3Nwcml0ZS9zaW1wbGUudHMiXSwibmFtZXMiOlsidmVjM190ZW1wcyIsImkiLCJwdXNoIiwiVmVjMyIsInNpbXBsZSIsImNyZWF0ZURhdGEiLCJzcHJpdGUiLCJyZW5kZXJEYXRhIiwicmVxdWVzdFJlbmRlckRhdGEiLCJkYXRhTGVuZ3RoIiwidmVydGV4Q291bnQiLCJpbmRpY2VDb3VudCIsInZEYXRhIiwiRmxvYXQzMkFycmF5IiwidXBkYXRlUmVuZGVyRGF0YSIsImZyYW1lIiwic3ByaXRlRnJhbWUiLCJ2ZXJ0RGlydHkiLCJ1cGRhdGVWZXJ0cyIsInV2RGlydHkiLCJ1cGRhdGVVdnMiLCJmaWxsQnVmZmVycyIsInJlbmRlcmVyIiwiZGF0YXMiLCJub2RlIiwiYnVmZmVyIiwiY3VyckJ1ZmZlckJhdGNoIiwidmVydGV4T2Zmc2V0IiwiYnl0ZU9mZnNldCIsImluZGljZU9mZnNldCIsInZlcnRleElkIiwiaXNSZWNyZWF0ZSIsInJlcXVlc3QiLCJ2YnVmIiwiaWJ1ZiIsImlEYXRhIiwiZGF0YTAiLCJkYXRhMyIsIm1hdHJpeCIsIndvcmxkTWF0cml4IiwiYSIsIm0wMCIsImIiLCJtMDEiLCJjIiwibTA0IiwiZCIsIm0wNSIsInR4IiwibTEyIiwidHkiLCJtMTMiLCJ2bCIsIngiLCJ2ciIsInZiIiwieSIsInZ0IiwiYWwiLCJhciIsImJsIiwiYnIiLCJjYiIsImN0IiwiZGIiLCJkdCIsInNldCIsImN3Iiwid2lkdGgiLCJjaCIsImhlaWdodCIsImFwcHgiLCJhbmNob3JYIiwiYXBweSIsImFuY2hvclkiLCJsIiwiciIsInQiLCJ0cmltIiwib3JpZ2luU2l6ZSIsImdldE9yaWdpbmFsU2l6ZSIsInJlY3QiLCJnZXRSZWN0Iiwib3ciLCJvaCIsInJ3IiwicmgiLCJvZmZzZXQiLCJnZXRPZmZzZXQiLCJzY2FsZVgiLCJzY2FsZVkiLCJ0cmltTGVmdCIsInRyaW1SaWdodCIsInRyaW1Cb3R0b20iLCJ0cmltVG9wIiwieiIsInV2IiwidXBkYXRlQ29sb3IiLCJjb2xvck9mZnNldCIsImNvbG9yIiwiY29sb3JyIiwiY29sb3JnIiwiZyIsImNvbG9yYiIsImNvbG9yYSJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQXlCQTs7OztBQVdBLE1BQU1BLFVBQWtCLEdBQUcsRUFBM0I7O0FBQ0EsT0FBSyxJQUFJQyxDQUFDLEdBQUcsQ0FBYixFQUFnQkEsQ0FBQyxHQUFHLENBQXBCLEVBQXVCQSxDQUFDLEVBQXhCLEVBQTRCO0FBQ3hCRCxJQUFBQSxVQUFVLENBQUNFLElBQVgsQ0FBZ0IsSUFBSUMsV0FBSixFQUFoQjtBQUNIO0FBRUQ7Ozs7OztBQUlPLE1BQU1DLE1BQWtCLEdBQUc7QUFDOUJDLElBQUFBLFVBRDhCLHNCQUNsQkMsTUFEa0IsRUFDTztBQUNqQyxVQUFNQyxVQUFVLEdBQUdELE1BQU0sQ0FBQ0UsaUJBQVAsRUFBbkI7QUFDQUQsTUFBQUEsVUFBVSxDQUFFRSxVQUFaLEdBQXlCLENBQXpCO0FBQ0FGLE1BQUFBLFVBQVUsQ0FBRUcsV0FBWixHQUEwQixDQUExQjtBQUNBSCxNQUFBQSxVQUFVLENBQUVJLFdBQVosR0FBMEIsQ0FBMUI7QUFFQUosTUFBQUEsVUFBVSxDQUFDSyxLQUFYLEdBQW1CLElBQUlDLFlBQUosQ0FBaUIsSUFBSSxDQUFyQixDQUFuQjtBQUVBLGFBQU9OLFVBQVA7QUFDSCxLQVY2QjtBQVk5Qk8sSUFBQUEsZ0JBWjhCLDRCQVlaUixNQVpZLEVBWWE7QUFDdkMsVUFBTVMsS0FBSyxHQUFHVCxNQUFNLENBQUNVLFdBQXJCLENBRHVDLENBR3ZDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLFVBQU1ULFVBQVUsR0FBR0QsTUFBTSxDQUFDQyxVQUExQjs7QUFDQSxVQUFJQSxVQUFVLElB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QUFJLENBQWY7QUFDSDtBQUNKO0FBak02QixHQUEzQiIsInNvdXJjZXNDb250ZW50IjpbIi8qXHJcbiBDb3B5cmlnaHQgKGMpIDIwMTctMjAxOCBYaWFtZW4gWWFqaSBTb2Z0d2FyZSBDby4sIEx0ZC5cclxuXHJcbiBodHRwczovL3d3dy5jb2Nvcy5jb20vXHJcblxyXG4gUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGEgY29weVxyXG4gb2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBlbmdpbmUgc291cmNlIGNvZGUgKHRoZSBcIlNvZnR3YXJlXCIpLCBhIGxpbWl0ZWQsXHJcbiB3b3JsZHdpZGUsIHJveWFsdHktZnJlZSwgbm9uLWFzc2lnbmFibGUsIHJldm9jYWJsZSBhbmQgbm9uLWV4Y2x1c2l2ZSBsaWNlbnNlXHJcbiB0byB1c2UgQ29jb3MgQ3JlYXRvciBzb2xlbHkgdG8gZGV2ZWxvcCBnYW1lcyBvbiB5b3VyIHRhcmdldCBwbGF0Zm9ybXMuIFlvdSBzaGFsbFxyXG4gbm90IHVzZSBDb2NvcyBDcmVhdG9yIHNvZnR3YXJlIGZvciBkZXZlbG9waW5nIG90aGVyIHNvZnR3YXJlIG9yIHRvb2xzIHRoYXQnc1xyXG4gdXNlZCBmb3IgZGV2ZWxvcGluZyBnYW1lcy4gWW91IGFyZSBub3QgZ3JhbnRlZCB0byBwdWJsaXNoLCBkaXN0cmlidXRlLFxyXG4gc3VibGljZW5zZSwgYW5kL29yIHNlbGwgY29waWVzIG9mIENvY29zIENyZWF0b3IuXHJcblxyXG4gVGhlIHNvZnR3YXJlIG9yIHRvb2xzIGluIHRoaXMgTGljZW5zZSBBZ3JlZW1lbnQgYXJlIGxpY2Vuc2VkLCBub3Qgc29sZC5cclxuIFhpYW1lbiBZYWppIFNvZnR3YXJlIENvLiwgTHRkLiByZXNlcnZlcyBhbGwgcmlnaHRzIG5vdCBleHByZXNzbHkgZ3JhbnRlZCB0byB5b3UuXHJcblxyXG4gVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEIFwiQVMgSVNcIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUyBPUlxyXG4gSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFksXHJcbiBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEVcclxuIEFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sIERBTUFHRVMgT1IgT1RIRVJcclxuIExJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HIEZST00sXHJcbiBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElOXHJcbiBUSEUgU09GVFdBUkUuXHJcbiovXHJcblxyXG4vKipcclxuICogVUkg57uE6KOF5ZmoXHJcbiAqIEBjYXRlZ29yeSB1aS1hc3NlbWJsZXJcclxuICovXHJcblxyXG5pbXBvcnQgeyBWZWMzIH0gZnJvbSAnLi4vLi4vLi4vY29yZS9tYXRoJztcclxuaW1wb3J0IHsgSUFzc2VtYmxlciB9IGZyb20gJy4uLy4uLy4uL2NvcmUvcmVuZGVyZXIvdWkvYmFzZSc7XHJcbmltcG9ydCB7IElSZW5kZXJEYXRhLCBSZW5kZXJEYXRhIH0gZnJvbSAnLi4vLi4vLi4vY29yZS9yZW5kZXJlci91aS9yZW5kZXItZGF0YSc7XHJcbmltcG9ydCB7IFVJIH0gZnJvbSAnLi4vLi4vLi4vY29yZS9yZW5kZXJlci91aS91aSc7XHJcbmltcG9ydCB7IFNwcml0ZUNvbXBvbmVudCB9IGZyb20gJy4uLy4uL2NvbXBvbmVudHMnO1xyXG5cclxuY29uc3QgdmVjM190ZW1wczogVmVjM1tdID0gW107XHJcbmZvciAobGV0IGkgPSAwOyBpIDwgNDsgaSsrKSB7XHJcbiAgICB2ZWMzX3RlbXBzLnB1c2gobmV3IFZlYzMoKSk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBzaW1wbGUg57uE6KOF5ZmoXHJcbiAqIOWPr+mAmui/hyBjYy5VSS5zaW1wbGUg6I635Y+W6K+l57uE6KOF5Zmo44CCXHJcbiAqL1xyXG5leHBvcnQgY29uc3Qgc2ltcGxlOiBJQXNzZW1ibGVyID0ge1xyXG4gICAgY3JlYXRlRGF0YSAoc3ByaXRlOiBTcHJpdGVDb21wb25lbnQpIHtcclxuICAgICAgICBjb25zdCByZW5kZXJEYXRhID0gc3ByaXRlLnJlcXVlc3RSZW5kZXJEYXRhKCk7XHJcbiAgICAgICAgcmVuZGVyRGF0YSEuZGF0YUxlbmd0aCA9IDQ7XHJcbiAgICAgICAgcmVuZGVyRGF0YSEudmVydGV4Q291bnQgPSA0O1xyXG4gICAgICAgIHJlbmRlckRhdGEhLmluZGljZUNvdW50ID0gNjtcclxuXHJcbiAgICAgICAgcmVuZGVyRGF0YS52RGF0YSA9IG5ldyBGbG9hdDMyQXJyYXkoNCAqIDkpO1xyXG5cclxuICAgICAgICByZXR1cm4gcmVuZGVyRGF0YSBhcyBSZW5kZXJEYXRhO1xyXG4gICAgfSxcclxuXHJcbiAgICB1cGRhdGVSZW5kZXJEYXRhIChzcHJpdGU6IFNwcml0ZUNvbXBvbmVudCkge1xyXG4gICAgICAgIGNvbnN0IGZyYW1lID0gc3ByaXRlLnNwcml0ZUZyYW1lO1xyXG5cclxuICAgICAgICAvLyBUT0RPOiBNYXRlcmlhbCBBUEkgZGVzaWduIGFuZCBleHBvcnQgZnJvbSBlZGl0b3IgY291bGQgYWZmZWN0IHRoZSBtYXRlcmlhbCBhY3RpdmF0aW9uIHByb2Nlc3NcclxuICAgICAgICAvLyBuZWVkIHRvIHVwZGF0ZSB0aGUgbG9naWMgaGVyZVxyXG4gICAgICAgIC8vIGlmIChmcmFtZSkge1xyXG4gICAgICAgIC8vICAgICBpZiAoIWZyYW1lLl9vcmlnaW5hbCAmJiBkeW5hbWljQXRsYXNNYW5hZ2VyKSB7XHJcbiAgICAgICAgLy8gICAgICAgICBkeW5hbWljQXRsYXNNYW5hZ2VyLmluc2VydFNwcml0ZUZyYW1lKGZyYW1lKTtcclxuICAgICAgICAvLyAgICAgfVxyXG4gICAgICAgIC8vICAgICBpZiAoc3ByaXRlLl9tYXRlcmlhbC5fdGV4dHVyZSAhPT0gZnJhbWUuX3RleHR1cmUpIHtcclxuICAgICAgICAvLyAgICAgICAgIHNwcml0ZS5fYWN0aXZhdGVNYXRlcmlhbCgpO1xyXG4gICAgICAgIC8vICAgICB9XHJcbiAgICAgICAgLy8gfVxyXG5cclxuICAgICAgICBjb25zdCByZW5kZXJEYXRhID0gc3ByaXRlLnJlbmRlckRhdGE7XHJcbiAgICAgICAgaWYgKHJlbmRlckRhdGEgJiYgZnJhbWUpIHtcclxuICAgICAgICAgICAgaWYgKHJlbmRlckRhdGEudmVydERpcnR5KSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZVZlcnRzKHNwcml0ZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHJlbmRlckRhdGEudXZEaXJ0eSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy51cGRhdGVVdnMoc3ByaXRlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH0sXHJcblxyXG4gICAgZmlsbEJ1ZmZlcnMgKHNwcml0ZTogU3ByaXRlQ29tcG9uZW50LCByZW5kZXJlcjogVUkpIHtcclxuICAgICAgICBpZiAoc3ByaXRlID09PSBudWxsKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIGNvbnN0IGJ1ZmZlcjogTWVzaEJ1ZmZlciA9IHJlbmRlcmVyLmNyZWF0ZUJ1ZmZlcihcclxuICAgICAgICAvLyAgICAgc3ByaXRlLnJlbmRlckRhdGEhLnZlcnRleENvdW50LFxyXG4gICAgICAgIC8vICAgICBzcHJpdGUucmVuZGVyRGF0YSEuaW5kaWNlQ291bnQsXHJcbiAgICAgICAgLy8gKTtcclxuICAgICAgICAvLyBjb25zdCBjb21taXRCdWZmZXI6IElVSVJlbmRlckRhdGEgPSByZW5kZXJlci5jcmVhdGVVSVJlbmRlckRhdGEoKTtcclxuICAgICAgICBjb25zdCBkYXRhczogSVJlbmRlckRhdGFbXSA9IHNwcml0ZSEucmVuZGVyRGF0YSEuZGF0YXM7XHJcbiAgICAgICAgY29uc3Qgbm9kZSA9IHNwcml0ZS5ub2RlO1xyXG5cclxuICAgICAgICBsZXQgYnVmZmVyID0gcmVuZGVyZXIuY3VyckJ1ZmZlckJhdGNoITtcclxuICAgICAgICBsZXQgdmVydGV4T2Zmc2V0ID0gYnVmZmVyLmJ5dGVPZmZzZXQgPj4gMjtcclxuICAgICAgICBsZXQgaW5kaWNlT2Zmc2V0ID0gYnVmZmVyLmluZGljZU9mZnNldDtcclxuICAgICAgICBsZXQgdmVydGV4SWQgPSBidWZmZXIudmVydGV4T2Zmc2V0O1xyXG5cclxuICAgICAgICBjb25zdCBpc1JlY3JlYXRlID0gYnVmZmVyLnJlcXVlc3QoKTtcclxuICAgICAgICBpZiAoIWlzUmVjcmVhdGUpIHtcclxuICAgICAgICAgICAgYnVmZmVyID0gcmVuZGVyZXIuY3VyckJ1ZmZlckJhdGNoITtcclxuICAgICAgICAgICAgdmVydGV4T2Zmc2V0ID0gMDtcclxuICAgICAgICAgICAgaW5kaWNlT2Zmc2V0ID0gMDtcclxuICAgICAgICAgICAgdmVydGV4SWQgPSAwO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gYnVmZmVyIGRhdGEgbWF5IGJlIHJlYWxsb2NhdGVkLCBuZWVkIGdldCByZWZlcmVuY2UgYWZ0ZXIgcmVxdWVzdC5cclxuICAgICAgICBjb25zdCB2YnVmID0gYnVmZmVyLnZEYXRhITtcclxuICAgICAgICBjb25zdCBpYnVmID0gYnVmZmVyLmlEYXRhITtcclxuICAgICAgICBjb25zdCB2RGF0YSA9IHNwcml0ZSEucmVuZGVyRGF0YSEudkRhdGEhO1xyXG4gICAgICAgIGNvbnN0IGRhdGEwID0gZGF0YXNbMF07XHJcbiAgICAgICAgY29uc3QgZGF0YTMgPSBkYXRhc1szXTtcclxuICAgICAgICBjb25zdCBtYXRyaXggPSBub2RlLndvcmxkTWF0cml4O1xyXG4gICAgICAgIGNvbnN0IGEgPSBtYXRyaXgubTAwOyBjb25zdCBiID0gbWF0cml4Lm0wMTtcclxuICAgICAgICBjb25zdCBjID0gbWF0cml4Lm0wNDsgY29uc3QgZCA9IG1hdHJpeC5tMDU7XHJcbiAgICAgICAgY29uc3QgdHggPSBtYXRyaXgubTEyOyBjb25zdCB0eSA9IG1hdHJpeC5tMTM7XHJcbiAgICAgICAgY29uc3QgdmwgPSBkYXRhMC54OyBjb25zdCB2ciA9IGRhdGEzLng7XHJcbiAgICAgICAgY29uc3QgdmIgPSBkYXRhMC55OyBjb25zdCB2dCA9IGRhdGEzLnk7XHJcbiAgICAgICAgY29uc3QgYWwgPSBhICogdmw7IGNvbnN0IGFyID0gYSAqIHZyO1xyXG4gICAgICAgIGNvbnN0IGJsID0gYiAqIHZsOyBjb25zdCBiciA9IGIgKiB2cjtcclxuICAgICAgICBjb25zdCBjYiA9IGMgKiB2YjsgY29uc3QgY3QgPSBjICogdnQ7XHJcbiAgICAgICAgY29uc3QgZGIgPSBkICogdmI7IGNvbnN0IGR0ID0gZCAqIHZ0O1xyXG4gICAgICAgIC8vIGxlZnQgYm90dG9tXHJcbiAgICAgICAgdkRhdGFbMF0gPSBhbCArIGNiICsgdHg7XHJcbiAgICAgICAgdkRhdGFbMV0gPSBibCArIGRiICsgdHk7XHJcbiAgICAgICAgLy8gcmlnaHQgYm90dG9tXHJcbiAgICAgICAgdkRhdGFbOV0gPSBhciArIGNiICsgdHg7XHJcbiAgICAgICAgdkRhdGFbMTBdID0gYnIgKyBkYiArIHR5O1xyXG4gICAgICAgIC8vIGxlZnQgdG9wXHJcbiAgICAgICAgdkRhdGFbMThdID0gYWwgKyBjdCArIHR4O1xyXG4gICAgICAgIHZEYXRhWzE5XSA9IGJsICsgZHQgKyB0eTtcclxuICAgICAgICAvLyByaWdodCB0b3BcclxuICAgICAgICB2RGF0YVsyN10gPSBhciArIGN0ICsgdHg7XHJcbiAgICAgICAgdkRhdGFbMjhdID0gYnIgKyBkdCArIHR5O1xyXG5cclxuICAgICAgICB2YnVmLnNldCh2RGF0YSwgdmVydGV4T2Zmc2V0KTtcclxuXHJcbiAgICAgICAgLy8gZmlsbCBpbmRleCBkYXRhXHJcbiAgICAgICAgaWJ1ZltpbmRpY2VPZmZzZXQrK10gPSB2ZXJ0ZXhJZDtcclxuICAgICAgICBpYnVmW2luZGljZU9mZnNldCsrXSA9IHZlcnRleElkICsgMTtcclxuICAgICAgICBpYnVmW2luZGljZU9mZnNldCsrXSA9IHZlcnRleElkICsgMjtcclxuICAgICAgICBpYnVmW2luZGljZU9mZnNldCsrXSA9IHZlcnRleElkICsgMjtcclxuICAgICAgICBpYnVmW2luZGljZU9mZnNldCsrXSA9IHZlcnRleElkICsgMTtcclxuICAgICAgICBpYnVmW2luZGljZU9mZnNldCsrXSA9IHZlcnRleElkICsgMztcclxuICAgIH0sXHJcblxyXG4gICAgdXBkYXRlVmVydHMgKHNwcml0ZTogU3ByaXRlQ29tcG9uZW50KSB7XHJcbiAgICAgICAgY29uc3QgcmVuZGVyRGF0YTogUmVuZGVyRGF0YSB8IG51bGwgPSBzcHJpdGUucmVuZGVyRGF0YTtcclxuICAgICAgICBpZiAoIXJlbmRlckRhdGEpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3Qgbm9kZSA9IHNwcml0ZS5ub2RlO1xyXG4gICAgICAgIGNvbnN0IGRhdGFzOiBJUmVuZGVyRGF0YVtdID0gcmVuZGVyRGF0YS5kYXRhcztcclxuICAgICAgICBjb25zdCBjdyA9IG5vZGUud2lkdGg7XHJcbiAgICAgICAgY29uc3QgY2ggPSBub2RlLmhlaWdodDtcclxuICAgICAgICBjb25zdCBhcHB4ID0gbm9kZS5hbmNob3JYICogY3c7XHJcbiAgICAgICAgY29uc3QgYXBweSA9IG5vZGUuYW5jaG9yWSAqIGNoO1xyXG4gICAgICAgIGxldCBsID0gMDtcclxuICAgICAgICBsZXQgYiA9IDA7XHJcbiAgICAgICAgbGV0IHIgPSAwO1xyXG4gICAgICAgIGxldCB0ID0gMDtcclxuICAgICAgICBpZiAoc3ByaXRlLnRyaW0pIHtcclxuICAgICAgICAgICAgbCA9IC1hcHB4O1xyXG4gICAgICAgICAgICBiID0gLWFwcHk7XHJcbiAgICAgICAgICAgIHIgPSBjdyAtIGFwcHg7XHJcbiAgICAgICAgICAgIHQgPSBjaCAtIGFwcHk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBjb25zdCBmcmFtZSA9IHNwcml0ZS5zcHJpdGVGcmFtZSE7XHJcbiAgICAgICAgICAgIGNvbnN0IG9yaWdpblNpemUgPSBmcmFtZS5nZXRPcmlnaW5hbFNpemUoKTtcclxuICAgICAgICAgICAgY29uc3QgcmVjdCA9IGZyYW1lLmdldFJlY3QoKTtcclxuICAgICAgICAgICAgY29uc3Qgb3cgPSBvcmlnaW5TaXplLndpZHRoO1xyXG4gICAgICAgICAgICBjb25zdCBvaCA9IG9yaWdpblNpemUuaGVpZ2h0O1xyXG4gICAgICAgICAgICBjb25zdCBydyA9IHJlY3Qud2lkdGg7XHJcbiAgICAgICAgICAgIGNvbnN0IHJoID0gcmVjdC5oZWlnaHQ7XHJcbiAgICAgICAgICAgIGNvbnN0IG9mZnNldCA9IGZyYW1lLmdldE9mZnNldCgpO1xyXG4gICAgICAgICAgICBjb25zdCBzY2FsZVggPSBjdyAvIG93O1xyXG4gICAgICAgICAgICBjb25zdCBzY2FsZVkgPSBjaCAvIG9oO1xyXG4gICAgICAgICAgICBjb25zdCB0cmltTGVmdCA9IG9mZnNldC54ICsgKG93IC0gcncpIC8gMjtcclxuICAgICAgICAgICAgY29uc3QgdHJpbVJpZ2h0ID0gb2Zmc2V0LnggLSAob3cgLSBydykgLyAyO1xyXG4gICAgICAgICAgICBjb25zdCB0cmltQm90dG9tID0gb2Zmc2V0LnkgKyAob2ggLSByaCkgLyAyO1xyXG4gICAgICAgICAgICBjb25zdCB0cmltVG9wID0gb2Zmc2V0LnkgLSAob2ggLSByaCkgLyAyO1xyXG4gICAgICAgICAgICBsID0gdHJpbUxlZnQgKiBzY2FsZVggLSBhcHB4O1xyXG4gICAgICAgICAgICBiID0gdHJpbUJvdHRvbSAqIHNjYWxlWSAtIGFwcHk7XHJcbiAgICAgICAgICAgIHIgPSBjdyArIHRyaW1SaWdodCAqIHNjYWxlWCAtIGFwcHg7XHJcbiAgICAgICAgICAgIHQgPSBjaCArIHRyaW1Ub3AgKiBzY2FsZVkgLSBhcHB5O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZGF0YXNbMF0ueCA9IGw7XHJcbiAgICAgICAgZGF0YXNbMF0ueSA9IGI7XHJcbiAgICAgICAgZGF0YXNbMF0ueiA9IDA7XHJcbiAgICAgICAgLy8gZGF0YXNbMV0ueCA9IHI7XHJcbiAgICAgICAgLy8gZGF0YXNbMV0ueSA9IGI7XHJcbiAgICAgICAgLy8gZGF0YXNbMl0ueCA9IGw7XHJcbiAgICAgICAgLy8gZGF0YXNbMl0ueSA9IHQ7XHJcbiAgICAgICAgZGF0YXNbM10ueCA9IHI7XHJcbiAgICAgICAgZGF0YXNbM10ueSA9IHQ7XHJcbiAgICAgICAgZGF0YXNbM10ueiA9IDA7XHJcblxyXG4gICAgICAgIHJlbmRlckRhdGEudmVydERpcnR5ID0gZmFsc2U7XHJcbiAgICB9LFxyXG5cclxuICAgIHVwZGF0ZVV2cyAoc3ByaXRlOiBTcHJpdGVDb21wb25lbnQpIHtcclxuICAgICAgICBjb25zdCByZW5kZXJEYXRhID0gc3ByaXRlLnJlbmRlckRhdGEhO1xyXG4gICAgICAgIGNvbnN0IHZEYXRhID0gcmVuZGVyRGF0YS52RGF0YSE7XHJcbiAgICAgICAgY29uc3QgdXYgPSBzcHJpdGUhLnNwcml0ZUZyYW1lIS51djtcclxuICAgICAgICB2RGF0YVszXSA9IHV2WzBdO1xyXG4gICAgICAgIHZEYXRhWzRdID0gdXZbMV07XHJcbiAgICAgICAgdkRhdGFbMTJdID0gdXZbMl07XHJcbiAgICAgICAgdkRhdGFbMTNdID0gdXZbM107XHJcbiAgICAgICAgdkRhdGFbMjFdID0gdXZbNF07XHJcbiAgICAgICAgdkRhdGFbMjJdID0gdXZbNV07XHJcbiAgICAgICAgdkRhdGFbMzBdID0gdXZbNl07XHJcbiAgICAgICAgdkRhdGFbMzFdID0gdXZbN107XHJcblxyXG4gICAgICAgIHJlbmRlckRhdGEudXZEaXJ0eSA9IGZhbHNlO1xyXG4gICAgfSxcclxuXHJcbiAgICB1cGRhdGVDb2xvciAoc3ByaXRlOiBTcHJpdGVDb21wb25lbnQpIHtcclxuICAgICAgICBjb25zdCB2RGF0YSA9IHNwcml0ZS5yZW5kZXJEYXRhIS52RGF0YTtcclxuXHJcbiAgICAgICAgbGV0IGNvbG9yT2Zmc2V0ID0gNTtcclxuICAgICAgICBjb25zdCBjb2xvciA9IHNwcml0ZS5jb2xvcjtcclxuICAgICAgICBjb25zdCBjb2xvcnIgPSBjb2xvci5yIC8gMjU1O1xyXG4gICAgICAgIGNvbnN0IGNvbG9yZyA9IGNvbG9yLmcgLyAyNTU7XHJcbiAgICAgICAgY29uc3QgY29sb3JiID0gY29sb3IuYiAvIDI1NTtcclxuICAgICAgICBjb25zdCBjb2xvcmEgPSBjb2xvci5hIC8gMjU1O1xyXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgNDsgaSsrKSB7XHJcbiAgICAgICAgICAgIHZEYXRhIVtjb2xvck9mZnNldF0gPSBjb2xvcnI7XHJcbiAgICAgICAgICAgIHZEYXRhIVtjb2xvck9mZnNldCArIDFdID0gY29sb3JnO1xyXG4gICAgICAgICAgICB2RGF0YSFbY29sb3JPZmZzZXQgKyAyXSA9IGNvbG9yYjtcclxuICAgICAgICAgICAgdkRhdGEhW2NvbG9yT2Zmc2V0ICsgM10gPSBjb2xvcmE7XHJcblxyXG4gICAgICAgICAgICBjb2xvck9mZnNldCArPSA5O1xyXG4gICAgICAgIH1cclxuICAgIH0sXHJcbn07XHJcbiJdfQ==