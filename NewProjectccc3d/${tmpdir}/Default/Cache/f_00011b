(function (global, factory) {
  if (typeof define === "function" && define.amd) {
    define(["exports", "../../../core/math/index.js"], factory);
  } else if (typeof exports !== "undefined") {
    factory(exports, require("../../../core/math/index.js"));
  } else {
    var mod = {
      exports: {}
    };
    factory(mod.exports, global.index);
    global.sliced = mod.exports;
  }
})(typeof globalThis !== "undefined" ? globalThis : typeof self !== "undefined" ? self : this, function (_exports, _index) {
  "use strict";

  Object.defineProperty(_exports, "__esModule", {
    value: true
  });
  _exports.sliced = void 0;

  /*
   Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.
  
   http://www.cocos.com
  
   Permission is hereby granted, free of charge, to any person obtaining a copy
   of this software and associated engine source code (the "Software"), a limited,
   worldwide, royalty-free, non-assignable, revocable and non-exclusive license
   to use Cocos Creator solely to develop games on your target platforms. You shall
   not use Cocos Creator software for developing other software or tools that's
   used for developing games. You are not granted to publish, distribute,
   sublicense, and/or sell copies of Cocos Creator.
  
   The software or tools in this License Agreement are licensed, not sold.
   Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.
  
   THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
   IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
   FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
   AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
   LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
   OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
   THE SOFTWARE.
  */

  /**
   * @category ui-assembler
   */
  var vec3_temp = new _index.Vec3();
  var matrix = new _index.Mat4();
  /**
   * sliced 组装器
   * 可通过 cc.UI.sliced 获取该组装器。
   */

  var sliced = {
    useModel: false,
    createData: function createData(sprite) {
      var renderData = sprite.requestRenderData(); // 0-4 for local verts
      // 5-20 for world verts

      renderData.dataLength = 20;
      renderData.vertexCount = 16;
      renderData.indiceCount = 54;
      return renderData;
    },
    updateRenderData: function updateRenderData(sprite) {
      var frame = sprite.spriteFrame; // TODO: Material API design and export from editor could affect the material activation process
      // need to update the logic here
      // if (frame) {
      //     if (!frame._original && dynamicAtlasManager) {
      //         dynamicAtlasManager.insertSpriteFrame(frame);
      //     }
      //     if (sprite._material._texture !== frame._texture) {
      //         sprite._activateMaterial();
      //     }
      // }

      var renderData = sprite.renderData;

      if (renderData && frame) {
        var vertDirty = renderData.vertDirty;

        if (vertDirty) {
          this.updateVerts(sprite);
          this.updateWorldVerts(sprite);
        }
      }
    },
    updateVerts: function updateVerts(sprite) {
      var renderData = sprite.renderData;
      var datas = renderData.datas;
      var node = sprite.node;
      var width = node.width;
      var height = node.height;
      var appx = node.anchorX * width;
      var appy = node.anchorY * height;
      var frame = sprite.spriteFrame;
      var leftWidth = frame.insetLeft;
      var rightWidth = frame.insetRight;
      var topHeight = frame.insetTop;
      var bottomHeight = frame.insetBottom;
      var sizableWidth = width - leftWidth - rightWidth;
      var sizableHeight = height - topHeight - bottomHeight;
      var xScale = width / (leftWidth + rightWidth);
      var yScale = height / (topHeight + bottomHeight);
      xScale = isNaN(xScale) || xScale > 1 ? 1 : xScale;
      yScale = isNaN(yScale) || yScale > 1 ? 1 : yScale;
      sizableWidth = sizableWidth < 0 ? 0 : sizableWidth;
      sizableHeight = sizableHeight < 0 ? 0 : sizableHeight;
      datas[0].x = -appx;
      datas[0].y = -appy;
      datas[1].x = leftWidth * xScale - appx;
      datas[1].y = bottomHeight * yScale - appy;
      datas[2].x = datas[1].x + sizableWidth;
      datas[2].y = datas[1].y + sizableHeight;
      datas[3].x = width - appx;
      datas[3].y = height - appy;
      renderData.vertDirty = false;
    },
    fillBuffers: function fillBuffers(sprite, renderer) {
      if (sprite.node.hasChangedFlags) {
        this.updateWorldVerts(sprite);
      }

      var buffer = renderer.currBufferBatch;
      var renderData = sprite.renderData; // const node: Node = sprite.node;
      // const color: Color = sprite.color;

      var datas = renderData.datas;
      var vertexOffset = buffer.byteOffset >> 2;
      var vertexCount = renderData.vertexCount;
      var indiceOffset = buffer.indiceOffset;
      var vertexId = buffer.vertexOffset;
      var uvSliced = sprite.spriteFrame.uvSliced;
      var isRecreate = buffer.request(vertexCount, renderData.indiceCount);

      if (!isRecreate) {
        buffer = renderer.currBufferBatch;
        vertexOffset = 0;
        indiceOffset = 0;
        vertexId = 0;
      } // buffer data may be realloc, need get reference after request.


      var vbuf = buffer.vData; // const  uintbuf = buffer._uintVData,

      var ibuf = buffer.iData;

      for (var i = 4; i < 20; ++i) {
        var vert = datas[i];
        var uvs = uvSliced[i - 4];
        vbuf[vertexOffset++] = vert.x;
        vbuf[vertexOffset++] = vert.y;
        vbuf[vertexOffset++] = vert.z;
        vbuf[vertexOffset++] = uvs.u;
        vbuf[vertexOffset++] = uvs.v;

        _index.Color.toArray(vbuf, sprite.color, vertexOffset);

        vertexOffset += 4; // uintbuf[vertexOffset++] = color;
      }

      for (var r = 0; r < 3; ++r) {
        for (var c = 0; c < 3; ++c) {
          var start = vertexId + r * 4 + c;
          ibuf[indiceOffset++] = start;
          ibuf[indiceOffset++] = start + 1;
          ibuf[indiceOffset++] = start + 4;
          ibuf[indiceOffset++] = start + 1;
          ibuf[indiceOffset++] = start + 5;
          ibuf[indiceOffset++] = start + 4;
        }
      }
    },
    updateWorldVerts: function updateWorldVerts(sprite) {
      var node = sprite.node;
      var datas = sprite.renderData.datas;
      node.getWorldMatrix(matrix);

      for (var row = 0; row < 4; ++row) {
        var rowD = datas[row];

        for (var col = 0; col < 4; ++col) {
          var colD = datas[col];
          var world = datas[4 + row * 4 + col];

          _index.Vec3.set(vec3_temp, colD.x, rowD.y, 0);

          _index.Vec3.transformMat4(world, vec3_temp, matrix);
        }
      }
    }
  };
  _exports.sliced = sliced;
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkY6L2plbmtpbnMvd29ya3NwYWNlL0NyZWF0b3JfM0QvZWRpdG9yLTNkL3Jlc291cmNlcy8zZC9lbmdpbmUvY29jb3MvdWkvYXNzZW1ibGVyL3Nwcml0ZS9zbGljZWQudHMiXSwibmFtZXMiOlsidmVjM190ZW1wIiwiVmVjMyIsIm1hdHJpeCIsIk1hdDQiLCJzbGljZWQiLCJ1c2VNb2RlbCIsImNyZWF0ZURhdGEiLCJzcHJpdGUiLCJyZW5kZXJEYXRhIiwicmVxdWVzdFJlbmRlckRhdGEiLCJkYXRhTGVuZ3RoIiwidmVydGV4Q291bnQiLCJpbmRpY2VDb3VudCIsInVwZGF0ZVJlbmRlckRhdGEiLCJmcmFtZSIsInNwcml0ZUZyYW1lIiwidmVydERpcnR5IiwidXBkYXRlVmVydHMiLCJ1cGRhdGVXb3JsZFZlcnRzIiwiZGF0YXMiLCJub2RlIiwid2lkdGgiLCJoZWlnaHQiLCJhcHB4IiwiYW5jaG9yWCIsImFwcHkiLCJhbmNob3JZIiwibGVmdFdpZHRoIiwiaW5zZXRMZWZ0IiwicmlnaHRXaWR0aCIsImluc2V0UmlnaHQiLCJ0b3BIZWlnaHQiLCJpbnNldFRvcCIsImJvdHRvbUhlaWdodCIsImluc2V0Qm90dG9tIiwic2l6YWJsZVdpZHRoIiwic2l6YWJsZUhlaWdodCIsInhTY2FsZSIsInlTY2FsZSIsImlzTmFOIiwieCIsInkiLCJmaWxsQnVmZmVycyIsInJlbmRlcmVyIiwiaGFzQ2hhbmdlZEZsYWdzIiwiYnVmZmVyIiwiY3VyckJ1ZmZlckJhdGNoIiwidmVydGV4T2Zmc2V0IiwiYnl0ZU9mZnNldCIsImluZGljZU9mZnNldCIsInZlcnRleElkIiwidXZTbGljZWQiLCJpc1JlY3JlYXRlIiwicmVxdWVzdCIsInZidWYiLCJ2RGF0YSIsImlidWYiLCJpRGF0YSIsImkiLCJ2ZXJ0IiwidXZzIiwieiIsInUiLCJ2IiwiQ29sb3IiLCJ0b0FycmF5IiwiY29sb3IiLCJyIiwiYyIsInN0YXJ0IiwiZ2V0V29ybGRNYXRyaXgiLCJyb3ciLCJyb3dEIiwiY29sIiwi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b2Z0d2FyZSBDby4sIEx0ZC5cclxuXHJcbiBodHRwOi8vd3d3LmNvY29zLmNvbVxyXG5cclxuIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHlcclxuIG9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZW5naW5lIHNvdXJjZSBjb2RlICh0aGUgXCJTb2Z0d2FyZVwiKSwgYSBsaW1pdGVkLFxyXG4gd29ybGR3aWRlLCByb3lhbHR5LWZyZWUsIG5vbi1hc3NpZ25hYmxlLCByZXZvY2FibGUgYW5kIG5vbi1leGNsdXNpdmUgbGljZW5zZVxyXG4gdG8gdXNlIENvY29zIENyZWF0b3Igc29sZWx5IHRvIGRldmVsb3AgZ2FtZXMgb24geW91ciB0YXJnZXQgcGxhdGZvcm1zLiBZb3Ugc2hhbGxcclxuIG5vdCB1c2UgQ29jb3MgQ3JlYXRvciBzb2Z0d2FyZSBmb3IgZGV2ZWxvcGluZyBvdGhlciBzb2Z0d2FyZSBvciB0b29scyB0aGF0J3NcclxuIHVzZWQgZm9yIGRldmVsb3BpbmcgZ2FtZXMuIFlvdSBhcmUgbm90IGdyYW50ZWQgdG8gcHVibGlzaCwgZGlzdHJpYnV0ZSxcclxuIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsIGNvcGllcyBvZiBDb2NvcyBDcmVhdG9yLlxyXG5cclxuIFRoZSBzb2Z0d2FyZSBvciB0b29scyBpbiB0aGlzIExpY2Vuc2UgQWdyZWVtZW50IGFyZSBsaWNlbnNlZCwgbm90IHNvbGQuXHJcbiBYaWFtZW4gWWFqaSBTb2Z0d2FyZSBDby4sIEx0ZC4gcmVzZXJ2ZXMgYWxsIHJpZ2h0cyBub3QgZXhwcmVzc2x5IGdyYW50ZWQgdG8geW91LlxyXG5cclxuIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCBcIkFTIElTXCIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsIEVYUFJFU1MgT1JcclxuIElNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZLFxyXG4gRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5EIE5PTklORlJJTkdFTUVOVC4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFXHJcbiBBVVRIT1JTIE9SIENPUFlSSUdIVCBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9SIE9USEVSXHJcbiBMSUFCSUxJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBUT1JUIE9SIE9USEVSV0lTRSwgQVJJU0lORyBGUk9NLFxyXG4gT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgU09GVFdBUkUgT1IgVEhFIFVTRSBPUiBPVEhFUiBERUFMSU5HUyBJTlxyXG4gVEhFIFNPRlRXQVJFLlxyXG4qL1xyXG5cclxuLyoqXHJcbiAqIEBjYXRlZ29yeSB1aS1hc3NlbWJsZXJcclxuICovXHJcblxyXG5pbXBvcnQgeyBJVVYsIFNwcml0ZUZyYW1lIH0gZnJvbSAnLi4vLi4vLi4vY29yZS9hc3NldHMnO1xyXG5pbXBvcnQgeyBDb2xvciwgTWF0NCwgVmVjMyB9IGZyb20gJy4uLy4uLy4uL2NvcmUvbWF0aCc7XHJcbmltcG9ydCB7IElSZW5kZXJEYXRhLCBSZW5kZXJEYXRhIH0gZnJvbSAnLi4vLi4vLi4vY29yZS9yZW5kZXJlci91aS9yZW5kZXItZGF0YSc7XHJcbmltcG9ydCB7IFVJIH0gZnJvbSAnLi4vLi4vLi4vY29yZS9yZW5kZXJlci91aS91aSc7XHJcbmltcG9ydCB7IFNwcml0ZUNvbXBvbmVudCB9IGZyb20gJy4uLy4uL2NvbXBvbmVudHMnO1xyXG5pbXBvcnQgeyBJQXNzZW1ibGVyIH0gZnJvbSAnLi4vLi4vLi4vY29yZS9yZW5kZXJlci91aS9iYXNlJztcclxuXHJcbmNvbnN0IHZlYzNfdGVtcCA9IG5ldyBWZWMzKCk7XHJcbmNvbnN0IG1hdHJpeCA9IG5ldyBNYXQ0KCk7XHJcblxyXG4vKipcclxuICogc2xpY2VkIOe7hOijheWZqFxyXG4gKiDlj6/pgJrov4cgY2MuVUkuc2xpY2VkIOiOt+WPluivpee7hOijheWZqOOAglxyXG4gKi9cclxuZXhwb3J0IGNvbnN0IHNsaWNlZDogSUFzc2VtYmxlciA9IHtcclxuICAgIHVzZU1vZGVsOiBmYWxzZSxcclxuXHJcbiAgICBjcmVhdGVEYXRhIChzcHJpdGU6IFNwcml0ZUNvbXBvbmVudCkge1xyXG4gICAgICAgIGNvbnN0IHJlbmRlckRhdGE6IFJlbmRlckRhdGEgfCBudWxsID0gc3ByaXRlLnJlcXVlc3RSZW5kZXJEYXRhKCk7XHJcbiAgICAgICAgLy8gMC00IGZvciBsb2NhbCB2ZXJ0c1xyXG4gICAgICAgIC8vIDUtMjAgZm9yIHdvcmxkIHZlcnRzXHJcbiAgICAgICAgcmVuZGVyRGF0YSEuZGF0YUxlbmd0aCA9IDIwO1xyXG5cclxuICAgICAgICByZW5kZXJEYXRhIS52ZXJ0ZXhDb3VudCA9IDE2O1xyXG4gICAgICAgIHJlbmRlckRhdGEhLmluZGljZUNvdW50ID0gNTQ7XHJcbiAgICAgICAgcmV0dXJuIHJlbmRlckRhdGEgYXMgUmVuZGVyRGF0YTtcclxuICAgIH0sXHJcblxyXG4gICAgdXBkYXRlUmVuZGVyRGF0YSAoc3ByaXRlOiBTcHJpdGVDb21wb25lbnQpIHtcclxuICAgICAgICBjb25zdCBmcmFtZSA9IHNwcml0ZS5zcHJpdGVGcmFtZTtcclxuXHJcbiAgICAgICAgLy8gVE9ETzogTWF0ZXJpYWwgQVBJIGRlc2lnbiBhbmQgZXhwb3J0IGZyb20gZWRpdG9yIGNvdWxkIGFmZmVjdCB0aGUgbWF0ZXJpYWwgYWN0aXZhdGlvbiBwcm9jZXNzXHJcbiAgICAgICAgLy8gbmVlZCB0byB1cGRhdGUgdGhlIGxvZ2ljIGhlcmVcclxuICAgICAgICAvLyBpZiAoZnJhbWUpIHtcclxuICAgICAgICAvLyAgICAgaWYgKCFmcmFtZS5fb3JpZ2luYWwgJiYgZHluYW1pY0F0bGFzTWFuYWdlcikge1xyXG4gICAgICAgIC8vICAgICAgICAgZHluYW1pY0F0bGFzTWFuYWdlci5pbnNlcnRTcHJpdGVGcmFtZShmcmFtZSk7XHJcbiAgICAgICAgLy8gICAgIH1cclxuICAgICAgICAvLyAgICAgaWYgKHNwcml0ZS5fbWF0ZXJpYWwuX3RleHR1cmUgIT09IGZyYW1lLl90ZXh0dXJlKSB7XHJcbiAgICAgICAgLy8gICAgICAgICBzcHJpdGUuX2FjdGl2YXRlTWF0ZXJpYWwoKTtcclxuICAgICAgICAvLyAgICAgfVxyXG4gICAgICAgIC8vIH1cclxuXHJcbiAgICAgICAgY29uc3QgcmVuZGVyRGF0YSA9IHNwcml0ZS5yZW5kZXJEYXRhO1xyXG4gICAgICAgIGlmIChyZW5kZXJEYXRhICYmIGZyYW1lKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHZlcnREaXJ0eSA9IHJlbmRlckRhdGEudmVydERpcnR5O1xyXG4gICAgICAgICAgICBpZiAodmVydERpcnR5KSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZVZlcnRzIShzcHJpdGUpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy51cGRhdGVXb3JsZFZlcnRzIShzcHJpdGUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfSxcclxuXHJcbiAgICB1cGRhdGVWZXJ0cyAoc3ByaXRlOiBTcHJpdGVDb21wb25lbnQpIHtcclxuICAgICAgICBjb25zdCByZW5kZXJEYXRhOiBSZW5kZXJEYXRhIHwgbnVsbCA9IHNwcml0ZS5yZW5kZXJEYXRhO1xyXG4gICAgICAgIGNvbnN0IGRhdGFzOiBJUmVuZGVyRGF0YVtdID0gcmVuZGVyRGF0YSEuZGF0YXM7XHJcbiAgICAgICAgY29uc3Qgbm9kZSA9IHNwcml0ZS5ub2RlO1xyXG4gICAgICAgIGNvbnN0IHdpZHRoID0gbm9kZS53aWR0aCE7XHJcbiAgICAgICAgY29uc3QgaGVpZ2h0ID0gbm9kZS5oZWlnaHQhO1xyXG4gICAgICAgIGNvbnN0IGFwcHggPSBub2RlLmFuY2hvclghICogd2lkdGg7XHJcbiAgICAgICAgY29uc3QgYXBweSA9IG5vZGUuYW5jaG9yWSEgKiBoZWlnaHQ7XHJcblxyXG4gICAgICAgIGNvbnN0IGZyYW1lOiBTcHJpdGVGcmFtZXxudWxsID0gc3ByaXRlLnNwcml0ZUZyYW1lO1xyXG4gICAgICAgIGNvbnN0IGxlZnRXaWR0aCA9IGZyYW1lIS5pbnNldExlZnQ7XHJcbiAgICAgICAgY29uc3QgcmlnaHRXaWR0aCA9IGZyYW1lIS5pbnNldFJpZ2h0O1xyXG4gICAgICAgIGNvbnN0IHRvcEhlaWdodCA9IGZyYW1lIS5pbnNldFRvcDtcclxuICAgICAgICBjb25zdCBib3R0b21IZWlnaHQgPSBmcmFtZSEuaW5zZXRCb3R0b207XHJcblxyXG4gICAgICAgIGxldCBzaXphYmxlV2lkdGggPSB3aWR0aCAtIGxlZnRXaWR0aCAtIHJpZ2h0V2lkdGg7XHJcbiAgICAgICAgbGV0IHNpemFibGVIZWlnaHQgPSBoZWlnaHQgLSB0b3BIZWlnaHQgLSBib3R0b21IZWlnaHQ7XHJcbiAgICAgICAgbGV0IHhTY2FsZSA9IHdpZHRoIC8gKGxlZnRXaWR0aCArIHJpZ2h0V2lkdGgpO1xyXG4gICAgICAgIGxldCB5U2NhbGUgPSBoZWlnaHQgLyAodG9wSGVpZ2h0ICsgYm90dG9tSGVpZ2h0KTtcclxuICAgICAgICB4U2NhbGUgPSAoaXNOYU4oeFNjYWxlKSB8fCB4U2NhbGUgPiAxKSA/IDEgOiB4U2NhbGU7XHJcbiAgICAgICAgeVNjYWxlID0gKGlzTmFOKHlTY2FsZSkgfHwgeVNjYWxlID4gMSkgPyAxIDogeVNjYWxlO1xyXG4gICAgICAgIHNpemFibGVXaWR0aCA9IHNpemFibGVXaWR0aCA8IDAgPyAwIDogc2l6YWJsZVdpZHRoO1xyXG4gICAgICAgIHNpemFibGVIZWlnaHQgPSBzaXphYmxlSGVpZ2h0IDwgMCA/IDAgOiBzaXphYmxlSGVpZ2h0O1xyXG5cclxuICAgICAgICBkYXRhc1swXS54ID0gLWFwcHg7XHJcbiAgICAgICAgZGF0YXNbMF0ueSA9IC1hcHB5O1xyXG4gICAgICAgIGRhdGFzWzFdLnggPSBsZWZ0V2lkdGggKiB4U2NhbGUgLSBhcHB4O1xyXG4gICAgICAgIGRhdGFzWzFdLnkgPSBib3R0b21IZWlnaHQgKiB5U2NhbGUgLSBhcHB5O1xyXG4gICAgICAgIGRhdGFzWzJdLnggPSBkYXRhc1sxXS54ICsgc2l6YWJsZVdpZHRoO1xyXG4gICAgICAgIGRhdGFzWzJdLnkgPSBkYXRhc1sxXS55ICsgc2l6YWJsZUhlaWdodDtcclxuICAgICAgICBkYXRhc1szXS54ID0gd2lkdGggLSBhcHB4O1xyXG4gICAgICAgIGRhdGFzWzNdLnkgPSBoZWlnaHQgLSBhcHB5O1xyXG5cclxuICAgICAgICByZW5kZXJEYXRhIS52ZXJ0RGlydHkgPSBmYWxzZTtcclxuICAgIH0sXHJcblxyXG4gICAgZmlsbEJ1ZmZlcnMgKHNwcml0ZTogU3ByaXRlQ29tcG9uZW50LCByZW5kZXJlcjogVUkpIHtcclxuICAgICAgICBpZiAoc3ByaXRlLm5vZGUuaGFzQ2hhbmdlZEZsYWdzKSB7XHJcbiAgICAgICAgICAgIHRoaXMudXBkYXRlV29ybGRWZXJ0cyhzcHJpdGUpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgbGV0IGJ1ZmZlciA9IHJlbmRlcmVyLmN1cnJCdWZmZXJCYXRjaCE7XHJcbiAgICAgICAgY29uc3QgcmVuZGVyRGF0YTogUmVuZGVyRGF0YXxudWxsID0gc3ByaXRlLnJlbmRlckRhdGE7XHJcbiAgICAgICAgLy8gY29uc3Qgbm9kZTogTm9kZSA9IHNwcml0ZS5ub2RlO1xyXG4gICAgICAgIC8vIGNvbnN0IGNvbG9yOiBDb2xvciA9IHNwcml0ZS5jb2xvcjtcclxuICAgICAgICBjb25zdCBkYXRhczogSVJlbmRlckRhdGFbXSA9IHJlbmRlckRhdGEhLmRhdGFzO1xyXG5cclxuICAgICAgICBsZXQgdmVydGV4T2Zmc2V0ID0gYnVmZmVyLmJ5dGVPZmZzZXQgPj4gMjtcclxuICAgICAgICBjb25zdCB2ZXJ0ZXhDb3VudCA9IHJlbmRlckRhdGEhLnZlcnRleENvdW50O1xyXG4gICAgICAgIGxldCBpbmRpY2VPZmZzZXQ6IG51bWJlciA9IGJ1ZmZlci5pbmRpY2VPZmZzZXQ7XHJcbiAgICAgICAgbGV0IHZlcnRleElkOiBudW1iZXIgPSBidWZmZXIudmVydGV4T2Zmc2V0O1xyXG5cclxuICAgICAgICBjb25zdCB1dlNsaWNlZDogSVVWW10gPSBzcHJpdGUhLnNwcml0ZUZyYW1lIS51dlNsaWNlZDtcclxuXHJcbiAgICAgICAgY29uc3QgaXNSZWNyZWF0ZSA9IGJ1ZmZlci5yZXF1ZXN0KHZlcnRleENvdW50LCByZW5kZXJEYXRhIS5pbmRpY2VDb3VudCk7XHJcbiAgICAgICAgaWYgKCFpc1JlY3JlYXRlKSB7XHJcbiAgICAgICAgICAgIGJ1ZmZlciA9IHJlbmRlcmVyLmN1cnJCdWZmZXJCYXRjaCE7XHJcbiAgICAgICAgICAgIHZlcnRleE9mZnNldCA9IDA7XHJcbiAgICAgICAgICAgIGluZGljZU9mZnNldCA9IDA7XHJcbiAgICAgICAgICAgIHZlcnRleElkID0gMDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIGJ1ZmZlciBkYXRhIG1heSBiZSByZWFsbG9jLCBuZWVkIGdldCByZWZlcmVuY2UgYWZ0ZXIgcmVxdWVzdC5cclxuICAgICAgICBjb25zdCB2YnVmOiBGbG9hdDMyQXJyYXl8bnVsbCA9IGJ1ZmZlci52RGF0YTtcclxuICAgICAgICAvLyBjb25zdCAgdWludGJ1ZiA9IGJ1ZmZlci5fdWludFZEYXRhLFxyXG4gICAgICAgIGNvbnN0IGlidWY6IFVpbnQxNkFycmF5fG51bGwgPSBidWZmZXIuaURhdGE7XHJcblxyXG4gICAgICAgIGZvciAobGV0IGkgPSA0OyBpIDwgMjA7ICsraSkge1xyXG4gICAgICAgICAgICBjb25zdCB2ZXJ0ID0gZGF0YXNbaV07XHJcbiAgICAgICAgICAgIGNvbnN0IHV2cyA9IHV2U2xpY2VkW2kgLSA0XTtcclxuXHJcbiAgICAgICAgICAgIHZidWYhW3ZlcnRleE9mZnNldCsrXSA9IHZlcnQueDtcclxuICAgICAgICAgICAgdmJ1ZiFbdmVydGV4T2Zmc2V0KytdID0gdmVydC55O1xyXG4gICAgICAgICAgICB2YnVmIVt2ZXJ0ZXhPZmZzZXQrK10gPSB2ZXJ0Lno7XHJcbiAgICAgICAgICAgIHZidWYhW3ZlcnRleE9mZnNldCsrXSA9IHV2cy51O1xyXG4gICAgICAgICAgICB2YnVmIVt2ZXJ0ZXhPZmZzZXQrK10gPSB1dnMudjtcclxuICAgICAgICAgICAgQ29sb3IudG9BcnJheSh2YnVmISwgc3ByaXRlLmNvbG9yLCB2ZXJ0ZXhPZmZzZXQpO1xyXG4gICAgICAgICAgICB2ZXJ0ZXhPZmZzZXQgKz0gNDtcclxuICAgICAgICAgICAgLy8gdWludGJ1Zlt2ZXJ0ZXhPZmZzZXQrK10gPSBjb2xvcjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZvciAobGV0IHIgPSAwOyByIDwgMzsgKytyKSB7XHJcbiAgICAgICAgICAgIGZvciAobGV0IGMgPSAwOyBjIDwgMzsgKytjKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBzdGFydCA9IHZlcnRleElkICsgciAqIDQgKyBjO1xyXG4gICAgICAgICAgICAgICAgaWJ1ZiFbaW5kaWNlT2Zmc2V0KytdID0gc3RhcnQ7XHJcbiAgICAgICAgICAgICAgICBpYnVmIVtpbmRpY2VPZmZzZXQrK10gPSBzdGFydCArIDE7XHJcbiAgICAgICAgICAgICAgICBpYnVmIVtpbmRpY2VPZmZzZXQrK10gPSBzdGFydCArIDQ7XHJcbiAgICAgICAgICAgICAgICBpYnVmIVtpbmRpY2VPZmZzZXQrK10gPSBzdGFydCArIDE7XHJcbiAgICAgICAgICAgICAgICBpYnVmIVtpbmRpY2VPZmZzZXQrK10gPSBzdGFydCArIDU7XHJcbiAgICAgICAgICAgICAgICBpYnVmIVtpbmRpY2VPZmZzZXQrK10gPSBzdGFydCArIDQ7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9LFxyXG5cclxuICAgIHVwZGF0ZVdvcmxkVmVydHMgKHNwcml0ZTogU3ByaXRlQ29tcG9uZW50KSB7XHJcbiAgICAgICAgY29uc3Qgbm9kZSA9IHNwcml0ZS5ub2RlO1xyXG4gICAgICAgIGNvbnN0IGRhdGFzOiBJUmVuZGVyRGF0YVtdID0gc3ByaXRlIS5yZW5kZXJEYXRhIS5kYXRhcztcclxuICAgICAgICBub2RlLmdldFdvcmxkTWF0cml4KG1hdHJpeCk7XHJcbiAgICAgICAgZm9yIChsZXQgcm93ID0gMDsgcm93IDwgNDsgKytyb3cpIHtcclxuICAgICAgICAgICAgY29uc3Qgcm93RCA9IGRhdGFzW3Jvd107XHJcbiAgICAgICAgICAgIGZvciAobGV0IGNvbCA9IDA7IGNvbCA8IDQ7ICsrY29sKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBjb2xEID0gZGF0YXNbY29sXTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHdvcmxkID0gZGF0YXNbNCArIHJvdyAqIDQgKyBjb2xdO1xyXG5cclxuICAgICAgICAgICAgICAgIFZlYzMuc2V0KHZlYzNfdGVtcCwgY29sRC54LCByb3dELnksIDApO1xyXG4gICAgICAgICAgICAgICAgVmVjMy50cmFuc2Zvcm1NYXQ0KHdvcmxkLCB2ZWMzX3RlbXAsIG1hdHJpeCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9LFxyXG59O1xyXG4iXX0=