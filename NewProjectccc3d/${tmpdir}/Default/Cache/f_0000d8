(function (global, factory) {
  if (typeof define === "function" && define.amd) {
    define(["exports", "../../core/assets/index.js", "../../core/data/class-decorator.js", "../../core/utils/index.js", "../../core/utils/pool.js", "../../core/math/index.js", "../../core/scene-graph/index.js", "./label-component.js", "./label-outline-component.js", "./sprite-component.js", "../../core/components/ui-base/ui-component.js", "../../core/components/ui-base/ui-transform-component.js", "../../core/platform/debug.js", "../../core/load-pipeline/index.js", "../../core/default-constants.js"], factory);
  } else if (typeof exports !== "undefined") {
    factory(exports, require("../../core/assets/index.js"), require("../../core/data/class-decorator.js"), require("../../core/utils/index.js"), require("../../core/utils/pool.js"), require("../../core/math/index.js"), require("../../core/scene-graph/index.js"), require("./label-component.js"), require("./label-outline-component.js"), require("./sprite-component.js"), require("../../core/components/ui-base/ui-component.js"), require("../../core/components/ui-base/ui-transform-component.js"), require("../../core/platform/debug.js"), require("../../core/load-pipeline/index.js"), require("../../core/default-constants.js"));
  } else {
    var mod = {
      exports: {}
    };
    factory(mod.exports, global.index, global.classDecorator, global.index, global.pool, global.index, global.index, global.labelComponent, global.labelOutlineComponent, global.spriteComponent, global.uiComponent, global.uiTransformComponent, global.debug, global.index, global.defaultConstants);
    global.richTextComponent = mod.exports;
  }
})(typeof globalThis !== "undefined" ? globalThis : typeof self !== "undefined" ? self : this, function (_exports, _index, _classDecorator, _index2, _pool, _index3, _index4, _labelComponent, _labelOutlineComponent, _spriteComponent, _uiComponent, _uiTransformComponent, _debug, _index5, _defaultConstants) {
  "use strict";

  Object.defineProperty(_exports, "__esModule", {
    value: true
  });
  _exports.RichTextComponent = void 0;
  _pool = _interopRequireDefault(_pool);

  var _dec, _dec2, _dec3, _dec4, _dec5, _dec6, _dec7, _dec8, _dec9, _dec10, _dec11, _dec12, _class, _class2, _descriptor, _descriptor2, _descriptor3, _descriptor4, _descriptor5, _descriptor6, _descriptor7, _descriptor8, _class3, _temp;

  function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

  function _typeof(obj) { "@babel/helpers - typeof"; if (typeof Symbol === "function" && typeof Symbol.iterator === "symbol") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }; } return _typeof(obj); }

  function _createForOfIteratorHelper(o) { if (typeof Symbol === "undefined" || o[Symbol.iterator] == null) { if (Array.isArray(o) || (o = _unsupportedIterableToArray(o))) { var i = 0; var F = function F() {}; return { s: F, n: function n() { if (i >= o.length) return { done: true }; return { done: false, value: o[i++] }; }, e: function e(_e) { throw _e; }, f: F }; } throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); } var it, normalCompletion = true, didErr = false, err; return { s: function s() { it = o[Symbol.iterator](); }, n: function n() { var step = it.next(); normalCompletion = step.done; return step; }, e: function e(_e2) { didErr = true; err = _e2; }, f: function f() { try { if (!normalCompletion && it["return"] != null) it["return"](); } finally { if (didErr) throw err; } } }; }

  function _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(n); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }

  function _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }

  function _initializerDefineProperty(target, property, descriptor, context) { if (!descriptor) return; Object.defineProperty(target, property, { enumerable: descriptor.enumerable, configurable: descriptor.configurable, writable: descriptor.writable, value: descriptor.initializer ? descriptor.initializer.call(context) : void 0 }); }

  function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

  function _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === "object" || typeof call === "function")) { return call; } return _assertThisInitialized(self); }

  function _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }

  function _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return self; }

  function _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }

  function _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }

  function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); if (superClass) _setPrototypeOf(subClass, superClass); }

  function _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }

  function _initializerWarningHelper(descriptor, context) { throw new Error('Decorating class property failed. Please ensure that ' + 'proposal-class-properties is enabled and runs after the decorators transform.'); }

  function _applyDecoratedDescriptor(target, property, decorators, descriptor, context) { var desc = {}; Object.keys(descriptor).forEach(function (key) { desc[key] = descriptor[key]; }); desc.enumerable = !!desc.enumerable; desc.configurable = !!desc.configurable; if ('value' in desc || desc.initializer) { desc.writable = true; } desc = decorators.slice().reverse().reduce(function (desc, decorator) { return decorator(target, property, desc) || desc; }, desc); if (context && desc.initializer !== void 0) { desc.value = desc.initializer ? desc.initializer.call(context) : void 0; desc.initializer = undefined; } if (desc.initializer === void 0) { Object.defineProperty(target, property, desc); desc = null; } return desc; }

  var _htmlTextParser = new _index2.HtmlTextParser();

  var RichTextChildName = 'RICHTEXT_CHILD';
  var RichTextChildImageName = 'RICHTEXT_Image_CHILD';
  /**
   * @zh
   * 返回一个可延时调用函数。只要不被调用就不会触发。选择 ‘immediate’ 则在触发时不会延迟而是立马回调。
   *
   * @param func - 延时调用函数。
   * @param wait - 延时时间。
   * @param immediate - 是否立马执行回调。
   */

  function debounce(func, wait, immediate) {
    var timeout;
    return function () {
      for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {
        args[_key] = arguments[_key];
      }

      var context = this;

      var later = function later() {
        timeout = null;

        if (!immediate) {
          func.apply(context, args);
        }
      };

      var callNow = immediate && !timeout;
      clearTimeout(timeout);
      timeout = setTimeout(later, wait);

      if (callNow) {
        func.apply(context, args);
      }
    };
  }
  /**
   * 富文本池。<br/>
   */


  var pool = new _pool.default(function (labelSeg) {
    if (_defaultConstants.EDITOR) {
      return false;
    }

    if (_defaultConstants.DEV) {
      (0, _debug.assert)(!labelSeg.node.parent, 'Recycling node\'s parent should be null!');
    }

    if (!cc.isValid(labelSeg.node)) {
      return false;
    } else if (labelSeg.node.getComponent(_labelOutlineComponent.LabelOutlineComponent)) {
      return false;
    }

    return true;
  }, 20); // @ts-ignore

  pool.get = function (str, richtext) {
    var labelSeg = this._get();

    if (!labelSeg) {
      labelSeg = {
        node: new _index4.PrivateNode(RichTextChildName),
        comp: null,
        lineCount: 0,
        styleIndex: 0,
        clickHandler: ''
      };
    }

    var labelNode = labelSeg.node;

    if (!labelNode) {
      labelNode = new _index4.PrivateNode(RichTextChildName);
    }

    var labelComponent = labelNode.getComponent(_labelComponent.LabelComponent);

    if (!labelComponent) {
      labelComponent = labelNode.addComponent(_labelComponent.LabelComponent);
    }

    labelComponent = labelComponent;
    labelNode.setPosition(0, 0, 0);
    labelNode.setAnchorPoint(0.5, 0.5);
    labelNode.setContentSize(128, 128); // labelNode.skewX = 0;

    if (typeof str !== 'string') {
      str = '' + str;
    }

    var isAsset = richtext.font instanceof _index.Font;

    if (isAsset) {
      labelComponent.font = richtext.font;
    } else {
      labelComponent.fontFamily = 'Arial';
    }

    labelComponent.string = str;
    labelComponent.horizontalAlign = _labelComponent.HorizontalTextAlignment.LEFT;
    labelComponent.verticalAlign = _labelComponent.VerticalTextAlignment.TOP;
    labelComponent.fontSize = richtext.fontSize || 40;
    labelComponent.overflow = 0;
    labelComponent.enableWrapText = true;
    labelComponent.lineHeight = 40;
    labelComponent.isBold = false;
    labelComponent.isItalic = false;
    labelComponent.isUnderline = false;
    var labelObj = {
      node: labelNode,
      comp: labelComponent,
      lineCount: 0,
      clickHandler: '',
      styleIndex: 0
    };
    return labelObj;
  };

  /**
   * @en
   * The RichText Component.
   *
   * @zh
   * 富文本组件。
   */
  var RichTextComponent = (_dec = (0, _classDecorator.ccclass)('cc.RichTextComponent'), _dec2 = (0, _classDecorator.help)('i18n:cc.RichTextComponent'), _dec3 = (0, _classDecorator.executionOrder)(110), _dec4 = (0, _classDecorator.menu)('UI/Render/RichText'), _dec5 = (0, _classDecorator.property)({
    multiline: true,
    tooltip: '富文本显示的文本内容'
  }), _dec6 = (0, _classDecorator.property)({
    type: _labelComponent.HorizontalTextAlignment,
    tooltip: '文本内容的水平对齐方式'
  }), _dec7 = (0, _classDecorator.property)({
    tooltip: '富文本字体大小'
  }), _dec8 = (0, _classDecorator.property)({
    type: _index.Font,
    tooltip: '富文本定制字体'
  }), _dec9 = (0, _classDecorator.property)({
    tooltip: '富文本的最大宽度'
  }), _dec10 = (0, _classDecorator.property)({
    tooltip: '富文本行高'
  }), _dec11 = (0, _classDecorator.property)({
    type: _index.SpriteAtlas,
    tooltip: '对于 img 标签里面的 src 属性名称，都需要在 imageAtlas 里面找到一个有效的 spriteFrame，否则 img tag 会判定为无效'
  }), _dec12 = (0, _classDecorator.property)({
    tooltip: '选中此选项后，RichText 将阻止节点边界框中的所有输入事件（鼠标和触摸），从而防止输入事件穿透到底层节点'
  }), _dec(_class = _dec2(_class = _dec3(_class = _dec4(_class = (0, _classDecorator.executeInEditMode)(_class = (_class2 = (_temp = _class3 = /*#__PURE__*/function (_UIComponent) {
    _inherits(RichTextComponent, _UIComponent);

    _createClass(RichTextComponent, [{
      key: "string",

      /**
       * @en
       * Content string of RichText.
       *
       * @zh
       * 富文本显示的文本内容。
       */
      get: function get() {
        return this._string;
      },
      set: function set(value) {
        if (this._string === value) {
          return;
        }

        this._string = value;

        this._updateRichTextStatus();
      }
      /**
       * @en
       * Horizontal Alignment of each line in RichText.
       *
       * @zh
       * 文本内容的水平对齐方式。
       */

    }, {
      key: "horizontalAlign",
      get: function get() {
        return this._horizontalAlign;
      },
      set: function set(value) {
        if (this.horizontalAlign === value) {
          return;
        }

        this._horizontalAlign = value;
        this._layoutDirty = true;

        this._updateRichTextStatus();
      }
      /**
       * @en
       * Font size of RichText.
       *
       * @zh
       * 富文本字体大小。
       */

    }, {
      key: "fontSize",
      get: function get() {
        return this._fontSize;
      },
      set: function set(value) {
        if (this._fontSize === value) {
          return;
        }

        this._fontSize = value;
        this._layoutDirty = true;

        this._updateRichTextStatus();
      }
      /**
       * @en
       * Custom System font of RichText.
       *
       * @zh
       * 富文本定制字体。
       */

    }, {
      key: "font",
      get: function get() {
        return this._font;
      },
      set: function set(value) {
        if (this._font === value) {
          return;
        } // TODO: Remove when Editor inspector add multi-format support


        if (value instanceof _index.BitmapFont) {
          console.warn('RichText only accepts TTF fonts, but you are trying to use a bitmap font.');
          return;
        }

        this._font = value;
        this._layoutDirty = true;

        if (this._font) {
          this._onTTFLoaded();
        }

        this._updateRichTextStatus();
      }
      /**
       * @en
       * The maximize width of the RichText.
       *
       * @zh
       * 富文本的最大宽度。
       */

    }, {
      key: "maxWidth",
      get: function get() {
        return this._maxWidth;
      },
      set: function set(value) {
        if (this._maxWidth === value) {
          return;
        }

        this._maxWidth = value;
        this._layoutDirty = true;

        this._updateRichTextStatus();
      }
      /**
       * @en
       * Line Height of RichText.
       *
       * @zh
       * 富文本行高。
       */

    }, {
      key: "lineHeight",
      get: function get() {
        return this._lineHeight;
      },
      set: function set(value) {
        if (this._lineHeight === value) {
          return;
        }

        this._lineHeight = value;
        this._layoutDirty = true;

        this._updateRichTextStatus();
      }
      /**
       * @en
       * The image atlas for the img tag. For each src value in the img tag, there should be a valid spriteFrame in the image atlas.
       *
       * @zh
       * 对于 img 标签里面的 src 属性名称，都需要在 imageAtlas 里面找到一个有效的 spriteFrame，否则 img tag 会判定为无效。
       */

    }, {
      key: "imageAtlas",
      get: function get() {
        return this._imageAtlas;
      },
      set: function set(value) {
        if (this._imageAtlas === value) {
          return;
        }

        this._imageAtlas = value;
        this._layoutDirty = true;

        this._updateRichTextStatus();
      }
      /**
       * @en
       * Once checked, the RichText will block all input events (mouse and touch) within
       * the bounding box of the node, preventing the input from penetrating into the underlying node.
       *
       * @zh
       * 选中此选项后，RichText 将阻止节点边界框中的所有输入事件（鼠标和触摸），从而防止输入事件穿透到底层节点。
       */

    }, {
      key: "handleTouchEvent",
      get: function get() {
        return this._handleTouchEvent;
      },
      set: function set(value) {
        if (this._handleTouchEvent === value) {
          return;
        }

        this._handleTouchEvent = value;

        if (this.enabledInHierarchy) {
          this.handleTouchEvent ? this._addEventListeners() : this._removeEventListeners();
        }
      }
    }]);

    function RichTextComponent() {
      var _this;

      _classCallCheck(this, RichTextComponent);

      _this = _possibleConstructorReturn(this, _getPrototypeOf(RichTextComponent).call(this));

      _initializerDefineProperty(_this, "_lineHeight", _descriptor, _assertThisInitialized(_this));

      _initializerDefineProperty(_this, "_string", _descriptor2, _assertThisInitialized(_this));

      _initializerDefineProperty(_this, "_horizontalAlign", _descriptor3, _assertThisInitialized(_this));

      _initializerDefineProperty(_this, "_fontSize", _descriptor4, _assertThisInitialized(_this));

      _initializerDefineProperty(_this, "_maxWidth", _descriptor5, _assertThisInitialized(_this));

      _initializerDefineProperty(_this, "_font", _descriptor6, _assertThisInitialized(_this));

      _initializerDefineProperty(_this, "_imageAtlas", _descriptor7, _assertThisInitialized(_this));

      _initializerDefineProperty(_this, "_handleTouchEvent", _descriptor8, _assertThisInitialized(_this));

      _this._textArray = [];
      _this._labelSegments = [];
      _this._labelSegmentsCache = [];
      _this._linesWidth = [];
      _this._lineCount = 1;
      _this._labelWidth = 0;
      _this._labelHeight = 0;
      _this._layoutDirty = true;
      _this._lineOffsetX = 0;
      _this._updateRichTextStatus = void 0;

      if (_defaultConstants.EDITOR) {
        _this._updateRichTextStatus = debounce(_this._updateRichText, 200);
      } else {
        _this._updateRichTextStatus = _this._updateRichText;
      }

      return _this;
    }

    _createClass(RichTextComponent, [{
      key: "onEnable",
      value: function onEnable() {
        if (this.handleTouchEvent) {
          this._addEventListeners();
        }

        this._updateRichText();

        this._activateChildren(true);
      }
    }, {
      key: "onDisable",
      value: function onDisable() {
        if (this.handleTouchEvent) {
          this._removeEventListeners();
        }

        this._activateChildren(false);
      }
    }, {
      key: "start",
      value: function start() {
        this._onTTFLoaded();

        this.node.on(_index4.Node.EventType.ANCHOR_CHANGED, this._anchorChanged, this);
      }
    }, {
      key: "onRestore",
      value: function onRestore() {
        if (!_defaultConstants.EDITOR) {
          return;
        } // TODO: refine undo/redo system
        // Because undo/redo will not call onEnable/onDisable,
        // we need call onEnable/onDisable manually to active/disactive children nodes.


        if (this.enabledInHierarchy) {
          this.onEnable();
        } else {
          this.onDisable();
        }
      }
    }, {
      key: "onDestroy",
      value: function onDestroy() {
        var _iterator = _createForOfIteratorHelper(this._labelSegments),
            _step;

        try {
          for (_iterator.s(); !(_step = _iterator.n()).done;) {
            var seg = _step.value;
            seg.node.removeFromParent();
            pool.put(seg);
          }
        } catch (err) {
          _iterator.e(err);
        } finally {
          _iterator.f();
        }

        this.node.off(_index4.Node.EventType.ANCHOR_CHANGED, this._anchorChanged);
      }
    }, {
      key: "_addEventListeners",
      value: function _addEventListeners() {
        this.node.on(_index4.Node.EventType.TOUCH_END, this._onTouchEnded, this);
      }
    }, {
      key: "_removeEventListeners",
      value: function _removeEventListeners() {
        this.node.off(_index4.Node.EventType.TOUCH_END, this._onTouchEnded, this);
      }
    }, {
      key: "_updateLabelSegmentTextAttributes",
      value: function _updateLabelSegmentTextAttributes() {
        var _this2 = this;

        this._labelSegments.forEach(function (item) {
          _this2._applyTextAttribute(item);
        });
      }
    }, {
      key: "_createFontLabel",
      value: function _createFontLabel(str) {
        // @ts-ignore
        return pool.get(str, this);
      }
    }, {
      key: "_onTTFLoaded",
      value: function _onTTFLoaded() {
        if (this._font instanceof _index.TTFFont) {
          if (this._font._nativeAsset) {
            this._layoutDirty = true;

            this._updateRichText();
          } else {
            var self = this;

            _index5.loader.load(this._font.nativeUrl, function (err, fontFamily) {
              self._layoutDirty = true;

              self._updateRichText();
            });
          }
        } else {
          this._layoutDirty = true;

          this._updateRichText();
        }
      }
    }, {
      key: "_measureText",
      value: function _measureText(styleIndex, string) {
        var self = this;

        var func = function func(s) {
          var label;

          if (self._labelSegmentsCache.length === 0) {
            label = self._createFontLabel(s);

            self._labelSegmentsCache.push(label);
          } else {
            label = self._labelSegmentsCache[0];
            label.node.getComponent(_labelComponent.LabelComponent).string = s;
          }

          label.styleIndex = styleIndex;

          self._applyTextAttribute(label);

          var labelSize = label.node.getContentSize();
          return labelSize.width;
        };

        if (string) {
          return func(string);
        } else {
          return func;
        }
      }
    }, {
      key: "_onTouchEnded",
      value: function _onTouchEnded(event) {
        var _this3 = this;

        var components = this.node.getComponents(_uiComponent.UIComponent);
        var self = this;

        var _iterator2 = _createForOfIteratorHelper(this._labelSegments),
            _step2;

        try {
          var _loop = function _loop() {
            var seg = _step2.value;
            var clickHandler = seg.clickHandler;

            if (clickHandler && _this3._containsTouchLocation(seg, event.touch.getUILocation())) {
              components.forEach(function (component) {
                var func = component[clickHandler];

                if (component.enabledInHierarchy && func) {
                  func.call(self, event);
                }
              });
              event.propagationStopped = true;
            }
          };

          for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {
            _loop();
          }
        } catch (err) {
          _iterator2.e(err);
        } finally {
          _iterator2.f();
        }
      }
    }, {
      key: "_containsTouchLocation",
      value: function _containsTouchLocation(label, point) {
        var comp = label.node.getComponent(_uiTransformComponent.UITransformComponent);

        if (!comp) {
          return false;
        }

        var myRect = comp.getBoundingBoxToWorld();
        return myRect.contains(point);
      }
    }, {
      key: "_resetState",
      value: function _resetState() {
        var _this4 = this;

        var children = this.node.children;

        var _loop2 = function _loop2(i) {
          var child = children[i];

          if (child.name === RichTextChildName || child.name === RichTextChildImageName) {
            if (child.parent === _this4.node) {
              child.parent = null;
            } else {
              // In case child.parent !== this.node, child cannot be removed from children
              children.splice(i, 1);
            }

            if (child.name === RichTextChildName) {
              var index = _this4._labelSegments.findIndex(function (seg) {
                return seg.node === child;
              });

              if (index !== -1) {
                pool.put(_this4._labelSegments[index]);
              }
            }
          }
        };

        for (var i = children.length - 1; i >= 0; i--) {
          _loop2(i);
        }

        this._labelSegments.length = 0;
        this._labelSegmentsCache.length = 0;
        this._linesWidth.length = 0;
        this._lineOffsetX = 0;
        this._lineCount = 1;
        this._labelWidth = 0;
        this._labelHeight = 0;
        this._layoutDirty = true;
      }
    }, {
      key: "_activateChildren",
      value: function _activateChildren(active) {
        for (var i = this.node.children.length - 1; i >= 0; i--) {
          var child = this.node.children[i];

          if (child.name === RichTextChildName || child.name === RichTextChildImageName) {
            child.active = active;
          }
        }
      }
    }, {
      key: "_addLabelSegment",
      value: function _addLabelSegment(stringToken, styleIndex) {
        var labelSegment;

        if (this._labelSegmentsCache.length === 0) {
          labelSegment = this._createFontLabel(stringToken);
        } else {
          labelSegment = this._labelSegmentsCache.pop();
          var label = labelSegment.node.getComponent(_labelComponent.LabelComponent);

          if (label) {
            label.string = stringToken;
          }
        }

        labelSegment.styleIndex = styleIndex;
        labelSegment.lineCount = this._lineCount;
        labelSegment.node.setAnchorPoint(0, 0);

        this._applyTextAttribute(labelSegment); // @ts-ignore


        this.node.addChild(labelSegment.node);

        this._labelSegments.push(labelSegment);

        return labelSegment;
      }
    }, {
      key: "_updateRichTextWithMaxWidth",
      value: function _updateRichTextWithMaxWidth(labelString, labelWidth, styleIndex) {
        var fragmentWidth = labelWidth;
        var labelSegment;

        if (this._lineOffsetX > 0 && fragmentWidth + this._lineOffsetX > this.maxWidth) {
          // concat previous line
          var checkStartIndex = 0;

          while (this._lineOffsetX <= this.maxWidth) {
            var checkEndIndex = this._getFirstWordLen(labelString, checkStartIndex, labelString.length);

            var checkString = labelString.substr(checkStartIndex, checkEndIndex);

            var checkStringWidth = this._measureText(styleIndex, checkString);

            if (this._lineOffsetX + checkStringWidth <= this.maxWidth) {
              this._lineOffsetX += checkStringWidth;
              checkStartIndex += checkEndIndex;
            } else {
              if (checkStartIndex > 0) {
                var remainingString = labelString.substr(0, checkStartIndex);

                this._addLabelSegment(remainingString, styleIndex);

                labelString = labelString.substr(checkStartIndex, labelString.length);
                fragmentWidth = this._measureText(styleIndex, labelString);
              }

              this._updateLineInfo();

              break;
            }
          }
        }

        if (fragmentWidth > this.maxWidth) {
          var fragments = (0, _index2.fragmentText)(labelString, fragmentWidth, this.maxWidth, this._measureText(styleIndex));

          for (var k = 0; k < fragments.length; ++k) {
            var splitString = fragments[k];
            labelSegment = this._addLabelSegment(splitString, styleIndex);
            var labelSize = labelSegment.node.getContentSize();
            this._lineOffsetX += labelSize.width;

            if (fragments.length > 1 && k < fragments.length - 1) {
              this._updateLineInfo();
            }
          }
        } else {
          this._lineOffsetX += fragmentWidth;

          this._addLabelSegment(labelString, styleIndex);
        }
      }
    }, {
      key: "_isLastComponentCR",
      value: function _isLastComponentCR(stringToken) {
        return stringToken.length - 1 === stringToken.lastIndexOf('\n');
      }
    }, {
      key: "_updateLineInfo",
      value: function _updateLineInfo() {
        this._linesWidth.push(this._lineOffsetX);

        this._lineOffsetX = 0;
        this._lineCount++;
      }
    }, {
      key: "_needsUpdateTextLayout",
      value: function _needsUpdateTextLayout(newTextArray) {
        if (this._layoutDirty || !this._textArray || !newTextArray) {
          return true;
        }

        if (this._textArray.length !== newTextArray.length) {
          return true;
        }

        for (var i = 0; i < this._textArray.length; i++) {
          var oldItem = this._textArray[i];
          var newItem = newTextArray[i];

          if (oldItem.text !== newItem.text) {
            return true;
          } else {
            if (oldItem.style) {
              if (newItem.style) {
                if (!!newItem.style.outline !== !!oldItem.style.outline) {
                  return true;
                }

                if (oldItem.style.size !== newItem.style.size || oldItem.style.italic !== newItem.style.italic || oldItem.style.isImage !== newItem.style.isImage) {
                  return true;
                }

                if (oldItem.style.isImage === newItem.style.isImage) {
                  if (oldItem.style.src !== newItem.style.src) {
                    return true;
                  }
                }
              } else {
                if (oldItem.style.size || oldItem.style.italic || oldItem.style.isImage || oldItem.style.outline) {
                  return true;
                }
              }
            } else {
              if (newItem.style) {
                if (newItem.style.size || newItem.style.italic || newItem.style.isImage || newItem.style.outline) {
                  return true;
                }
              }
            }
          }
        }

        return false;
      }
    }, {
      key: "_addRichTextImageElement",
      value: function _addRichTextImageElement(richTextElement) {
        if (!richTextElement.style) {
          return;
        }

        var spriteFrameName = richTextElement.style.src;

        var spriteFrame = this._imageAtlas && spriteFrameName && this._imageAtlas.getSpriteFrame(spriteFrameName);

        if (spriteFrame) {
          var spriteNode = new _index4.PrivateNode(RichTextChildImageName);
          var spriteComponent = spriteNode.addComponent(_spriteComponent.SpriteComponent);
          spriteNode.setAnchorPoint(0, 0);
          spriteComponent.type = _spriteComponent.SpriteComponent.Type.SLICED;
          spriteComponent.sizeMode = _spriteComponent.SpriteComponent.SizeMode.CUSTOM; // @ts-ignore

          this.node.addChild(spriteNode);
          var obj = {
            node: spriteNode,
            comp: spriteComponent,
            lineCount: 0,
            clickHandler: '',
            styleIndex: 0
          };

          this._labelSegments.push(obj);

          var spriteRect = spriteFrame.getRect();
          var scaleFactor = 1;
          var spriteWidth = spriteRect.width;
          var spriteHeight = spriteRect.height;
          var expectWidth = richTextElement.style.imageWidth;
          var expectHeight = richTextElement.style.imageHeight; // follow the original rule, expectHeight must less then lineHeight

          if (expectHeight !== undefined && expectHeight > 0 && expectHeight < this.lineHeight) {
            scaleFactor = expectHeight / spriteHeight;
            spriteWidth = spriteWidth * scaleFactor;
            spriteHeight = spriteHeight * scaleFactor;
          } else {
            scaleFactor = this.lineHeight / spriteHeight;
            spriteWidth = spriteWidth * scaleFactor;
            spriteHeight = spriteHeight * scaleFactor;
          }

          if (expectWidth !== undefined && expectWidth > 0) {
            spriteWidth = expectWidth;
          }

          if (this.maxWidth > 0) {
            if (this._lineOffsetX + spriteWidth > this.maxWidth) {
              this._updateLineInfo();
            }

            this._lineOffsetX += spriteWidth;
          } else {
            this._lineOffsetX += spriteWidth;

            if (this._lineOffsetX > this._labelWidth) {
              this._labelWidth = this._lineOffsetX;
            }
          }

          spriteComponent.spriteFrame = spriteFrame;
          spriteNode.setContentSize(spriteWidth, spriteHeight);
          obj.lineCount = this._lineCount;

          if (richTextElement.style.event) {
            var c = 'click';

            if (richTextElement.style.event[c]) {
              obj.clickHandler = richTextElement.style.event[c];
            }
          }
        } else {
          (0, _debug.warnID)(4400);
        }
      }
    }, {
      key: "_updateRichText",
      value: function _updateRichText() {
        if (!this.enabled) {
          return;
        }

        var newTextArray = _htmlTextParser.parse(this._string);

        if (!this._needsUpdateTextLayout(newTextArray)) {
          this._textArray = newTextArray.slice();

          this._updateLabelSegmentTextAttributes();

          return;
        }

        this._textArray = newTextArray.slice();

        this._resetState();

        var lastEmptyLine = false;
        var label;
        var labelSize;

        for (var i = 0; i < this._textArray.length; ++i) {
          var richTextElement = this._textArray[i];
          var text = richTextElement.text;

          if (text === undefined) {
            continue;
          } // handle <br/> <img /> tag


          if (text === '') {
            if (richTextElement.style && richTextElement.style.isNewLine) {
              this._updateLineInfo();

              continue;
            }

            if (richTextElement.style && richTextElement.style.isImage && this.imageAtlas) {
              this._addRichTextImageElement(richTextElement);

              continue;
            }
          }

          var multilineTexts = text.split('\n');

          for (var j = 0; j < multilineTexts.length; ++j) {
            var labelString = multilineTexts[j];

            if (labelString === '') {
              // for continues \n
              if (this._isLastComponentCR(text) && j === multilineTexts.length - 1) {
                continue;
              }

              this._updateLineInfo();

              lastEmptyLine = true;
              continue;
            }

            lastEmptyLine = false;

            if (this.maxWidth > 0) {
              var labelWidth = this._measureText(i, labelString);

              this._updateRichTextWithMaxWidth(labelString, labelWidth, i);

              if (multilineTexts.length > 1 && j < multilineTexts.length - 1) {
                this._updateLineInfo();
              }
            } else {
              label = this._addLabelSegment(labelString, i);
              labelSize = label.node.getContentSize();
              this._lineOffsetX += labelSize.width;

              if (this._lineOffsetX > this._labelWidth) {
                this._labelWidth = this._lineOffsetX;
              }

              if (multilineTexts.length > 1 && j < multilineTexts.length - 1) {
                this._updateLineInfo();
              }
            }
          }
        }

        if (!lastEmptyLine) {
          this._linesWidth.push(this._lineOffsetX);
        }

        if (this.maxWidth > 0) {
          this._labelWidth = this.maxWidth;
        }

        this._labelHeight = (this._lineCount + _index2.BASELINE_RATIO) * this.lineHeight; // trigger "size-changed" event

        this.node.setContentSize(this._labelWidth, this._labelHeight);

        this._updateRichTextPosition();

        this._layoutDirty = false;
      }
    }, {
      key: "_getFirstWordLen",
      value: function _getFirstWordLen(text, startIndex, textLen) {
        var character = text.charAt(startIndex);

        if ((0, _index2.isUnicodeCJK)(character) || (0, _index2.isUnicodeSpace)(character)) {
          return 1;
        }

        var len = 1;

        for (var index = startIndex + 1; index < textLen; ++index) {
          character = text.charAt(index);

          if ((0, _index2.isUnicodeSpace)(character) || (0, _index2.isUnicodeCJK)(character)) {
            break;
          }

          len++;
        }

        return len;
      }
    }, {
      key: "_updateRichTextPosition",
      value: function _updateRichTextPosition() {
        var nextTokenX = 0;
        var nextLineIndex = 1;
        var totalLineCount = this._lineCount;

        var _iterator3 = _createForOfIteratorHelper(this._labelSegments),
            _step3;

        try {
          for (_iterator3.s(); !(_step3 = _iterator3.n()).done;) {
            var label = _step3.value;
            var lineCount = label.lineCount;

            if (lineCount > nextLineIndex) {
              nextTokenX = 0;
              nextLineIndex = lineCount;
            }

            var anchorX = this.node.anchorX;
            var lineOffsetX = this._labelWidth * (this.horizontalAlign * 0.5 - anchorX);

            switch (this.horizontalAlign) {
              case _labelComponent.HorizontalTextAlignment.LEFT:
                break;

              case _labelComponent.HorizontalTextAlignment.CENTER:
                lineOffsetX -= this._linesWidth[lineCount - 1] / 2;
                break;

              case _labelComponent.HorizontalTextAlignment.RIGHT:
                lineOffsetX -= this._linesWidth[lineCount - 1];
                break;

              default:
                break;
            }

            var pos = label.node.position;
            var anchorY = this.node.anchorY;
            label.node.setPosition(nextTokenX + lineOffsetX, this.lineHeight * (totalLineCount - lineCount) - this._labelHeight * anchorY, pos.z);

            if (lineCount === nextLineIndex) {
              nextTokenX += label.node.width;
            }
          }
        } catch (err) {
          _iterator3.e(err);
        } finally {
          _iterator3.f();
        }
      }
    }, {
      key: "_convertLiteralColorValue",
      value: function _convertLiteralColorValue(color) {
        var colorValue = color.toUpperCase();

        if (_index3.Color[colorValue]) {
          return _index3.Color[colorValue];
        } else {
          var out = new _index3.Color();
          return out.fromHEX(color);
        }
      }
    }, {
      key: "_applyTextAttribute",
      value: function _applyTextAttribute(labelSeg) {
        var labelComponent = labelSeg.node.getComponent(_labelComponent.LabelComponent);

        if (!labelComponent) {
          return;
        }

        var index = labelSeg.styleIndex;
        labelComponent.lineHeight = this.lineHeight;
        labelComponent.horizontalAlign = _labelComponent.HorizontalTextAlignment.LEFT;
        labelComponent.verticalAlign = _labelComponent.VerticalTextAlignment.CENTER;
        var textStyle;

        if (this._textArray[index]) {
          textStyle = this._textArray[index].style;
        }

        var labelComp = labelSeg.node.getComponent(_labelComponent.LabelComponent);

        if (labelComp) {
          if (textStyle && textStyle.color) {
            labelComp.color = this._convertLiteralColorValue(textStyle.color);
          } else {
            labelComp.color = this._convertLiteralColorValue('white');
          }
        }

        labelComponent.isBold = !!(textStyle && textStyle.bold);
        labelComponent.isItalic = !!(textStyle && textStyle.italic); // TODO: temporary implementation, the italic effect should be implemented in the internal of label-assembler.
        // if (textStyle && textStyle.italic) {
        //     labelNode.skewX = 12;
        // }

        labelComponent.isUnderline = !!(textStyle && textStyle.underline);

        if (textStyle && textStyle.outline) {
          var labelOutlineComponent = labelSeg.node.getComponent(_labelOutlineComponent.LabelOutlineComponent);

          if (!labelOutlineComponent) {
            labelOutlineComponent = labelSeg.node.addComponent(_labelOutlineComponent.LabelOutlineComponent);
          }

          labelOutlineComponent.color = this._convertLiteralColorValue(textStyle.outline.color);
          labelOutlineComponent.width = textStyle.outline.width;
        }

        if (textStyle && textStyle.size) {
          labelComponent.fontSize = textStyle.size;
        } else {
          labelComponent.fontSize = this._fontSize;
        }

        labelComponent.updateRenderData(true);

        if (textStyle && textStyle.event) {
          var c = 'click';

          if (textStyle.event[c]) {
            labelSeg.clickHandler = textStyle.event[c];
          }
        }
      }
    }, {
      key: "_anchorChanged",
      value: function _anchorChanged() {
        this._updateRichTextPosition();
      }
    }]);

    return RichTextComponent;
  }(_uiComponent.UIComponent), _class3.HorizontalAlign = _labelComponent.HorizontalTextAlignment, _class3.VerticalAlign = _labelComponent.VerticalTextAlignment, _temp), (_applyDecoratedDescriptor(_class2.prototype, "string", [_dec5], Object.getOwnPropertyDescriptor(_class2.prototype, "string"), _class2.prototype), _applyDecoratedDescriptor(_class2.prototype, "horizontalAlign", [_dec6], Object.getOwnPropertyDescriptor(_class2.prototype, "horizontalAlign"), _class2.prototype), _applyDecoratedDescriptor(_class2.prototype, "fontSize", [_dec7], Object.getOwnPropertyDescriptor(_class2.prototype, "fontSize"), _class2.prototype), _applyDecoratedDescriptor(_class2.prototype, "font", [_dec8], Object.getOwnPropertyDescriptor(_class2.prototype, "font"), _class2.prototype), _applyDecoratedDescriptor(_class2.prototype, "maxWidth", [_dec9], Object.getOwnPropertyDescriptor(_class2.prototype, "maxWidth"), _class2.prototype), _applyDecoratedDescriptor(_class2.prototype, "lineHeight", [_dec10], Object.getOwnPropertyDescriptor(_class2.prototype, "lineHeight"), _class2.prototype), _applyDecoratedDescriptor(_class2.prototype, "imageAtlas", [_dec11], Object.getOwnPropertyDescriptor(_class2.prototype, "imageAtlas"), _class2.prototype), _applyDecoratedDescriptor(_class2.prototype, "handleTouchEvent", [_dec12], Object.getOwnPropertyDescriptor(_class2.prototype, "handleTouchEvent"), _class2.prototype), _descriptor = _applyDecoratedDescriptor(_class2.prototype, "_lineHeight", [_classDecorator.property], {
    configurable: true,
    enumerable: true,
    writable: true,
    initializer: function initializer() {
      return 40;
    }
  }), _descriptor2 = _applyDecoratedDescriptor(_class2.prototype, "_string", [_classDecorator.property], {
    configurable: true,
    enumerable: true,
    writable: true,
    initializer: function initializer() {
      return '<color=#00ff00>Rich</c><color=#0fffff>Text</color>';
    }
  }), _descriptor3 = _applyDecoratedDescriptor(_class2.prototype, "_horizontalAlign", [_classDecorator.property], {
    configurable: true,
    enumerable: true,
    writable: true,
    initializer: function initializer() {
      return _labelComponent.HorizontalTextAlignment.LEFT;
    }
  }), _descriptor4 = _applyDecoratedDescriptor(_class2.prototype, "_fontSize", [_classDecorator.property], {
    configurable: true,
    enumerable: true,
    writable: true,
    initializer: function initializer() {
      return 40;
    }
  }), _descriptor5 = _applyDecoratedDescriptor(_class2.prototype, "_maxWidth", [_classDecorator.property], {
    configurable: true,
    enumerable: true,
    writable: true,
    initializer: function initializer() {
      return 0;
    }
  }), _descriptor6 = _applyDecoratedDescriptor(_class2.prototype, "_font", [_classDecorator.property], {
    configurable: true,
    enumerable: true,
    writable: true,
    initializer: function initializer() {
      return null;
    }
  }), _descriptor7 = _applyDecoratedDescriptor(_class2.prototype, "_imageAtlas", [_classDecorator.property], {
    configurable: true,
    enumerable: true,
    writable: true,
    initializer: function initializer() {
      return null;
    }
  }), _descriptor8 = _applyDecoratedDescriptor(_class2.prototype, "_handleTouchEvent", [_classDecorator.property], {
    configurable: true,
    enumerable: true,
    writable: true,
    initializer: function initializer() {
      return true;
    }
  })), _class2)) || _class) || _class) || _class) || _class) || _class);
  _exports.RichTextComponent = RichTextComponent;
  cc.RichTextComponent = RichTextComponent;
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkY6L2plbmtpbnMvd29ya3NwYWNlL0NyZWF0b3JfM0QvZWRpdG9yLTNkL3Jlc291cmNlcy8zZC9lbmdpbmUvY29jb3MvdWkvY29tcG9uZW50cy9yaWNoLXRleHQtY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbIl9odG1sVGV4dFBhcnNlciIsIkh0bWxUZXh0UGFyc2VyIiwiUmljaFRleHRDaGlsZE5hbWUiLCJSaWNoVGV4dENoaWxkSW1hZ2VOYW1lIiwiZGVib3VuY2UiLCJmdW5jIiwid2FpdCIsImltbWVkaWF0ZSIsInRpbWVvdXQiLCJhcmdzIiwiY29udGV4dCIsImxhdGVyIiwiYXBwbHkiLCJjYWxsTm93IiwiY2xlYXJUaW1lb3V0Iiwic2V0VGltZW91dCIsInBvb2wiLCJQb29sIiwibGFiZWxTZWciLCJFRElUT1IiLCJERVYiLCJub2RlIiwicGFyZW50IiwiY2MiLCJpc1ZhbGlkIiwiZ2V0Q29tcG9uZW50IiwiTGFiZWxPdXRsaW5lQ29tcG9uZW50IiwiZ2V0Iiwic3RyIiwicmljaHRleHQiLCJfZ2V0IiwiUHJpdmF0ZU5vZGUiLCJjb21wIiwibGluZUNvdW50Iiwic3R5bGVJbmRleCIsImNsaWNrSGFuZGxlciIsImxhYmVsTm9kZSIsImxhYmVsQ29tcG9uZW50IiwiTGFiZWxDb21wb25lbnQiLCJhZGRDb21wb25lbnQiLCJzZXRQb3NpdGlvbiIsInNldEFuY2hvclBvaW50Iiwic2V0Q29udGVudFNpemUiLCJpc0Fzc2V0IiwiZm9udCIsIkZvbnQiLCJmb250RmFtaWx5Iiwic3RyaW5nIiwiaG9yaXpvbnRhbEFsaWduIiwiSG9yaXpvbnRhbFRleHRBbGlnbm1lbnQiLCJMRUZUIiwidmVydGljYWxBbGlnbiIsIlZlcnRpY2FsVGV4dEFsaWdubWVudCIsIlRPUCIsImZvbnRTaXplIiwib3ZlcmZsb3ciLCJlbmFibGVXcmFwVGV4dCIsImxpbmVIZWlnaHQiLCJpc0JvbGQiLCJpc0l0YWxpYyIsImlzVW5kZXJsaW5lIiwibGFiZWxPYmoiLCJSaWNoVGV4dENvbXBvbmVudCIsIm11bHRpbGluZSIsInRvb2x0aXAiLCJ0eXBlIiwiU3ByaXRlQXRsYXMiLCJleGVjdXRlSW5FZGl0TW9kZSIsIl9zdHJpbmciLCJ2YWx1ZSIsIl91cGRhdGVSaWNoVGV4dFN0YXR1cyIsIl9ob3Jpem9udGFsQWxpZ24iLCJfbGF5b3V0RGlydHkiLCJfZm9udFNpemUiLCJfZm9udCIsIkJpdG1hcEZvbnQiLCJjb25zb2xlIiwid2FybiIsIl9vblRURkxvYWRlZCIsIl9tYXhXaWR0aCIsIl9saW5lSGVpZ2h0IiwiX2ltYWdlQXRsYXMiLCJfaGFuZGxlVG91Y2hFdmVudCIsImVuYWJsZWRJbkhpZXJhcmNoeSIsImhhbmRsZVRvdWNoRXZlbnQiLCJfYWRkRXZlbnRMaXN0ZW5lcnMiLCJfcmVtb3ZlRXZlbnRMaXN0ZW5lcnMiLCJfdGV4dEFycmF5IiwiX2xhYmVsU2VnbWVudHMiLCJfbGFiZWxTZWdtZW50c0NhY2hlIiwiX2xpbmVzV2lkdGgiLCJfbGluZUNvdW50IiwiX2xhYmVsV2lkdGgiLCJfbGFiZWxIZWlnaHQiLCJfbGluZU9mZnNldFgiLCJfdXBkYXRlUmljaFRleHQiLCJfYWN0aXZhdGVDaGlsZHJlbiIsIm9uIiwiTm9kZSIsIkV2ZW50VHlwZSIsIkFOQ0hPUl9DSEFOR0VEIiwiX2FuY2hvckNoYW5nZWQiLCJvbkVuYWJsZSIsIm9uRGlzYWJsZSIsInNlZyIsInJlbW92ZUZyb21QYXJlbnQiLCJwdXQiLCJvZmYiLCJUT1VDSF9FTkQiLCJfb25Ub3VjaEVuZGVkIiwiZm9yRWFjaCIsIml0ZW0iLCJfYXBwbHlUZXh0QXR0cmlidXRlIiwiVFRGRm9udCIsIl9uYXRpdmVBc3NldCIsInNlbGYiLCJsb2FkZXIiLCJsb2FkIiwibmF0aXZlVXJsIiwiZXJyIiwicyIsImxhYmVsIiwibGVuZ3RoIiwiX2NyZWF0ZUZvbnRMYWJlbCIsInB1c2giLCJsYWJlbFNpemUiLCJnZXRDb250ZW50U2l6ZSIsIndpZHRoIiwiZXZlbnQiLCJjb21wb25lbnRzIiwiZ2V0Q29tcG9uZW50cyIsIlVJQ29tcG9uZW50IiwiX2NvbnRhaW5zVG91Y2hMb2NhdGlvbiIsInRvdWNoIiwiZ2V0VUlMb2NhdGlvbiIsImNvbXBvbmVudCIsImNhbGwiLCJwcm9wYWdhdGlvblN0b3BwZWQiLCJwb2ludCIsIlVJVHJhbnNmb3JtQ29tcG9uZW50IiwibXlSZWN0IiwiZ2V0Qm91bmRpbmdCb3hUb1dvcmxkIiwiY29udGFpbnMiLCJjaGlsZHJlbiIsImkiLCJjaGlsZCIsIm5hbWUiLCJzcGxpY2UiLCJpbmRleCIsImZpbmRJbmRleCIsImFjdGl2ZSIsInN0cmluZ1Rva2VuIiwibGFiZWxTZWdtZW50IiwicG9wIiwiYWRkQ2hpbGQiLCJsYWJlbFN0cmluZyIsImxhYmVsV2lkdGgiLCJmcmFnbWVudFdpZHRoIiwibWF4V2lkdGgiLCJjaGVja1N0YXJ0SW5kZXgiLCJjaGVja0VuZEluZGV4IiwiX2dldEZpcnN0V29yZExlbiIsImNoZWNrU3RyaW5nIiwic3Vic3RyIiwiY2hlY2tTdHJpbmdXaWR0aCIsIl9tZWFzdXJlVGV4dCIsInJlbWFpbmluZ1N0cmluZyIsIl9hZGRMYWJlbFNlZ21lbnQiLCJfdXBkYXRlTGluZUluZm8iLCJmcmFnbWVudHMiLCJrIiwic3BsaXRTdHJpbmciLCJsYXN0SW5kZXhPZiIsIm5ld1RleHRBcnJheSIsIm9sZEl0ZW0iLCJuZXdJdGVtIiwidGV4dCIsInN0eWxlIiwib3V0bGluZSIsInNpemUiLCJpdGFsaWMiLCJpc0ltYWdlIiwic3JjIiwicmljaFRleHRFbGVtZW50Iiwic3ByaXRlRnJhbWVOYW1lIiwic3ByaXRlRnJhbWUiLCJnZXRTcHJpdGVGcmFtZSIsInNwcml0ZU5vZGUiLCJzcHJpdGVDb21wb25lbnQiLCJTcHJpdGVDb21wb25lbnQiLCJUeXBlIiwiU0xJQ0VEIiwic2l6ZU1vZGUiLCJTaXplTW9kZSIsIkNVU1RPTSIsIm9iaiIsInNwcml0ZVJlY3QiLCJnZXRSZWN0Iiwic2NhbGVGYWN0b3IiLCJzcHJpdGVXaWR0aCIsInNwcml0ZUhlaWdodCIsImhlaWdodCIsImV4cGVjdFdpZHRoIiwiaW1hZ2VXaWR0aCIsImV4cGVjdEhlaWdodCIsImltYWdlSGVpZ2h0IiwidW5kZWZpbmVkIiwiYyIsImVuYWJsZWQiLCJwYXJzZSIsIl9uZWVkc1VwZGF0ZVRleHRMYXlvdXQiLCJzbGljZSIsIl91cGRhdGVMYWJlbFNlZ21lbnRUZXh0QXR0cmlidXRlcyIsIl9yZXNldFN0YXRlIiwibGFzdEVtcHR5TGluZSIsImlzTmV3TGluZSIsImltYWdlQXRsYXMiLCJfYWRkUmljaFRleHRJbWFnZUVsZW1lbnQiLCJtdWx0aWxpbmVUZXh0cyIsInNwbGl0IiwiaiIsIl9pc0xhc3RDb21wb25lbnRDUiIsIl91cGRhdGVSaWNoVGV4dFdpdGhNYXhXaWR0aCIsIkJBU0VMSU5FX1JBVElPIiwiX3VwZGF0ZVJpY2hUZXh0UG9zaXRpb24iLCJzdGFydEluZGV4IiwidGV4dExlbiIsImNoYXJhY3RlciIsImNoYXJBdCIsImxlbiIsIm5leHRUb2tlblgiLCJuZXh0TGluZUluZGV4IiwidG90YWxMaW5lQ291bnQiLCJhbmNob3JYIiwibGluZU9mZnNldFgiLCJDRU5URVIiLCJSSUdIVCIsInBvcyIsInBvc2l0aW9uIiwiYW5jaG9yWSIsInoiLCJjb2xvciIsImNvbG9yVmFsdWUiLCJ0b1VwcGVyQ2FzZSIsIkNvbG9yIiwib3V0IiwiZnJvbUhFWCIsInRleHRTdHlsZSIsImxhYmVsQ29tcCIsIl9jb252ZXJ0TGl0ZXJhbENvbG9yVmFsdWUiLCJib2xkIiwidW5kZXJsaW5lIiwibGFiZWxPdXRsaW5lQ29tcG9uZW50IiwidXBkYXRlUmVuZGVyRGF0YSIsIkhvcml6b250YWxBbGlnbiIsIlZlcnRpY2FsQWxpZ24iLCJwcm9wZXJ0eSJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQStDQSxNQUFNQSxlQUFlLEdBQUcsSUFBSUMsc0JBQUosRUFBeEI7O0FBQ0EsTUFBTUMsaUJBQWlCLEdBQUcsZ0JBQTFCO0FBQ0EsTUFBTUMsc0JBQXNCLEdBQUcsc0JBQS9C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LENBQUNwRSxJQUFwQztBQUNILFNBRkQsTUFHSztBQUNEOUksVUFBQUEsY0FBYyxDQUFDaUIsUUFBZixHQUEwQixLQUFLbUIsU0FBL0I7QUFDSDs7QUFFRHBDLFFBQUFBLGNBQWMsQ0FBQ3dOLGdCQUFmLENBQWdDLElBQWhDOztBQUVBLFlBQUlOLFNBQVMsSUFBSUEsU0FBUyxDQUFDdkgsS0FBM0IsRUFBa0M7QUFDOUIsY0FBTStFLENBQUMsR0FBRyxPQUFWOztBQUNBLGNBQUl3QyxTQUFTLENBQUN2SCxLQUFWLENBQWdCK0UsQ0FBaEIsQ0FBSixFQUF3QjtBQUNwQjdMLFlBQUFBLFFBQVEsQ0FBQ2lCLFlBQVQsR0FBd0JvTixTQUFTLENBQUN2SCxLQUFWLENBQWdCK0UsQ0FBaEIsQ0FBeEI7QUFDSDtBQUNKO0FBQ0o7Ozt1Q0FFeUI7QUFDdEIsYUFBS2lCLHVCQUFMO0FBQ0g7Ozs7SUEzMUJrQzdGLHdCLFdBMk1yQjJILGUsR0FBa0I3TSx1QyxVQUNsQjhNLGEsR0FBZ0IzTSxxQyxteUNBRTdCNE0sd0I7Ozs7O2FBQ3VCLEU7OzhFQUN2QkEsd0I7Ozs7O2FBQ21CLG9EOzt1RkFFbkJBLHdCOzs7OzthQUM0Qi9NLHdDQUF3QkMsSTs7Z0ZBQ3BEOE0sd0I7Ozs7O2FBQ3FCLEU7O2dGQUNyQkEsd0I7Ozs7O2FBQ3FCLEM7OzRFQUNyQkEsd0I7Ozs7O2FBQ2lDLEk7O2tGQUNqQ0Esd0I7Ozs7O2FBQzJDLEk7O3dGQUMzQ0Esd0I7Ozs7O2FBQzZCLEk7Ozs7QUFnb0JsQ3pPLEVBQUFBLEVBQUUsQ0FBQ3VDLGlCQUFILEdBQXVCQSxpQkFBdkIiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxyXG4gQ29weXJpZ2h0IChjKSAyMDEzLTIwMTYgQ2h1a29uZyBUZWNobm9sb2dpZXMgSW5jLlxyXG4gQ29weXJpZ2h0IChjKSAyMDE3LTIwMTggWGlhbWVuIFlhamkgU29mdHdhcmUgQ28uLCBMdGQuXHJcblxyXG4gaHR0cDovL3d3dy5jb2Nvcy5jb21cclxuXHJcbiBQZXJtaXNzaW9uIGlzIGhlcmVieSBncmFudGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbiBvYnRhaW5pbmcgYSBjb3B5XHJcbiBvZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGVuZ2luZSBzb3VyY2UgY29kZSAodGhlIFwiU29mdHdhcmVcIiksIGEgbGltaXRlZCxcclxuICB3b3JsZHdpZGUsIHJveWFsdHktZnJlZSwgbm9uLWFzc2lnbmFibGUsIHJldm9jYWJsZSBhbmQgbm9uLWV4Y2x1c2l2ZSBsaWNlbnNlXHJcbiB0byB1c2UgQ29jb3MgQ3JlYXRvciBzb2xlbHkgdG8gZGV2ZWxvcCBnYW1lcyBvbiB5b3VyIHRhcmdldCBwbGF0Zm9ybXMuIFlvdSBzaGFsbFxyXG4gIG5vdCB1c2UgQ29jb3MgQ3JlYXRvciBzb2Z0d2FyZSBmb3IgZGV2ZWxvcGluZyBvdGhlciBzb2Z0d2FyZSBvciB0b29scyB0aGF0J3NcclxuICB1c2VkIGZvciBkZXZlbG9waW5nIGdhbWVzLiBZb3UgYXJlIG5vdCBncmFudGVkIHRvIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsXHJcbiAgc3VibGljZW5zZSwgYW5kL29yIHNlbGwgY29waWVzIG9mIENvY29zIENyZWF0b3IuXHJcblxyXG4gVGhlIHNvZnR3YXJlIG9yIHRvb2xzIGluIHRoaXMgTGljZW5zZSBBZ3JlZW1lbnQgYXJlIGxpY2Vuc2VkLCBub3Qgc29sZC5cclxuIFhpYW1lbiBZYWppIFNvZnR3YXJlIENvLiwgTHRkLiByZXNlcnZlcyBhbGwgcmlnaHRzIG5vdCBleHByZXNzbHkgZ3JhbnRlZCB0byB5b3UuXHJcblxyXG4gVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEIFwiQVMgSVNcIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUyBPUlxyXG4gSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFksXHJcbiBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEVcclxuIEFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sIERBTUFHRVMgT1IgT1RIRVJcclxuIExJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HIEZST00sXHJcbiBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElOXHJcbiBUSEUgU09GVFdBUkUuXHJcbiovXHJcblxyXG4vKipcclxuICogQGNhdGVnb3J5IHVpXHJcbiAqL1xyXG5cclxuaW1wb3J0IHsgRm9udCwgU3ByaXRlQXRsYXMsIFRURkZvbnQsIEJpdG1hcEZvbnQgfSBmcm9tICcuLi8uLi9jb3JlL2Fzc2V0cyc7XHJcbmltcG9ydCB7IGNjY2xhc3MsIGhlbHAsIGV4ZWN1dGVJbkVkaXRNb2RlLCBleGVjdXRpb25PcmRlciwgbWVudSwgcHJvcGVydHkgfSBmcm9tICcuLi8uLi9jb3JlL2RhdGEvY2xhc3MtZGVjb3JhdG9yJztcclxuaW1wb3J0IHsgRXZlbnRUb3VjaCB9IGZyb20gJy4uLy4uL2NvcmUvcGxhdGZvcm0nO1xyXG5pbXBvcnQgeyBmcmFnbWVudFRleHQsIEh0bWxUZXh0UGFyc2VyLCBJSHRtbFRleHRQYXJzZXJSZXN1bHRPYmosIElIdG1sVGV4dFBhcnNlclN0YWNrLCBpc1VuaWNvZGVDSkssIGlzVW5pY29kZVNwYWNlLCBCQVNFTElORV9SQVRJTyB9IGZyb20gJy4uLy4uL2NvcmUvdXRpbHMnO1xyXG5pbXBvcnQgUG9vbCBmcm9tICcuLi8uLi9jb3JlL3V0aWxzL3Bvb2wnO1xyXG5pbXBvcnQgeyBDb2xvciwgVmVjMiB9IGZyb20gJy4uLy4uL2NvcmUvbWF0aCc7XHJcbmltcG9ydCB7IFByaXZhdGVOb2RlLCBOb2RlIH0gZnJvbSAnLi4vLi4vY29yZS9zY2VuZS1ncmFwaCc7XHJcbmltcG9ydCB7IEhvcml6b250YWxUZXh0QWxpZ25tZW50LCBMYWJlbENvbXBvbmVudCwgVmVydGljYWxUZXh0QWxpZ25tZW50IH0gZnJvbSAnLi9sYWJlbC1jb21wb25lbnQnO1xyXG5pbXBvcnQgeyBMYWJlbE91dGxpbmVDb21wb25lbnQgfSBmcm9tICcuL2xhYmVsLW91dGxpbmUtY29tcG9uZW50JztcclxuaW1wb3J0IHsgU3ByaXRlQ29tcG9uZW50IH0gZnJvbSAnLi9zcHJpdGUtY29tcG9uZW50JztcclxuaW1wb3J0IHsgVUlDb21wb25lbnQgfSBmcm9tICcuLi8uLi9jb3JlL2NvbXBvbmVudHMvdWktYmFzZS91aS1jb21wb25lbnQnO1xyXG5pbXBvcnQgeyBVSVJlbmRlckNvbXBvbmVudCB9IGZyb20gJy4uLy4uL2NvcmUvY29tcG9uZW50cy91aS1iYXNlL3VpLXJlbmRlci1jb21wb25lbnQnO1xyXG5pbXBvcnQgeyBVSVRyYW5zZm9ybUNvbXBvbmVudCB9IGZyb20gJy4uLy4uL2NvcmUvY29tcG9uZW50cy91aS1iYXNlL3VpLXRyYW5zZm9ybS1jb21wb25lbnQnO1xyXG5pbXBvcnQgeyBhc3NlcnQsIHdhcm5JRCB9IGZyb20gJy4uLy4uL2NvcmUvcGxhdGZvcm0vZGVidWcnO1xyXG5pbXBvcnQgeyBsb2FkZXIgfSBmcm9tICcuLi8uLi9jb3JlL2xvYWQtcGlwZWxpbmUnO1xyXG5pbXBvcnQgeyBFRElUT1IsIERFViB9IGZyb20gJ2ludGVybmFsOmNvbnN0YW50cyc7XHJcblxyXG5jb25zdCBfaHRtbFRleHRQYXJzZXIgPSBuZXcgSHRtbFRleHRQYXJzZXIoKTtcclxuY29uc3QgUmljaFRleHRDaGlsZE5hbWUgPSAnUklDSFRFWFRfQ0hJTEQnO1xyXG5jb25zdCBSaWNoVGV4dENoaWxkSW1hZ2VOYW1lID0gJ1JJQ0hURVhUX0ltYWdlX0NISUxEJztcclxuXHJcbi8qKlxyXG4gKiBAemhcclxuICog6L+U5Zue5LiA5Liq5Y+v5bu25pe26LCD55So5Ye95pWw44CC5Y+q6KaB5LiN6KKr6LCD55So5bCx5LiN5Lya6Kem5Y+R44CC6YCJ5oupIOKAmGltbWVkaWF0ZeKAmSDliJnlnKjop6blj5Hml7bkuI3kvJrlu7bov5/ogIzmmK/nq4vpqazlm57osIPjgIJcclxuICpcclxuICogQHBhcmFtIGZ1bmMgLSDlu7bml7bosIPnlKjlh73mlbDjgIJcclxuICogQHBhcmFtIHdhaXQgLSDlu7bml7bml7bpl7TjgIJcclxuICogQHBhcmFtIGltbWVkaWF0ZSAtIOaYr+WQpueri+mprOaJp+ihjOWbnuiwg+OAglxyXG4gKi9cclxuZnVuY3Rpb24gZGVib3VuY2UgKGZ1bmM6IEZ1bmN0aW9uLCB3YWl0OiBudW1iZXIsIGltbWVkaWF0ZT86IGJvb2xlYW4pIHtcclxuICAgIGxldCB0aW1lb3V0O1xyXG4gICAgcmV0dXJuIGZ1bmN0aW9uICh0aGlzOiBhbnksIC4uLmFyZ3M6IGFueVtdKSB7XHJcbiAgICAgICAgY29uc3QgY29udGV4dCA9IHRoaXM7XHJcbiAgICAgICAgY29uc3QgbGF0ZXIgPSAoKSA9PiB7XHJcbiAgICAgICAgICAgIHRpbWVvdXQgPSBudWxsO1xyXG4gICAgICAgICAgICBpZiAoIWltbWVkaWF0ZSkgeyBmdW5jLmFwcGx5KGNvbnRleHQsIGFyZ3MpOyB9XHJcbiAgICAgICAgfTtcclxuICAgICAgICBjb25zdCBjYWxsTm93ID0gaW1tZWRpYXRlICYmICF0aW1lb3V0O1xyXG4gICAgICAgIGNsZWFyVGltZW91dCh0aW1lb3V0KTtcclxuICAgICAgICB0aW1lb3V0ID0gc2V0VGltZW91dChsYXRlciwgd2FpdCk7XHJcbiAgICAgICAgaWYgKGNhbGxOb3cpIHsgZnVuYy5hcHBseShjb250ZXh0LCBhcmdzKTsgfVxyXG4gICAgfTtcclxufVxyXG5cclxuLyoqXHJcbiAqIOWvjOaWh+acrOaxoOOAgjxici8+XHJcbiAqL1xyXG5jb25zdCBwb29sID0gbmV3IFBvb2woKGxhYmVsU2VnOiBJTGFiZWxTZWdtZW50KSA9PiB7XHJcbiAgICBpZiAoRURJVE9SKSB7XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG4gICAgaWYgKERFVikge1xyXG4gICAgICAgIGFzc2VydCghbGFiZWxTZWcubm9kZS5wYXJlbnQsICdSZWN5Y2xpbmcgbm9kZVxcJ3MgcGFyZW50IHNob3VsZCBiZSBudWxsIScpO1xyXG4gICAgfVxyXG4gICAgaWYgKCFjYy5pc1ZhbGlkKGxhYmVsU2VnLm5vZGUpKSB7XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG4gICAgZWxzZSBpZiAobGFiZWxTZWcubm9kZS5nZXRDb21wb25lbnQoTGFiZWxPdXRsaW5lQ29tcG9uZW50KSkge1xyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuICAgIHJldHVybiB0cnVlO1xyXG59LCAyMCk7XHJcblxyXG4vLyBAdHMtaWdub3JlXHJcbnBvb2wuZ2V0ID0gZnVuY3Rpb24gKHN0cjogc3RyaW5nLCByaWNodGV4dDogUmljaFRleHRDb21wb25lbnQpIHtcclxuICAgIGxldCBsYWJlbFNlZyA9IHRoaXMuX2dldCgpO1xyXG4gICAgaWYgKCFsYWJlbFNlZykge1xyXG4gICAgICAgIGxhYmVsU2VnID0ge1xyXG4gICAgICAgICAgICBub2RlOiBuZXcgUHJpdmF0ZU5vZGUoUmljaFRleHRDaGlsZE5hbWUpLFxyXG4gICAgICAgICAgICBjb21wOiBudWxsLFxyXG4gICAgICAgICAgICBsaW5lQ291bnQ6IDAsXHJcbiAgICAgICAgICAgIHN0eWxlSW5kZXg6IDAsXHJcbiAgICAgICAgICAgIGNsaWNrSGFuZGxlcjogJycsXHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICBsZXQgbGFiZWxOb2RlID0gbGFiZWxTZWcubm9kZTtcclxuICAgIGlmICghbGFiZWxOb2RlKSB7XHJcbiAgICAgICAgbGFiZWxOb2RlID0gbmV3IFByaXZhdGVOb2RlKFJpY2hUZXh0Q2hpbGROYW1lKTtcclxuICAgIH1cclxuXHJcbiAgICBsZXQgbGFiZWxDb21wb25lbnQgPSBsYWJlbE5vZGUuZ2V0Q29tcG9uZW50KExhYmVsQ29tcG9uZW50KTtcclxuICAgIGlmICghbGFiZWxDb21wb25lbnQpIHtcclxuICAgICAgICBsYWJlbENvbXBvbmVudCA9IGxhYmVsTm9kZS5hZGRDb21wb25lbnQoTGFiZWxDb21wb25lbnQpO1xyXG4gICAgfVxyXG5cclxuICAgIGxhYmVsQ29tcG9uZW50ID0gbGFiZWxDb21wb25lbnQhO1xyXG4gICAgbGFiZWxOb2RlLnNldFBvc2l0aW9uKDAsIDAsIDApO1xyXG4gICAgbGFiZWxOb2RlLnNldEFuY2hvclBvaW50KDAuNSwgMC41KTtcclxuICAgIGxhYmVsTm9kZS5zZXRDb250ZW50U2l6ZSgxMjgsIDEyOCk7XHJcbiAgICAvLyBsYWJlbE5vZGUuc2tld1ggPSAwO1xyXG5cclxuICAgIGlmICh0eXBlb2Ygc3RyICE9PSAnc3RyaW5nJykge1xyXG4gICAgICAgIHN0ciA9ICcnICsgc3RyO1xyXG4gICAgfVxyXG4gICAgY29uc3QgaXNBc3NldCA9IHJpY2h0ZXh0LmZvbnQgaW5zdGFuY2VvZiBGb250O1xyXG4gICAgaWYgKGlzQXNzZXQpIHtcclxuICAgICAgICBsYWJlbENvbXBvbmVudC5mb250ID0gcmljaHRleHQuZm9udDtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgbGFiZWxDb21wb25lbnQuZm9udEZhbWlseSA9ICdBcmlhbCc7XHJcbiAgICB9XHJcblxyXG4gICAgbGFiZWxDb21wb25lbnQuc3RyaW5nID0gc3RyO1xyXG4gICAgbGFiZWxDb21wb25lbnQuaG9yaXpvbnRhbEFsaWduID0gSG9yaXpvbnRhbFRleHRBbGlnbm1lbnQuTEVGVDtcclxuICAgIGxhYmVsQ29tcG9uZW50LnZlcnRpY2FsQWxpZ24gPSBWZXJ0aWNhbFRleHRBbGlnbm1lbnQuVE9QO1xyXG4gICAgbGFiZWxDb21wb25lbnQuZm9udFNpemUgPSByaWNodGV4dC5mb250U2l6ZSB8fCA0MDtcclxuICAgIGxhYmVsQ29tcG9uZW50Lm92ZXJmbG93ID0gMDtcclxuICAgIGxhYmVsQ29tcG9uZW50LmVuYWJsZVdyYXBUZXh0ID0gdHJ1ZTtcclxuICAgIGxhYmVsQ29tcG9uZW50LmxpbmVIZWlnaHQgPSA0MDtcclxuICAgIGxhYmVsQ29tcG9uZW50LmlzQm9sZCA9IGZhbHNlO1xyXG4gICAgbGFiZWxDb21wb25lbnQuaXNJdGFsaWMgPSBmYWxzZTtcclxuICAgIGxhYmVsQ29tcG9uZW50LmlzVW5kZXJsaW5lID0gZmFsc2U7XHJcblxyXG4gICAgY29uc3QgbGFiZWxPYmo6IElMYWJlbFNlZ21lbnQgPSB7XHJcbiAgICAgICAgbm9kZTogbGFiZWxOb2RlLFxyXG4gICAgICAgIGNvbXA6IGxhYmVsQ29tcG9uZW50LFxyXG4gICAgICAgIGxpbmVDb3VudDogMCxcclxuICAgICAgICBjbGlja0hhbmRsZXI6ICcnLFxyXG4gICAgICAgIHN0eWxlSW5kZXg6IDAsXHJcbiAgICB9O1xyXG5cclxuICAgIHJldHVybiBsYWJlbE9iajtcclxufTtcclxuXHJcbmludGVyZmFjZSBJTGFiZWxTZWdtZW50IHtcclxuICAgIG5vZGU6IFByaXZhdGVOb2RlO1xyXG4gICAgY29tcDogVUlSZW5kZXJDb21wb25lbnQgfCBudWxsO1xyXG4gICAgY2xpY2tIYW5kbGVyOiAnJztcclxuICAgIHN0eWxlSW5kZXg6IG51bWJlcjtcclxuICAgIGxpbmVDb3VudDogbnVtYmVyO1xyXG59XHJcblxyXG4vKipcclxuICogQGVuXHJcbiAqIFRoZSBSaWNoVGV4dCBDb21wb25lbnQuXHJcbiAqXHJcbiAqIEB6aFxyXG4gKiDlr4zmlofmnKznu4Tku7bjgIJcclxuICovXHJcbkBjY2NsYXNzKCdjYy5SaWNoVGV4dENvbXBvbmVudCcpXHJcbkBoZWxwKCdpMThuOmNjLlJpY2hUZXh0Q29tcG9uZW50JylcclxuQGV4ZWN1dGlvbk9yZGVyKDExMClcclxuQG1lbnUoJ1VJL1JlbmRlci9SaWNoVGV4dCcpXHJcbkBleGVjdXRlSW5FZGl0TW9kZVxyXG5leHBvcnQgY2xhc3MgUmljaFRleHRDb21wb25lbnQgZXh0ZW5kcyBVSUNvbXBvbmVudCB7XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBAZW5cclxuICAgICAqIENvbnRlbnQgc3RyaW5nIG9mIFJpY2hUZXh0LlxyXG4gICAgICpcclxuICAgICAqIEB6aFxyXG4gICAgICog5a+M5paH5pys5pi+56S655qE5paH5pys5YaF5a6544CCXHJcbiAgICAgKi9cclxuICAgIEBwcm9wZXJ0eSh7XHJcbiAgICAgICAgbXVsdGlsaW5lOiB0cnVlLFxyXG4gICAgICAgIHRvb2x0aXA6J+WvjOaWh+acrOaYvuekuueahOaWh+acrOWGheWuuScsXHJcbiAgICB9KVxyXG4gICAgZ2V0IHN0cmluZyAoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3N0cmluZztcclxuICAgIH1cclxuICAgIHNldCBzdHJpbmcgKHZhbHVlKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuX3N0cmluZyA9PT0gdmFsdWUpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5fc3RyaW5nID0gdmFsdWU7XHJcbiAgICAgICAgdGhpcy5fdXBkYXRlUmljaFRleHRTdGF0dXMoKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEBlblxyXG4gICAgICogSG9yaXpvbnRhbCBBbGlnbm1lbnQgb2YgZWFjaCBsaW5lIGluIFJpY2hUZXh0LlxyXG4gICAgICpcclxuICAgICAqIEB6aFxyXG4gICAgICog5paH5pys5YaF5a6555qE5rC05bmz5a+56b2Q5pa55byP44CCXHJcbiAgICAgKi9cclxuICAgIEBwcm9wZXJ0eSh7XHJcbiAgICAgICAgdHlwZTogSG9yaXpvbnRhbFRleHRBbGlnbm1lbnQsXHJcbiAgICAgICAgdG9vbHRpcDon5paH5pys5YaF5a6555qE5rC05bmz5a+56b2Q5pa55byPJyxcclxuICAgIH0pXHJcbiAgICBnZXQgaG9yaXpvbnRhbEFsaWduICgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5faG9yaXpvbnRhbEFsaWduO1xyXG4gICAgfVxyXG5cclxuICAgIHNldCBob3Jpem9udGFsQWxpZ24gKHZhbHVlKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuaG9yaXpvbnRhbEFsaWduID09PSB2YWx1ZSkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLl9ob3Jpem9udGFsQWxpZ24gPSB2YWx1ZTtcclxuICAgICAgICB0aGlzLl9sYXlvdXREaXJ0eSA9IHRydWU7XHJcbiAgICAgICAgdGhpcy5fdXBkYXRlUmljaFRleHRTdGF0dXMoKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEBlblxyXG4gICAgICogRm9udCBzaXplIG9mIFJpY2hUZXh0LlxyXG4gICAgICpcclxuICAgICAqIEB6aFxyXG4gICAgICog5a+M5paH5pys5a2X5L2T5aSn5bCP44CCXHJcbiAgICAgKi9cclxuICAgIEBwcm9wZXJ0eSh7XHJcbiAgICAgICAgdG9vbHRpcDon5a+M5paH5pys5a2X5L2T5aSn5bCPJyxcclxuICAgIH0pXHJcbiAgICBnZXQgZm9udFNpemUgKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9mb250U2l6ZTtcclxuICAgIH1cclxuXHJcbiAgICBzZXQgZm9udFNpemUgKHZhbHVlKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuX2ZvbnRTaXplID09PSB2YWx1ZSkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLl9mb250U2l6ZSA9IHZhbHVlO1xyXG4gICAgICAgIHRoaXMuX2xheW91dERpcnR5ID0gdHJ1ZTtcclxuICAgICAgICB0aGlzLl91cGRhdGVSaWNoVGV4dFN0YXR1cygpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogQGVuXHJcbiAgICAgKiBDdXN0b20gU3lzdGVtIGZvbnQgb2YgUmljaFRleHQuXHJcbiAgICAgKlxyXG4gICAgICogQHpoXHJcbiAgICAgKiDlr4zmlofmnKzlrprliLblrZfkvZPjgIJcclxuICAgICAqL1xyXG4gICAgQHByb3BlcnR5KHtcclxuICAgICAgICB0eXBlOiBGb250LFxyXG4gICAgICAgIHRvb2x0aXA6J+WvjOaWh+acrOWumuWItuWtl+S9kycsXHJcbiAgICB9KVxyXG4gICAgZ2V0IGZvbnQgKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9mb250O1xyXG4gICAgfVxyXG4gICAgc2V0IGZvbnQgKHZhbHVlKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuX2ZvbnQgPT09IHZhbHVlKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gVE9ETzogUmVtb3ZlIHdoZW4gRWRpdG9yIGluc3BlY3RvciBhZGQgbXVsdGktZm9ybWF0IHN1cHBvcnRcclxuICAgICAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBCaXRtYXBGb250KSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUud2FybignUmljaFRleHQgb25seSBhY2NlcHRzIFRURiBmb250cywgYnV0IHlvdSBhcmUgdHJ5aW5nIHRvIHVzZSBhIGJpdG1hcCBmb250LicpO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuX2ZvbnQgPSB2YWx1ZTtcclxuICAgICAgICB0aGlzLl9sYXlvdXREaXJ0eSA9IHRydWU7XHJcbiAgICAgICAgaWYgKHRoaXMuX2ZvbnQpIHtcclxuICAgICAgICAgICAgdGhpcy5fb25UVEZMb2FkZWQoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5fdXBkYXRlUmljaFRleHRTdGF0dXMoKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEBlblxyXG4gICAgICogVGhlIG1heGltaXplIHdpZHRoIG9mIHRoZSBSaWNoVGV4dC5cclxuICAgICAqXHJcbiAgICAgKiBAemhcclxuICAgICAqIOWvjOaWh+acrOeahOacgOWkp+WuveW6puOAglxyXG4gICAgICovXHJcbiAgICBAcHJvcGVydHkoe1xyXG4gICAgICAgIHRvb2x0aXA6J+WvjOaWh+acrOeahOacgOWkp+WuveW6picsXHJcbiAgICB9KVxyXG4gICAgZ2V0IG1heFdpZHRoICgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fbWF4V2lkdGg7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0IG1heFdpZHRoICh2YWx1ZSkge1xyXG4gICAgICAgIGlmICh0aGlzLl9tYXhXaWR0aCA9PT0gdmFsdWUpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5fbWF4V2lkdGggPSB2YWx1ZTtcclxuICAgICAgICB0aGlzLl9sYXlvdXREaXJ0eSA9IHRydWU7XHJcbiAgICAgICAgdGhpcy5fdXBkYXRlUmljaFRleHRTdGF0dXMoKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEBlblxyXG4gICAgICogTGluZSBIZWlnaHQgb2YgUmljaFRleHQuXHJcbiAgICAgKlxyXG4gICAgICogQHpoXHJcbiAgICAgKiDlr4zmlofmnKzooYzpq5jjgIJcclxuICAgICAqL1xyXG4gICAgQHByb3BlcnR5KHtcclxuICAgICAgICB0b29sdGlwOiflr4zmlofmnKzooYzpq5gnLFxyXG4gICAgfSlcclxuICAgIGdldCBsaW5lSGVpZ2h0ICgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fbGluZUhlaWdodDtcclxuICAgIH1cclxuXHJcbiAgICBzZXQgbGluZUhlaWdodCAodmFsdWUpIHtcclxuICAgICAgICBpZiAodGhpcy5fbGluZUhlaWdodCA9PT0gdmFsdWUpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5fbGluZUhlaWdodCA9IHZhbHVlO1xyXG4gICAgICAgIHRoaXMuX2xheW91dERpcnR5ID0gdHJ1ZTtcclxuICAgICAgICB0aGlzLl91cGRhdGVSaWNoVGV4dFN0YXR1cygpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogQGVuXHJcbiAgICAgKiBUaGUgaW1hZ2UgYXRsYXMgZm9yIHRoZSBpbWcgdGFnLiBGb3IgZWFjaCBzcmMgdmFsdWUgaW4gdGhlIGltZyB0YWcsIHRoZXJlIHNob3VsZCBiZSBhIHZhbGlkIHNwcml0ZUZyYW1lIGluIHRoZSBpbWFnZSBhdGxhcy5cclxuICAgICAqXHJcbiAgICAgKiBAemhcclxuICAgICAqIOWvueS6jiBpbWcg5qCH562+6YeM6Z2i55qEIHNyYyDlsZ7mgKflkI3np7DvvIzpg73pnIDopoHlnKggaW1hZ2VBdGxhcyDph4zpnaLmib7liLDkuIDkuKrmnInmlYjnmoQgc3ByaXRlRnJhbWXvvIzlkKbliJkgaW1nIHRhZyDkvJrliKTlrprkuLrml6DmlYjjgIJcclxuICAgICAqL1xyXG4gICAgQHByb3BlcnR5KHtcclxuICAgICAgICB0eXBlOiBTcHJpdGVBdGxhcyxcclxuICAgICAgICB0b29sdGlwOiflr7nkuo4gaW1nIOagh+etvumHjOmdoueahCBzcmMg5bGe5oCn5ZCN56ew77yM6YO96ZyA6KaB5ZyoIGltYWdlQXRsYXMg6YeM6Z2i5om+5Yiw5LiA5Liq5pyJ5pWI55qEIHNwcml0ZUZyYW1l77yM5ZCm5YiZIGltZyB0YWcg5Lya5Yik5a6a5Li65peg5pWIJyxcclxuICAgIH0pXHJcbiAgICBnZXQgaW1hZ2VBdGxhcyAoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2ltYWdlQXRsYXM7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0IGltYWdlQXRsYXMgKHZhbHVlKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuX2ltYWdlQXRsYXMgPT09IHZhbHVlKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuX2ltYWdlQXRsYXMgPSB2YWx1ZTtcclxuICAgICAgICB0aGlzLl9sYXlvdXREaXJ0eSA9IHRydWU7XHJcbiAgICAgICAgdGhpcy5fdXBkYXRlUmljaFRleHRTdGF0dXMoKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEBlblxyXG4gICAgICogT25jZSBjaGVja2VkLCB0aGUgUmljaFRleHQgd2lsbCBibG9jayBhbGwgaW5wdXQgZXZlbnRzIChtb3VzZSBhbmQgdG91Y2gpIHdpdGhpblxyXG4gICAgICogdGhlIGJvdW5kaW5nIGJveCBvZiB0aGUgbm9kZSwgcHJldmVudGluZyB0aGUgaW5wdXQgZnJvbSBwZW5ldHJhdGluZyBpbnRvIHRoZSB1bmRlcmx5aW5nIG5vZGUuXHJcbiAgICAgKlxyXG4gICAgICogQHpoXHJcbiAgICAgKiDpgInkuK3mraTpgInpobnlkI7vvIxSaWNoVGV4dCDlsIbpmLvmraLoioLngrnovrnnlYzmoYbkuK3nmoTmiYDmnInovpPlhaXkuovku7bvvIjpvKDmoIflkozop6bmkbjvvInvvIzku47ogIzpmLLmraLovpPlhaXkuovku7bnqb/pgI/liLDlupXlsYLoioLngrnjgIJcclxuICAgICAqL1xyXG4gICAgQHByb3BlcnR5KHtcclxuICAgICAgICB0b29sdGlwOifpgInkuK3mraTpgInpobnlkI7vvIxSaWNoVGV4dCDlsIbpmLvmraLoioLngrnovrnnlYzmoYbkuK3nmoTmiYDmnInovpPlhaXkuovku7bvvIjpvKDmoIflkozop6bmkbjvvInvvIzku47ogIzpmLLmraLovpPlhaXkuovku7bnqb/pgI/liLDlupXlsYLoioLngrknLFxyXG4gICAgfSlcclxuICAgIGdldCBoYW5kbGVUb3VjaEV2ZW50ICgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5faGFuZGxlVG91Y2hFdmVudDtcclxuICAgIH1cclxuXHJcbiAgICBzZXQgaGFuZGxlVG91Y2hFdmVudCAodmFsdWUpIHtcclxuICAgICAgICBpZiAodGhpcy5faGFuZGxlVG91Y2hFdmVudCA9PT0gdmFsdWUpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5faGFuZGxlVG91Y2hFdmVudCA9IHZhbHVlO1xyXG4gICAgICAgIGlmICh0aGlzLmVuYWJsZWRJbkhpZXJhcmNoeSkge1xyXG4gICAgICAgICAgICB0aGlzLmhhbmRsZVRvdWNoRXZlbnQgPyB0aGlzLl9hZGRFdmVudExpc3RlbmVycygpIDogdGhpcy5fcmVtb3ZlRXZlbnRMaXN0ZW5lcnMoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBwdWJsaWMgc3RhdGljIEhvcml6b250YWxBbGlnbiA9IEhvcml6b250YWxUZXh0QWxpZ25tZW50O1xyXG4gICAgcHVibGljIHN0YXRpYyBWZXJ0aWNhbEFsaWduID0gVmVydGljYWxUZXh0QWxpZ25tZW50O1xyXG5cclxuICAgIEBwcm9wZXJ0eVxyXG4gICAgcHJvdGVjdGVkIF9saW5lSGVpZ2h0ID0gNDA7XHJcbiAgICBAcHJvcGVydHlcclxuICAgIHByb3RlY3RlZCBfc3RyaW5nID0gJzxjb2xvcj0jMDBmZjAwPlJpY2g8L2M+PGNvbG9yPSMwZmZmZmY+VGV4dDwvY29sb3I+JztcclxuICAgIC8vIHByb3RlY3RlZCBfdXBkYXRlUmljaFRleHRTdGF0dXMgPVxyXG4gICAgQHByb3BlcnR5XHJcbiAgICBwcm90ZWN0ZWQgX2hvcml6b250YWxBbGlnbiA9IEhvcml6b250YWxUZXh0QWxpZ25tZW50LkxFRlQ7XHJcbiAgICBAcHJvcGVydHlcclxuICAgIHByb3RlY3RlZCBfZm9udFNpemUgPSA0MDtcclxuICAgIEBwcm9wZXJ0eVxyXG4gICAgcHJvdGVjdGVkIF9tYXhXaWR0aCA9IDA7XHJcbiAgICBAcHJvcGVydHlcclxuICAgIHByb3RlY3RlZCBfZm9udDogVFRGRm9udCB8IG51bGwgPSBudWxsO1xyXG4gICAgQHByb3BlcnR5XHJcbiAgICBwcm90ZWN0ZWQgX2ltYWdlQXRsYXM6IFNwcml0ZUF0bGFzIHwgbnVsbCA9IG51bGw7XHJcbiAgICBAcHJvcGVydHlcclxuICAgIHByb3RlY3RlZCBfaGFuZGxlVG91Y2hFdmVudCA9IHRydWU7XHJcblxyXG4gICAgcHJvdGVjdGVkIF90ZXh0QXJyYXk6IElIdG1sVGV4dFBhcnNlclJlc3VsdE9ialtdID0gW107XHJcbiAgICBwcm90ZWN0ZWQgX2xhYmVsU2VnbWVudHM6IElMYWJlbFNlZ21lbnRbXSA9IFtdO1xyXG4gICAgcHJvdGVjdGVkIF9sYWJlbFNlZ21lbnRzQ2FjaGU6IElMYWJlbFNlZ21lbnRbXSA9IFtdO1xyXG4gICAgcHJvdGVjdGVkIF9saW5lc1dpZHRoOiBudW1iZXJbXSA9IFtdO1xyXG4gICAgcHJvdGVjdGVkIF9saW5lQ291bnQgPSAxO1xyXG4gICAgcHJvdGVjdGVkIF9sYWJlbFdpZHRoID0gMDtcclxuICAgIHByb3RlY3RlZCBfbGFiZWxIZWlnaHQgPSAwO1xyXG4gICAgcHJvdGVjdGVkIF9sYXlvdXREaXJ0eSA9IHRydWU7XHJcbiAgICBwcm90ZWN0ZWQgX2xpbmVPZmZzZXRYID0gMDtcclxuICAgIHByb3RlY3RlZCBfdXBkYXRlUmljaFRleHRTdGF0dXM6ICgpID0+IHZvaWQ7XHJcblxyXG4gICAgY29uc3RydWN0b3IgKCkge1xyXG4gICAgICAgIHN1cGVyKCk7XHJcbiAgICAgICAgaWYgKEVESVRPUikge1xyXG4gICAgICAgICAgICB0aGlzLl91cGRhdGVSaWNoVGV4dFN0YXR1cyA9IGRlYm91bmNlKHRoaXMuX3VwZGF0ZVJpY2hUZXh0LCAyMDApO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5fdXBkYXRlUmljaFRleHRTdGF0dXMgPSB0aGlzLl91cGRhdGVSaWNoVGV4dDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIG9uRW5hYmxlICgpIHtcclxuICAgICAgICBpZiAodGhpcy5oYW5kbGVUb3VjaEV2ZW50KSB7XHJcbiAgICAgICAgICAgIHRoaXMuX2FkZEV2ZW50TGlzdGVuZXJzKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLl91cGRhdGVSaWNoVGV4dCgpO1xyXG4gICAgICAgIHRoaXMuX2FjdGl2YXRlQ2hpbGRyZW4odHJ1ZSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIG9uRGlzYWJsZSAoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuaGFuZGxlVG91Y2hFdmVudCkge1xyXG4gICAgICAgICAgICB0aGlzLl9yZW1vdmVFdmVudExpc3RlbmVycygpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5fYWN0aXZhdGVDaGlsZHJlbihmYWxzZSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHN0YXJ0ICgpIHtcclxuICAgICAgICB0aGlzLl9vblRURkxvYWRlZCgpO1xyXG4gICAgICAgIHRoaXMubm9kZS5vbihOb2RlLkV2ZW50VHlwZS5BTkNIT1JfQ0hBTkdFRCwgdGhpcy5fYW5jaG9yQ2hhbmdlZCwgdGhpcyk7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIG9uUmVzdG9yZSAoKSB7XHJcbiAgICAgICAgaWYgKCFFRElUT1IpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gVE9ETzogcmVmaW5lIHVuZG8vcmVkbyBzeXN0ZW1cclxuICAgICAgICAvLyBCZWNhdXNlIHVuZG8vcmVkbyB3aWxsIG5vdCBjYWxsIG9uRW5hYmxlL29uRGlzYWJsZSxcclxuICAgICAgICAvLyB3ZSBuZWVkIGNhbGwgb25FbmFibGUvb25EaXNhYmxlIG1hbnVhbGx5IHRvIGFjdGl2ZS9kaXNhY3RpdmUgY2hpbGRyZW4gbm9kZXMuXHJcbiAgICAgICAgaWYgKHRoaXMuZW5hYmxlZEluSGllcmFyY2h5KSB7XHJcbiAgICAgICAgICAgIHRoaXMub25FbmFibGUoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMub25EaXNhYmxlKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBvbkRlc3Ryb3kgKCkge1xyXG4gICAgICAgIGZvciAoY29uc3Qgc2VnIG9mIHRoaXMuX2xhYmVsU2VnbWVudHMpIHtcclxuICAgICAgICAgICAgc2VnLm5vZGUucmVtb3ZlRnJvbVBhcmVudCgpO1xyXG4gICAgICAgICAgICBwb29sLnB1dChzZWcpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5ub2RlLm9mZihOb2RlLkV2ZW50VHlwZS5BTkNIT1JfQ0hBTkdFRCwgdGhpcy5fYW5jaG9yQ2hhbmdlZCk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJvdGVjdGVkIF9hZGRFdmVudExpc3RlbmVycyAoKSB7XHJcbiAgICAgICAgdGhpcy5ub2RlLm9uKE5vZGUuRXZlbnRUeXBlLlRPVUNIX0VORCwgdGhpcy5fb25Ub3VjaEVuZGVkLCB0aGlzKTtcclxuICAgIH1cclxuXHJcbiAgICBwcm90ZWN0ZWQgX3JlbW92ZUV2ZW50TGlzdGVuZXJzICgpIHtcclxuICAgICAgICB0aGlzLm5vZGUub2ZmKE5vZGUuRXZlbnRUeXBlLlRPVUNIX0VORCwgdGhpcy5fb25Ub3VjaEVuZGVkLCB0aGlzKTtcclxuICAgIH1cclxuXHJcbiAgICBwcm90ZWN0ZWQgX3VwZGF0ZUxhYmVsU2VnbWVudFRleHRBdHRyaWJ1dGVzICgpIHtcclxuICAgICAgICB0aGlzLl9sYWJlbFNlZ21lbnRzLmZvckVhY2goKGl0ZW0pID0+IHtcclxuICAgICAgICAgICAgdGhpcy5fYXBwbHlUZXh0QXR0cmlidXRlKGl0ZW0pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHByb3RlY3RlZCBfY3JlYXRlRm9udExhYmVsIChzdHI6IHN0cmluZykge1xyXG4gICAgICAgIC8vIEB0cy1pZ25vcmVcclxuICAgICAgICByZXR1cm4gcG9vbC5nZXQhKHN0ciwgdGhpcyk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJvdGVjdGVkIF9vblRURkxvYWRlZCAoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuX2ZvbnQgaW5zdGFuY2VvZiBUVEZGb250KSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLl9mb250Ll9uYXRpdmVBc3NldCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fbGF5b3V0RGlydHkgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fdXBkYXRlUmljaFRleHQoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xyXG4gICAgICAgICAgICAgICAgbG9hZGVyLmxvYWQodGhpcy5fZm9udC5uYXRpdmVVcmwsIChlcnIsIGZvbnRGYW1pbHkpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBzZWxmLl9sYXlvdXREaXJ0eSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5fdXBkYXRlUmljaFRleHQoKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLl9sYXlvdXREaXJ0eSA9IHRydWU7XHJcbiAgICAgICAgICAgIHRoaXMuX3VwZGF0ZVJpY2hUZXh0KCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByb3RlY3RlZCBfbWVhc3VyZVRleHQgKHN0eWxlSW5kZXg6IG51bWJlciwgc3RyaW5nPzogc3RyaW5nKSB7XHJcbiAgICAgICAgY29uc3Qgc2VsZiA9IHRoaXM7XHJcbiAgICAgICAgY29uc3QgZnVuYyA9IChzOiBzdHJpbmcpID0+IHtcclxuICAgICAgICAgICAgbGV0IGxhYmVsOiBJTGFiZWxTZWdtZW50O1xyXG4gICAgICAgICAgICBpZiAoc2VsZi5fbGFiZWxTZWdtZW50c0NhY2hlLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICAgICAgICAgICAgbGFiZWwgPSBzZWxmLl9jcmVhdGVGb250TGFiZWwocyk7XHJcbiAgICAgICAgICAgICAgICBzZWxmLl9sYWJlbFNlZ21lbnRzQ2FjaGUucHVzaChsYWJlbCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBsYWJlbCA9IHNlbGYuX2xhYmVsU2VnbWVudHNDYWNoZVswXTtcclxuICAgICAgICAgICAgICAgIGxhYmVsLm5vZGUuZ2V0Q29tcG9uZW50KExhYmVsQ29tcG9uZW50KSEuc3RyaW5nID0gcztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBsYWJlbC5zdHlsZUluZGV4ID0gc3R5bGVJbmRleDtcclxuICAgICAgICAgICAgc2VsZi5fYXBwbHlUZXh0QXR0cmlidXRlKGxhYmVsKTtcclxuICAgICAgICAgICAgY29uc3QgbGFiZWxTaXplID0gbGFiZWwubm9kZS5nZXRDb250ZW50U2l6ZSgpO1xyXG4gICAgICAgICAgICByZXR1cm4gbGFiZWxTaXplLndpZHRoO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgaWYgKHN0cmluZykge1xyXG4gICAgICAgICAgICByZXR1cm4gZnVuYyhzdHJpbmcpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgcmV0dXJuIGZ1bmM7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByb3RlY3RlZCBfb25Ub3VjaEVuZGVkIChldmVudDogRXZlbnRUb3VjaCkge1xyXG4gICAgICAgIGNvbnN0IGNvbXBvbmVudHMgPSB0aGlzLm5vZGUuZ2V0Q29tcG9uZW50cyhVSUNvbXBvbmVudCk7XHJcblxyXG4gICAgICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xyXG4gICAgICAgIGZvciAoY29uc3Qgc2VnIG9mIHRoaXMuX2xhYmVsU2VnbWVudHMpIHtcclxuICAgICAgICAgICAgY29uc3QgY2xpY2tIYW5kbGVyID0gc2VnLmNsaWNrSGFuZGxlcjtcclxuICAgICAgICAgICAgaWYgKGNsaWNrSGFuZGxlciAmJiB0aGlzLl9jb250YWluc1RvdWNoTG9jYXRpb24oc2VnLCBldmVudC50b3VjaCEuZ2V0VUlMb2NhdGlvbigpKSkge1xyXG4gICAgICAgICAgICAgICAgY29tcG9uZW50cy5mb3JFYWNoKChjb21wb25lbnQpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBmdW5jID0gY29tcG9uZW50W2NsaWNrSGFuZGxlcl0gYXMgRnVuY3Rpb247XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNvbXBvbmVudC5lbmFibGVkSW5IaWVyYXJjaHkgJiYgZnVuYykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBmdW5jLmNhbGwoc2VsZiwgZXZlbnQpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgZXZlbnQucHJvcGFnYXRpb25TdG9wcGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcm90ZWN0ZWQgX2NvbnRhaW5zVG91Y2hMb2NhdGlvbiAobGFiZWw6IElMYWJlbFNlZ21lbnQsIHBvaW50OiBWZWMyKSB7XHJcbiAgICAgICAgY29uc3QgY29tcCA9IGxhYmVsLm5vZGUuZ2V0Q29tcG9uZW50KFVJVHJhbnNmb3JtQ29tcG9uZW50KTtcclxuICAgICAgICBpZiAoIWNvbXApIHtcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgbXlSZWN0ID0gY29tcC5nZXRCb3VuZGluZ0JveFRvV29ybGQoKTtcclxuICAgICAgICByZXR1cm4gbXlSZWN0LmNvbnRhaW5zKHBvaW50KTtcclxuICAgIH1cclxuXHJcbiAgICBwcm90ZWN0ZWQgX3Jlc2V0U3RhdGUgKCkge1xyXG4gICAgICAgIGNvbnN0IGNoaWxkcmVuID0gdGhpcy5ub2RlLmNoaWxkcmVuIGFzIE11dGFibGU8Tm9kZVtdPjtcclxuXHJcbiAgICAgICAgZm9yIChsZXQgaSA9IGNoaWxkcmVuLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGNoaWxkID0gY2hpbGRyZW5baV07XHJcbiAgICAgICAgICAgIGlmIChjaGlsZC5uYW1lID09PSBSaWNoVGV4dENoaWxkTmFtZSB8fCBjaGlsZC5uYW1lID09PSBSaWNoVGV4dENoaWxkSW1hZ2VOYW1lKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoY2hpbGQucGFyZW50ID09PSB0aGlzLm5vZGUpIHtcclxuICAgICAgICAgICAgICAgICAgICBjaGlsZC5wYXJlbnQgPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBJbiBjYXNlIGNoaWxkLnBhcmVudCAhPT0gdGhpcy5ub2RlLCBjaGlsZCBjYW5ub3QgYmUgcmVtb3ZlZCBmcm9tIGNoaWxkcmVuXHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGNoaWxkcmVuLnNwbGljZShpLCAxKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoY2hpbGQubmFtZSA9PT0gUmljaFRleHRDaGlsZE5hbWUpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBpbmRleCA9IHRoaXMuX2xhYmVsU2VnbWVudHMuZmluZEluZGV4KChzZWcpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNlZy5ub2RlID09PSBjaGlsZDtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGluZGV4ICE9PSAtMSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBwb29sLnB1dCh0aGlzLl9sYWJlbFNlZ21lbnRzW2luZGV4XSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLl9sYWJlbFNlZ21lbnRzLmxlbmd0aCA9IDA7XHJcbiAgICAgICAgdGhpcy5fbGFiZWxTZWdtZW50c0NhY2hlLmxlbmd0aCA9IDA7XHJcbiAgICAgICAgdGhpcy5fbGluZXNXaWR0aC5sZW5ndGggPSAwO1xyXG4gICAgICAgIHRoaXMuX2xpbmVPZmZzZXRYID0gMDtcclxuICAgICAgICB0aGlzLl9saW5lQ291bnQgPSAxO1xyXG4gICAgICAgIHRoaXMuX2xhYmVsV2lkdGggPSAwO1xyXG4gICAgICAgIHRoaXMuX2xhYmVsSGVpZ2h0ID0gMDtcclxuICAgICAgICB0aGlzLl9sYXlvdXREaXJ0eSA9IHRydWU7XHJcbiAgICB9XHJcblxyXG4gICAgcHJvdGVjdGVkIF9hY3RpdmF0ZUNoaWxkcmVuIChhY3RpdmUpIHtcclxuICAgICAgICBmb3IgKGxldCBpID0gdGhpcy5ub2RlLmNoaWxkcmVuLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGNoaWxkID0gdGhpcy5ub2RlLmNoaWxkcmVuW2ldO1xyXG4gICAgICAgICAgICBpZiAoY2hpbGQubmFtZSA9PT0gUmljaFRleHRDaGlsZE5hbWUgfHwgY2hpbGQubmFtZSA9PT0gUmljaFRleHRDaGlsZEltYWdlTmFtZSkge1xyXG4gICAgICAgICAgICAgICAgY2hpbGQuYWN0aXZlID0gYWN0aXZlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByb3RlY3RlZCBfYWRkTGFiZWxTZWdtZW50IChzdHJpbmdUb2tlbjogc3RyaW5nLCBzdHlsZUluZGV4OiBudW1iZXIpIHtcclxuICAgICAgICBsZXQgbGFiZWxTZWdtZW50OiBJTGFiZWxTZWdtZW50O1xyXG4gICAgICAgIGlmICh0aGlzLl9sYWJlbFNlZ21lbnRzQ2FjaGUubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgICAgIGxhYmVsU2VnbWVudCA9IHRoaXMuX2NyZWF0ZUZvbnRMYWJlbChzdHJpbmdUb2tlbik7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgbGFiZWxTZWdtZW50ID0gdGhpcy5fbGFiZWxTZWdtZW50c0NhY2hlLnBvcCgpITtcclxuICAgICAgICAgICAgY29uc3QgbGFiZWwgPSBsYWJlbFNlZ21lbnQubm9kZS5nZXRDb21wb25lbnQoTGFiZWxDb21wb25lbnQpO1xyXG4gICAgICAgICAgICBpZiAobGFiZWwpIHtcclxuICAgICAgICAgICAgICAgIGxhYmVsLnN0cmluZyA9IHN0cmluZ1Rva2VuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBsYWJlbFNlZ21lbnQuc3R5bGVJbmRleCA9IHN0eWxlSW5kZXg7XHJcbiAgICAgICAgbGFiZWxTZWdtZW50LmxpbmVDb3VudCA9IHRoaXMuX2xpbmVDb3VudDtcclxuICAgICAgICBsYWJlbFNlZ21lbnQubm9kZS5zZXRBbmNob3JQb2ludCgwLCAwKTtcclxuICAgICAgICB0aGlzLl9hcHBseVRleHRBdHRyaWJ1dGUobGFiZWxTZWdtZW50KTtcclxuICAgICAgICAvLyBAdHMtaWdub3JlXHJcbiAgICAgICAgdGhpcy5ub2RlLmFkZENoaWxkKGxhYmVsU2VnbWVudC5ub2RlKTtcclxuICAgICAgICB0aGlzLl9sYWJlbFNlZ21lbnRzLnB1c2gobGFiZWxTZWdtZW50KTtcclxuXHJcbiAgICAgICAgcmV0dXJuIGxhYmVsU2VnbWVudDtcclxuICAgIH1cclxuXHJcbiAgICBwcm90ZWN0ZWQgX3VwZGF0ZVJpY2hUZXh0V2l0aE1heFdpZHRoIChsYWJlbFN0cmluZzogc3RyaW5nLCBsYWJlbFdpZHRoOiBudW1iZXIsIHN0eWxlSW5kZXg6IG51bWJlcikge1xyXG4gICAgICAgIGxldCBmcmFnbWVudFdpZHRoID0gbGFiZWxXaWR0aDtcclxuICAgICAgICBsZXQgbGFiZWxTZWdtZW50OiBJTGFiZWxTZWdtZW50O1xyXG5cclxuICAgICAgICBpZiAodGhpcy5fbGluZU9mZnNldFggPiAwICYmIGZyYWdtZW50V2lkdGggKyB0aGlzLl9saW5lT2Zmc2V0WCA+IHRoaXMubWF4V2lkdGgpIHtcclxuICAgICAgICAgICAgLy8gY29uY2F0IHByZXZpb3VzIGxpbmVcclxuICAgICAgICAgICAgbGV0IGNoZWNrU3RhcnRJbmRleCA9IDA7XHJcbiAgICAgICAgICAgIHdoaWxlICh0aGlzLl9saW5lT2Zmc2V0WCA8PSB0aGlzLm1heFdpZHRoKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBjaGVja0VuZEluZGV4ID0gdGhpcy5fZ2V0Rmlyc3RXb3JkTGVuKGxhYmVsU3RyaW5nLFxyXG4gICAgICAgICAgICAgICAgICAgIGNoZWNrU3RhcnRJbmRleCxcclxuICAgICAgICAgICAgICAgICAgICBsYWJlbFN0cmluZy5sZW5ndGgpO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgY2hlY2tTdHJpbmcgPSBsYWJlbFN0cmluZy5zdWJzdHIoY2hlY2tTdGFydEluZGV4LCBjaGVja0VuZEluZGV4KTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGNoZWNrU3RyaW5nV2lkdGggPSB0aGlzLl9tZWFzdXJlVGV4dChzdHlsZUluZGV4LCBjaGVja1N0cmluZykgYXMgbnVtYmVyO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLl9saW5lT2Zmc2V0WCArIGNoZWNrU3RyaW5nV2lkdGggPD0gdGhpcy5tYXhXaWR0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2xpbmVPZmZzZXRYICs9IGNoZWNrU3RyaW5nV2lkdGg7XHJcbiAgICAgICAgICAgICAgICAgICAgY2hlY2tTdGFydEluZGV4ICs9IGNoZWNrRW5kSW5kZXg7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNoZWNrU3RhcnRJbmRleCA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVtYWluaW5nU3RyaW5nID0gbGFiZWxTdHJpbmcuc3Vic3RyKDAsIGNoZWNrU3RhcnRJbmRleCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2FkZExhYmVsU2VnbWVudChyZW1haW5pbmdTdHJpbmcsIHN0eWxlSW5kZXgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBsYWJlbFN0cmluZyA9IGxhYmVsU3RyaW5nLnN1YnN0cihjaGVja1N0YXJ0SW5kZXgsIGxhYmVsU3RyaW5nLmxlbmd0aCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZyYWdtZW50V2lkdGggPSB0aGlzLl9tZWFzdXJlVGV4dChzdHlsZUluZGV4LCBsYWJlbFN0cmluZykgYXMgbnVtYmVyO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl91cGRhdGVMaW5lSW5mbygpO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChmcmFnbWVudFdpZHRoID4gdGhpcy5tYXhXaWR0aCkge1xyXG4gICAgICAgICAgICBjb25zdCBmcmFnbWVudHMgPSBmcmFnbWVudFRleHQobGFiZWxTdHJpbmcsXHJcbiAgICAgICAgICAgICAgICBmcmFnbWVudFdpZHRoLFxyXG4gICAgICAgICAgICAgICAgdGhpcy5tYXhXaWR0aCxcclxuICAgICAgICAgICAgICAgIHRoaXMuX21lYXN1cmVUZXh0KHN0eWxlSW5kZXgpIGFzIChzOiBzdHJpbmcpID0+IG51bWJlcik7XHJcbiAgICAgICAgICAgIGZvciAobGV0IGsgPSAwOyBrIDwgZnJhZ21lbnRzLmxlbmd0aDsgKytrKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBzcGxpdFN0cmluZyA9IGZyYWdtZW50c1trXTtcclxuICAgICAgICAgICAgICAgIGxhYmVsU2VnbWVudCA9IHRoaXMuX2FkZExhYmVsU2VnbWVudChzcGxpdFN0cmluZywgc3R5bGVJbmRleCk7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBsYWJlbFNpemUgPSBsYWJlbFNlZ21lbnQubm9kZS5nZXRDb250ZW50U2l6ZSgpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fbGluZU9mZnNldFggKz0gbGFiZWxTaXplLndpZHRoO1xyXG4gICAgICAgICAgICAgICAgaWYgKGZyYWdtZW50cy5sZW5ndGggPiAxICYmIGsgPCBmcmFnbWVudHMubGVuZ3RoIC0gMSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3VwZGF0ZUxpbmVJbmZvKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMuX2xpbmVPZmZzZXRYICs9IGZyYWdtZW50V2lkdGg7XHJcbiAgICAgICAgICAgIHRoaXMuX2FkZExhYmVsU2VnbWVudChsYWJlbFN0cmluZywgc3R5bGVJbmRleCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByb3RlY3RlZCBfaXNMYXN0Q29tcG9uZW50Q1IgKHN0cmluZ1Rva2VuKSB7XHJcbiAgICAgICAgcmV0dXJuIHN0cmluZ1Rva2VuLmxlbmd0aCAtIDEgPT09IHN0cmluZ1Rva2VuLmxhc3RJbmRleE9mKCdcXG4nKTtcclxuICAgIH1cclxuXHJcbiAgICBwcm90ZWN0ZWQgX3VwZGF0ZUxpbmVJbmZvICgpIHtcclxuICAgICAgICB0aGlzLl9saW5lc1dpZHRoLnB1c2godGhpcy5fbGluZU9mZnNldFgpO1xyXG4gICAgICAgIHRoaXMuX2xpbmVPZmZzZXRYID0gMDtcclxuICAgICAgICB0aGlzLl9saW5lQ291bnQrKztcclxuICAgIH1cclxuXHJcbiAgICBwcm90ZWN0ZWQgX25lZWRzVXBkYXRlVGV4dExheW91dCAobmV3VGV4dEFycmF5OiBJSHRtbFRleHRQYXJzZXJSZXN1bHRPYmpbXSkge1xyXG4gICAgICAgIGlmICh0aGlzLl9sYXlvdXREaXJ0eSB8fCAhdGhpcy5fdGV4dEFycmF5IHx8ICFuZXdUZXh0QXJyYXkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodGhpcy5fdGV4dEFycmF5Lmxlbmd0aCAhPT0gbmV3VGV4dEFycmF5Lmxlbmd0aCkge1xyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5fdGV4dEFycmF5Lmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IG9sZEl0ZW0gPSB0aGlzLl90ZXh0QXJyYXlbaV07XHJcbiAgICAgICAgICAgIGNvbnN0IG5ld0l0ZW0gPSBuZXdUZXh0QXJyYXlbaV07XHJcbiAgICAgICAgICAgIGlmIChvbGRJdGVtLnRleHQgIT09IG5ld0l0ZW0udGV4dCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBpZiAob2xkSXRlbS5zdHlsZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChuZXdJdGVtLnN0eWxlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghIW5ld0l0ZW0uc3R5bGUub3V0bGluZSAhPT0gISFvbGRJdGVtLnN0eWxlLm91dGxpbmUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvbGRJdGVtLnN0eWxlLnNpemUgIT09IG5ld0l0ZW0uc3R5bGUuc2l6ZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfHwgb2xkSXRlbS5zdHlsZS5pdGFsaWMgIT09IG5ld0l0ZW0uc3R5bGUuaXRhbGljXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB8fCBvbGRJdGVtLnN0eWxlLmlzSW1hZ2UgIT09IG5ld0l0ZW0uc3R5bGUuaXNJbWFnZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9sZEl0ZW0uc3R5bGUuaXNJbWFnZSA9PT0gbmV3SXRlbS5zdHlsZS5pc0ltYWdlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAob2xkSXRlbS5zdHlsZS5zcmMgIT09IG5ld0l0ZW0uc3R5bGUuc3JjKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAob2xkSXRlbS5zdHlsZS5zaXplIHx8IG9sZEl0ZW0uc3R5bGUuaXRhbGljIHx8IG9sZEl0ZW0uc3R5bGUuaXNJbWFnZSB8fCBvbGRJdGVtLnN0eWxlLm91dGxpbmUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAobmV3SXRlbS5zdHlsZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAobmV3SXRlbS5zdHlsZS5zaXplIHx8IG5ld0l0ZW0uc3R5bGUuaXRhbGljIHx8IG5ld0l0ZW0uc3R5bGUuaXNJbWFnZSB8fCBuZXdJdGVtLnN0eWxlLm91dGxpbmUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuXHJcbiAgICBwcm90ZWN0ZWQgX2FkZFJpY2hUZXh0SW1hZ2VFbGVtZW50IChyaWNoVGV4dEVsZW1lbnQ6IElIdG1sVGV4dFBhcnNlclJlc3VsdE9iaikge1xyXG4gICAgICAgIGlmICghcmljaFRleHRFbGVtZW50LnN0eWxlKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IHNwcml0ZUZyYW1lTmFtZSA9IHJpY2hUZXh0RWxlbWVudC5zdHlsZS5zcmM7XHJcbiAgICAgICAgY29uc3Qgc3ByaXRlRnJhbWUgPSB0aGlzLl9pbWFnZUF0bGFzICYmIHNwcml0ZUZyYW1lTmFtZSAmJiB0aGlzLl9pbWFnZUF0bGFzLmdldFNwcml0ZUZyYW1lKHNwcml0ZUZyYW1lTmFtZSk7XHJcbiAgICAgICAgaWYgKHNwcml0ZUZyYW1lKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHNwcml0ZU5vZGUgPSBuZXcgUHJpdmF0ZU5vZGUoUmljaFRleHRDaGlsZEltYWdlTmFtZSk7XHJcbiAgICAgICAgICAgIGNvbnN0IHNwcml0ZUNvbXBvbmVudCA9IHNwcml0ZU5vZGUuYWRkQ29tcG9uZW50KFNwcml0ZUNvbXBvbmVudCk7XHJcbiAgICAgICAgICAgIHNwcml0ZU5vZGUuc2V0QW5jaG9yUG9pbnQoMCwgMCk7XHJcbiAgICAgICAgICAgIHNwcml0ZUNvbXBvbmVudCEudHlwZSA9IFNwcml0ZUNvbXBvbmVudC5UeXBlLlNMSUNFRDtcclxuICAgICAgICAgICAgc3ByaXRlQ29tcG9uZW50IS5zaXplTW9kZSA9IFNwcml0ZUNvbXBvbmVudC5TaXplTW9kZS5DVVNUT007XHJcbiAgICAgICAgICAgIC8vIEB0cy1pZ25vcmVcclxuICAgICAgICAgICAgdGhpcy5ub2RlLmFkZENoaWxkKHNwcml0ZU5vZGUpO1xyXG4gICAgICAgICAgICBjb25zdCBvYmo6IElMYWJlbFNlZ21lbnQgPSB7XHJcbiAgICAgICAgICAgICAgICBub2RlOiBzcHJpdGVOb2RlLFxyXG4gICAgICAgICAgICAgICAgY29tcDogc3ByaXRlQ29tcG9uZW50LFxyXG4gICAgICAgICAgICAgICAgbGluZUNvdW50OiAwLFxyXG4gICAgICAgICAgICAgICAgY2xpY2tIYW5kbGVyOiAnJyxcclxuICAgICAgICAgICAgICAgIHN0eWxlSW5kZXg6IDAsXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIHRoaXMuX2xhYmVsU2VnbWVudHMucHVzaChvYmopO1xyXG5cclxuICAgICAgICAgICAgY29uc3Qgc3ByaXRlUmVjdCA9IHNwcml0ZUZyYW1lLmdldFJlY3QoKTtcclxuICAgICAgICAgICAgbGV0IHNjYWxlRmFjdG9yID0gMTtcclxuICAgICAgICAgICAgbGV0IHNwcml0ZVdpZHRoID0gc3ByaXRlUmVjdC53aWR0aDtcclxuICAgICAgICAgICAgbGV0IHNwcml0ZUhlaWdodCA9IHNwcml0ZVJlY3QuaGVpZ2h0O1xyXG4gICAgICAgICAgICBjb25zdCBleHBlY3RXaWR0aCA9IHJpY2hUZXh0RWxlbWVudC5zdHlsZS5pbWFnZVdpZHRoO1xyXG4gICAgICAgICAgICBjb25zdCBleHBlY3RIZWlnaHQgPSByaWNoVGV4dEVsZW1lbnQuc3R5bGUuaW1hZ2VIZWlnaHQ7XHJcblxyXG4gICAgICAgICAgICAvLyBmb2xsb3cgdGhlIG9yaWdpbmFsIHJ1bGUsIGV4cGVjdEhlaWdodCBtdXN0IGxlc3MgdGhlbiBsaW5lSGVpZ2h0XHJcbiAgICAgICAgICAgIGlmIChleHBlY3RIZWlnaHQgIT09IHVuZGVmaW5lZCAmJiBleHBlY3RIZWlnaHQgPiAwICYmIGV4cGVjdEhlaWdodCA8IHRoaXMubGluZUhlaWdodCkge1xyXG4gICAgICAgICAgICAgICAgc2NhbGVGYWN0b3IgPSBleHBlY3RIZWlnaHQgLyBzcHJpdGVIZWlnaHQ7XHJcbiAgICAgICAgICAgICAgICBzcHJpdGVXaWR0aCA9IHNwcml0ZVdpZHRoICogc2NhbGVGYWN0b3I7XHJcbiAgICAgICAgICAgICAgICBzcHJpdGVIZWlnaHQgPSBzcHJpdGVIZWlnaHQgKiBzY2FsZUZhY3RvcjtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHNjYWxlRmFjdG9yID0gdGhpcy5saW5lSGVpZ2h0IC8gc3ByaXRlSGVpZ2h0O1xyXG4gICAgICAgICAgICAgICAgc3ByaXRlV2lkdGggPSBzcHJpdGVXaWR0aCAqIHNjYWxlRmFjdG9yO1xyXG4gICAgICAgICAgICAgICAgc3ByaXRlSGVpZ2h0ID0gc3ByaXRlSGVpZ2h0ICogc2NhbGVGYWN0b3I7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmIChleHBlY3RXaWR0aCAhPT0gdW5kZWZpbmVkICYmIGV4cGVjdFdpZHRoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgc3ByaXRlV2lkdGggPSBleHBlY3RXaWR0aDtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKHRoaXMubWF4V2lkdGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5fbGluZU9mZnNldFggKyBzcHJpdGVXaWR0aCA+IHRoaXMubWF4V2lkdGgpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl91cGRhdGVMaW5lSW5mbygpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgdGhpcy5fbGluZU9mZnNldFggKz0gc3ByaXRlV2lkdGg7XHJcblxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fbGluZU9mZnNldFggKz0gc3ByaXRlV2lkdGg7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5fbGluZU9mZnNldFggPiB0aGlzLl9sYWJlbFdpZHRoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fbGFiZWxXaWR0aCA9IHRoaXMuX2xpbmVPZmZzZXRYO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHNwcml0ZUNvbXBvbmVudCEuc3ByaXRlRnJhbWUgPSBzcHJpdGVGcmFtZTtcclxuICAgICAgICAgICAgc3ByaXRlTm9kZS5zZXRDb250ZW50U2l6ZShzcHJpdGVXaWR0aCwgc3ByaXRlSGVpZ2h0KTtcclxuICAgICAgICAgICAgb2JqLmxpbmVDb3VudCA9IHRoaXMuX2xpbmVDb3VudDtcclxuXHJcbiAgICAgICAgICAgIGlmIChyaWNoVGV4dEVsZW1lbnQuc3R5bGUuZXZlbnQpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGMgPSAnY2xpY2snO1xyXG4gICAgICAgICAgICAgICAgaWYgKHJpY2hUZXh0RWxlbWVudC5zdHlsZS5ldmVudFtjXSkge1xyXG4gICAgICAgICAgICAgICAgICAgIG9iai5jbGlja0hhbmRsZXIgPSByaWNoVGV4dEVsZW1lbnQuc3R5bGUuZXZlbnRbY107XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHdhcm5JRCg0NDAwKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJvdGVjdGVkIF91cGRhdGVSaWNoVGV4dCAoKSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLmVuYWJsZWQpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgbmV3VGV4dEFycmF5ID0gX2h0bWxUZXh0UGFyc2VyLnBhcnNlKHRoaXMuX3N0cmluZyk7XHJcbiAgICAgICAgaWYgKCF0aGlzLl9uZWVkc1VwZGF0ZVRleHRMYXlvdXQobmV3VGV4dEFycmF5KSkge1xyXG4gICAgICAgICAgICB0aGlzLl90ZXh0QXJyYXkgPSBuZXdUZXh0QXJyYXkuc2xpY2UoKTtcclxuICAgICAgICAgICAgdGhpcy5fdXBkYXRlTGFiZWxTZWdtZW50VGV4dEF0dHJpYnV0ZXMoKTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5fdGV4dEFycmF5ID0gbmV3VGV4dEFycmF5LnNsaWNlKCk7XHJcbiAgICAgICAgdGhpcy5fcmVzZXRTdGF0ZSgpO1xyXG5cclxuICAgICAgICBsZXQgbGFzdEVtcHR5TGluZSA9IGZhbHNlO1xyXG4gICAgICAgIGxldCBsYWJlbDogSUxhYmVsU2VnbWVudDtcclxuICAgICAgICBsZXQgbGFiZWxTaXplO1xyXG5cclxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuX3RleHRBcnJheS5sZW5ndGg7ICsraSkge1xyXG4gICAgICAgICAgICBjb25zdCByaWNoVGV4dEVsZW1lbnQgPSB0aGlzLl90ZXh0QXJyYXlbaV07XHJcbiAgICAgICAgICAgIGNvbnN0IHRleHQgPSByaWNoVGV4dEVsZW1lbnQudGV4dDtcclxuICAgICAgICAgICAgaWYgKHRleHQgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgY29udGludWU7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIGhhbmRsZSA8YnIvPiA8aW1nIC8+IHRhZ1xyXG4gICAgICAgICAgICBpZiAodGV4dCA9PT0gJycpIHtcclxuICAgICAgICAgICAgICAgIGlmIChyaWNoVGV4dEVsZW1lbnQuc3R5bGUgJiYgcmljaFRleHRFbGVtZW50LnN0eWxlLmlzTmV3TGluZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3VwZGF0ZUxpbmVJbmZvKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgY29udGludWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAocmljaFRleHRFbGVtZW50LnN0eWxlICYmIHJpY2hUZXh0RWxlbWVudC5zdHlsZS5pc0ltYWdlICYmIHRoaXMuaW1hZ2VBdGxhcykge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2FkZFJpY2hUZXh0SW1hZ2VFbGVtZW50KHJpY2hUZXh0RWxlbWVudCk7XHJcbiAgICAgICAgICAgICAgICAgICAgY29udGludWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY29uc3QgbXVsdGlsaW5lVGV4dHMgPSB0ZXh0LnNwbGl0KCdcXG4nKTtcclxuXHJcbiAgICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgbXVsdGlsaW5lVGV4dHMubGVuZ3RoOyArK2opIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGxhYmVsU3RyaW5nID0gbXVsdGlsaW5lVGV4dHNbal07XHJcbiAgICAgICAgICAgICAgICBpZiAobGFiZWxTdHJpbmcgPT09ICcnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gZm9yIGNvbnRpbnVlcyBcXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5faXNMYXN0Q29tcG9uZW50Q1IodGV4dClcclxuICAgICAgICAgICAgICAgICAgICAgICAgJiYgaiA9PT0gbXVsdGlsaW5lVGV4dHMubGVuZ3RoIC0gMSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdXBkYXRlTGluZUluZm8oKTtcclxuICAgICAgICAgICAgICAgICAgICBsYXN0RW1wdHlMaW5lID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGxhc3RFbXB0eUxpbmUgPSBmYWxzZTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5tYXhXaWR0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBsYWJlbFdpZHRoID0gdGhpcy5fbWVhc3VyZVRleHQoaSwgbGFiZWxTdHJpbmcpIGFzIG51bWJlcjtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl91cGRhdGVSaWNoVGV4dFdpdGhNYXhXaWR0aChsYWJlbFN0cmluZywgbGFiZWxXaWR0aCwgaSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChtdWx0aWxpbmVUZXh0cy5sZW5ndGggPiAxICYmIGogPCBtdWx0aWxpbmVUZXh0cy5sZW5ndGggLSAxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3VwZGF0ZUxpbmVJbmZvKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBsYWJlbCA9IHRoaXMuX2FkZExhYmVsU2VnbWVudChsYWJlbFN0cmluZywgaSk7XHJcbiAgICAgICAgICAgICAgICAgICAgbGFiZWxTaXplID0gbGFiZWwubm9kZS5nZXRDb250ZW50U2l6ZSgpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9saW5lT2Zmc2V0WCArPSBsYWJlbFNpemUud2lkdGg7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuX2xpbmVPZmZzZXRYID4gdGhpcy5fbGFiZWxXaWR0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9sYWJlbFdpZHRoID0gdGhpcy5fbGluZU9mZnNldFg7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAobXVsdGlsaW5lVGV4dHMubGVuZ3RoID4gMSAmJiBqIDwgbXVsdGlsaW5lVGV4dHMubGVuZ3RoIC0gMSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl91cGRhdGVMaW5lSW5mbygpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoIWxhc3RFbXB0eUxpbmUpIHtcclxuICAgICAgICAgICAgdGhpcy5fbGluZXNXaWR0aC5wdXNoKHRoaXMuX2xpbmVPZmZzZXRYKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh0aGlzLm1heFdpZHRoID4gMCkge1xyXG4gICAgICAgICAgICB0aGlzLl9sYWJlbFdpZHRoID0gdGhpcy5tYXhXaWR0aDtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5fbGFiZWxIZWlnaHQgPSAodGhpcy5fbGluZUNvdW50ICsgQkFTRUxJTkVfUkFUSU8pICogdGhpcy5saW5lSGVpZ2h0O1xyXG5cclxuICAgICAgICAvLyB0cmlnZ2VyIFwic2l6ZS1jaGFuZ2VkXCIgZXZlbnRcclxuICAgICAgICB0aGlzLm5vZGUuc2V0Q29udGVudFNpemUodGhpcy5fbGFiZWxXaWR0aCwgdGhpcy5fbGFiZWxIZWlnaHQpO1xyXG5cclxuICAgICAgICB0aGlzLl91cGRhdGVSaWNoVGV4dFBvc2l0aW9uKCk7XHJcbiAgICAgICAgdGhpcy5fbGF5b3V0RGlydHkgPSBmYWxzZTtcclxuICAgIH1cclxuXHJcbiAgICBwcm90ZWN0ZWQgX2dldEZpcnN0V29yZExlbiAodGV4dDogc3RyaW5nLCBzdGFydEluZGV4OiBudW1iZXIsIHRleHRMZW46IG51bWJlcikge1xyXG4gICAgICAgIGxldCBjaGFyYWN0ZXIgPSB0ZXh0LmNoYXJBdChzdGFydEluZGV4KTtcclxuICAgICAgICBpZiAoaXNVbmljb2RlQ0pLKGNoYXJhY3RlcikgfHwgaXNVbmljb2RlU3BhY2UoY2hhcmFjdGVyKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gMTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGxldCBsZW4gPSAxO1xyXG4gICAgICAgIGZvciAobGV0IGluZGV4ID0gc3RhcnRJbmRleCArIDE7IGluZGV4IDwgdGV4dExlbjsgKytpbmRleCkge1xyXG4gICAgICAgICAgICBjaGFyYWN0ZXIgPSB0ZXh0LmNoYXJBdChpbmRleCk7XHJcbiAgICAgICAgICAgIGlmIChpc1VuaWNvZGVTcGFjZShjaGFyYWN0ZXIpIHx8IGlzVW5pY29kZUNKSyhjaGFyYWN0ZXIpKSB7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgbGVuKys7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gbGVuO1xyXG4gICAgfVxyXG5cclxuICAgIHByb3RlY3RlZCBfdXBkYXRlUmljaFRleHRQb3NpdGlvbiAoKSB7XHJcbiAgICAgICAgbGV0IG5leHRUb2tlblggPSAwO1xyXG4gICAgICAgIGxldCBuZXh0TGluZUluZGV4ID0gMTtcclxuICAgICAgICBjb25zdCB0b3RhbExpbmVDb3VudCA9IHRoaXMuX2xpbmVDb3VudDtcclxuICAgICAgICBmb3IgKGNvbnN0IGxhYmVsIG9mIHRoaXMuX2xhYmVsU2VnbWVudHMpIHtcclxuICAgICAgICAgICAgY29uc3QgbGluZUNvdW50ID0gbGFiZWwubGluZUNvdW50O1xyXG4gICAgICAgICAgICBpZiAobGluZUNvdW50ID4gbmV4dExpbmVJbmRleCkge1xyXG4gICAgICAgICAgICAgICAgbmV4dFRva2VuWCA9IDA7XHJcbiAgICAgICAgICAgICAgICBuZXh0TGluZUluZGV4ID0gbGluZUNvdW50O1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBjb25zdCBhbmNob3JYID0gdGhpcy5ub2RlLmFuY2hvclg7XHJcbiAgICAgICAgICAgIGxldCBsaW5lT2Zmc2V0WCA9IHRoaXMuX2xhYmVsV2lkdGggKiAodGhpcy5ob3Jpem9udGFsQWxpZ24gKiAwLjUgLSBhbmNob3JYKTtcclxuICAgICAgICAgICAgc3dpdGNoICh0aGlzLmhvcml6b250YWxBbGlnbikge1xyXG4gICAgICAgICAgICAgICAgY2FzZSBIb3Jpem9udGFsVGV4dEFsaWdubWVudC5MRUZUOlxyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgY2FzZSBIb3Jpem9udGFsVGV4dEFsaWdubWVudC5DRU5URVI6XHJcbiAgICAgICAgICAgICAgICAgICAgbGluZU9mZnNldFggLT0gdGhpcy5fbGluZXNXaWR0aFtsaW5lQ291bnQgLSAxXSAvIDI7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBjYXNlIEhvcml6b250YWxUZXh0QWxpZ25tZW50LlJJR0hUOlxyXG4gICAgICAgICAgICAgICAgICAgIGxpbmVPZmZzZXRYIC09IHRoaXMuX2xpbmVzV2lkdGhbbGluZUNvdW50IC0gMV07XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBjb25zdCBwb3MgPSBsYWJlbC5ub2RlLnBvc2l0aW9uO1xyXG4gICAgICAgICAgICBjb25zdCBhbmNob3JZID0gdGhpcy5ub2RlLmFuY2hvclk7XHJcbiAgICAgICAgICAgIGxhYmVsLm5vZGUuc2V0UG9zaXRpb24obmV4dFRva2VuWCArIGxpbmVPZmZzZXRYLFxyXG4gICAgICAgICAgICAgICAgdGhpcy5saW5lSGVpZ2h0ICogKHRvdGFsTGluZUNvdW50IC0gbGluZUNvdW50KSAtIHRoaXMuX2xhYmVsSGVpZ2h0ICogYW5jaG9yWSxcclxuICAgICAgICAgICAgICAgIHBvcy56LFxyXG4gICAgICAgICAgICApO1xyXG5cclxuICAgICAgICAgICAgaWYgKGxpbmVDb3VudCA9PT0gbmV4dExpbmVJbmRleCkge1xyXG4gICAgICAgICAgICAgICAgbmV4dFRva2VuWCArPSBsYWJlbC5ub2RlLndpZHRoO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByb3RlY3RlZCBfY29udmVydExpdGVyYWxDb2xvclZhbHVlIChjb2xvcjogc3RyaW5nKSB7XHJcbiAgICAgICAgY29uc3QgY29sb3JWYWx1ZSA9IGNvbG9yLnRvVXBwZXJDYXNlKCk7XHJcbiAgICAgICAgaWYgKENvbG9yW2NvbG9yVmFsdWVdKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBDb2xvcltjb2xvclZhbHVlXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIGNvbnN0IG91dCA9IG5ldyBDb2xvcigpO1xyXG4gICAgICAgICAgICByZXR1cm4gb3V0LmZyb21IRVgoY29sb3IpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcm90ZWN0ZWQgX2FwcGx5VGV4dEF0dHJpYnV0ZSAobGFiZWxTZWc6IElMYWJlbFNlZ21lbnQpIHtcclxuICAgICAgICBjb25zdCBsYWJlbENvbXBvbmVudCA9IGxhYmVsU2VnLm5vZGUuZ2V0Q29tcG9uZW50KExhYmVsQ29tcG9uZW50KTtcclxuICAgICAgICBpZiAoIWxhYmVsQ29tcG9uZW50KSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IGluZGV4ID0gbGFiZWxTZWcuc3R5bGVJbmRleDtcclxuICAgICAgICBsYWJlbENvbXBvbmVudC5saW5lSGVpZ2h0ID0gdGhpcy5saW5lSGVpZ2h0O1xyXG4gICAgICAgIGxhYmVsQ29tcG9uZW50Lmhvcml6b250YWxBbGlnbiA9IEhvcml6b250YWxUZXh0QWxpZ25tZW50LkxFRlQ7XHJcbiAgICAgICAgbGFiZWxDb21wb25lbnQudmVydGljYWxBbGlnbiA9IFZlcnRpY2FsVGV4dEFsaWdubWVudC5DRU5URVI7XHJcblxyXG4gICAgICAgIGxldCB0ZXh0U3R5bGU6IElIdG1sVGV4dFBhcnNlclN0YWNrIHwgdW5kZWZpbmVkO1xyXG4gICAgICAgIGlmICh0aGlzLl90ZXh0QXJyYXlbaW5kZXhdKSB7XHJcbiAgICAgICAgICAgIHRleHRTdHlsZSA9IHRoaXMuX3RleHRBcnJheVtpbmRleF0uc3R5bGU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCBsYWJlbENvbXAgPSBsYWJlbFNlZy5ub2RlLmdldENvbXBvbmVudChMYWJlbENvbXBvbmVudCk7XHJcbiAgICAgICAgaWYgKGxhYmVsQ29tcCkge1xyXG4gICAgICAgICAgICBpZiAodGV4dFN0eWxlICYmIHRleHRTdHlsZS5jb2xvcikge1xyXG4gICAgICAgICAgICAgICAgbGFiZWxDb21wLmNvbG9yID0gdGhpcy5fY29udmVydExpdGVyYWxDb2xvclZhbHVlKHRleHRTdHlsZS5jb2xvcik7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBsYWJlbENvbXAuY29sb3IgPSB0aGlzLl9jb252ZXJ0TGl0ZXJhbENvbG9yVmFsdWUoJ3doaXRlJyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGxhYmVsQ29tcG9uZW50LmlzQm9sZCA9ICEhKHRleHRTdHlsZSAmJiB0ZXh0U3R5bGUuYm9sZCk7XHJcblxyXG4gICAgICAgIGxhYmVsQ29tcG9uZW50LmlzSXRhbGljID0gISEodGV4dFN0eWxlICYmIHRleHRTdHlsZS5pdGFsaWMpO1xyXG4gICAgICAgIC8vIFRPRE86IHRlbXBvcmFyeSBpbXBsZW1lbnRhdGlvbiwgdGhlIGl0YWxpYyBlZmZlY3Qgc2hvdWxkIGJlIGltcGxlbWVudGVkIGluIHRoZSBpbnRlcm5hbCBvZiBsYWJlbC1hc3NlbWJsZXIuXHJcbiAgICAgICAgLy8gaWYgKHRleHRTdHlsZSAmJiB0ZXh0U3R5bGUuaXRhbGljKSB7XHJcbiAgICAgICAgLy8gICAgIGxhYmVsTm9kZS5za2V3WCA9IDEyO1xyXG4gICAgICAgIC8vIH1cclxuXHJcbiAgICAgICAgbGFiZWxDb21wb25lbnQuaXNVbmRlcmxpbmUgPSAhISh0ZXh0U3R5bGUgJiYgdGV4dFN0eWxlLnVuZGVybGluZSk7XHJcblxyXG4gICAgICAgIGlmICh0ZXh0U3R5bGUgJiYgdGV4dFN0eWxlLm91dGxpbmUpIHtcclxuICAgICAgICAgICAgbGV0IGxhYmVsT3V0bGluZUNvbXBvbmVudCA9IGxhYmVsU2VnLm5vZGUuZ2V0Q29tcG9uZW50KExhYmVsT3V0bGluZUNvbXBvbmVudCk7XHJcbiAgICAgICAgICAgIGlmICghbGFiZWxPdXRsaW5lQ29tcG9uZW50KSB7XHJcbiAgICAgICAgICAgICAgICBsYWJlbE91dGxpbmVDb21wb25lbnQgPSBsYWJlbFNlZy5ub2RlLmFkZENvbXBvbmVudChMYWJlbE91dGxpbmVDb21wb25lbnQpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBsYWJlbE91dGxpbmVDb21wb25lbnQhLmNvbG9yID0gdGhpcy5fY29udmVydExpdGVyYWxDb2xvclZhbHVlKHRleHRTdHlsZS5vdXRsaW5lLmNvbG9yKTtcclxuICAgICAgICAgICAgbGFiZWxPdXRsaW5lQ29tcG9uZW50IS53aWR0aCA9IHRleHRTdHlsZS5vdXRsaW5lLndpZHRoO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHRleHRTdHlsZSAmJiB0ZXh0U3R5bGUuc2l6ZSkge1xyXG4gICAgICAgICAgICBsYWJlbENvbXBvbmVudC5mb250U2l6ZSA9IHRleHRTdHlsZS5zaXplO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgbGFiZWxDb21wb25lbnQuZm9udFNpemUgPSB0aGlzLl9mb250U2l6ZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGxhYmVsQ29tcG9uZW50LnVwZGF0ZVJlbmRlckRhdGEodHJ1ZSk7XHJcblxyXG4gICAgICAgIGlmICh0ZXh0U3R5bGUgJiYgdGV4dFN0eWxlLmV2ZW50KSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGMgPSAnY2xpY2snO1xyXG4gICAgICAgICAgICBpZiAodGV4dFN0eWxlLmV2ZW50W2NdKSB7XHJcbiAgICAgICAgICAgICAgICBsYWJlbFNlZy5jbGlja0hhbmRsZXIgPSB0ZXh0U3R5bGUuZXZlbnRbY107XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBfYW5jaG9yQ2hhbmdlZCAoKSB7XHJcbiAgICAgICAgdGhpcy5fdXBkYXRlUmljaFRleHRQb3NpdGlvbigpO1xyXG4gICAgfVxyXG59XHJcblxyXG5jYy5SaWNoVGV4dENvbXBvbmVudCA9IFJpY2hUZXh0Q29tcG9uZW50O1xyXG4iXX0=