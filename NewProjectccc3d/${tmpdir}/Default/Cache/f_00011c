(function (global, factory) {
  if (typeof define === "function" && define.amd) {
    define(["exports", "../../../core/math/index.js"], factory);
  } else if (typeof exports !== "undefined") {
    factory(exports, require("../../../core/math/index.js"));
  } else {
    var mod = {
      exports: {}
    };
    factory(mod.exports, global.index);
    global.tiled = mod.exports;
  }
})(typeof globalThis !== "undefined" ? globalThis : typeof self !== "undefined" ? self : this, function (_exports, _index) {
  "use strict";

  Object.defineProperty(_exports, "__esModule", {
    value: true
  });
  _exports.tilled = void 0;

  /*
   Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.
  
   http://www.cocos.com
  
   Permission is hereby granted, free of charge, to any person obtaining a copy
   of this software and associated engine source code (the "Software"), a limited,
   worldwide, royalty-free, non-assignable, revocable and non-exclusive license
   to use Cocos Creator solely to develop games on your target platforms. You shall
   not use Cocos Creator software for developing other software or tools that's
   used for developing games. You are not granted to publish, distribute,
   sublicense, and/or sell copies of Cocos Creator.
  
   The software or tools in this License Agreement are licensed, not sold.
   Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.
  
   THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
   IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
   FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
   AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
   LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
   OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
   THE SOFTWARE.
  */

  /**
   * @hidden
   */
  var vec3_temps = [];

  for (var i = 0; i < 4; i++) {
    vec3_temps.push(new _index.Vec3());
  }

  var _perVertextLength = 9;
  var tilled = {
    useModel: false,
    createData: function createData(sprite) {
      return sprite.requestRenderData();
    },
    updateRenderData: function updateRenderData(sprite) {
      var renderData = sprite.renderData;
      var frame = sprite.spriteFrame;

      if (!frame || !renderData || !(renderData.uvDirty || renderData.vertDirty)) {
        return;
      }

      var node = sprite.node;
      var contentWidth = Math.abs(node.width);
      var contentHeight = Math.abs(node.height);
      var appx = node.anchorX * contentWidth;
      var appy = node.anchorY * contentHeight;
      var rect = frame.getRect();
      var rectWidth = rect.width;
      var rectHeight = rect.height;
      var hRepeat = contentWidth / rectWidth;
      var vRepeat = contentHeight / rectHeight;
      var row = Math.ceil(vRepeat);
      var col = Math.ceil(hRepeat);
      var datas = renderData.datas;
      renderData.dataLength = Math.max(8, row + 1, col + 1);

      for (var _i = 0; _i <= col; ++_i) {
        datas[_i].x = Math.min(rectWidth * _i, contentWidth) - appx;
      }

      for (var _i2 = 0; _i2 <= row; ++_i2) {
        datas[_i2].y = Math.min(rectHeight * _i2, contentHeight) - appy;
      } // update data property


      renderData.vertexCount = row * col * 4;
      renderData.indiceCount = row * col * 6;
      renderData.uvDirty = false;
      renderData.vertDirty = false;
    },
    fillBuffers: function fillBuffers(sprite, renderer) {
      var node = sprite.node;
      var renderData = sprite.renderData; // buffer

      var buffer = renderer.currBufferBatch; // buffer data may be realloc, need get reference after request.

      var indiceOffset = buffer.indiceOffset;
      var vertexOffset = buffer.byteOffset >> 2;
      var vertexId = buffer.vertexOffset;
      var vertexCount = renderData.vertexCount;
      var indiceCount = renderData.indiceCount;
      var vbuf = buffer.vData;
      var ibuf = buffer.iData;
      var isRecreate = buffer.request(vertexCount, indiceCount);

      if (!isRecreate) {
        buffer = renderer.currBufferBatch;
        vertexOffset = 0;
        indiceOffset = 0;
        vertexId = 0;
      }

      var frame = sprite.spriteFrame;
      var rotated = frame.isRotated();
      var uv = frame.uv;
      var rect = frame.getRect();
      var contentWidth = Math.abs(node.width);
      var contentHeight = Math.abs(node.height);
      var hRepeat = contentWidth / rect.width;
      var vRepeat = contentHeight / rect.height;
      var row = Math.ceil(vRepeat);
      var col = Math.ceil(hRepeat);
      var matrix = node.worldMatrix;
      this.fillVertices(vbuf, vertexOffset, matrix, row, col, renderData.datas);
      var offset = _perVertextLength;
      var offset1 = offset;
      var offset2 = offset * 2;
      var offset3 = offset * 3;
      var offset4 = offset * 4;
      var coefu = 0;
      var coefv = 0;

      for (var yindex = 0, ylength = row; yindex < ylength; ++yindex) {
        coefv = Math.min(1, vRepeat - yindex);

        for (var xindex = 0, xlength = col; xindex < xlength; ++xindex) {
          coefu = Math.min(1, hRepeat - xindex);
          var vertexOffsetU = vertexOffset + 3;
          var vertexOffsetV = vertexOffsetU + 1; // UV

          if (rotated) {
            // lb
            vbuf[vertexOffsetU] = uv[0];
            vbuf[vertexOffsetV] = uv[1]; // rb

            vbuf[vertexOffsetU + offset1] = uv[0];
            vbuf[vertexOffsetV + offset1] = uv[1] + (uv[7] - uv[1]) * coefu; // lt

            vbuf[vertexOffsetU + offset2] = uv[0] + (uv[6] - uv[0]) * coefv;
            vbuf[vertexOffsetV + offset2] = uv[1]; // rt

            vbuf[vertexOffsetU + offset3] = vbuf[vertexOffsetU + offset2];
            vbuf[vertexOffsetV + offset3] = vbuf[vertexOffsetV + offset1];
          } else {
            // lb
            vbuf[vertexOffsetU] = uv[0];
            vbuf[vertexOffsetV] = uv[1]; // rb

            vbuf[vertexOffsetU + offset1] = uv[0] + (uv[6] - uv[0]) * coefu;
            vbuf[vertexOffsetV + offset1] = uv[1]; // lt

            vbuf[vertexOffsetU + offset2] = uv[0];
            vbuf[vertexOffsetV + offset2] = uv[1] + (uv[7] - uv[1]) * coefv; // rt

            vbuf[vertexOffsetU + offset3] = vbuf[vertexOffsetU + offset1];
            vbuf[vertexOffsetV + offset3] = vbuf[vertexOffsetV + offset2];
          } // color


          _index.Color.toArray(vbuf, sprite.color, vertexOffsetV + 1);

          _index.Color.toArray(vbuf, sprite.color, vertexOffsetV + offset1 + 1);

          _index.Color.toArray(vbuf, sprite.color, vertexOffsetV + offset2 + 1);

          _index.Color.toArray(vbuf, sprite.color, vertexOffsetV + offset3 + 1);

          vertexOffset += offset4;
        }
      } // update indices


      for (var _i3 = 0; _i3 < indiceCount; _i3 += 6) {
        ibuf[indiceOffset++] = vertexId;
        ibuf[indiceOffset++] = vertexId + 1;
        ibuf[indiceOffset++] = vertexId + 2;
        ibuf[indiceOffset++] = vertexId + 1;
        ibuf[indiceOffset++] = vertexId + 3;
        ibuf[indiceOffset++] = vertexId + 2;
        vertexId += 4;
      }
    },
    fillVertices: function fillVertices(vbuf, vertexOffset, matrix, row, col, datas) {
      var x = 0;
      var x1 = 0;
      var y = 0;
      var y1 = 0;

      for (var yindex = 0, ylength = row; yindex < ylength; ++yindex) {
        y = datas[yindex].y;
        y1 = datas[yindex + 1].y;

        for (var xindex = 0, xlength = col; xindex < xlength; ++xindex) {
          x = datas[xindex].x;
          x1 = datas[xindex + 1].x;

          _index.Vec3.set(vec3_temps[0], x, y, 0);

          _index.Vec3.set(vec3_temps[1], x1, y, 0);

          _index.Vec3.set(vec3_temps[2], x, y1, 0);

          _index.Vec3.set(vec3_temps[3], x1, y1, 0);

          for (var _i4 = 0; _i4 < 4; _i4++) {
            var vec3_temp = vec3_temps[_i4];

            _index.Vec3.transformMat4(vec3_temp, vec3_temp, matrix);

            var offset = _i4 * _perVertextLength;
            vbuf[vertexOffset + offset] = vec3_temp.x;
            vbuf[vertexOffset + offset + 1] = vec3_temp.y;
            vbuf[vertexOffset + offset + 2] = vec3_temp.z;
          }

          vertexOffset += 36;
        }
      }
    }
  };
  _exports.tilled = tilled;
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkY6L2plbmtpbnMvd29ya3NwYWNlL0NyZWF0b3JfM0QvZWRpdG9yLTNkL3Jlc291cmNlcy8zZC9lbmdpbmUvY29jb3MvdWkvYXNzZW1ibGVyL3Nwcml0ZS90aWxlZC50cyJdLCJuYW1lcyI6WyJ2ZWMzX3RlbXBzIiwiaSIsInB1c2giLCJWZWMzIiwiX3BlclZlcnRleHRMZW5ndGgiLCJ0aWxsZWQiLCJ1c2VNb2RlbCIsImNyZWF0ZURhdGEiLCJzcHJpdGUiLCJyZXF1ZXN0UmVuZGVyRGF0YSIsInVwZGF0ZVJlbmRlckRhdGEiLCJyZW5kZXJEYXRhIiwiZnJhbWUiLCJzcHJpdGVGcmFtZSIsInV2RGlydHkiLCJ2ZXJ0RGlydHkiLCJub2RlIiwiY29udGVudFdpZHRoIiwiTWF0aCIsImFicyIsIndpZHRoIiwiY29udGVudEhlaWdodCIsImhlaWdodCIsImFwcHgiLCJhbmNob3JYIiwiYXBweSIsImFuY2hvclkiLCJyZWN0IiwiZ2V0UmVjdCIsInJlY3RXaWR0aCIsInJlY3RIZWlnaHQiLCJoUmVwZWF0IiwidlJlcGVhdCIsInJvdyIsImNlaWwiLCJjb2wiLCJkYXRhcyIsImRhdGFMZW5ndGgiLCJtYXgiLCJ4IiwibWluIiwieSIsInZlcnRleENvdW50IiwiaW5kaWNlQ291bnQiLCJmaWxsQnVmZmVycyIsInJlbmRlcmVyIiwiYnVmZmVyIiwiY3VyckJ1ZmZlckJhdGNoIiwiaW5kaWNlT2Zmc2V0IiwidmVydGV4T2Zmc2V0IiwiYnl0ZU9mZnNldCIsInZlcnRleElkIiwidmJ1ZiIsInZEYXRhIiwiaWJ1ZiIsImlEYXRhIiwiaXNSZWNyZWF0ZSIsInJlcXVlc3QiLCJyb3RhdGVkIiwiaXNSb3RhdGVkIiwidXYiLCJtYXRyaXgiLCJ3b3JsZE1hdHJpeCIsImZpbGxWZXJ0aWNlcyIsIm9mZnNldCIsIm9mZnNldDEiLCJvZmZzZXQyIiwib2Zmc2V0MyIsIm9mZnNldDQiLCJjb2VmdSIsImNvZWZ2IiwieWluZGV4IiwieWxlbmd0aCIsInhpbmRleCIsInhsZW5ndGgiLCJ2ZXJ0ZXhPZmZzZXRVIiwidmVydGV4T2Zmc2V0ViIsIkNvbG9yIiwidG9BcnJheSIsImNvbG9yIiwieDEiLCJ5MSIsInNldCIsInZlYzNfdGVtcCIsInRyYW5zZm9ybU1hdDQiLCJ6Il0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBeUJBOzs7QUFXQSxNQUFNQSxVQUFrQixHQUFHLEVBQTNCOztBQUNBLE9BQUssSUFBSUMsQ0FBQyxHQUFHLENBQWIsRUFBZ0JBLENBQUMsR0FBRyxDQUFwQixFQUF1QkEsQ0FBQyxFQUF4QixFQUE0QjtBQUN4QkQsSUFBQUEsVUFBVSxDQUFDRSxJQUFYLENBQWdCLElBQUlDLFdBQUosRUFBaEI7QUFDSDs7QUFFRCxNQUFNQyxpQkFBaUIsR0FBRyxDQUExQjtBQUVPLE1BQU1DLE1BQWtCLEdBQUc7QUFDOUJDLElBQUFBLFFBQVEsRUFBRSxLQURvQjtBQUc5QkMsSUFBQUEsVUFIOEIsc0JBR2xCQyxNQUhrQixFQUdTO0FBQ25DLGFBQU9BLE1BQU0sQ0FBQ0MsaUJBQVAsRUFBUDtBQUNILEtBTDZCO0FBTzlCQyxJQUFBQSxnQkFQOEIsNEJBT1pGLE1BUFksRUFPYTtBQUN2QyxVQUFNRyxVQUFVLEdBQUdILE1BQU0sQ0FBQ0csVUFBMUI7QUFDQSxVQUFNQyxLQUFLLEdBQUdKLE1BQU0sQ0FBQ0ssV0FBckI7O0FBQ0EsVUFBSSxDQUFDRCxLQUFELElBQVUsQ0FBQ0QsVUFBWCxJQUF5QixFQUFFQSxVQUFVLENBQUNHLE9BQVgsSUFBc0JILFVBQVUsQ0FBQ0ksU0FBbkMsQ0FBN0IsRUFBMkU7QUFDdkU7QUFDSDs7QUFFRCxVQUFNQyxJQUFJLEdBQUdSLE1BQU0sQ0FBQ1EsSUFBcEI7QUFDQSxVQUFNQyxZQUFZLEdBQUdDLElBQUksQ0FBQ0MsR0FBTCxDQUFTSCxJQUFJLENBQUNJLEtBQWQsQ0FBckI7QUFDQSxVQUFNQyxhQUFhLEdBQUdILElBQUksQ0FBQ0MsR0FBTCxDQUFTSCxJQUFJLENBQUNNLE1BQWQs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QUNILFlBQVksR0FBR2UsTUFBZixHQUF3QixDQUF6QixDQUFKLEdBQWtDbUIsU0FBUyxDQUFDMUMsQ0FBNUM7QUFDQVcsWUFBQUEsSUFBSSxDQUFDSCxZQUFZLEdBQUdlLE1BQWYsR0FBd0IsQ0FBekIsQ0FBSixHQUFrQ21CLFNBQVMsQ0FBQ0UsQ0FBNUM7QUFDSDs7QUFFRHBDLFVBQUFBLFlBQVksSUFBSSxFQUFoQjtBQUNIO0FBQ0o7QUFDSjtBQXpLNkIsR0FBM0IiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxyXG4gQ29weXJpZ2h0IChjKSAyMDE3LTIwMTggWGlhbWVuIFlhamkgU29mdHdhcmUgQ28uLCBMdGQuXHJcblxyXG4gaHR0cDovL3d3dy5jb2Nvcy5jb21cclxuXHJcbiBQZXJtaXNzaW9uIGlzIGhlcmVieSBncmFudGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbiBvYnRhaW5pbmcgYSBjb3B5XHJcbiBvZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGVuZ2luZSBzb3VyY2UgY29kZSAodGhlIFwiU29mdHdhcmVcIiksIGEgbGltaXRlZCxcclxuIHdvcmxkd2lkZSwgcm95YWx0eS1mcmVlLCBub24tYXNzaWduYWJsZSwgcmV2b2NhYmxlIGFuZCBub24tZXhjbHVzaXZlIGxpY2Vuc2VcclxuIHRvIHVzZSBDb2NvcyBDcmVhdG9yIHNvbGVseSB0byBkZXZlbG9wIGdhbWVzIG9uIHlvdXIgdGFyZ2V0IHBsYXRmb3Jtcy4gWW91IHNoYWxsXHJcbiBub3QgdXNlIENvY29zIENyZWF0b3Igc29mdHdhcmUgZm9yIGRldmVsb3Bpbmcgb3RoZXIgc29mdHdhcmUgb3IgdG9vbHMgdGhhdCdzXHJcbiB1c2VkIGZvciBkZXZlbG9waW5nIGdhbWVzLiBZb3UgYXJlIG5vdCBncmFudGVkIHRvIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsXHJcbiBzdWJsaWNlbnNlLCBhbmQvb3Igc2VsbCBjb3BpZXMgb2YgQ29jb3MgQ3JlYXRvci5cclxuXHJcbiBUaGUgc29mdHdhcmUgb3IgdG9vbHMgaW4gdGhpcyBMaWNlbnNlIEFncmVlbWVudCBhcmUgbGljZW5zZWQsIG5vdCBzb2xkLlxyXG4gWGlhbWVuIFlhamkgU29mdHdhcmUgQ28uLCBMdGQuIHJlc2VydmVzIGFsbCByaWdodHMgbm90IGV4cHJlc3NseSBncmFudGVkIHRvIHlvdS5cclxuXHJcbiBUSEUgU09GVFdBUkUgSVMgUFJPVklERUQgXCJBUyBJU1wiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SXHJcbiBJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSxcclxuIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRVxyXG4gQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUlxyXG4gTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSxcclxuIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU5cclxuIFRIRSBTT0ZUV0FSRS5cclxuKi9cclxuXHJcbi8qKlxyXG4gKiBAaGlkZGVuXHJcbiAqL1xyXG5cclxuaW1wb3J0IHsgTWF0NCwgVmVjMywgQ29sb3IgfSBmcm9tICcuLi8uLi8uLi9jb3JlL21hdGgnO1xyXG5pbXBvcnQgeyBSZW5kZXJEYXRhLCBJUmVuZGVyRGF0YSB9IGZyb20gJy4uLy4uLy4uL2NvcmUvcmVuZGVyZXIvdWkvcmVuZGVyLWRhdGEnO1xyXG5pbXBvcnQgeyBVSSB9IGZyb20gJy4uLy4uLy4uL2NvcmUvcmVuZGVyZXIvdWkvdWknO1xyXG5pbXBvcnQgeyBTcHJpdGVDb21wb25lbnQgfSBmcm9tICcuLi8uLi9jb21wb25lbnRzL3Nwcml0ZS1jb21wb25lbnQnO1xyXG5pbXBvcnQgeyBVSVJlbmRlckNvbXBvbmVudCB9IGZyb20gJy4uLy4uLy4uL2NvcmUvY29tcG9uZW50cy91aS1iYXNlL3VpLXJlbmRlci1jb21wb25lbnQnO1xyXG5pbXBvcnQgeyBJQXNzZW1ibGVyIH0gZnJvbSAnLi4vLi4vLi4vY29yZS9yZW5kZXJlci91aS9iYXNlJztcclxuXHJcbmNvbnN0IHZlYzNfdGVtcHM6IFZlYzNbXSA9IFtdO1xyXG5mb3IgKGxldCBpID0gMDsgaSA8IDQ7IGkrKykge1xyXG4gICAgdmVjM190ZW1wcy5wdXNoKG5ldyBWZWMzKCkpO1xyXG59XHJcblxyXG5jb25zdCBfcGVyVmVydGV4dExlbmd0aCA9IDk7XHJcblxyXG5leHBvcnQgY29uc3QgdGlsbGVkOiBJQXNzZW1ibGVyID0ge1xyXG4gICAgdXNlTW9kZWw6IGZhbHNlLFxyXG5cclxuICAgIGNyZWF0ZURhdGEgKHNwcml0ZTogVUlSZW5kZXJDb21wb25lbnQpIHtcclxuICAgICAgICByZXR1cm4gc3ByaXRlLnJlcXVlc3RSZW5kZXJEYXRhKCkgYXMgUmVuZGVyRGF0YTtcclxuICAgIH0sXHJcblxyXG4gICAgdXBkYXRlUmVuZGVyRGF0YSAoc3ByaXRlOiBTcHJpdGVDb21wb25lbnQpIHtcclxuICAgICAgICBjb25zdCByZW5kZXJEYXRhID0gc3ByaXRlLnJlbmRlckRhdGEhO1xyXG4gICAgICAgIGNvbnN0IGZyYW1lID0gc3ByaXRlLnNwcml0ZUZyYW1lITtcclxuICAgICAgICBpZiAoIWZyYW1lIHx8ICFyZW5kZXJEYXRhIHx8ICEocmVuZGVyRGF0YS51dkRpcnR5IHx8IHJlbmRlckRhdGEudmVydERpcnR5KSl7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IG5vZGUgPSBzcHJpdGUubm9kZTtcclxuICAgICAgICBjb25zdCBjb250ZW50V2lkdGggPSBNYXRoLmFicyhub2RlLndpZHRoKTtcclxuICAgICAgICBjb25zdCBjb250ZW50SGVpZ2h0ID0gTWF0aC5hYnMobm9kZS5oZWlnaHQpO1xyXG4gICAgICAgIGNvbnN0IGFwcHggPSBub2RlLmFuY2hvclggKiBjb250ZW50V2lkdGg7XHJcbiAgICAgICAgY29uc3QgYXBweSA9IG5vZGUuYW5jaG9yWSAqIGNvbnRlbnRIZWlnaHQ7XHJcblxyXG4gICAgICAgIGNvbnN0IHJlY3QgPSBmcmFtZS5nZXRSZWN0KCk7XHJcbiAgICAgICAgY29uc3QgcmVjdFdpZHRoID0gcmVjdC53aWR0aDtcclxuICAgICAgICBjb25zdCByZWN0SGVpZ2h0ID0gcmVjdC5oZWlnaHQ7XHJcbiAgICAgICAgY29uc3QgaFJlcGVhdCA9IGNvbnRlbnRXaWR0aCAvIHJlY3RXaWR0aDtcclxuICAgICAgICBjb25zdCB2UmVwZWF0ID0gY29udGVudEhlaWdodCAvIHJlY3RIZWlnaHQ7XHJcbiAgICAgICAgY29uc3Qgcm93ID0gTWF0aC5jZWlsKHZSZXBlYXQpO1xyXG4gICAgICAgIGNvbnN0IGNvbCA9IE1hdGguY2VpbChoUmVwZWF0KTtcclxuXHJcbiAgICAgICAgY29uc3QgZGF0YXMgPSByZW5kZXJEYXRhLmRhdGFzO1xyXG4gICAgICAgIHJlbmRlckRhdGEuZGF0YUxlbmd0aCA9IE1hdGgubWF4KDgsIHJvdyArIDEsIGNvbCArIDEpO1xyXG5cclxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8PSBjb2w7ICsraSkge1xyXG4gICAgICAgICAgICBkYXRhc1tpXS54ID0gTWF0aC5taW4ocmVjdFdpZHRoICogaSwgY29udGVudFdpZHRoKSAtIGFwcHg7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDw9IHJvdzsgKytpKSB7XHJcbiAgICAgICAgICAgIGRhdGFzW2ldLnkgPSBNYXRoLm1pbihyZWN0SGVpZ2h0ICogaSwgY29udGVudEhlaWdodCkgLSBhcHB5O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gdXBkYXRlIGRhdGEgcHJvcGVydHlcclxuICAgICAgICByZW5kZXJEYXRhLnZlcnRleENvdW50ID0gcm93ICogY29sICogNDtcclxuICAgICAgICByZW5kZXJEYXRhLmluZGljZUNvdW50ID0gcm93ICogY29sICogNjtcclxuICAgICAgICByZW5kZXJEYXRhLnV2RGlydHkgPSBmYWxzZTtcclxuICAgICAgICByZW5kZXJEYXRhLnZlcnREaXJ0eSA9IGZhbHNlO1xyXG4gICAgfSxcclxuXHJcbiAgICBmaWxsQnVmZmVycyAoc3ByaXRlOiBTcHJpdGVDb21wb25lbnQsIHJlbmRlcmVyOiBVSSkge1xyXG4gICAgICAgIGNvbnN0IG5vZGUgPSBzcHJpdGUubm9kZTtcclxuICAgICAgICBjb25zdCByZW5kZXJEYXRhID0gc3ByaXRlLnJlbmRlckRhdGEhO1xyXG5cclxuICAgICAgICAvLyBidWZmZXJcclxuICAgICAgICBsZXQgYnVmZmVyID0gcmVuZGVyZXIuY3VyckJ1ZmZlckJhdGNoITtcclxuICAgICAgICAvLyBidWZmZXIgZGF0YSBtYXkgYmUgcmVhbGxvYywgbmVlZCBnZXQgcmVmZXJlbmNlIGFmdGVyIHJlcXVlc3QuXHJcbiAgICAgICAgbGV0IGluZGljZU9mZnNldCA9IGJ1ZmZlci5pbmRpY2VPZmZzZXQ7XHJcbiAgICAgICAgbGV0IHZlcnRleE9mZnNldCA9IGJ1ZmZlci5ieXRlT2Zmc2V0ID4+IDI7XHJcbiAgICAgICAgbGV0IHZlcnRleElkID0gYnVmZmVyLnZlcnRleE9mZnNldDtcclxuICAgICAgICBjb25zdCB2ZXJ0ZXhDb3VudCA9IHJlbmRlckRhdGEhLnZlcnRleENvdW50O1xyXG4gICAgICAgIGNvbnN0IGluZGljZUNvdW50ID0gcmVuZGVyRGF0YS5pbmRpY2VDb3VudDtcclxuICAgICAgICBjb25zdCB2YnVmID0gYnVmZmVyLnZEYXRhITtcclxuICAgICAgICBjb25zdCBpYnVmID0gYnVmZmVyLmlEYXRhITtcclxuXHJcbiAgICAgICAgY29uc3QgaXNSZWNyZWF0ZSA9IGJ1ZmZlci5yZXF1ZXN0KHZlcnRleENvdW50LCBpbmRpY2VDb3VudCk7XHJcbiAgICAgICAgaWYgKCFpc1JlY3JlYXRlKSB7XHJcbiAgICAgICAgICAgIGJ1ZmZlciA9IHJlbmRlcmVyLmN1cnJCdWZmZXJCYXRjaCE7XHJcbiAgICAgICAgICAgIHZlcnRleE9mZnNldCA9IDA7XHJcbiAgICAgICAgICAgIGluZGljZU9mZnNldCA9IDA7XHJcbiAgICAgICAgICAgIHZlcnRleElkID0gMDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IGZyYW1lID0gc3ByaXRlLnNwcml0ZUZyYW1lITtcclxuICAgICAgICBjb25zdCByb3RhdGVkID0gZnJhbWUuaXNSb3RhdGVkKCk7XHJcbiAgICAgICAgY29uc3QgdXYgPSBmcmFtZS51djtcclxuICAgICAgICBjb25zdCByZWN0ID0gZnJhbWUuZ2V0UmVjdCgpO1xyXG4gICAgICAgIGNvbnN0IGNvbnRlbnRXaWR0aCA9IE1hdGguYWJzKG5vZGUud2lkdGgpO1xyXG4gICAgICAgIGNvbnN0IGNvbnRlbnRIZWlnaHQgPSBNYXRoLmFicyhub2RlLmhlaWdodCk7XHJcbiAgICAgICAgY29uc3QgaFJlcGVhdCA9IGNvbnRlbnRXaWR0aCAvIHJlY3Qud2lkdGg7XHJcbiAgICAgICAgY29uc3QgdlJlcGVhdCA9IGNvbnRlbnRIZWlnaHQgLyByZWN0LmhlaWdodDtcclxuICAgICAgICBjb25zdCByb3cgPSBNYXRoLmNlaWwodlJlcGVhdCk7XHJcbiAgICAgICAgY29uc3QgY29sID0gTWF0aC5jZWlsKGhSZXBlYXQpO1xyXG5cclxuICAgICAgICBjb25zdCBtYXRyaXggPSBub2RlLndvcmxkTWF0cml4O1xyXG5cclxuICAgICAgICB0aGlzLmZpbGxWZXJ0aWNlcyh2YnVmLCB2ZXJ0ZXhPZmZzZXQsIG1hdHJpeCwgcm93LCBjb2wsIHJlbmRlckRhdGEuZGF0YXMpO1xyXG5cclxuICAgICAgICBjb25zdCBvZmZzZXQgPSBfcGVyVmVydGV4dExlbmd0aDtcclxuICAgICAgICBjb25zdCBvZmZzZXQxID0gb2Zmc2V0OyBjb25zdCBvZmZzZXQyID0gb2Zmc2V0ICogMjsgY29uc3Qgb2Zmc2V0MyA9IG9mZnNldCAqIDM7IGNvbnN0IG9mZnNldDQgPSBvZmZzZXQgKiA0O1xyXG4gICAgICAgIGxldCBjb2VmdSA9IDA7IGxldCBjb2VmdiA9IDA7XHJcbiAgICAgICAgZm9yIChsZXQgeWluZGV4ID0gMCwgeWxlbmd0aCA9IHJvdzsgeWluZGV4IDwgeWxlbmd0aDsgKyt5aW5kZXgpIHtcclxuICAgICAgICAgICAgY29lZnYgPSBNYXRoLm1pbigxLCB2UmVwZWF0IC0geWluZGV4KTtcclxuICAgICAgICAgICAgZm9yIChsZXQgeGluZGV4ID0gMCwgeGxlbmd0aCA9IGNvbDsgeGluZGV4IDwgeGxlbmd0aDsgKyt4aW5kZXgpIHtcclxuICAgICAgICAgICAgICAgIGNvZWZ1ID0gTWF0aC5taW4oMSwgaFJlcGVhdCAtIHhpbmRleCk7XHJcblxyXG4gICAgICAgICAgICAgICAgY29uc3QgdmVydGV4T2Zmc2V0VSA9IHZlcnRleE9mZnNldCArIDM7XHJcbiAgICAgICAgICAgICAgICBjb25zdCB2ZXJ0ZXhPZmZzZXRWID0gdmVydGV4T2Zmc2V0VSArIDE7XHJcbiAgICAgICAgICAgICAgICAvLyBVVlxyXG4gICAgICAgICAgICAgICAgaWYgKHJvdGF0ZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBsYlxyXG4gICAgICAgICAgICAgICAgICAgIHZidWZbdmVydGV4T2Zmc2V0VV0gPSB1dlswXTtcclxuICAgICAgICAgICAgICAgICAgICB2YnVmW3ZlcnRleE9mZnNldFZdID0gdXZbMV07XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gcmJcclxuICAgICAgICAgICAgICAgICAgICB2YnVmW3ZlcnRleE9mZnNldFUgKyBvZmZzZXQxXSA9IHV2WzBdO1xyXG4gICAgICAgICAgICAgICAgICAgIHZidWZbdmVydGV4T2Zmc2V0ViArIG9mZnNldDFdID0gdXZbMV0gKyAodXZbN10gLSB1dlsxXSkgKiBjb2VmdTtcclxuICAgICAgICAgICAgICAgICAgICAvLyBsdFxyXG4gICAgICAgICAgICAgICAgICAgIHZidWZbdmVydGV4T2Zmc2V0VSArIG9mZnNldDJdID0gdXZbMF0gKyAodXZbNl0gLSB1dlswXSkgKiBjb2VmdjtcclxuICAgICAgICAgICAgICAgICAgICB2YnVmW3ZlcnRleE9mZnNldFYgKyBvZmZzZXQyXSA9IHV2WzFdO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIHJ0XHJcbiAgICAgICAgICAgICAgICAgICAgdmJ1Zlt2ZXJ0ZXhPZmZzZXRVICsgb2Zmc2V0M10gPSB2YnVmW3ZlcnRleE9mZnNldFUgKyBvZmZzZXQyXTtcclxuICAgICAgICAgICAgICAgICAgICB2YnVmW3ZlcnRleE9mZnNldFYgKyBvZmZzZXQzXSA9IHZidWZbdmVydGV4T2Zmc2V0ViArIG9mZnNldDFdO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gbGJcclxuICAgICAgICAgICAgICAgICAgICB2YnVmW3ZlcnRleE9mZnNldFVdID0gdXZbMF07XHJcbiAgICAgICAgICAgICAgICAgICAgdmJ1Zlt2ZXJ0ZXhPZmZzZXRWXSA9IHV2WzFdO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIHJiXHJcbiAgICAgICAgICAgICAgICAgICAgdmJ1Zlt2ZXJ0ZXhPZmZzZXRVICsgb2Zmc2V0MV0gPSB1dlswXSArICh1dls2XSAtIHV2WzBdKSAqIGNvZWZ1O1xyXG4gICAgICAgICAgICAgICAgICAgIHZidWZbdmVydGV4T2Zmc2V0ViArIG9mZnNldDFdID0gdXZbMV07XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gbHRcclxuICAgICAgICAgICAgICAgICAgICB2YnVmW3ZlcnRleE9mZnNldFUgKyBvZmZzZXQyXSA9IHV2WzBdO1xyXG4gICAgICAgICAgICAgICAgICAgIHZidWZbdmVydGV4T2Zmc2V0ViArIG9mZnNldDJdID0gdXZbMV0gKyAodXZbN10gLSB1dlsxXSkgKiBjb2VmdjtcclxuICAgICAgICAgICAgICAgICAgICAvLyBydFxyXG4gICAgICAgICAgICAgICAgICAgIHZidWZbdmVydGV4T2Zmc2V0VSArIG9mZnNldDNdID0gdmJ1Zlt2ZXJ0ZXhPZmZzZXRVICsgb2Zmc2V0MV07XHJcbiAgICAgICAgICAgICAgICAgICAgdmJ1Zlt2ZXJ0ZXhPZmZzZXRWICsgb2Zmc2V0M10gPSB2YnVmW3ZlcnRleE9mZnNldFYgKyBvZmZzZXQyXTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIC8vIGNvbG9yXHJcbiAgICAgICAgICAgICAgICBDb2xvci50b0FycmF5KHZidWYhLCBzcHJpdGUuY29sb3IsIHZlcnRleE9mZnNldFYgKyAxKTtcclxuICAgICAgICAgICAgICAgIENvbG9yLnRvQXJyYXkodmJ1ZiEsIHNwcml0ZS5jb2xvciwgdmVydGV4T2Zmc2V0ViArIG9mZnNldDEgKyAxKTtcclxuICAgICAgICAgICAgICAgIENvbG9yLnRvQXJyYXkodmJ1ZiEsIHNwcml0ZS5jb2xvciwgdmVydGV4T2Zmc2V0ViArIG9mZnNldDIgKyAxKTtcclxuICAgICAgICAgICAgICAgIENvbG9yLnRvQXJyYXkodmJ1ZiEsIHNwcml0ZS5jb2xvciwgdmVydGV4T2Zmc2V0ViArIG9mZnNldDMgKyAxKTtcclxuICAgICAgICAgICAgICAgIHZlcnRleE9mZnNldCArPSBvZmZzZXQ0O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyB1cGRhdGUgaW5kaWNlc1xyXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgaW5kaWNlQ291bnQ7IGkgKz0gNikge1xyXG4gICAgICAgICAgICBpYnVmW2luZGljZU9mZnNldCsrXSA9IHZlcnRleElkO1xyXG4gICAgICAgICAgICBpYnVmW2luZGljZU9mZnNldCsrXSA9IHZlcnRleElkICsgMTtcclxuICAgICAgICAgICAgaWJ1ZltpbmRpY2VPZmZzZXQrK10gPSB2ZXJ0ZXhJZCArIDI7XHJcbiAgICAgICAgICAgIGlidWZbaW5kaWNlT2Zmc2V0KytdID0gdmVydGV4SWQgKyAxO1xyXG4gICAgICAgICAgICBpYnVmW2luZGljZU9mZnNldCsrXSA9IHZlcnRleElkICsgMztcclxuICAgICAgICAgICAgaWJ1ZltpbmRpY2VPZmZzZXQrK10gPSB2ZXJ0ZXhJZCArIDI7XHJcbiAgICAgICAgICAgIHZlcnRleElkICs9IDQ7XHJcbiAgICAgICAgfVxyXG4gICAgfSxcclxuXHJcbiAgICBmaWxsVmVydGljZXMgKHZidWY6IEZsb2F0MzJBcnJheSwgdmVydGV4T2Zmc2V0OiBudW1iZXIsIG1hdHJpeDogTWF0NCwgcm93OiBudW1iZXIsIGNvbDogbnVtYmVyLCBkYXRhczogSVJlbmRlckRhdGFbXSkge1xyXG4gICAgICAgIGxldCB4ID0gMDsgbGV0IHgxID0gMDsgbGV0IHkgPSAwOyBsZXQgeTEgPSAwO1xyXG4gICAgICAgIGZvciAobGV0IHlpbmRleCA9IDAsIHlsZW5ndGggPSByb3c7IHlpbmRleCA8IHlsZW5ndGg7ICsreWluZGV4KSB7XHJcbiAgICAgICAgICAgIHkgPSBkYXRhc1t5aW5kZXhdLnk7XHJcbiAgICAgICAgICAgIHkxID0gZGF0YXNbeWluZGV4ICsgMV0ueTtcclxuICAgICAgICAgICAgZm9yIChsZXQgeGluZGV4ID0gMCwgeGxlbmd0aCA9IGNvbDsgeGluZGV4IDwgeGxlbmd0aDsgKyt4aW5kZXgpIHtcclxuICAgICAgICAgICAgICAgIHggPSBkYXRhc1t4aW5kZXhdLng7XHJcbiAgICAgICAgICAgICAgICB4MSA9IGRhdGFzW3hpbmRleCArIDFdLng7XHJcblxyXG4gICAgICAgICAgICAgICAgVmVjMy5zZXQodmVjM190ZW1wc1swXSwgeCwgeSwgMCk7XHJcbiAgICAgICAgICAgICAgICBWZWMzLnNldCh2ZWMzX3RlbXBzWzFdLCB4MSwgeSwgMCk7XHJcbiAgICAgICAgICAgICAgICBWZWMzLnNldCh2ZWMzX3RlbXBzWzJdLCB4LCB5MSwgMCk7XHJcbiAgICAgICAgICAgICAgICBWZWMzLnNldCh2ZWMzX3RlbXBzWzNdLCB4MSwgeTEsIDApO1xyXG5cclxuICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgNDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgdmVjM190ZW1wID0gdmVjM190ZW1wc1tpXTtcclxuICAgICAgICAgICAgICAgICAgICBWZWMzLnRyYW5zZm9ybU1hdDQodmVjM190ZW1wLCB2ZWMzX3RlbXAsIG1hdHJpeCk7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgb2Zmc2V0ID0gaSAqIF9wZXJWZXJ0ZXh0TGVuZ3RoO1xyXG4gICAgICAgICAgICAgICAgICAgIHZidWZbdmVydGV4T2Zmc2V0ICsgb2Zmc2V0XSA9IHZlYzNfdGVtcC54O1xyXG4gICAgICAgICAgICAgICAgICAgIHZidWZbdmVydGV4T2Zmc2V0ICsgb2Zmc2V0ICsgMV0gPSB2ZWMzX3RlbXAueTtcclxuICAgICAgICAgICAgICAgICAgICB2YnVmW3ZlcnRleE9mZnNldCArIG9mZnNldCArIDJdID0gdmVjM190ZW1wLno7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgdmVydGV4T2Zmc2V0ICs9IDM2O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfSxcclxufTtcclxuIl19