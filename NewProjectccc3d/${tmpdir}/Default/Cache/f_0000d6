(function (global, factory) {
  if (typeof define === "function" && define.amd) {
    define(["exports", "../../core/components/ui-base/ui-render-component.js", "../../core/data/class-decorator.js", "../../core/math/index.js", "../../core/platform/index.js", "../../core/platform/visible-rect.js", "../../core/scene-graph/index.js", "../../core/value-types/enum.js", "./graphics-component.js", "../../core/index.js"], factory);
  } else if (typeof exports !== "undefined") {
    factory(exports, require("../../core/components/ui-base/ui-render-component.js"), require("../../core/data/class-decorator.js"), require("../../core/math/index.js"), require("../../core/platform/index.js"), require("../../core/platform/visible-rect.js"), require("../../core/scene-graph/index.js"), require("../../core/value-types/enum.js"), require("./graphics-component.js"), require("../../core/index.js"));
  } else {
    var mod = {
      exports: {}
    };
    factory(mod.exports, global.uiRenderComponent, global.classDecorator, global.index, global.index, global.visibleRect, global.index, global._enum, global.graphicsComponent, global.index);
    global.maskComponent = mod.exports;
  }
})(typeof globalThis !== "undefined" ? globalThis : typeof self !== "undefined" ? self : this, function (_exports, _uiRenderComponent, _classDecorator, _index, _index2, _visibleRect, _index3, _enum, _graphicsComponent, _index4) {
  "use strict";

  Object.defineProperty(_exports, "__esModule", {
    value: true
  });
  _exports.MaskComponent = _exports.MaskType = void 0;
  _visibleRect = _interopRequireDefault(_visibleRect);

  var _dec, _dec2, _dec3, _dec4, _dec5, _dec6, _dec7, _dec8, _dec9, _class, _class2, _descriptor, _descriptor2, _descriptor3, _class3, _temp;

  function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

  function _typeof(obj) { "@babel/helpers - typeof"; if (typeof Symbol === "function" && typeof Symbol.iterator === "symbol") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }; } return _typeof(obj); }

  function _initializerDefineProperty(target, property, descriptor, context) { if (!descriptor) return; Object.defineProperty(target, property, { enumerable: descriptor.enumerable, configurable: descriptor.configurable, writable: descriptor.writable, value: descriptor.initializer ? descriptor.initializer.call(context) : void 0 }); }

  function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

  function _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === "object" || typeof call === "function")) { return call; } return _assertThisInitialized(self); }

  function _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return self; }

  function _get(target, property, receiver) { if (typeof Reflect !== "undefined" && Reflect.get) { _get = Reflect.get; } else { _get = function _get(target, property, receiver) { var base = _superPropBase(target, property); if (!base) return; var desc = Object.getOwnPropertyDescriptor(base, property); if (desc.get) { return desc.get.call(receiver); } return desc.value; }; } return _get(target, property, receiver || target); }

  function _superPropBase(object, property) { while (!Object.prototype.hasOwnProperty.call(object, property)) { object = _getPrototypeOf(object); if (object === null) break; } return object; }

  function _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }

  function _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }

  function _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }

  function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); if (superClass) _setPrototypeOf(subClass, superClass); }

  function _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }

  function _initializerWarningHelper(descriptor, context) { throw new Error('Decorating class property failed. Please ensure that ' + 'proposal-class-properties is enabled and runs after the decorators transform.'); }

  function _applyDecoratedDescriptor(target, property, decorators, descriptor, context) { var desc = {}; Object.keys(descriptor).forEach(function (key) { desc[key] = descriptor[key]; }); desc.enumerable = !!desc.enumerable; desc.configurable = !!desc.configurable; if ('value' in desc || desc.initializer) { desc.writable = true; } desc = decorators.slice().reverse().reduce(function (desc, decorator) { return decorator(target, property, desc) || desc; }, desc); if (context && desc.initializer !== void 0) { desc.value = desc.initializer ? desc.initializer.call(context) : void 0; desc.initializer = undefined; } if (desc.initializer === void 0) { Object.defineProperty(target, property, desc); desc = null; } return desc; }

  var _worldMatrix = new _index.Mat4();

  var _vec2_temp = new _index.Vec2();

  var _mat4_temp = new _index.Mat4();

  var _circlePoints = [];

  function _calculateCircle(center, radius, segments) {
    _circlePoints.length = 0;
    var anglePerStep = Math.PI * 2 / segments;

    for (var step = 0; step < segments; ++step) {
      _circlePoints.push(new _index.Vec3(radius.x * Math.cos(anglePerStep * step) + center.x, radius.y * Math.sin(anglePerStep * step) + center.y, 0));
    }

    return _circlePoints;
  }
  /**
   * @en The type for mask.
   *
   * @zh 遮罩组件类型。
   */


  var MaskType;
  _exports.MaskType = MaskType;

  (function (MaskType) {
    MaskType[MaskType["RECT"] = 0] = "RECT";
    MaskType[MaskType["ELLIPSE"] = 1] = "ELLIPSE";
    MaskType[MaskType["GRAPHICS_STENCIL"] = 2] = "GRAPHICS_STENCIL";
  })(MaskType || (_exports.MaskType = MaskType = {}));

  (0, _enum.ccenum)(MaskType);
  var SEGMENTS_MIN = 3;
  var SEGMENTS_MAX = 10000;
  /**
   * @en
   * The Mask Component.
   *
   * @zh
   * 遮罩组件。
   */

  var MaskComponent = (_dec = (0, _classDecorator.ccclass)('cc.MaskComponent'), _dec2 = (0, _classDecorator.help)('i18n:cc.MaskComponent'), _dec3 = (0, _classDecorator.executionOrder)(110), _dec4 = (0, _classDecorator.menu)('UI/Render/Mask'), _dec5 = (0, _classDecorator.property)({
    type: MaskType,
    displayOrder: 4,
    tooltip: '遮罩类型'
  }), _dec6 = (0, _classDecorator.property)({
    tooltip: '反向遮罩'
  }), _dec7 = (0, _classDecorator.property)({
    visible: false,
    override: true
  }), _dec8 = (0, _classDecorator.property)({
    visible: false,
    override: true
  }), _dec9 = (0, _classDecorator.property)({
    visible: false,
    override: true
  }), _dec(_class = _dec2(_class = _dec3(_class = _dec4(_class = (_class2 = (_temp = _class3 = /*#__PURE__*/function (_UIRenderComponent) {
    _inherits(MaskComponent, _UIRenderComponent);

    _createClass(MaskComponent, [{
      key: "type",

      /**
       * @en
       * The mask type.
       *
       * @zh
       * 遮罩类型。
       */
      get: function get() {
        return this._type;
      },
      set: function set(value) {
        if (this._type === value) {
          return;
        }

        this._type = value;

        this._updateGraphics();

        if (this._renderData) {
          this.destroyRenderData();
          this._renderData = null;
        }
      }
      /**
       * @en
       * Reverse mask (Not supported Canvas Mode)
       * .
       * @zh
       * 反向遮罩（不支持 Canvas 模式）。
       */

    }, {
      key: "inverted",
      get: function get() {
        return this._inverted;
      },
      set: function set(value) {
        if (cc.game.renderType === _index4.Game.RENDER_TYPE_CANVAS) {
          cc.warnID(4202);
          return;
        }

        this._inverted = value;
      }
      /**
       * @en
       * The segments for ellipse mask.
       *
       * TODO: remove segments, not supported by graphics
       * @zh
       * 椭圆遮罩的曲线细分数。
       */

    }, {
      key: "segments",
      get: function get() {
        return this._segments;
      },
      set: function set(value) {
        if (this._segments === value) {
          return;
        }

        this._segments = (0, _index.clamp)(value, SEGMENTS_MIN, SEGMENTS_MAX);

        this._updateGraphics();
      }
    }, {
      key: "graphics",
      get: function get() {
        return this._graphics;
      }
    }, {
      key: "clearGraphics",
      get: function get() {
        return this._clearGraphics;
      }
    }, {
      key: "dstBlendFactor",
      get: function get() {
        return this._dstBlendFactor;
      },
      set: function set(value) {
        if (this._dstBlendFactor === value) {
          return;
        }

        this._dstBlendFactor = value;

        this._updateBlendFunc();
      }
    }, {
      key: "srcBlendFactor",
      get: function get() {
        return this._srcBlendFactor;
      },
      set: function set(value) {
        if (this._srcBlendFactor === value) {
          return;
        }

        this._srcBlendFactor = value;

        this._updateBlendFunc();
      }
    }, {
      key: "color",
      get: function get() {
        return this._color;
      },
      set: function set(value) {
        if (this._color === value) {
          return;
        }

        this._color.set(value);

        this.markForUpdateRenderData();
      }
    }]);

    function MaskComponent() {
      var _this;

      _classCallCheck(this, MaskComponent);

      _this = _possibleConstructorReturn(this, _getPrototypeOf(MaskComponent).call(this));

      _initializerDefineProperty(_this, "_type", _descriptor, _assertThisInitialized(_this));

      _initializerDefineProperty(_this, "_inverted", _descriptor2, _assertThisInitialized(_this));

      _initializerDefineProperty(_this, "_segments", _descriptor3, _assertThisInitialized(_this));

      _this._graphics = null;
      _this._clearGraphics = null;
      _this._instanceMaterialType = _uiRenderComponent.InstanceMaterialType.ADDCOLOR;
      return _this;
    }

    _createClass(MaskComponent, [{
      key: "onLoad",
      value: function onLoad() {
        this._createGraphics();

        if (this._clearGraphics) {
          this._clearGraphics.onLoad();
        }

        if (this._graphics) {
          this._graphics.onLoad();
        }
      }
      /**
       * @zh
       * 图形内容重塑。
       */

    }, {
      key: "onRestore",
      value: function onRestore() {
        this._createGraphics();

        this._updateGraphics();
      }
    }, {
      key: "onEnable",
      value: function onEnable() {
        _get(_getPrototypeOf(MaskComponent.prototype), "onEnable", this).call(this);

        this._enableGraphics();

        _index2.view.on('design-resolution-changed', this._updateClearGraphics, this);
      }
    }, {
      key: "onDisable",
      value: function onDisable() {
        _get(_getPrototypeOf(MaskComponent.prototype), "onDisable", this).call(this);

        this._disableGraphics();

        _index2.view.off('design-resolution-changed', this._updateClearGraphics);
      }
    }, {
      key: "onDestroy",
      value: function onDestroy() {
        _get(_getPrototypeOf(MaskComponent.prototype), "onDestroy", this).call(this);

        this._removeGraphics();
      }
      /**
       * @zh
       * 根据屏幕坐标计算点击事件。
       *
       * @param cameraPt  屏幕点转换到相机坐标系下的点。
       */

    }, {
      key: "isHit",
      value: function isHit(cameraPt) {
        var node = this.node;
        var size = node.getContentSize();
        var w = size.width;
        var h = size.height;
        var testPt = _vec2_temp;
        this.node.getWorldMatrix(_worldMatrix);

        _index.Mat4.invert(_mat4_temp, _worldMatrix);

        _index.Vec2.transformMat4(testPt, cameraPt, _mat4_temp);

        var ap = node.getAnchorPoint();
        testPt.x += ap.x * w;
        testPt.y += ap.y * h;
        var result = false;

        if (this.type === MaskType.RECT || this.type === MaskType.GRAPHICS_STENCIL) {
          result = testPt.x >= 0 && testPt.y >= 0 && testPt.x <= w && testPt.y <= h;
        } else if (this.type === MaskType.ELLIPSE) {
          var rx = w / 2;
          var ry = h / 2;
          var px = testPt.x - 0.5 * w;
          var py = testPt.y - 0.5 * h;
          result = px * px / (rx * rx) + py * py / (ry * ry) < 1;
        }

        if (this._inverted) {
          result = !result;
        }

        return result;
      }
    }, {
      key: "_render",
      value: function _render(render) {
        render.commitComp(this, null, this._assembler);
      }
    }, {
      key: "_postRender",
      value: function _postRender(render) {
        if (!this._postAssembler) {
          return;
        }

        render.commitComp(this, null, this._postAssembler);
      }
    }, {
      key: "_nodeStateChange",
      value: function _nodeStateChange(type) {
        _get(_getPrototypeOf(MaskComponent.prototype), "_nodeStateChange", this).call(this, type);

        this._updateGraphics();
      }
    }, {
      key: "_resolutionChanged",
      value: function _resolutionChanged() {
        this._updateClearGraphics();
      }
    }, {
      key: "_canRender",
      value: function _canRender() {
        if (!_get(_getPrototypeOf(MaskComponent.prototype), "_canRender", this).call(this)) {
          return false;
        }

        return this._clearGraphics !== null && this._graphics !== null;
      }
    }, {
      key: "_flushAssembler",
      value: function _flushAssembler() {
        var assembler = MaskComponent.Assembler.getAssembler(this);
        var posAssembler = MaskComponent.PostAssembler.getAssembler(this);

        if (this._assembler !== assembler) {
          this.destroyRenderData();
          this._assembler = assembler;
        }

        if (this._postAssembler !== posAssembler) {
          this._postAssembler = posAssembler;
        }

        if (!this._renderData) {
          if (this._assembler && this._assembler.createData) {
            this._renderData = this._assembler.createData(this);
            this._renderData.material = this.sharedMaterial;
            this.markForUpdateRenderData();
          }
        }
      }
    }, {
      key: "_createGraphics",
      value: function _createGraphics() {
        if (!this._clearGraphics) {
          var node = new _index3.Node('clear-graphics');
          var clearGraphics = this._clearGraphics = node.addComponent(_graphicsComponent.GraphicsComponent);
          clearGraphics.delegateSrc = this.node;
          clearGraphics.helpInstanceMaterial();
          clearGraphics.lineWidth = 0;

          var color = _index.Color.WHITE.clone();

          color.a = 0;
          clearGraphics.fillColor = color;
        }

        if (!this._graphics) {
          var graphics = this._graphics = new _graphicsComponent.GraphicsComponent();
          graphics.node = this.node;
          graphics.node.getWorldMatrix();
          graphics.helpInstanceMaterial();
          graphics.lineWidth = 0;

          var _color = _index.Color.WHITE.clone();

          _color.a = 0;
          graphics.fillColor = _color;
        }
      }
    }, {
      key: "_updateClearGraphics",
      value: function _updateClearGraphics() {
        if (!this._clearGraphics) {
          return;
        }

        var size = _visibleRect.default;

        this._clearGraphics.node.setWorldPosition(size.width / 2, size.height / 2, 0);

        this._clearGraphics.clear();

        this._clearGraphics.rect(-size.width / 2, -size.height / 2, size.width, size.height);

        this._clearGraphics.fill();
      }
    }, {
      key: "_updateGraphics",
      value: function _updateGraphics() {
        if (!this._graphics) {
          return;
        }

        var node = this.node;
        var graphics = this._graphics; // Share render data with graphics content

        graphics.clear();
        var size = node.getContentSize();
        var width = size.width;
        var height = size.height;
        var ap = node.getAnchorPoint();
        var x = -width * ap.x;
        var y = -height * ap.y;

        if (this._type === MaskType.RECT) {
          graphics.rect(x, y, width, height);
        } else if (this._type === MaskType.ELLIPSE) {
          var center = new _index.Vec3(x + width / 2, y + height / 2, 0);
          var radius = new _index.Vec3(width / 2, height / 2, 0);

          var points = _calculateCircle(center, radius, this._segments);

          for (var i = 0; i < points.length; ++i) {
            var point = points[i];

            if (i === 0) {
              graphics.moveTo(point.x, point.y);
            } else {
              graphics.lineTo(point.x, point.y);
            }
          }

          graphics.close();
        }

        graphics.fill();
      }
    }, {
      key: "_enableGraphics",
      value: function _enableGraphics() {
        if (this._clearGraphics) {
          this._clearGraphics.onEnable();

          this._updateClearGraphics();
        }

        if (this._graphics) {
          this._graphics.onEnable();

          this._updateGraphics();
        }
      }
    }, {
      key: "_disableGraphics",
      value: function _disableGraphics() {
        if (this._graphics) {
          this._graphics.onDisable();
        }

        if (this._clearGraphics) {
          this._clearGraphics.onDisable();
        }
      }
    }, {
      key: "_removeGraphics",
      value: function _removeGraphics() {
        if (this._graphics) {
          this._graphics.destroy();
        }

        if (this._clearGraphics) {
          this._clearGraphics.destroy();
        }
      }
    }]);

    return MaskComponent;
  }(_uiRenderComponent.UIRenderComponent), _class3.Type = MaskType, _temp), (_applyDecoratedDescriptor(_class2.prototype, "type", [_dec5], Object.getOwnPropertyDescriptor(_class2.prototype, "type"), _class2.prototype), _applyDecoratedDescriptor(_class2.prototype, "inverted", [_dec6], Object.getOwnPropertyDescriptor(_class2.prototype, "inverted"), _class2.prototype), _applyDecoratedDescriptor(_class2.prototype, "segments", [_classDecorator.property], Object.getOwnPropertyDescriptor(_class2.prototype, "segments"), _class2.prototype), _applyDecoratedDescriptor(_class2.prototype, "dstBlendFactor", [_dec7], Object.getOwnPropertyDescriptor(_class2.prototype, "dstBlendFactor"), _class2.prototype), _applyDecoratedDescriptor(_class2.prototype, "srcBlendFactor", [_dec8], Object.getOwnPropertyDescriptor(_class2.prototype, "srcBlendFactor"), _class2.prototype), _applyDecoratedDescriptor(_class2.prototype, "color", [_dec9], Object.getOwnPropertyDescriptor(_class2.prototype, "color"), _class2.prototype), _descriptor = _applyDecoratedDescriptor(_class2.prototype, "_type", [_classDecorator.property], {
    configurable: true,
    enumerable: true,
    writable: true,
    initializer: function initializer() {
      return MaskType.RECT;
    }
  }), _descriptor2 = _applyDecoratedDescriptor(_class2.prototype, "_inverted", [_classDecorator.property], {
    configurable: true,
    enumerable: true,
    writable: true,
    initializer: function initializer() {
      return false;
    }
  }), _descriptor3 = _applyDecoratedDescriptor(_class2.prototype, "_segments", [_classDecorator.property], {
    configurable: true,
    enumerable: true,
    writable: true,
    initializer: function initializer() {
      return 64;
    }
  })), _class2)) || _class) || _class) || _class) || _class); // tslint:disable-next-line

  _exports.MaskComponent = MaskComponent;
  cc.MaskComponent = MaskComponent;
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkY6L2plbmtpbnMvd29ya3NwYWNlL0NyZWF0b3JfM0QvZWRpdG9yLTNkL3Jlc291cmNlcy8zZC9lbmdpbmUvY29jb3MvdWkvY29tcG9uZW50cy9tYXNrLWNvbXBvbmVudC50cyJdLCJuYW1lcyI6WyJfd29ybGRNYXRyaXgiLCJNYXQ0IiwiX3ZlYzJfdGVtcCIsIlZlYzIiLCJfbWF0NF90ZW1wIiwiX2NpcmNsZVBvaW50cyIsIl9jYWxjdWxhdGVDaXJjbGUiLCJjZW50ZXIiLCJyYWRpdXMiLCJzZWdtZW50cyIsImxlbmd0aCIsImFuZ2xlUGVyU3RlcCIsIk1hdGgiLCJQSSIsInN0ZXAiLCJwdXNoIiwiVmVjMyIsIngiLCJjb3MiLCJ5Iiwic2luIiwiTWFza1R5cGUiLCJTRUdNRU5UU19NSU4iLCJTRUdNRU5UU19NQVgiLCJNYXNrQ29tcG9uZW50IiwidHlwZSIsImRpc3BsYXlPcmRlciIsInRvb2x0aXAiLCJ2aXNpYmxlIiwib3ZlcnJpZGUiLCJfdHlwZSIsInZhbHVlIiwiX3VwZGF0ZUdyYXBoaWNzIiwiX3JlbmRlckRhdGEiLCJkZXN0cm95UmVuZGVyRGF0YSIsIl9pbnZlcnRlZCIsImNjIiwiZ2FtZSIsInJlbmRlclR5cGUiLCJHYW1lIiwiUkVOREVSX1RZUEVfQ0FOVkFTIiwid2FybklEIiwiX3NlZ21lbnRzIiwiX2dyYXBoaWNzIiwiX2NsZWFyR3JhcGhpY3MiLCJfZHN0QmxlbmRGYWN0b3IiLCJfdXBkYXRlQmxlbmRGdW5jIiwiX3NyY0JsZW5kRmFjdG9yIiwiX2NvbG9yIiwic2V0IiwibWFya0ZvclVwZGF0ZVJlbmRlckRhdGEiLCJfaW5zdGFuY2VNYXRlcmlhbFR5cGUiLCJJbnN0YW5jZU1hdGVyaWFsVHlwZSIsIkFERENPTE9SIiwiX2NyZWF0ZUdyYXBoaWNzIiwib25Mb2FkIiwiX2VuYWJsZUdyYXBoaWNzIiwidmlldyIsIm9uIiwiX3VwZGF0ZUNsZWFyR3JhcGhpY3MiLCJfZGlzYWJsZUdyYXBoaWNzIiwib2ZmIiwiX3JlbW92ZUdyYXBoaWNzIiwiY2FtZXJhUHQiLCJub2RlIiwic2l6ZSIsImdldENvbnRlbnRTaXplIiwidyIsIndpZHRoIiwiaCIsImhlaWdodCIsInRlc3RQdCIsImdldFdvcmxkTWF0cml4IiwiaW52ZXJ0IiwidHJhbnNmb3JtTWF0NCIsImFwIiwiZ2V0QW5jaG9yUG9pbnQiLCJyZXN1bHQiLCJSRUNUIiwiR1JBUEhJQ1NfU1RFTkNJTCIsIkVMTElQU0UiLCJyeCIsInJ5IiwicHgiLCJweSIsInJlbmRlciIsImNvbW1pdENvbXAiLCJfYXNzZW1ibGVyIiwiX3Bvc3RBc3NlbWJsZXIiLCJhc3NlbWJsZXIiLCJBc3NlbWJsZXIiLCJnZXRBc3NlbWJsZXIiLCJwb3NBc3NlbWJsZXIiLCJQb3N0QXNzZW1ibGVyIiwiY3JlYXRlRGF0YSIsIm1hdGVyaWFsIiwic2hhcmVkTWF0ZXJpYWwiLCJOb2RlIiwiY2xlYXJHcmFwaGljcyIsImFkZENvbXBvbmVudCIsIkdyYXBoaWNzQ29tcG9uZW50IiwiZGVsZWdhdGVTcmMiLCJoZWxwSW5zdGFuY2VNYXRlcmlhbCIsImxpbmVXaWR0aCIsImNvbG9yIiwiQ29sb3IiLCJXSElURSIsImNsb25lIiwiYSIsImZpbGxDb2xvciIsImdyYXBoaWNzIiwidmlzaWJsZVJlY3QiLCJzZXRXb3JsZFBvc2l0aW9uIiwiY2xlYXIiLCJyZWN0IiwiZmlsbCIsInBvaW50cyIsImkiLCJwb2ludCIsIm1vdmVUbyIsImxpbmVUbyIsImNsb3NlIiwib25FbmFibGUiLCJvbkRpc2FibGUiLCJkZXN0cm95IiwiVUlSZW5kZXJDb21wb25lbnQiLCJUeXBlIiwicHJvcGVydHkiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBMkNBLE1BQU1BLFlBQVksR0FBRyxJQUFJQyxXQUFKLEVBQXJCOztBQUNBLE1BQU1DLFVBQVUsR0FBRyxJQUFJQyxXQUFKLEVBQW5COztBQUNBLE1BQU1DLFVBQVUsR0FBRyxJQUFJSCxXQUFKLEVBQW5COztBQUVBLE1B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QUFMO0FBQ0g7QUFDSjs7O3lDQUU2QjtBQUMxQixZQUFJLEtBQUtXLFNBQVQsRUFBb0I7QUFDaEIsZUFBS0EsU0FBTCxDQUFlZ0YsU0FBZjtBQUNIOztBQUVELFlBQUksS0FBSy9FLGNBQVQsRUFBeUI7QUFDckIsZUFBS0EsY0FBTCxDQUFvQitFLFNBQXBCO0FBQ0g7QUFDSjs7O3dDQUU0QjtBQUN6QixZQUFJLEtBQUtoRixTQUFULEVBQW9CO0FBQ2hCLGVBQUtBLFNBQUwsQ0FBZWlGLE9BQWY7QUFDSDs7QUFFRCxZQUFJLEtBQUtoRixjQUFULEVBQXlCO0FBQ3JCLGVBQUtBLGNBQUwsQ0FBb0JnRixPQUFwQjtBQUNIO0FBQ0o7Ozs7SUFoWThCQyxvQyxXQXVJakJDLEksR0FBT3pHLFEseVdBMUVwQjBHLHdCLGduQkE0RUFBLHdCOzs7OzthQUNpQjFHLFFBQVEsQ0FBQ3lELEk7O2dGQUUxQmlELHdCOzs7OzthQUNxQixLOztnRkFFckJBLHdCOzs7OzthQUNxQixFOzs4REFtUDFCOzs7QUFDQTNGLEVBQUFBLEVBQUUsQ0FBQ1osYUFBSCxHQUFtQkEsYUFBbkIiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxyXG4gQ29weXJpZ2h0IChjKSAyMDEzLTIwMTYgQ2h1a29uZyBUZWNobm9sb2dpZXMgSW5jLlxyXG4gQ29weXJpZ2h0IChjKSAyMDE3LTIwMTggWGlhbWVuIFlhamkgU29mdHdhcmUgQ28uLCBMdGQuXHJcblxyXG4gaHR0cDovL3d3dy5jb2Nvcy5jb21cclxuXHJcbiBQZXJtaXNzaW9uIGlzIGhlcmVieSBncmFudGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbiBvYnRhaW5pbmcgYSBjb3B5XHJcbiBvZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGVuZ2luZSBzb3VyY2UgY29kZSAodGhlIFwiU29mdHdhcmVcIiksIGEgbGltaXRlZCxcclxuICB3b3JsZHdpZGUsIHJveWFsdHktZnJlZSwgbm9uLWFzc2lnbmFibGUsIHJldm9jYWJsZSBhbmQgbm9uLWV4Y2x1c2l2ZSBsaWNlbnNlXHJcbiB0byB1c2UgQ29jb3MgQ3JlYXRvciBzb2xlbHkgdG8gZGV2ZWxvcCBnYW1lcyBvbiB5b3VyIHRhcmdldCBwbGF0Zm9ybXMuIFlvdSBzaGFsbFxyXG4gIG5vdCB1c2UgQ29jb3MgQ3JlYXRvciBzb2Z0d2FyZSBmb3IgZGV2ZWxvcGluZyBvdGhlciBzb2Z0d2FyZSBvciB0b29scyB0aGF0J3NcclxuICB1c2VkIGZvciBkZXZlbG9waW5nIGdhbWVzLiBZb3UgYXJlIG5vdCBncmFudGVkIHRvIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsXHJcbiAgc3VibGljZW5zZSwgYW5kL29yIHNlbGwgY29waWVzIG9mIENvY29zIENyZWF0b3IuXHJcblxyXG4gVGhlIHNvZnR3YXJlIG9yIHRvb2xzIGluIHRoaXMgTGljZW5zZSBBZ3JlZW1lbnQgYXJlIGxpY2Vuc2VkLCBub3Qgc29sZC5cclxuIFhpYW1lbiBZYWppIFNvZnR3YXJlIENvLiwgTHRkLiByZXNlcnZlcyBhbGwgcmlnaHRzIG5vdCBleHByZXNzbHkgZ3JhbnRlZCB0byB5b3UuXHJcblxyXG4gVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEIFwiQVMgSVNcIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUyBPUlxyXG4gSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFksXHJcbiBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEVcclxuIEFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sIERBTUFHRVMgT1IgT1RIRVJcclxuIExJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HIEZST00sXHJcbiBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElOXHJcbiBUSEUgU09GVFdBUkUuXHJcbiovXHJcblxyXG4vKipcclxuICogQGNhdGVnb3J5IHVpXHJcbiAqL1xyXG5cclxuaW1wb3J0IHsgSW5zdGFuY2VNYXRlcmlhbFR5cGUsIFVJUmVuZGVyQ29tcG9uZW50IH0gZnJvbSAnLi4vLi4vY29yZS9jb21wb25lbnRzL3VpLWJhc2UvdWktcmVuZGVyLWNvbXBvbmVudCc7XHJcbmltcG9ydCB7IGNjY2xhc3MsIGhlbHAsIGV4ZWN1dGlvbk9yZGVyLCBtZW51LCBwcm9wZXJ0eSB9IGZyb20gJy4uLy4uL2NvcmUvZGF0YS9jbGFzcy1kZWNvcmF0b3InO1xyXG5pbXBvcnQgeyBjbGFtcCwgQ29sb3IsIE1hdDQsIFZlYzIsIFZlYzMgfSBmcm9tICcuLi8uLi9jb3JlL21hdGgnO1xyXG5pbXBvcnQgeyB2aWV3IH0gZnJvbSAnLi4vLi4vY29yZS9wbGF0Zm9ybSc7XHJcbmltcG9ydCB2aXNpYmxlUmVjdCBmcm9tICcuLi8uLi9jb3JlL3BsYXRmb3JtL3Zpc2libGUtcmVjdCc7XHJcbmltcG9ydCB7IFVJIH0gZnJvbSAnLi4vLi4vY29yZS9yZW5kZXJlci91aS91aSc7XHJcbmltcG9ydCB7IE5vZGUgfSBmcm9tICcuLi8uLi9jb3JlL3NjZW5lLWdyYXBoJztcclxuaW1wb3J0IHsgY2NlbnVtIH0gZnJvbSAnLi4vLi4vY29yZS92YWx1ZS10eXBlcy9lbnVtJztcclxuaW1wb3J0IHsgR3JhcGhpY3NDb21wb25lbnQgfSBmcm9tICcuL2dyYXBoaWNzLWNvbXBvbmVudCc7XHJcbmltcG9ydCB7IFRyYW5zZm9ybUJpdCB9IGZyb20gJy4uLy4uL2NvcmUvc2NlbmUtZ3JhcGgvbm9kZS1lbnVtJztcclxuaW1wb3J0IHsgTWF0ZXJpYWwgfSBmcm9tICdAY29jb3MvY2Fubm9uJztcclxuaW1wb3J0IHsgR2FtZSB9IGZyb20gJy4uLy4uL2NvcmUnO1xyXG5cclxuY29uc3QgX3dvcmxkTWF0cml4ID0gbmV3IE1hdDQoKTtcclxuY29uc3QgX3ZlYzJfdGVtcCA9IG5ldyBWZWMyKCk7XHJcbmNvbnN0IF9tYXQ0X3RlbXAgPSBuZXcgTWF0NCgpO1xyXG5cclxuY29uc3QgX2NpcmNsZVBvaW50czogVmVjM1tdID0gW107XHJcbmZ1bmN0aW9uIF9jYWxjdWxhdGVDaXJjbGUgKGNlbnRlcjogVmVjMywgcmFkaXVzOiBWZWMzLCBzZWdtZW50czogbnVtYmVyKSB7XHJcbiAgICBfY2lyY2xlUG9pbnRzLmxlbmd0aCA9IDA7XHJcbiAgICBjb25zdCBhbmdsZVBlclN0ZXAgPSBNYXRoLlBJICogMiAvIHNlZ21lbnRzO1xyXG4gICAgZm9yIChsZXQgc3RlcCA9IDA7IHN0ZXAgPCBzZWdtZW50czsgKytzdGVwKSB7XHJcbiAgICAgICAgX2NpcmNsZVBvaW50cy5wdXNoKG5ldyBWZWMzKHJhZGl1cy54ICogTWF0aC5jb3MoYW5nbGVQZXJTdGVwICogc3RlcCkgKyBjZW50ZXIueCxcclxuICAgICAgICAgICAgcmFkaXVzLnkgKiBNYXRoLnNpbihhbmdsZVBlclN0ZXAgKiBzdGVwKSArIGNlbnRlci55LCAwKSk7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIF9jaXJjbGVQb2ludHM7XHJcbn1cclxuLyoqXHJcbiAqIEBlbiBUaGUgdHlwZSBmb3IgbWFzay5cclxuICpcclxuICogQHpoIOmBrue9qee7hOS7tuexu+Wei+OAglxyXG4gKi9cclxuZXhwb3J0IGVudW0gTWFza1R5cGUge1xyXG4gICAgLyoqXHJcbiAgICAgKiBAZW4gUmVjdCBtYXNrLlxyXG4gICAgICpcclxuICAgICAqIEB6aFxyXG4gICAgICog5L2/55So55+p5b2i5L2c5Li66YGu572p44CCXHJcbiAgICAgKi9cclxuICAgIFJFQ1QgPSAwLFxyXG5cclxuICAgIC8qKlxyXG4gICAgICogQGVuIEVsbGlwc2UgTWFzay5cclxuICAgICAqXHJcbiAgICAgKiBAemhcclxuICAgICAqIOS9v+eUqOakreWchuS9nOS4uumBrue9qeOAglxyXG4gICAgICovXHJcbiAgICBFTExJUFNFID0gMSxcclxuXHJcbiAgICAvKipcclxuICAgICAqIEBlbiBFbGxpcHNlIE1hc2suXHJcbiAgICAgKlxyXG4gICAgICogQHpoXHJcbiAgICAgKiDkvb/nlKjlm77lg4/mqKHniYjkvZzkuLrpga7nvanjgIJcclxuICAgICAqL1xyXG4gICAgR1JBUEhJQ1NfU1RFTkNJTCA9IDIsXHJcbn1cclxuXHJcbmNjZW51bShNYXNrVHlwZSk7XHJcblxyXG5jb25zdCBTRUdNRU5UU19NSU4gPSAzO1xyXG5jb25zdCBTRUdNRU5UU19NQVggPSAxMDAwMDtcclxuXHJcbi8qKlxyXG4gKiBAZW5cclxuICogVGhlIE1hc2sgQ29tcG9uZW50LlxyXG4gKlxyXG4gKiBAemhcclxuICog6YGu572p57uE5Lu244CCXHJcbiAqL1xyXG5AY2NjbGFzcygnY2MuTWFza0NvbXBvbmVudCcpXHJcbkBoZWxwKCdpMThuOmNjLk1hc2tDb21wb25lbnQnKVxyXG5AZXhlY3V0aW9uT3JkZXIoMTEwKVxyXG5AbWVudSgnVUkvUmVuZGVyL01hc2snKVxyXG5leHBvcnQgY2xhc3MgTWFza0NvbXBvbmVudCBleHRlbmRzIFVJUmVuZGVyQ29tcG9uZW50IHtcclxuICAgIC8qKlxyXG4gICAgICogQGVuXHJcbiAgICAgKiBUaGUgbWFzayB0eXBlLlxyXG4gICAgICpcclxuICAgICAqIEB6aFxyXG4gICAgICog6YGu572p57G75Z6L44CCXHJcbiAgICAgKi9cclxuICAgIEBwcm9wZXJ0eSh7XHJcbiAgICAgICAgdHlwZTogTWFza1R5cGUsXHJcbiAgICAgICAgZGlzcGxheU9yZGVyOiA0LFxyXG4gICAgICAgIHRvb2x0aXA6ICfpga7nvannsbvlnosnLFxyXG4gICAgfSlcclxuICAgIGdldCB0eXBlICgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fdHlwZTtcclxuICAgIH1cclxuXHJcbiAgICBzZXQgdHlwZSAodmFsdWU6IE1hc2tUeXBlKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuX3R5cGUgPT09IHZhbHVlKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuX3R5cGUgPSB2YWx1ZTtcclxuICAgICAgICB0aGlzLl91cGRhdGVHcmFwaGljcygpO1xyXG4gICAgICAgIGlmICh0aGlzLl9yZW5kZXJEYXRhKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZGVzdHJveVJlbmRlckRhdGEoKTtcclxuICAgICAgICAgICAgdGhpcy5fcmVuZGVyRGF0YSA9IG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogQGVuXHJcbiAgICAgKiBSZXZlcnNlIG1hc2sgKE5vdCBzdXBwb3J0ZWQgQ2FudmFzIE1vZGUpXHJcbiAgICAgKiAuXHJcbiAgICAgKiBAemhcclxuICAgICAqIOWPjeWQkemBrue9qe+8iOS4jeaUr+aMgSBDYW52YXMg5qih5byP77yJ44CCXHJcbiAgICAgKi9cclxuICAgIEBwcm9wZXJ0eSh7XHJcbiAgICAgICAgdG9vbHRpcDogJ+WPjeWQkemBrue9qScsXHJcbiAgICB9KVxyXG4gICAgZ2V0IGludmVydGVkICgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5faW52ZXJ0ZWQ7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0IGludmVydGVkICh2YWx1ZSkge1xyXG4gICAgICAgIGlmIChjYy5nYW1lLnJlbmRlclR5cGUgPT09IEdhbWUuUkVOREVSX1RZUEVfQ0FOVkFTKSB7XHJcbiAgICAgICAgICAgIGNjLndhcm5JRCg0MjAyKTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5faW52ZXJ0ZWQgPSB2YWx1ZTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEBlblxyXG4gICAgICogVGhlIHNlZ21lbnRzIGZvciBlbGxpcHNlIG1hc2suXHJcbiAgICAgKlxyXG4gICAgICogVE9ETzogcmVtb3ZlIHNlZ21lbnRzLCBub3Qgc3VwcG9ydGVkIGJ5IGdyYXBoaWNzXHJcbiAgICAgKiBAemhcclxuICAgICAqIOakreWchumBrue9qeeahOabsue6v+e7huWIhuaVsOOAglxyXG4gICAgICovXHJcbiAgICBAcHJvcGVydHlcclxuICAgIGdldCBzZWdtZW50cyAoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3NlZ21lbnRzO1xyXG4gICAgfVxyXG5cclxuICAgIHNldCBzZWdtZW50cyAodmFsdWUpIHtcclxuICAgICAgICBpZiAodGhpcy5fc2VnbWVudHMgPT09IHZhbHVlKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuX3NlZ21lbnRzID0gY2xhbXAodmFsdWUsIFNFR01FTlRTX01JTiwgU0VHTUVOVFNfTUFYKTtcclxuICAgICAgICB0aGlzLl91cGRhdGVHcmFwaGljcygpO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBncmFwaGljcyAoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2dyYXBoaWNzO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBjbGVhckdyYXBoaWNzICgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fY2xlYXJHcmFwaGljcztcclxuICAgIH1cclxuXHJcbiAgICBAcHJvcGVydHkoe1xyXG4gICAgICAgIHZpc2libGU6IGZhbHNlLFxyXG4gICAgICAgIG92ZXJyaWRlOiB0cnVlLFxyXG4gICAgfSlcclxuICAgIGdldCBkc3RCbGVuZEZhY3RvciAoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2RzdEJsZW5kRmFjdG9yO1xyXG4gICAgfVxyXG5cclxuICAgIHNldCBkc3RCbGVuZEZhY3RvciAodmFsdWUpIHtcclxuICAgICAgICBpZiAodGhpcy5fZHN0QmxlbmRGYWN0b3IgPT09IHZhbHVlKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuX2RzdEJsZW5kRmFjdG9yID0gdmFsdWU7XHJcbiAgICAgICAgdGhpcy5fdXBkYXRlQmxlbmRGdW5jKCk7XHJcbiAgICB9XHJcblxyXG4gICAgQHByb3BlcnR5KHtcclxuICAgICAgICB2aXNpYmxlOiBmYWxzZSxcclxuICAgICAgICBvdmVycmlkZTogdHJ1ZSxcclxuICAgIH0pXHJcbiAgICBnZXQgc3JjQmxlbmRGYWN0b3IgKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9zcmNCbGVuZEZhY3RvcjtcclxuICAgIH1cclxuXHJcbiAgICBzZXQgc3JjQmxlbmRGYWN0b3IgKHZhbHVlKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuX3NyY0JsZW5kRmFjdG9yID09PSB2YWx1ZSkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLl9zcmNCbGVuZEZhY3RvciA9IHZhbHVlO1xyXG4gICAgICAgIHRoaXMuX3VwZGF0ZUJsZW5kRnVuYygpO1xyXG4gICAgfVxyXG5cclxuICAgIEBwcm9wZXJ0eSh7XHJcbiAgICAgICAgdmlzaWJsZTogZmFsc2UsXHJcbiAgICAgICAgb3ZlcnJpZGU6IHRydWUsXHJcbiAgICB9KVxyXG4gICAgLy8gQGNvbnN0Z2V0XHJcbiAgICBnZXQgY29sb3IgKCk6IFJlYWRvbmx5PENvbG9yPiB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2NvbG9yO1xyXG4gICAgfVxyXG5cclxuICAgIHNldCBjb2xvciAodmFsdWUpIHtcclxuICAgICAgICBpZiAodGhpcy5fY29sb3IgPT09IHZhbHVlKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuX2NvbG9yLnNldCh2YWx1ZSk7XHJcbiAgICAgICAgdGhpcy5tYXJrRm9yVXBkYXRlUmVuZGVyRGF0YSgpO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBzdGF0aWMgVHlwZSA9IE1hc2tUeXBlO1xyXG5cclxuICAgIEBwcm9wZXJ0eVxyXG4gICAgcHJvdGVjdGVkIF90eXBlID0gTWFza1R5cGUuUkVDVDtcclxuXHJcbiAgICBAcHJvcGVydHlcclxuICAgIHByb3RlY3RlZCBfaW52ZXJ0ZWQgPSBmYWxzZTtcclxuXHJcbiAgICBAcHJvcGVydHlcclxuICAgIHByb3RlY3RlZCBfc2VnbWVudHMgPSA2NDtcclxuXHJcbiAgICBwcm90ZWN0ZWQgX2dyYXBoaWNzOiBHcmFwaGljc0NvbXBvbmVudCB8IG51bGwgPSBudWxsO1xyXG4gICAgcHJvdGVjdGVkIF9jbGVhckdyYXBoaWNzOiBHcmFwaGljc0NvbXBvbmVudCB8IG51bGwgPSBudWxsO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yICgpIHtcclxuICAgICAgICBzdXBlcigpO1xyXG4gICAgICAgIHRoaXMuX2luc3RhbmNlTWF0ZXJpYWxUeXBlID0gSW5zdGFuY2VNYXRlcmlhbFR5cGUuQUREQ09MT1I7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIG9uTG9hZCAoKSB7XHJcbiAgICAgICAgdGhpcy5fY3JlYXRlR3JhcGhpY3MoKTtcclxuICAgICAgICBpZiAodGhpcy5fY2xlYXJHcmFwaGljcykge1xyXG4gICAgICAgICAgICB0aGlzLl9jbGVhckdyYXBoaWNzLm9uTG9hZCgpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHRoaXMuX2dyYXBoaWNzKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX2dyYXBoaWNzLm9uTG9hZCgpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEB6aFxyXG4gICAgICog5Zu+5b2i5YaF5a656YeN5aGR44CCXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBvblJlc3RvcmUgKCkge1xyXG4gICAgICAgIHRoaXMuX2NyZWF0ZUdyYXBoaWNzKCk7XHJcbiAgICAgICAgdGhpcy5fdXBkYXRlR3JhcGhpY3MoKTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgb25FbmFibGUgKCkge1xyXG4gICAgICAgIHN1cGVyLm9uRW5hYmxlKCk7XHJcbiAgICAgICAgdGhpcy5fZW5hYmxlR3JhcGhpY3MoKTtcclxuXHJcbiAgICAgICAgdmlldy5vbignZGVzaWduLXJlc29sdXRpb24tY2hhbmdlZCcsIHRoaXMuX3VwZGF0ZUNsZWFyR3JhcGhpY3MsIHRoaXMpO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBvbkRpc2FibGUgKCkge1xyXG4gICAgICAgIHN1cGVyLm9uRGlzYWJsZSgpO1xyXG4gICAgICAgIHRoaXMuX2Rpc2FibGVHcmFwaGljcygpO1xyXG4gICAgICAgIHZpZXcub2ZmKCdkZXNpZ24tcmVzb2x1dGlvbi1jaGFuZ2VkJywgdGhpcy5fdXBkYXRlQ2xlYXJHcmFwaGljcyk7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIG9uRGVzdHJveSAoKSB7XHJcbiAgICAgICAgc3VwZXIub25EZXN0cm95KCk7XHJcbiAgICAgICAgdGhpcy5fcmVtb3ZlR3JhcGhpY3MoKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEB6aFxyXG4gICAgICog5qC55o2u5bGP5bmV5Z2Q5qCH6K6h566X54K55Ye75LqL5Lu244CCXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIGNhbWVyYVB0ICDlsY/luZXngrnovazmjaLliLDnm7jmnLrlnZDmoIfns7vkuIvnmoTngrnjgIJcclxuICAgICAqL1xyXG4gICAgcHVibGljIGlzSGl0IChjYW1lcmFQdDogVmVjMikge1xyXG4gICAgICAgIGNvbnN0IG5vZGUgPSB0aGlzLm5vZGU7XHJcbiAgICAgICAgY29uc3Qgc2l6ZSA9IG5vZGUuZ2V0Q29udGVudFNpemUoKTtcclxuICAgICAgICBjb25zdCB3ID0gc2l6ZS53aWR0aDtcclxuICAgICAgICBjb25zdCBoID0gc2l6ZS5oZWlnaHQ7XHJcbiAgICAgICAgY29uc3QgdGVzdFB0ID0gX3ZlYzJfdGVtcDtcclxuXHJcbiAgICAgICAgdGhpcy5ub2RlLmdldFdvcmxkTWF0cml4KF93b3JsZE1hdHJpeCk7XHJcbiAgICAgICAgTWF0NC5pbnZlcnQoX21hdDRfdGVtcCwgX3dvcmxkTWF0cml4KTtcclxuICAgICAgICBWZWMyLnRyYW5zZm9ybU1hdDQodGVzdFB0LCBjYW1lcmFQdCwgX21hdDRfdGVtcCk7XHJcbiAgICAgICAgY29uc3QgYXAgPSBub2RlLmdldEFuY2hvclBvaW50KCk7XHJcbiAgICAgICAgdGVzdFB0LnggKz0gYXAueCAqIHc7XHJcbiAgICAgICAgdGVzdFB0LnkgKz0gYXAueSAqIGg7XHJcblxyXG4gICAgICAgIGxldCByZXN1bHQgPSBmYWxzZTtcclxuICAgICAgICBpZiAodGhpcy50eXBlID09PSBNYXNrVHlwZS5SRUNUIHx8IHRoaXMudHlwZSA9PT0gTWFza1R5cGUuR1JBUEhJQ1NfU1RFTkNJTCkge1xyXG4gICAgICAgICAgICByZXN1bHQgPSB0ZXN0UHQueCA+PSAwICYmIHRlc3RQdC55ID49IDAgJiYgdGVzdFB0LnggPD0gdyAmJiB0ZXN0UHQueSA8PSBoO1xyXG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy50eXBlID09PSBNYXNrVHlwZS5FTExJUFNFKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHJ4ID0gdyAvIDI7XHJcbiAgICAgICAgICAgIGNvbnN0IHJ5ID0gaCAvIDI7XHJcbiAgICAgICAgICAgIGNvbnN0IHB4ID0gdGVzdFB0LnggLSAwLjUgKiB3O1xyXG4gICAgICAgICAgICBjb25zdCBweSA9IHRlc3RQdC55IC0gMC41ICogaDtcclxuICAgICAgICAgICAgcmVzdWx0ID0gcHggKiBweCAvIChyeCAqIHJ4KSArIHB5ICogcHkgLyAocnkgKiByeSkgPCAxO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHRoaXMuX2ludmVydGVkKSB7XHJcbiAgICAgICAgICAgIHJlc3VsdCA9ICFyZXN1bHQ7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgfVxyXG5cclxuICAgIHByb3RlY3RlZCBfcmVuZGVyIChyZW5kZXI6IFVJKSB7XHJcbiAgICAgICAgcmVuZGVyLmNvbW1pdENvbXAodGhpcywgbnVsbCwgdGhpcy5fYXNzZW1ibGVyISk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJvdGVjdGVkIF9wb3N0UmVuZGVyIChyZW5kZXI6IFVJKSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLl9wb3N0QXNzZW1ibGVyKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJlbmRlci5jb21taXRDb21wKHRoaXMsIG51bGwsIHRoaXMuX3Bvc3RBc3NlbWJsZXIhKTtcclxuICAgIH1cclxuXHJcbiAgICBwcm90ZWN0ZWQgX25vZGVTdGF0ZUNoYW5nZSAodHlwZTogVHJhbnNmb3JtQml0KSB7XHJcbiAgICAgICAgc3VwZXIuX25vZGVTdGF0ZUNoYW5nZSh0eXBlKTtcclxuXHJcbiAgICAgICAgdGhpcy5fdXBkYXRlR3JhcGhpY3MoKTtcclxuICAgIH1cclxuXHJcbiAgICBwcm90ZWN0ZWQgX3Jlc29sdXRpb25DaGFuZ2VkICgpIHtcclxuICAgICAgICB0aGlzLl91cGRhdGVDbGVhckdyYXBoaWNzKCk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJvdGVjdGVkIF9jYW5SZW5kZXIgKCkge1xyXG4gICAgICAgIGlmICghc3VwZXIuX2NhblJlbmRlcigpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiB0aGlzLl9jbGVhckdyYXBoaWNzICE9PSBudWxsICYmIHRoaXMuX2dyYXBoaWNzICE9PSBudWxsO1xyXG4gICAgfVxyXG5cclxuICAgIHByb3RlY3RlZCBfZmx1c2hBc3NlbWJsZXIgKCkge1xyXG4gICAgICAgIGNvbnN0IGFzc2VtYmxlciA9IE1hc2tDb21wb25lbnQuQXNzZW1ibGVyIS5nZXRBc3NlbWJsZXIodGhpcyk7XHJcbiAgICAgICAgY29uc3QgcG9zQXNzZW1ibGVyID0gTWFza0NvbXBvbmVudC5Qb3N0QXNzZW1ibGVyIS5nZXRBc3NlbWJsZXIodGhpcyk7XHJcblxyXG4gICAgICAgIGlmICh0aGlzLl9hc3NlbWJsZXIgIT09IGFzc2VtYmxlcikge1xyXG4gICAgICAgICAgICB0aGlzLmRlc3Ryb3lSZW5kZXJEYXRhKCk7XHJcbiAgICAgICAgICAgIHRoaXMuX2Fzc2VtYmxlciA9IGFzc2VtYmxlcjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh0aGlzLl9wb3N0QXNzZW1ibGVyICE9PSBwb3NBc3NlbWJsZXIpIHtcclxuICAgICAgICAgICAgdGhpcy5fcG9zdEFzc2VtYmxlciA9IHBvc0Fzc2VtYmxlcjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICghdGhpcy5fcmVuZGVyRGF0YSkge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5fYXNzZW1ibGVyICYmIHRoaXMuX2Fzc2VtYmxlci5jcmVhdGVEYXRhKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9yZW5kZXJEYXRhID0gdGhpcy5fYXNzZW1ibGVyLmNyZWF0ZURhdGEodGhpcyk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9yZW5kZXJEYXRhIS5tYXRlcmlhbCA9IHRoaXMuc2hhcmVkTWF0ZXJpYWw7XHJcbiAgICAgICAgICAgICAgICB0aGlzLm1hcmtGb3JVcGRhdGVSZW5kZXJEYXRhKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJvdGVjdGVkIF9jcmVhdGVHcmFwaGljcyAoKSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLl9jbGVhckdyYXBoaWNzKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IG5vZGUgPSBuZXcgTm9kZSgnY2xlYXItZ3JhcGhpY3MnKTtcclxuICAgICAgICAgICAgY29uc3QgY2xlYXJHcmFwaGljcyA9IHRoaXMuX2NsZWFyR3JhcGhpY3MgPSBub2RlLmFkZENvbXBvbmVudChHcmFwaGljc0NvbXBvbmVudCkhO1xyXG4gICAgICAgICAgICBjbGVhckdyYXBoaWNzLmRlbGVnYXRlU3JjID0gdGhpcy5ub2RlO1xyXG4gICAgICAgICAgICBjbGVhckdyYXBoaWNzLmhlbHBJbnN0YW5jZU1hdGVyaWFsKCk7XHJcbiAgICAgICAgICAgIGNsZWFyR3JhcGhpY3MubGluZVdpZHRoID0gMDtcclxuICAgICAgICAgICAgY29uc3QgY29sb3IgPSBDb2xvci5XSElURS5jbG9uZSgpO1xyXG4gICAgICAgICAgICBjb2xvci5hID0gMDtcclxuICAgICAgICAgICAgY2xlYXJHcmFwaGljcy5maWxsQ29sb3IgPSBjb2xvcjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICghdGhpcy5fZ3JhcGhpY3MpIHtcclxuICAgICAgICAgICAgY29uc3QgZ3JhcGhpY3MgPSB0aGlzLl9ncmFwaGljcyA9IG5ldyBHcmFwaGljc0NvbXBvbmVudCgpO1xyXG4gICAgICAgICAgICBncmFwaGljcy5ub2RlID0gdGhpcy5ub2RlO1xyXG4gICAgICAgICAgICBncmFwaGljcy5ub2RlLmdldFdvcmxkTWF0cml4KCk7XHJcbiAgICAgICAgICAgIGdyYXBoaWNzLmhlbHBJbnN0YW5jZU1hdGVyaWFsKCk7XHJcbiAgICAgICAgICAgIGdyYXBoaWNzLmxpbmVXaWR0aCA9IDA7XHJcbiAgICAgICAgICAgIGNvbnN0IGNvbG9yID0gQ29sb3IuV0hJVEUuY2xvbmUoKTtcclxuICAgICAgICAgICAgY29sb3IuYSA9IDA7XHJcbiAgICAgICAgICAgIGdyYXBoaWNzLmZpbGxDb2xvciA9IGNvbG9yO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcm90ZWN0ZWQgX3VwZGF0ZUNsZWFyR3JhcGhpY3MgKCkge1xyXG4gICAgICAgIGlmICghdGhpcy5fY2xlYXJHcmFwaGljcykge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCBzaXplID0gdmlzaWJsZVJlY3Q7XHJcbiAgICAgICAgdGhpcy5fY2xlYXJHcmFwaGljcy5ub2RlLnNldFdvcmxkUG9zaXRpb24oc2l6ZS53aWR0aCAvIDIsIHNpemUuaGVpZ2h0IC8gMiwgMCk7XHJcbiAgICAgICAgdGhpcy5fY2xlYXJHcmFwaGljcy5jbGVhcigpO1xyXG4gICAgICAgIHRoaXMuX2NsZWFyR3JhcGhpY3MucmVjdCgtc2l6ZS53aWR0aCAvIDIsIC1zaXplLmhlaWdodCAvIDIsIHNpemUud2lkdGgsIHNpemUuaGVpZ2h0KTtcclxuICAgICAgICB0aGlzLl9jbGVhckdyYXBoaWNzLmZpbGwoKTtcclxuICAgIH1cclxuXHJcbiAgICBwcm90ZWN0ZWQgX3VwZGF0ZUdyYXBoaWNzICgpIHtcclxuICAgICAgICBpZiAoIXRoaXMuX2dyYXBoaWNzKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IG5vZGUgPSB0aGlzLm5vZGU7XHJcbiAgICAgICAgY29uc3QgZ3JhcGhpY3MgPSB0aGlzLl9ncmFwaGljcztcclxuICAgICAgICAvLyBTaGFyZSByZW5kZXIgZGF0YSB3aXRoIGdyYXBoaWNzIGNvbnRlbnRcclxuICAgICAgICBncmFwaGljcy5jbGVhcigpO1xyXG4gICAgICAgIGNvbnN0IHNpemUgPSBub2RlLmdldENvbnRlbnRTaXplKCk7XHJcbiAgICAgICAgY29uc3Qgd2lkdGggPSBzaXplLndpZHRoO1xyXG4gICAgICAgIGNvbnN0IGhlaWdodCA9IHNpemUuaGVpZ2h0O1xyXG4gICAgICAgIGNvbnN0IGFwID0gbm9kZS5nZXRBbmNob3JQb2ludCgpO1xyXG4gICAgICAgIGNvbnN0IHggPSAtd2lkdGggKiBhcC54O1xyXG4gICAgICAgIGNvbnN0IHkgPSAtaGVpZ2h0ICogYXAueTtcclxuICAgICAgICBpZiAodGhpcy5fdHlwZSA9PT0gTWFza1R5cGUuUkVDVCkge1xyXG4gICAgICAgICAgICBncmFwaGljcy5yZWN0KHgsIHksIHdpZHRoLCBoZWlnaHQpO1xyXG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy5fdHlwZSA9PT0gTWFza1R5cGUuRUxMSVBTRSkge1xyXG4gICAgICAgICAgICBjb25zdCBjZW50ZXIgPSBuZXcgVmVjMyh4ICsgd2lkdGggLyAyLCB5ICsgaGVpZ2h0IC8gMiwgMCk7XHJcbiAgICAgICAgICAgIGNvbnN0IHJhZGl1cyA9IG5ldyBWZWMzKHdpZHRoIC8gMiwgaGVpZ2h0IC8gMiwgMCxcclxuICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgY29uc3QgcG9pbnRzID0gX2NhbGN1bGF0ZUNpcmNsZShjZW50ZXIsIHJhZGl1cywgdGhpcy5fc2VnbWVudHMpO1xyXG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHBvaW50cy5sZW5ndGg7ICsraSkge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgcG9pbnQgPSBwb2ludHNbaV07XHJcbiAgICAgICAgICAgICAgICBpZiAoaSA9PT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGdyYXBoaWNzLm1vdmVUbyhwb2ludC54LCBwb2ludC55KTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZ3JhcGhpY3MubGluZVRvKHBvaW50LngsIHBvaW50LnkpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGdyYXBoaWNzLmNsb3NlKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBncmFwaGljcy5maWxsKCk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJvdGVjdGVkIF9lbmFibGVHcmFwaGljcyAoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuX2NsZWFyR3JhcGhpY3MpIHtcclxuICAgICAgICAgICAgdGhpcy5fY2xlYXJHcmFwaGljcy5vbkVuYWJsZSgpO1xyXG4gICAgICAgICAgICB0aGlzLl91cGRhdGVDbGVhckdyYXBoaWNzKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodGhpcy5fZ3JhcGhpY3MpIHtcclxuICAgICAgICAgICAgdGhpcy5fZ3JhcGhpY3Mub25FbmFibGUoKTtcclxuICAgICAgICAgICAgdGhpcy5fdXBkYXRlR3JhcGhpY3MoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJvdGVjdGVkIF9kaXNhYmxlR3JhcGhpY3MgKCkge1xyXG4gICAgICAgIGlmICh0aGlzLl9ncmFwaGljcykge1xyXG4gICAgICAgICAgICB0aGlzLl9ncmFwaGljcy5vbkRpc2FibGUoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh0aGlzLl9jbGVhckdyYXBoaWNzKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX2NsZWFyR3JhcGhpY3Mub25EaXNhYmxlKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByb3RlY3RlZCBfcmVtb3ZlR3JhcGhpY3MgKCkge1xyXG4gICAgICAgIGlmICh0aGlzLl9ncmFwaGljcykge1xyXG4gICAgICAgICAgICB0aGlzLl9ncmFwaGljcy5kZXN0cm95KCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodGhpcy5fY2xlYXJHcmFwaGljcykge1xyXG4gICAgICAgICAgICB0aGlzLl9jbGVhckdyYXBoaWNzLmRlc3Ryb3koKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuXHJcbi8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZVxyXG5jYy5NYXNrQ29tcG9uZW50ID0gTWFza0NvbXBvbmVudDtcclxuIl19