(function (global, factory) {
  if (typeof define === "function" && define.amd) {
    define(["exports", "./js.js", "../default-constants.js"], factory);
  } else if (typeof exports !== "undefined") {
    factory(exports, require("./js.js"), require("../default-constants.js"));
  } else {
    var mod = {
      exports: {}
    };
    factory(mod.exports, global.js, global.defaultConstants);
    global.misc = mod.exports;
  }
})(typeof globalThis !== "undefined" ? globalThis : typeof self !== "undefined" ? self : this, function (_exports, _js, _defaultConstants) {
  "use strict";

  Object.defineProperty(_exports, "__esModule", {
    value: true
  });
  _exports.propertyDefine = propertyDefine;
  _exports.nextPOT = nextPOT;
  _exports.pushToMap = pushToMap;
  _exports.contains = contains;
  _exports.isDomNode = isDomNode;
  _exports.callInNextTick = callInNextTick;
  _exports.tryCatchFunctor_EDITOR = tryCatchFunctor_EDITOR;
  _exports.isPlainEmptyObj_DEV = isPlainEmptyObj_DEV;
  _exports.cloneable_DEV = cloneable_DEV;
  _exports.BASE64_VALUES = _exports.BUILTIN_CLASSID_RE = void 0;

  function _typeof(obj) { "@babel/helpers - typeof"; if (typeof Symbol === "function" && typeof Symbol.iterator === "symbol") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }; } return _typeof(obj); }

  var BUILTIN_CLASSID_RE = /^(?:cc|dragonBones|sp|ccsg)\..+/;
  _exports.BUILTIN_CLASSID_RE = BUILTIN_CLASSID_RE;
  var BASE64_KEYS = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';
  var values = new Array(123); // max char code in base64Keys

  for (var i = 0; i < 123; ++i) {
    values[i] = 64;
  } // fill with placeholder('=') index


  for (var _i = 0; _i < 64; ++_i) {
    values[BASE64_KEYS.charCodeAt(_i)] = _i;
  } // decoded value indexed by base64 char code


  var BASE64_VALUES = values;
  /**
   * misc utilities
   * @class misc
   * @static
   */

  /**
   * @method propertyDefine
   * @param {Function} ctor
   * @param {Array} sameNameGetSets
   * @param {Object} diffNameGetSets
   */

  _exports.BASE64_VALUES = BASE64_VALUES;

  function propertyDefine(ctor, sameNameGetSets, diffNameGetSets) {
    function define(np, propName, getter, setter) {
      var pd = Object.getOwnPropertyDescriptor(np, propName);

      if (pd) {
        if (pd.get) {
          np[getter] = pd.get;
        }

        if (pd.set && setter) {
          np[setter] = pd.set;
        }
      } else {
        var getterFunc = np[getter];

        if (_defaultConstants.DEV && !getterFunc) {
          var clsName = cc.Class._isCCClass(ctor) && (0, _js.getClassName)(ctor) || ctor.name || '(anonymous class)';
          cc.warnID(5700, propName, getter, clsName);
        } else {
          (0, _js.getset)(np, propName, getterFunc, np[setter]);
        }
      }
    }

    var propName,
        np = ctor.prototype;

    for (var _i2 = 0; _i2 < sameNameGetSets.length; _i2++) {
      propName = sameNameGetSets[_i2];
      var suffix = propName[0].toUpperCase() + propName.slice(1);
      define(np, propName, 'get' + suffix, 'set' + suffix);
    }

    for (propName in diffNameGetSets) {
      var gs = diffNameGetSets[propName];
      define(np, propName, gs[0], gs[1]);
    }
  }
  /**
   * @method nextPOT
   * @param {Number} x
   * @return {Number}
   */


  function nextPOT(x) {
    x = x - 1;
    x = x | x >> 1;
    x = x | x >> 2;
    x = x | x >> 4;
    x = x | x >> 8;
    x = x | x >> 16;
    return x + 1;
  } // set value to map, if key exists, push to array


  function pushToMap(map, key, value, pushFront) {
    var exists = map[key];

    if (exists) {
      if (Array.isArray(exists)) {
        if (pushFront) {
          exists.push(exists[0]);
          exists[0] = value;
        } else {
          exists.push(value);
        }
      } else {
        map[key] = pushFront ? [value, exists] : [exists, value];
      }
    } else {
      map[key] = value;
    }
  }

  function contains(refNode, otherNode) {
    if (typeof refNode.contains === 'function') {
      return refNode.contains(otherNode);
    } else if (typeof refNode.compareDocumentPosition === 'function') {
      return !!(refNode.compareDocumentPosition(otherNode) & 16);
    } else {
      var node = otherNode.parentNode;

      if (node) {
        do {
          if (node === refNode) {
            return true;
          } else {
            node = node.parentNode;
          }
        } while (node !== null);
      }

      return false;
    }
  }

  function isDomNode(obj) {
    if ((typeof window === "undefined" ? "undefined" : _typeof(window)) === 'object' && typeof Node === 'function') {
      // If "TypeError: Right-hand side of 'instanceof' is not callback" is thrown,
      // it should because window.Node was overwritten.
      return obj instanceof Node;
    } else {
      return obj && _typeof(obj) === 'object' && typeof obj.nodeType === 'number' && typeof obj.nodeName === 'string';
    }
  }

  function callInNextTick(callback, p1, p2) {
    if (_defaultConstants.EDITOR) {
      if (callback) {
        // @ts-ignore
        process.nextTick(function () {
          callback(p1, p2);
        });
      }
    } else {
      if (callback) {
        setTimeout(function () {
          callback(p1, p2);
        }, 0);
      }
    }
  } // use anonymous function here to ensure it will not being hoisted without EDITOR


  function tryCatchFunctor_EDITOR(funcName) {
    return Function('target', 'try {\n' + '  target.' + funcName + '();\n' + '}\n' + 'catch (e) {\n' + '  cc._throw(e);\n' + '}');
  }

  function isPlainEmptyObj_DEV(obj) {
    if (!obj || obj.constructor !== Object) {
      return false;
    } // jshint ignore: start


    for (var k in obj) {
      return false;
    } // jshint ignore: end


    return true;
  }

  function cloneable_DEV(obj) {
    return obj && typeof obj.clone === 'function' && (obj.constructor && obj.constructor.prototype.hasOwnProperty('clone') || obj.hasOwnProperty('clone'));
  } // if (TEST) {
  //     // editor mocks using in unit tests
  //     if (typeof Editor === 'undefined') {
  //         window.Editor = {
  //             UuidUtils: {
  //                 NonUuidMark: '.',
  //                 uuid () {
  //                     return '' + ((new Date()).getTime() + Math.random());
  //                 },
  //             },
  //         };
  //     }
  // }


  cc.misc = {
    BUILTIN_CLASSID_RE: BUILTIN_CLASSID_RE,
    BASE64_VALUES: BASE64_VALUES,
    propertyDefine: propertyDefine,
    nextPOT: nextPOT,
    pushToMap: pushToMap,
    contains: contains,
    isDomNode: isDomNode,
    callInNextTick: callInNextTick,
    tryCatchFunctor_EDITOR: tryCatchFunctor_EDITOR,
    isPlainEmptyObj_DEV: isPlainEmptyObj_DEV,
    cloneable_DEV: cloneable_DEV
  };
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkY6L2plbmtpbnMvd29ya3NwYWNlL0NyZWF0b3JfM0QvZWRpdG9yLTNkL3Jlc291cmNlcy8zZC9lbmdpbmUvY29jb3MvY29yZS91dGlscy9taXNjLnRzIl0sIm5hbWVzIjpbIkJVSUxUSU5fQ0xBU1NJRF9SRSIsIkJBU0U2NF9LRVlTIiwidmFsdWVzIiwiQXJyYXkiLCJpIiwiY2hhckNvZGVBdCIsIkJBU0U2NF9WQUxVRVMiLCJwcm9wZXJ0eURlZmluZSIsImN0b3IiLCJzYW1lTmFtZUdldFNldHMiLCJkaWZmTmFtZUdldFNldHMiLCJkZWZpbmUiLCJucCIsInByb3BOYW1lIiwiZ2V0dGVyIiwic2V0dGVyIiwicGQiLCJPYmplY3QiLCJnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IiLCJnZXQiLCJzZXQiLCJnZXR0ZXJGdW5jIiwiREVWIiwiY2xzTmFtZSIsImNjIiwiQ2xhc3MiLCJfaXNDQ0NsYXNzIiwibmFtZSIsIndhcm5JRCIsInByb3RvdHlwZSIsImxlbmd0aCIsInN1ZmZpeCIsInRvVXBwZXJDYXNlIiwic2xpY2UiLCJncyIsIm5leHRQT1QiLCJ4IiwicHVzaFRvTWFwIiwibWFwIiwia2V5IiwidmFsdWUiLCJwdXNoRnJvbnQiLCJleGlzdHMiLCJpc0FycmF5IiwicHVzaCIsImNvbnRhaW5zIiwicmVmTm9kZSIsIm90aGVyTm9kZSIsImNvbXBhcmVEb2N1bWVudFBvc2l0aW9uIiwibm9kZSIsInBhcmVudE5vZGUiLCJpc0RvbU5vZGUiLCJvYmoiLCJ3aW5kb3ciLCJOb2RlIiwibm9kZVR5cGUiLCJub2RlTmFtZSIsImNhbGxJbk5leHRUaWNrIiwiY2FsbGJhY2siLCJwMSIsInAyIiwiRURJVE9SIiwicHJvY2VzcyIsIm5leHRUaWNrIiwic2V0VGltZW91dCIsInRyeUNhdGNoRnVuY3Rvcl9FRElUT1IiLCJmdW5jTmFtZSIsIkZ1bmN0aW9uIiwiaXNQbGFpbkVtcHR5T2JqX0RFViIsImNvbnN0cnVjdG9yIiwiayIsImNsb25lYWJsZV9ERVYiLCJjbG9u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QUF4QixFQUE2QjtBQUNoQyxXQUFPQSxHQUFHLElBQ04sT0FBT0EsR0FBRyxDQUFDb0IsS0FBWCxLQUFxQixVQURsQixLQUVEcEIsR0FBRyxDQUFDaUIsV0FBSixJQUFtQmpCLEdBQUcsQ0FBQ2lCLFdBQUosQ0FBZ0J4QyxTQUFoQixDQUEwQjRDLGNBQTFCLENBQXlDLE9BQXpDLENBQXBCLElBQTBFckIsR0FBRyxDQUFDcUIsY0FBSixDQUFtQixPQUFuQixDQUZ4RSxDQUFQO0FBR0gsRyxDQUVEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFFQWpELEVBQUFBLEVBQUUsQ0FBQ2tELElBQUgsR0FBVTtBQUNOMUUsSUFBQUEsa0JBQWtCLEVBQWxCQSxrQkFETTtBQUVOTSxJQUFBQSxhQUFhLEVBQWJBLGFBRk07QUFHTkMsSUFBQUEsY0FBYyxFQUFkQSxjQUhNO0FBSU40QixJQUFBQSxPQUFPLEVBQVBBLE9BSk07QUFLTkUsSUFBQUEsU0FBUyxFQUFUQSxTQUxNO0FBTU5RLElBQUFBLFFBQVEsRUFBUkEsUUFOTTtBQU9OTSxJQUFBQSxTQUFTLEVBQVRBLFNBUE07QUFRTk0sSUFBQUEsY0FBYyxFQUFkQSxjQVJNO0FBU05RLElBQUFBLHNCQUFzQixFQUF0QkEsc0JBVE07QUFVTkcsSUFBQUEsbUJBQW1CLEVBQW5CQSxtQkFWTTtBQVdORyxJQUFBQSxhQUFhLEVBQWJBO0FBWE0sR0FBViIsInNvdXJjZXNDb250ZW50IjpbIi8qXHJcbiBDb3B5cmlnaHQgKGMpIDIwMTMtMjAxNiBDaHVrb25nIFRlY2hub2xvZ2llcyBJbmMuXHJcbiBDb3B5cmlnaHQgKGMpIDIwMTctMjAxOCBYaWFtZW4gWWFqaSBTb2Z0d2FyZSBDby4sIEx0ZC5cclxuXHJcbiBodHRwOi8vd3d3LmNvY29zLmNvbVxyXG5cclxuIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHlcclxuIG9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZW5naW5lIHNvdXJjZSBjb2RlICh0aGUgXCJTb2Z0d2FyZVwiKSwgYSBsaW1pdGVkLFxyXG4gIHdvcmxkd2lkZSwgcm95YWx0eS1mcmVlLCBub24tYXNzaWduYWJsZSwgcmV2b2NhYmxlIGFuZCBub24tZXhjbHVzaXZlIGxpY2Vuc2VcclxuIHRvIHVzZSBDb2NvcyBDcmVhdG9yIHNvbGVseSB0byBkZXZlbG9wIGdhbWVzIG9uIHlvdXIgdGFyZ2V0IHBsYXRmb3Jtcy4gWW91IHNoYWxsXHJcbiAgbm90IHVzZSBDb2NvcyBDcmVhdG9yIHNvZnR3YXJlIGZvciBkZXZlbG9waW5nIG90aGVyIHNvZnR3YXJlIG9yIHRvb2xzIHRoYXQnc1xyXG4gIHVzZWQgZm9yIGRldmVsb3BpbmcgZ2FtZXMuIFlvdSBhcmUgbm90IGdyYW50ZWQgdG8gcHVibGlzaCwgZGlzdHJpYnV0ZSxcclxuICBzdWJsaWNlbnNlLCBhbmQvb3Igc2VsbCBjb3BpZXMgb2YgQ29jb3MgQ3JlYXRvci5cclxuXHJcbiBUaGUgc29mdHdhcmUgb3IgdG9vbHMgaW4gdGhpcyBMaWNlbnNlIEFncmVlbWVudCBhcmUgbGljZW5zZWQsIG5vdCBzb2xkLlxyXG4gWGlhbWVuIFlhamkgU29mdHdhcmUgQ28uLCBMdGQuIHJlc2VydmVzIGFsbCByaWdodHMgbm90IGV4cHJlc3NseSBncmFudGVkIHRvIHlvdS5cclxuXHJcbiBUSEUgU09GVFdBUkUgSVMgUFJPVklERUQgXCJBUyBJU1wiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SXHJcbiBJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSxcclxuIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRVxyXG4gQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUlxyXG4gTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSxcclxuIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU5cclxuIFRIRSBTT0ZUV0FSRS5cclxuKi9cclxuXHJcbiAvLyB0c2xpbnQ6ZGlzYWJsZVxyXG5cclxuaW1wb3J0IHsgZ2V0Q2xhc3NOYW1lLCBnZXRzZXQgfSBmcm9tICcuL2pzJztcclxuaW1wb3J0IHsgRURJVE9SLCBERVYgfSBmcm9tICdpbnRlcm5hbDpjb25zdGFudHMnO1xyXG5cclxuZXhwb3J0IGNvbnN0IEJVSUxUSU5fQ0xBU1NJRF9SRSA9IC9eKD86Y2N8ZHJhZ29uQm9uZXN8c3B8Y2NzZylcXC4uKy87XHJcblxyXG5jb25zdCBCQVNFNjRfS0VZUyA9ICdBQkNERUZHSElKS0xNTk9QUVJTVFVWV1hZWmFiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6MDEyMzQ1Njc4OSsvPSc7XHJcbmNvbnN0IHZhbHVlcyA9IG5ldyBBcnJheSgxMjMpOyAvLyBtYXggY2hhciBjb2RlIGluIGJhc2U2NEtleXNcclxuZm9yIChsZXQgaSA9IDA7IGkgPCAxMjM7ICsraSkgeyB2YWx1ZXNbaV0gPSA2NDsgfSAvLyBmaWxsIHdpdGggcGxhY2Vob2xkZXIoJz0nKSBpbmRleFxyXG5mb3IgKGxldCBpID0gMDsgaSA8IDY0OyArK2kpIHsgdmFsdWVzW0JBU0U2NF9LRVlTLmNoYXJDb2RlQXQoaSldID0gaTsgfVxyXG5cclxuLy8gZGVjb2RlZCB2YWx1ZSBpbmRleGVkIGJ5IGJhc2U2NCBjaGFyIGNvZGVcclxuZXhwb3J0IGNvbnN0IEJBU0U2NF9WQUxVRVMgPSB2YWx1ZXM7XHJcblxyXG4vKipcclxuICogbWlzYyB1dGlsaXRpZXNcclxuICogQGNsYXNzIG1pc2NcclxuICogQHN0YXRpY1xyXG4gKi9cclxuXHJcbi8qKlxyXG4gKiBAbWV0aG9kIHByb3BlcnR5RGVmaW5lXHJcbiAqIEBwYXJhbSB7RnVuY3Rpb259IGN0b3JcclxuICogQHBhcmFtIHtBcnJheX0gc2FtZU5hbWVHZXRTZXRzXHJcbiAqIEBwYXJhbSB7T2JqZWN0fSBkaWZmTmFtZUdldFNldHNcclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiBwcm9wZXJ0eURlZmluZSAoY3Rvciwgc2FtZU5hbWVHZXRTZXRzLCBkaWZmTmFtZUdldFNldHMpIHtcclxuICAgIGZ1bmN0aW9uIGRlZmluZSAobnAsIHByb3BOYW1lLCBnZXR0ZXIsIHNldHRlcikge1xyXG4gICAgICAgIGNvbnN0IHBkID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihucCwgcHJvcE5hbWUpO1xyXG4gICAgICAgIGlmIChwZCkge1xyXG4gICAgICAgICAgICBpZiAocGQuZ2V0KSB7IG5wW2dldHRlcl0gPSBwZC5nZXQ7IH1cclxuICAgICAgICAgICAgaWYgKHBkLnNldCAmJiBzZXR0ZXIpIHsgbnBbc2V0dGVyXSA9IHBkLnNldDsgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgY29uc3QgZ2V0dGVyRnVuYyA9IG5wW2dldHRlcl07XHJcbiAgICAgICAgICAgIGlmIChERVYgJiYgIWdldHRlckZ1bmMpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGNsc05hbWUgPSAoY2MuQ2xhc3MuX2lzQ0NDbGFzcyhjdG9yKSAmJiBnZXRDbGFzc05hbWUoY3RvcikpIHx8XHJcbiAgICAgICAgICAgICAgICAgICAgY3Rvci5uYW1lIHx8XHJcbiAgICAgICAgICAgICAgICAgICAgJyhhbm9ueW1vdXMgY2xhc3MpJztcclxuICAgICAgICAgICAgICAgIGNjLndhcm5JRCg1NzAwLCBwcm9wTmFtZSwgZ2V0dGVyLCBjbHNOYW1lKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGdldHNldChucCwgcHJvcE5hbWUsIGdldHRlckZ1bmMsIG5wW3NldHRlcl0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgbGV0IHByb3BOYW1lLCBucCA9IGN0b3IucHJvdG90eXBlO1xyXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzYW1lTmFtZUdldFNldHMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICBwcm9wTmFtZSA9IHNhbWVOYW1lR2V0U2V0c1tpXTtcclxuICAgICAgICBjb25zdCBzdWZmaXggPSBwcm9wTmFtZVswXS50b1VwcGVyQ2FzZSgpICsgcHJvcE5hbWUuc2xpY2UoMSk7XHJcbiAgICAgICAgZGVmaW5lKG5wLCBwcm9wTmFtZSwgJ2dldCcgKyBzdWZmaXgsICdzZXQnICsgc3VmZml4KTtcclxuICAgIH1cclxuICAgIGZvciAocHJvcE5hbWUgaW4gZGlmZk5hbWVHZXRTZXRzKSB7XHJcbiAgICAgICAgY29uc3QgZ3MgPSBkaWZmTmFtZUdldFNldHNbcHJvcE5hbWVdO1xyXG4gICAgICAgIGRlZmluZShucCwgcHJvcE5hbWUsIGdzWzBdLCBnc1sxXSk7XHJcbiAgICB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBAbWV0aG9kIG5leHRQT1RcclxuICogQHBhcmFtIHtOdW1iZXJ9IHhcclxuICogQHJldHVybiB7TnVtYmVyfVxyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIG5leHRQT1QgKHgpIHtcclxuICAgIHggPSB4IC0gMTtcclxuICAgIHggPSB4IHwgKHggPj4gMSk7XHJcbiAgICB4ID0geCB8ICh4ID4+IDIpO1xyXG4gICAgeCA9IHggfCAoeCA+PiA0KTtcclxuICAgIHggPSB4IHwgKHggPj4gOCk7XHJcbiAgICB4ID0geCB8ICh4ID4+IDE2KTtcclxuICAgIHJldHVybiB4ICsgMTtcclxufVxyXG5cclxuLy8gc2V0IHZhbHVlIHRvIG1hcCwgaWYga2V5IGV4aXN0cywgcHVzaCB0byBhcnJheVxyXG5leHBvcnQgZnVuY3Rpb24gcHVzaFRvTWFwIChtYXAsIGtleSwgdmFsdWUsIHB1c2hGcm9udCkge1xyXG4gICAgY29uc3QgZXhpc3RzID0gbWFwW2tleV07XHJcbiAgICBpZiAoZXhpc3RzKSB7XHJcbiAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoZXhpc3RzKSkge1xyXG4gICAgICAgICAgICBpZiAocHVzaEZyb250KSB7XHJcbiAgICAgICAgICAgICAgICBleGlzdHMucHVzaChleGlzdHNbMF0pO1xyXG4gICAgICAgICAgICAgICAgZXhpc3RzWzBdID0gdmFsdWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBleGlzdHMucHVzaCh2YWx1ZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIG1hcFtrZXldID0gKHB1c2hGcm9udCA/IFt2YWx1ZSwgZXhpc3RzXSA6IFtleGlzdHMsIHZhbHVlXSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgICAgbWFwW2tleV0gPSB2YWx1ZTtcclxuICAgIH1cclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGNvbnRhaW5zIChyZWZOb2RlLCBvdGhlck5vZGUpIHtcclxuICAgIGlmICh0eXBlb2YgcmVmTm9kZS5jb250YWlucyA9PT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICAgIHJldHVybiByZWZOb2RlLmNvbnRhaW5zKG90aGVyTm9kZSk7XHJcbiAgICB9IGVsc2UgaWYgKHR5cGVvZiByZWZOb2RlLmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uID09PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgICAgcmV0dXJuICEhKHJlZk5vZGUuY29tcGFyZURvY3VtZW50UG9zaXRpb24ob3RoZXJOb2RlKSAmIDE2KTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgbGV0IG5vZGUgPSBvdGhlck5vZGUucGFyZW50Tm9kZTtcclxuICAgICAgICBpZiAobm9kZSkge1xyXG4gICAgICAgICAgICBkbyB7XHJcbiAgICAgICAgICAgICAgICBpZiAobm9kZSA9PT0gcmVmTm9kZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBub2RlID0gbm9kZS5wYXJlbnROb2RlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9IHdoaWxlIChub2RlICE9PSBudWxsKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gaXNEb21Ob2RlIChvYmopIHtcclxuICAgIGlmICh0eXBlb2Ygd2luZG93ID09PSAnb2JqZWN0JyAmJiB0eXBlb2YgTm9kZSA9PT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICAgIC8vIElmIFwiVHlwZUVycm9yOiBSaWdodC1oYW5kIHNpZGUgb2YgJ2luc3RhbmNlb2YnIGlzIG5vdCBjYWxsYmFja1wiIGlzIHRocm93bixcclxuICAgICAgICAvLyBpdCBzaG91bGQgYmVjYXVzZSB3aW5kb3cuTm9kZSB3YXMgb3ZlcndyaXR0ZW4uXHJcbiAgICAgICAgcmV0dXJuIG9iaiBpbnN0YW5jZW9mIE5vZGU7XHJcbiAgICB9XHJcbiAgICBlbHNlIHtcclxuICAgICAgICByZXR1cm4gb2JqICYmXHJcbiAgICAgICAgICAgIHR5cGVvZiBvYmogPT09ICdvYmplY3QnICYmXHJcbiAgICAgICAgICAgIHR5cGVvZiBvYmoubm9kZVR5cGUgPT09ICdudW1iZXInICYmXHJcbiAgICAgICAgICAgIHR5cGVvZiBvYmoubm9kZU5hbWUgPT09ICdzdHJpbmcnO1xyXG4gICAgfVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gY2FsbEluTmV4dFRpY2sgKGNhbGxiYWNrLCBwMT86IGFueSwgcDI/OiBhbnkpIHtcclxuICAgIGlmIChFRElUT1IpIHtcclxuICAgICAgICBpZiAoY2FsbGJhY2spIHtcclxuICAgICAgICAgICAgLy8gQHRzLWlnbm9yZVxyXG4gICAgICAgICAgICBwcm9jZXNzLm5leHRUaWNrKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIGNhbGxiYWNrKHAxLCBwMik7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICAgIGlmIChjYWxsYmFjaykge1xyXG4gICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIGNhbGxiYWNrKHAxLCBwMik7XHJcbiAgICAgICAgICAgIH0sIDApO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG5cclxuLy8gdXNlIGFub255bW91cyBmdW5jdGlvbiBoZXJlIHRvIGVuc3VyZSBpdCB3aWxsIG5vdCBiZWluZyBob2lzdGVkIHdpdGhvdXQgRURJVE9SXHJcbmV4cG9ydCBmdW5jdGlvbiB0cnlDYXRjaEZ1bmN0b3JfRURJVE9SIChmdW5jTmFtZSkge1xyXG4gICAgcmV0dXJuIEZ1bmN0aW9uKCd0YXJnZXQnLFxyXG4gICAgICAgICd0cnkge1xcbicgK1xyXG4gICAgICAgICcgIHRhcmdldC4nICsgZnVuY05hbWUgKyAnKCk7XFxuJyArXHJcbiAgICAgICAgJ31cXG4nICtcclxuICAgICAgICAnY2F0Y2ggKGUpIHtcXG4nICtcclxuICAgICAgICAnICBjYy5fdGhyb3coZSk7XFxuJyArXHJcbiAgICAgICAgJ30nKTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGlzUGxhaW5FbXB0eU9ial9ERVYgKG9iaikge1xyXG4gICAgaWYgKCFvYmogfHwgb2JqLmNvbnN0cnVjdG9yICE9PSBPYmplY3QpIHtcclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcbiAgICAvLyBqc2hpbnQgaWdub3JlOiBzdGFydFxyXG4gICAgZm9yIChjb25zdCBrIGluIG9iaikge1xyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuICAgIC8vIGpzaGludCBpZ25vcmU6IGVuZFxyXG4gICAgcmV0dXJuIHRydWU7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBjbG9uZWFibGVfREVWIChvYmopIHtcclxuICAgIHJldHVybiBvYmogJiZcclxuICAgICAgICB0eXBlb2Ygb2JqLmNsb25lID09PSAnZnVuY3Rpb24nICYmXHJcbiAgICAgICAgKChvYmouY29uc3RydWN0b3IgJiYgb2JqLmNvbnN0cnVjdG9yLnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eSgnY2xvbmUnKSkgfHwgb2JqLmhhc093blByb3BlcnR5KCdjbG9uZScpKTtcclxufVxyXG5cclxuLy8gaWYgKFRFU1QpIHtcclxuLy8gICAgIC8vIGVkaXRvciBtb2NrcyB1c2luZyBpbiB1bml0IHRlc3RzXHJcbi8vICAgICBpZiAodHlwZW9mIEVkaXRvciA9PT0gJ3VuZGVmaW5lZCcpIHtcclxuLy8gICAgICAgICB3aW5kb3cuRWRpdG9yID0ge1xyXG4vLyAgICAgICAgICAgICBVdWlkVXRpbHM6IHtcclxuLy8gICAgICAgICAgICAgICAgIE5vblV1aWRNYXJrOiAnLicsXHJcbi8vICAgICAgICAgICAgICAgICB1dWlkICgpIHtcclxuLy8gICAgICAgICAgICAgICAgICAgICByZXR1cm4gJycgKyAoKG5ldyBEYXRlKCkpLmdldFRpbWUoKSArIE1hdGgucmFuZG9tKCkpO1xyXG4vLyAgICAgICAgICAgICAgICAgfSxcclxuLy8gICAgICAgICAgICAgfSxcclxuLy8gICAgICAgICB9O1xyXG4vLyAgICAgfVxyXG4vLyB9XHJcblxyXG5jYy5taXNjID0ge1xyXG4gICAgQlVJTFRJTl9DTEFTU0lEX1JFLFxyXG4gICAgQkFTRTY0X1ZBTFVFUyxcclxuICAgIHByb3BlcnR5RGVmaW5lLFxyXG4gICAgbmV4dFBPVCxcclxuICAgIHB1c2hUb01hcCxcclxuICAgIGNvbnRhaW5zLFxyXG4gICAgaXNEb21Ob2RlLFxyXG4gICAgY2FsbEluTmV4dFRpY2ssXHJcbiAgICB0cnlDYXRjaEZ1bmN0b3JfRURJVE9SLFxyXG4gICAgaXNQbGFpbkVtcHR5T2JqX0RFVixcclxuICAgIGNsb25lYWJsZV9ERVYsXHJcbn07XHJcbiJdfQ==