(function (global, factory) {
  if (typeof define === "function" && define.amd) {
    define(["exports", "../data/class-decorator.js", "../gfx/define.js", "./image-asset.js", "./simple-texture.js"], factory);
  } else if (typeof exports !== "undefined") {
    factory(exports, require("../data/class-decorator.js"), require("../gfx/define.js"), require("./image-asset.js"), require("./simple-texture.js"));
  } else {
    var mod = {
      exports: {}
    };
    factory(mod.exports, global.classDecorator, global.define, global.imageAsset, global.simpleTexture);
    global.textureCube = mod.exports;
  }
})(typeof globalThis !== "undefined" ? globalThis : typeof self !== "undefined" ? self : this, function (_exports, _classDecorator, _define, _imageAsset, _simpleTexture) {
  "use strict";

  Object.defineProperty(_exports, "__esModule", {
    value: true
  });
  _exports.TextureCube = void 0;

  var _dec, _class, _class2, _descriptor, _class3, _temp;

  function _typeof(obj) { "@babel/helpers - typeof"; if (typeof Symbol === "function" && typeof Symbol.iterator === "symbol") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }; } return _typeof(obj); }

  function _initializerDefineProperty(target, property, descriptor, context) { if (!descriptor) return; Object.defineProperty(target, property, { enumerable: descriptor.enumerable, configurable: descriptor.configurable, writable: descriptor.writable, value: descriptor.initializer ? descriptor.initializer.call(context) : void 0 }); }

  function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

  function _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === "object" || typeof call === "function")) { return call; } return _assertThisInitialized(self); }

  function _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return self; }

  function _get(target, property, receiver) { if (typeof Reflect !== "undefined" && Reflect.get) { _get = Reflect.get; } else { _get = function _get(target, property, receiver) { var base = _superPropBase(target, property); if (!base) return; var desc = Object.getOwnPropertyDescriptor(base, property); if (desc.get) { return desc.get.call(receiver); } return desc.value; }; } return _get(target, property, receiver || target); }

  function _superPropBase(object, property) { while (!Object.prototype.hasOwnProperty.call(object, property)) { object = _getPrototypeOf(object); if (object === null) break; } return object; }

  function _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }

  function _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }

  function _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }

  function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); if (superClass) _setPrototypeOf(subClass, superClass); }

  function _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }

  function _applyDecoratedDescriptor(target, property, decorators, descriptor, context) { var desc = {}; Object.keys(descriptor).forEach(function (key) { desc[key] = descriptor[key]; }); desc.enumerable = !!desc.enumerable; desc.configurable = !!desc.configurable; if ('value' in desc || desc.initializer) { desc.writable = true; } desc = decorators.slice().reverse().reduce(function (desc, decorator) { return decorator(target, property, desc) || desc; }, desc); if (context && desc.initializer !== void 0) { desc.value = desc.initializer ? desc.initializer.call(context) : void 0; desc.initializer = undefined; } if (desc.initializer === void 0) { Object.defineProperty(target, property, desc); desc = null; } return desc; }

  function _initializerWarningHelper(descriptor, context) { throw new Error('Decorating class property failed. Please ensure that ' + 'proposal-class-properties is enabled and runs after the decorators transform.'); }

  /**
   * 立方体每个面的约定索引。
   */
  var FaceIndex;
  /**
   * 立方体贴图资源。
   * 立方体贴图资源的每个 Mipmap 层级都为 6 张图像资源，分别代表了立方体贴图的 6 个面。
   */

  (function (FaceIndex) {
    FaceIndex[FaceIndex["right"] = 0] = "right";
    FaceIndex[FaceIndex["left"] = 1] = "left";
    FaceIndex[FaceIndex["top"] = 2] = "top";
    FaceIndex[FaceIndex["bottom"] = 3] = "bottom";
    FaceIndex[FaceIndex["front"] = 4] = "front";
    FaceIndex[FaceIndex["back"] = 5] = "back";
  })(FaceIndex || (FaceIndex = {}));

  var TextureCube = (_dec = (0, _classDecorator.ccclass)('cc.TextureCube'), _dec(_class = (_class2 = (_temp = _class3 = /*#__PURE__*/function (_SimpleTexture) {
    _inherits(TextureCube, _SimpleTexture);

    _createClass(TextureCube, [{
      key: "mipmaps",

      /**
       * 所有层级 Mipmap，注意，这里不包含自动生成的 Mipmap。
       * 当设置 Mipmap 时，贴图的尺寸以及像素格式可能会改变。
       */
      get: function get() {
        return this._mipmaps;
      },
      set: function set(value) {
        var _this2 = this;

        this._mipmaps = value;

        this._setMipmapLevel(this._mipmaps.length);

        if (this._mipmaps.length > 0) {
          var imageAsset = this._mipmaps[0].front;
          this.reset({
            width: imageAsset.width,
            height: imageAsset.height,
            format: imageAsset.format,
            mipmapLevel: this._mipmaps.length
          });

          this._mipmaps.forEach(function (mipmap, level) {
            _forEachFace(mipmap, function (face, faceIndex) {
              _this2._assignImage(face, level, faceIndex);
            });
          });
        } else {
          this.reset({
            width: 0,
            height: 0,
            mipmapLevel: this._mipmaps.length
          });
        }
      }
      /**
       * 0 级 Mipmap。<br>
       * 注意，`this.image = i` 等价于 `this.mipmaps = [i]`，
       * 也就是说，通过 `this.image` 设置 0 级 Mipmap 时将隐式地清除之前的所有 Mipmap。
       */

    }, {
      key: "image",
      get: function get() {
        return this._mipmaps.length === 0 ? null : this._mipmaps[0];
      },
      set: function set(value) {
        this.mipmaps = value ? [value] : [];
      }
      /**
       * 通过二维贴图指定每个 Mipmap 的每个面创建立方体贴图。
       * @param textures 数组长度必须是6的倍数。
       * 每 6 个二维贴图依次构成立方体贴图的 Mipmap。6 个面应该按 `FaceIndex` 规定顺序排列。
       * @param out 出口立方体贴图，若未定义则将创建为新的立方体贴图。
       * @returns `out`
       * @example
       * ```typescript
       * const textures = new Array<Texture2D>(6);
       * textures[TextureCube.FaceIndex.front] = frontImage;
       * textures[TextureCube.FaceIndex.back] = backImage;
       * textures[TextureCube.FaceIndex.left] = leftImage;
       * textures[TextureCube.FaceIndex.right] = rightImage;
       * textures[TextureCube.FaceIndex.top] = topImage;
       * textures[TextureCube.FaceIndex.bottom] = bottomImage;
       * const textureCube = TextureCube.fromTexture2DArray(textures);
       * ```
       */

    }], [{
      key: "fromTexture2DArray",
      value: function fromTexture2DArray(textures, out) {
        var mipmaps = [];
        var nMipmaps = textures.length / 6;

        for (var i = 0; i < nMipmaps; i++) {
          var x = i * 6;
          mipmaps.push({
            front: textures[x + FaceIndex.front].image,
            back: textures[x + FaceIndex.back].image,
            left: textures[x + FaceIndex.left].image,
            right: textures[x + FaceIndex.right].image,
            top: textures[x + FaceIndex.top].image,
            bottom: textures[x + FaceIndex.bottom].image
          });
        }

        out = out || new TextureCube();
        out.mipmaps = mipmaps;
        return out;
      }
    }]);

    function TextureCube() {
      var _this;

      _classCallCheck(this, TextureCube);

      _this = _possibleConstructorReturn(this, _getPrototypeOf(TextureCube).call(this));

      _initializerDefineProperty(_this, "_mipmaps", _descriptor, _assertThisInitialized(_this));

      return _this;
    }

    _createClass(TextureCube, [{
      key: "onLoaded",
      value: function onLoaded() {
        this.mipmaps = this._mipmaps;
        this.loaded = true;
        this.emit('load');
      }
      /**
       * 将当前贴图重置为指定尺寸、像素格式以及指定 mipmap 层级。重置后，贴图的像素数据将变为未定义。
       * mipmap 图像的数据不会自动更新到贴图中，你必须显式调用 `this.uploadData` 来上传贴图数据。
       * @param info 贴图重置选项。
       */

    }, {
      key: "reset",
      value: function reset(info) {
        this._width = info.width;
        this._height = info.height;

        this._setGFXFormat(info.format);

        this._setMipmapLevel(info.mipmapLevel || 1);

        this._tryReset();
      }
    }, {
      key: "updateMipmaps",
      value: function updateMipmaps() {
        var _this3 = this;

        var firstLevel = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 0;
        var count = arguments.length > 1 ? arguments[1] : undefined;

        if (firstLevel >= this._mipmaps.length) {
          return;
        }

        var nUpdate = Math.min(count === undefined ? this._mipmaps.length : count, this._mipmaps.length - firstLevel);

        var _loop = function _loop(i) {
          var level = firstLevel + i;

          _forEachFace(_this3._mipmaps[level], function (face, faceIndex) {
            _this3._assignImage(face, level, faceIndex);
          });
        };

        for (var i = 0; i < nUpdate; ++i) {
          _loop(i);
        }
      }
      /**
       * 销毁此贴图，清空所有 Mipmap 并释放占用的 GPU 资源。
       */

    }, {
      key: "destroy",
      value: function destroy() {
        this._mipmaps = [];
        return _get(_getPrototypeOf(TextureCube.prototype), "destroy", this).call(this);
      }
      /**
       * 释放占用的 GPU 资源。
       * @deprecated 请转用 `this.destroy()`。
       */

    }, {
      key: "releaseTexture",
      value: function releaseTexture() {
        this.mipmaps = [];
      }
    }, {
      key: "_serialize",
      value: function _serialize(exporting) {
        return {
          base: _get(_getPrototypeOf(TextureCube.prototype), "_serialize", this).call(this),
          mipmaps: this._mipmaps.map(function (mipmap) {
            return exporting ? {
              front: EditorExtends.UuidUtils.compressUuid(mipmap.front._uuid, true),
              back: EditorExtends.UuidUtils.compressUuid(mipmap.back._uuid, true),
              left: EditorExtends.UuidUtils.compressUuid(mipmap.left._uuid, true),
              right: EditorExtends.UuidUtils.compressUuid(mipmap.right._uuid, true),
              top: EditorExtends.UuidUtils.compressUuid(mipmap.top._uuid, true),
              bottom: EditorExtends.UuidUtils.compressUuid(mipmap.bottom._uuid, true)
            } : {
              front: mipmap.front._uuid,
              back: mipmap.back._uuid,
              left: mipmap.left._uuid,
              right: mipmap.right._uuid,
              top: mipmap.top._uuid,
              bottom: mipmap.bottom._uuid
            };
          })
        };
      }
    }, {
      key: "_deserialize",
      value: function _deserialize(serializedData, handle) {
        var data = serializedData;

        _get(_getPrototypeOf(TextureCube.prototype), "_deserialize", this).call(this, data.base, handle);

        this._mipmaps = new Array(data.mipmaps.length);

        for (var i = 0; i < data.mipmaps.length; ++i) {
          // Prevent resource load failed
          this._mipmaps[i] = {
            front: new _imageAsset.ImageAsset(),
            back: new _imageAsset.ImageAsset(),
            left: new _imageAsset.ImageAsset(),
            right: new _imageAsset.ImageAsset(),
            top: new _imageAsset.ImageAsset(),
            bottom: new _imageAsset.ImageAsset()
          };
          var mipmap = data.mipmaps[i];
          handle.result.push(this._mipmaps[i], "front", mipmap.front);
          handle.result.push(this._mipmaps[i], "back", mipmap.back);
          handle.result.push(this._mipmaps[i], "left", mipmap.left);
          handle.result.push(this._mipmaps[i], "right", mipmap.right);
          handle.result.push(this._mipmaps[i], "top", mipmap.top);
          handle.result.push(this._mipmaps[i], "bottom", mipmap.bottom);
        }
      }
    }, {
      key: "_getGfxTextureCreateInfo",
      value: function _getGfxTextureCreateInfo(presumed) {
        var result = Object.assign({
          type: _define.GFXTextureType.TEX2D,
          width: this._width,
          height: this._height,
          arrayLayer: 6
        }, presumed);
        result.flags = (result.flags || 0) | _define.GFXTextureFlagBit.CUBEMAP;
        return result;
      }
    }, {
      key: "_getGfxTextureViewCreateInfo",
      value: function _getGfxTextureViewCreateInfo(presumed) {
        return Object.assign({
          type: _define.GFXTextureViewType.CUBE,
          layerCount: 6
        }, presumed);
      }
    }]);

    return TextureCube;
  }(_simpleTexture.SimpleTexture), _class3.FaceIndex = FaceIndex, _temp), (_descriptor = _applyDecoratedDescriptor(_class2.prototype, "_mipmaps", [_classDecorator.property], {
    configurable: true,
    enumerable: true,
    writable: true,
    initializer: function initializer() {
      return [];
    }
  })), _class2)) || _class);
  _exports.TextureCube = TextureCube;
  cc.TextureCube = TextureCube;

  /**
   * @param {Mipmap} mipmap
   * @param {(face: ImageAsset) => void} callback
   */
  function _forEachFace(mipmap, callback) {
    callback(mipmap.front, FaceIndex.front);
    callback(mipmap.back, FaceIndex.back);
    callback(mipmap.left, FaceIndex.left);
    callback(mipmap.right, FaceIndex.right);
    callback(mipmap.top, FaceIndex.top);
    callback(mipmap.bottom, FaceIndex.bottom);
  }
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkY6L2plbmtpbnMvd29ya3NwYWNlL0NyZWF0b3JfM0QvZWRpdG9yLTNkL3Jlc291cmNlcy8zZC9lbmdpbmUvY29jb3MvY29yZS9hc3NldHMvdGV4dHVyZS1jdWJlLnRzIl0sIm5hbWVzIjpbIkZhY2VJbmRleCIsIlRleHR1cmVDdWJlIiwiX21pcG1hcHMiLCJ2YWx1ZSIsIl9zZXRNaXBtYXBMZXZlbCIsImxlbmd0aCIsImltYWdlQXNzZXQiLCJmcm9udCIsInJlc2V0Iiwid2lkdGgiLCJoZWlnaHQiLCJmb3JtYXQiLCJtaXBtYXBMZXZlbCIsImZvckVhY2giLCJtaXBtYXAiLCJsZXZlbCIsIl9mb3JFYWNoRmFjZSIsImZhY2UiLCJmYWNlSW5kZXgiLCJfYXNzaWduSW1hZ2UiLCJtaXBtYXBzIiwidGV4dHVyZXMiLCJvdXQiLCJuTWlwbWFwcyIsImkiLCJ4IiwicHVzaCIsImltYWdlIiwiYmFjayIsImxlZnQiLCJyaWdodCIsInRvcCIsImJvdHRvbSIsImxvYWRlZCIsImVtaXQiLCJpbmZvIiwiX3dpZHRoIiwiX2hlaWdodCIsIl9zZXRHRlhGb3JtYXQiLCJfdHJ5UmVzZXQiLCJmaXJzdExldmVsIiwiY291bnQiLCJuVXBkYXRlIiwiTWF0aCIsIm1pbiIsInVuZGVmaW5lZCIsImV4cG9ydGluZyIsImJhc2UiLCJtYXAiLCJFZGl0b3JFeHRlbmRzIiwiVXVpZFV0aWxzIiwiY29tcHJlc3NVdWlkIiwiX3V1aWQiLCJzZXJpYWxpemVkRGF0YSIsImhhbmRsZSIsImRhdGEiLCJBcnJheSIsIkltYWdlQXNzZXQiLCJyZXN1bHQiLCJwcmVzdW1lZCIsIk9iamVjdCIsImFzc2lnbiIsInR5cGUiLCJHRlhUZXh0dXJlVHlwZSIsIlRFWDJEIiwiYXJyYXlMYXllciIsImZsYWdzIiwiR0ZYVGV4dHVyZUZsYWdCaXQiLCJDVUJFTUFQIiwiR0ZYVGV4dHVyZVZpZXdUeXBlIiwiQ1VCRSIsImxheWVyQ291bnQiLCJTaW1wbGVUZXh0dXJlIiwicHJvcGVydHkiLCJjYyIsImNh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QSxXQUFTZSxZQUFULENBQXVCRixNQUF2QixFQUFtRDZELFFBQW5ELEVBQTRHO0FBQ3hHQSxJQUFBQSxRQUFRLENBQUM3RCxNQUFNLENBQUNQLEtBQVIsRUFBZVAsU0FBUyxDQUFDTyxLQUF6QixDQUFSO0FBQ0FvRSxJQUFBQSxRQUFRLENBQUM3RCxNQUFNLENBQUNjLElBQVIsRUFBYzVCLFNBQVMsQ0FBQzRCLElBQXhCLENBQVI7QUFDQStDLElBQUFBLFFBQVEsQ0FBQzdELE1BQU0sQ0FBQ2UsSUFBUixFQUFjN0IsU0FBUyxDQUFDNkIsSUFBeEIsQ0FBUjtBQUNBOEMsSUFBQUEsUUFBUSxDQUFDN0QsTUFBTSxDQUFDZ0IsS0FBUixFQUFlOUIsU0FBUyxDQUFDOEIsS0FBekIsQ0FBUjtBQUNBNkMsSUFBQUEsUUFBUSxDQUFDN0QsTUFBTSxDQUFDaUIsR0FBUixFQUFhL0IsU0FBUyxDQUFDK0IsR0FBdkIsQ0FBUjtBQUNBNEMsSUFBQUEsUUFBUSxDQUFDN0QsTUFBTSxDQUFDa0IsTUFBUixFQUFnQmhDLFNBQVMsQ0FBQ2dDLE1BQTFCLENBQVI7QUFDSCIsInNvdXJjZXNDb250ZW50IjpbIi8qXHJcbiBDb3B5cmlnaHQgKGMpIDIwMTctMjAxOCBYaWFtZW4gWWFqaSBTb2Z0d2FyZSBDby4sIEx0ZC5cclxuXHJcbiBodHRwOi8vd3d3LmNvY29zLmNvbVxyXG5cclxuIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHlcclxuIG9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZW5naW5lIHNvdXJjZSBjb2RlICh0aGUgXCJTb2Z0d2FyZVwiKSwgYSBsaW1pdGVkLFxyXG4gIHdvcmxkd2lkZSwgcm95YWx0eS1mcmVlLCBub24tYXNzaWduYWJsZSwgcmV2b2NhYmxlIGFuZCBub24tZXhjbHVzaXZlIGxpY2Vuc2VcclxuIHRvIHVzZSBDb2NvcyBDcmVhdG9yIHNvbGVseSB0byBkZXZlbG9wIGdhbWVzIG9uIHlvdXIgdGFyZ2V0IHBsYXRmb3Jtcy4gWW91IHNoYWxsXHJcbiAgbm90IHVzZSBDb2NvcyBDcmVhdG9yIHNvZnR3YXJlIGZvciBkZXZlbG9waW5nIG90aGVyIHNvZnR3YXJlIG9yIHRvb2xzIHRoYXQnc1xyXG4gIHVzZWQgZm9yIGRldmVsb3BpbmcgZ2FtZXMuIFlvdSBhcmUgbm90IGdyYW50ZWQgdG8gcHVibGlzaCwgZGlzdHJpYnV0ZSxcclxuICBzdWJsaWNlbnNlLCBhbmQvb3Igc2VsbCBjb3BpZXMgb2YgQ29jb3MgQ3JlYXRvci5cclxuXHJcbiBUaGUgc29mdHdhcmUgb3IgdG9vbHMgaW4gdGhpcyBMaWNlbnNlIEFncmVlbWVudCBhcmUgbGljZW5zZWQsIG5vdCBzb2xkLlxyXG4gWGlhbWVuIFlhamkgU29mdHdhcmUgQ28uLCBMdGQuIHJlc2VydmVzIGFsbCByaWdodHMgbm90IGV4cHJlc3NseSBncmFudGVkIHRvIHlvdS5cclxuXHJcbiBUSEUgU09GVFdBUkUgSVMgUFJPVklERUQgXCJBUyBJU1wiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SXHJcbiBJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSxcclxuIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRVxyXG4gQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUlxyXG4gTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSxcclxuIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU5cclxuIFRIRSBTT0ZUV0FSRS5cclxuKi9cclxuXHJcbi8qKlxyXG4gKiBAY2F0ZWdvcnkgYXNzZXRcclxuICovXHJcblxyXG5pbXBvcnQgeyBjY2NsYXNzLCBwcm9wZXJ0eSB9IGZyb20gJy4uL2RhdGEvY2xhc3MtZGVjb3JhdG9yJztcclxuaW1wb3J0IHsgR0ZYVGV4dHVyZUZsYWdCaXQsIEdGWFRleHR1cmVUeXBlLCBHRlhUZXh0dXJlVmlld1R5cGUgfSBmcm9tICcuLi9nZngvZGVmaW5lJztcclxuaW1wb3J0IHsgSW1hZ2VBc3NldCB9IGZyb20gJy4vaW1hZ2UtYXNzZXQnO1xyXG5pbXBvcnQgeyBQcmVzdW1lZEdGWFRleHR1cmVJbmZvLCBQcmVzdW1lZEdGWFRleHR1cmVWaWV3SW5mbywgU2ltcGxlVGV4dHVyZSB9IGZyb20gJy4vc2ltcGxlLXRleHR1cmUnO1xyXG5pbXBvcnQgeyBJVGV4dHVyZTJEQ3JlYXRlSW5mbywgVGV4dHVyZTJEIH0gZnJvbSAnLi90ZXh0dXJlLTJkJztcclxuXHJcbmV4cG9ydCB0eXBlIElUZXh0dXJlQ3ViZUNyZWF0ZUluZm8gPSBJVGV4dHVyZTJEQ3JlYXRlSW5mbztcclxuXHJcbi8qKlxyXG4gKiDnq4vmlrnkvZPotLTlm77nmoQgTWlwbWFw44CCXHJcbiAqL1xyXG5pbnRlcmZhY2UgSVRleHR1cmVDdWJlTWlwbWFwIHtcclxuICAgIGZyb250OiBJbWFnZUFzc2V0O1xyXG4gICAgYmFjazogSW1hZ2VBc3NldDtcclxuICAgIGxlZnQ6IEltYWdlQXNzZXQ7XHJcbiAgICByaWdodDogSW1hZ2VBc3NldDtcclxuICAgIHRvcDogSW1hZ2VBc3NldDtcclxuICAgIGJvdHRvbTogSW1hZ2VBc3NldDtcclxufVxyXG5cclxuLyoqXHJcbiAqIOeri+aWueS9k+avj+S4qumdoueahOe6puWumue0ouW8leOAglxyXG4gKi9cclxuZW51bSBGYWNlSW5kZXgge1xyXG4gICAgcmlnaHQgPSAwLFxyXG4gICAgbGVmdCA9IDEsXHJcbiAgICB0b3AgPSAyLFxyXG4gICAgYm90dG9tID0gMyxcclxuICAgIGZyb250ID0gNCxcclxuICAgIGJhY2sgPSA1LFxyXG59XHJcblxyXG4vKipcclxuICog56uL5pa55L2T6LS05Zu+6LWE5rqQ44CCXHJcbiAqIOeri+aWueS9k+i0tOWbvui1hOa6kOeahOavj+S4qiBNaXBtYXAg5bGC57qn6YO95Li6IDYg5byg5Zu+5YOP6LWE5rqQ77yM5YiG5Yir5Luj6KGo5LqG56uL5pa55L2T6LS05Zu+55qEIDYg5Liq6Z2i44CCXHJcbiAqL1xyXG5AY2NjbGFzcygnY2MuVGV4dHVyZUN1YmUnKVxyXG5leHBvcnQgY2xhc3MgVGV4dHVyZUN1YmUgZXh0ZW5kcyBTaW1wbGVUZXh0dXJlIHtcclxuICAgIHB1YmxpYyBzdGF0aWMgRmFjZUluZGV4ID0gRmFjZUluZGV4O1xyXG5cclxuICAgIC8qKlxyXG4gICAgICog5omA5pyJ5bGC57qnIE1pcG1hcO+8jOazqOaEj++8jOi/memHjOS4jeWMheWQq+iHquWKqOeUn+aIkOeahCBNaXBtYXDjgIJcclxuICAgICAqIOW9k+iuvue9riBNaXBtYXAg5pe277yM6LS05Zu+55qE5bC65a+45Lul5Y+K5YOP57Sg5qC85byP5Y+v6IO95Lya5pS55Y+Y44CCXHJcbiAgICAgKi9cclxuICAgIGdldCBtaXBtYXBzICgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fbWlwbWFwcztcclxuICAgIH1cclxuXHJcbiAgICBzZXQgbWlwbWFwcyAodmFsdWUpIHtcclxuICAgICAgICB0aGlzLl9taXBtYXBzID0gdmFsdWU7XHJcbiAgICAgICAgdGhpcy5fc2V0TWlwbWFwTGV2ZWwodGhpcy5fbWlwbWFwcy5sZW5ndGgpO1xyXG4gICAgICAgIGlmICh0aGlzLl9taXBtYXBzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgY29uc3QgaW1hZ2VBc3NldDogSW1hZ2VBc3NldCA9IHRoaXMuX21pcG1hcHNbMF0uZnJvbnQ7XHJcbiAgICAgICAgICAgIHRoaXMucmVzZXQoe1xyXG4gICAgICAgICAgICAgICAgd2lkdGg6IGltYWdlQXNzZXQud2lkdGgsXHJcbiAgICAgICAgICAgICAgICBoZWlnaHQ6IGltYWdlQXNzZXQuaGVpZ2h0LFxyXG4gICAgICAgICAgICAgICAgZm9ybWF0OiBpbWFnZUFzc2V0LmZvcm1hdCxcclxuICAgICAgICAgICAgICAgIG1pcG1hcExldmVsOiB0aGlzLl9taXBtYXBzLmxlbmd0aCxcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHRoaXMuX21pcG1hcHMuZm9yRWFjaCgobWlwbWFwLCBsZXZlbCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgX2ZvckVhY2hGYWNlKG1pcG1hcCwgKGZhY2UsIGZhY2VJbmRleCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2Fzc2lnbkltYWdlKGZhY2UsIGxldmVsLCBmYWNlSW5kZXgpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMucmVzZXQoe1xyXG4gICAgICAgICAgICAgICAgd2lkdGg6IDAsXHJcbiAgICAgICAgICAgICAgICBoZWlnaHQ6IDAsXHJcbiAgICAgICAgICAgICAgICBtaXBtYXBMZXZlbDogdGhpcy5fbWlwbWFwcy5sZW5ndGgsXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIDAg57qnIE1pcG1hcOOAgjxicj5cclxuICAgICAqIOazqOaEj++8jGB0aGlzLmltYWdlID0gaWAg562J5Lu35LqOIGB0aGlzLm1pcG1hcHMgPSBbaV1g77yMXHJcbiAgICAgKiDkuZ/lsLHmmK/or7TvvIzpgJrov4cgYHRoaXMuaW1hZ2VgIOiuvue9riAwIOe6pyBNaXBtYXAg5pe25bCG6ZqQ5byP5Zyw5riF6Zmk5LmL5YmN55qE5omA5pyJIE1pcG1hcOOAglxyXG4gICAgICovXHJcbiAgICBnZXQgaW1hZ2UgKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9taXBtYXBzLmxlbmd0aCA9PT0gMCA/IG51bGwgOiB0aGlzLl9taXBtYXBzWzBdO1xyXG4gICAgfVxyXG5cclxuICAgIHNldCBpbWFnZSAodmFsdWUpIHtcclxuICAgICAgICB0aGlzLm1pcG1hcHMgPSB2YWx1ZSA/IFt2YWx1ZV0gOiBbXTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOmAmui/h+S6jOe7tOi0tOWbvuaMh+Wumuavj+S4qiBNaXBtYXAg55qE5q+P5Liq6Z2i5Yib5bu656uL5pa55L2T6LS05Zu+44CCXHJcbiAgICAgKiBAcGFyYW0gdGV4dHVyZXMg5pWw57uE6ZW/5bqm5b+F6aG75pivNueahOWAjeaVsOOAglxyXG4gICAgICog5q+PIDYg5Liq5LqM57u06LS05Zu+5L6d5qyh5p6E5oiQ56uL5pa55L2T6LS05Zu+55qEIE1pcG1hcOOAgjYg5Liq6Z2i5bqU6K+l5oyJIGBGYWNlSW5kZXhgIOinhOWumumhuuW6j+aOkuWIl+OAglxyXG4gICAgICogQHBhcmFtIG91dCDlh7rlj6Pnq4vmlrnkvZPotLTlm77vvIzoi6XmnKrlrprkuYnliJnlsIbliJvlu7rkuLrmlrDnmoTnq4vmlrnkvZPotLTlm77jgIJcclxuICAgICAqIEByZXR1cm5zIGBvdXRgXHJcbiAgICAgKiBAZXhhbXBsZVxyXG4gICAgICogYGBgdHlwZXNjcmlwdFxyXG4gICAgICogY29uc3QgdGV4dHVyZXMgPSBuZXcgQXJyYXk8VGV4dHVyZTJEPig2KTtcclxuICAgICAqIHRleHR1cmVzW1RleHR1cmVDdWJlLkZhY2VJbmRleC5mcm9udF0gPSBmcm9udEltYWdlO1xyXG4gICAgICogdGV4dHVyZXNbVGV4dHVyZUN1YmUuRmFjZUluZGV4LmJhY2tdID0gYmFja0ltYWdlO1xyXG4gICAgICogdGV4dHVyZXNbVGV4dHVyZUN1YmUuRmFjZUluZGV4LmxlZnRdID0gbGVmdEltYWdlO1xyXG4gICAgICogdGV4dHVyZXNbVGV4dHVyZUN1YmUuRmFjZUluZGV4LnJpZ2h0XSA9IHJpZ2h0SW1hZ2U7XHJcbiAgICAgKiB0ZXh0dXJlc1tUZXh0dXJlQ3ViZS5GYWNlSW5kZXgudG9wXSA9IHRvcEltYWdlO1xyXG4gICAgICogdGV4dHVyZXNbVGV4dHVyZUN1YmUuRmFjZUluZGV4LmJvdHRvbV0gPSBib3R0b21JbWFnZTtcclxuICAgICAqIGNvbnN0IHRleHR1cmVDdWJlID0gVGV4dHVyZUN1YmUuZnJvbVRleHR1cmUyREFycmF5KHRleHR1cmVzKTtcclxuICAgICAqIGBgYFxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgc3RhdGljIGZyb21UZXh0dXJlMkRBcnJheSAodGV4dHVyZXM6IFRleHR1cmUyRFtdLCBvdXQ/OiBUZXh0dXJlQ3ViZSkge1xyXG4gICAgICAgIGNvbnN0IG1pcG1hcHM6IElUZXh0dXJlQ3ViZU1pcG1hcFtdID0gW107XHJcbiAgICAgICAgY29uc3Qgbk1pcG1hcHMgPSB0ZXh0dXJlcy5sZW5ndGggLyA2O1xyXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbk1pcG1hcHM7IGkrKykge1xyXG4gICAgICAgICAgICBjb25zdCB4ID0gaSAqIDY7XHJcbiAgICAgICAgICAgIG1pcG1hcHMucHVzaCh7XHJcbiAgICAgICAgICAgICAgICBmcm9udDogdGV4dHVyZXNbeCArIEZhY2VJbmRleC5mcm9udF0uaW1hZ2UhLFxyXG4gICAgICAgICAgICAgICAgYmFjazogdGV4dHVyZXNbeCArIEZhY2VJbmRleC5iYWNrXS5pbWFnZSEsXHJcbiAgICAgICAgICAgICAgICBsZWZ0OiB0ZXh0dXJlc1t4ICsgRmFjZUluZGV4LmxlZnRdLmltYWdlISxcclxuICAgICAgICAgICAgICAgIHJpZ2h0OiB0ZXh0dXJlc1t4ICsgRmFjZUluZGV4LnJpZ2h0XS5pbWFnZSEsXHJcbiAgICAgICAgICAgICAgICB0b3A6IHRleHR1cmVzW3ggKyBGYWNlSW5kZXgudG9wXS5pbWFnZSEsXHJcbiAgICAgICAgICAgICAgICBib3R0b206IHRleHR1cmVzW3ggKyBGYWNlSW5kZXguYm90dG9tXS5pbWFnZSEsXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICBvdXQgPSBvdXQgfHwgbmV3IFRleHR1cmVDdWJlKCk7XHJcbiAgICAgICAgb3V0Lm1pcG1hcHMgPSBtaXBtYXBzO1xyXG4gICAgICAgIHJldHVybiBvdXQ7XHJcbiAgICB9XHJcblxyXG4gICAgQHByb3BlcnR5XHJcbiAgICBwdWJsaWMgX21pcG1hcHM6IElUZXh0dXJlQ3ViZU1pcG1hcFtdID0gW107XHJcblxyXG4gICAgY29uc3RydWN0b3IgKCkge1xyXG4gICAgICAgIHN1cGVyKCk7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIG9uTG9hZGVkICgpIHtcclxuICAgICAgICB0aGlzLm1pcG1hcHMgPSB0aGlzLl9taXBtYXBzO1xyXG4gICAgICAgIHRoaXMubG9hZGVkID0gdHJ1ZTtcclxuICAgICAgICB0aGlzLmVtaXQoJ2xvYWQnKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOWwhuW9k+WJjei0tOWbvumHjee9ruS4uuaMh+WumuWwuuWvuOOAgeWDj+e0oOagvOW8j+S7peWPiuaMh+WumiBtaXBtYXAg5bGC57qn44CC6YeN572u5ZCO77yM6LS05Zu+55qE5YOP57Sg5pWw5o2u5bCG5Y+Y5Li65pyq5a6a5LmJ44CCXHJcbiAgICAgKiBtaXBtYXAg5Zu+5YOP55qE5pWw5o2u5LiN5Lya6Ieq5Yqo5pu05paw5Yiw6LS05Zu+5Lit77yM5L2g5b+F6aG75pi+5byP6LCD55SoIGB0aGlzLnVwbG9hZERhdGFgIOadpeS4iuS8oOi0tOWbvuaVsOaNruOAglxyXG4gICAgICogQHBhcmFtIGluZm8g6LS05Zu+6YeN572u6YCJ6aG544CCXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyByZXNldCAoaW5mbzogSVRleHR1cmVDdWJlQ3JlYXRlSW5mbykge1xyXG4gICAgICAgIHRoaXMuX3dpZHRoID0gaW5mby53aWR0aDtcclxuICAgICAgICB0aGlzLl9oZWlnaHQgPSBpbmZvLmhlaWdodDtcclxuICAgICAgICB0aGlzLl9zZXRHRlhGb3JtYXQoaW5mby5mb3JtYXQpO1xyXG4gICAgICAgIHRoaXMuX3NldE1pcG1hcExldmVsKGluZm8ubWlwbWFwTGV2ZWwgfHwgMSk7XHJcbiAgICAgICAgdGhpcy5fdHJ5UmVzZXQoKTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgdXBkYXRlTWlwbWFwcyAoZmlyc3RMZXZlbDogbnVtYmVyID0gMCwgY291bnQ/OiBudW1iZXIpIHtcclxuICAgICAgICBpZiAoZmlyc3RMZXZlbCA+PSB0aGlzLl9taXBtYXBzLmxlbmd0aCkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCBuVXBkYXRlID0gTWF0aC5taW4oXHJcbiAgICAgICAgICAgIGNvdW50ID09PSB1bmRlZmluZWQgPyB0aGlzLl9taXBtYXBzLmxlbmd0aCA6IGNvdW50LFxyXG4gICAgICAgICAgICB0aGlzLl9taXBtYXBzLmxlbmd0aCAtIGZpcnN0TGV2ZWwpO1xyXG5cclxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG5VcGRhdGU7ICsraSkge1xyXG4gICAgICAgICAgICBjb25zdCBsZXZlbCA9IGZpcnN0TGV2ZWwgKyBpO1xyXG4gICAgICAgICAgICBfZm9yRWFjaEZhY2UodGhpcy5fbWlwbWFwc1tsZXZlbF0sIChmYWNlLCBmYWNlSW5kZXgpID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMuX2Fzc2lnbkltYWdlKGZhY2UsIGxldmVsLCBmYWNlSW5kZXgpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDplIDmr4HmraTotLTlm77vvIzmuIXnqbrmiYDmnIkgTWlwbWFwIOW5tumHiuaUvuWNoOeUqOeahCBHUFUg6LWE5rqQ44CCXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBkZXN0cm95ICgpIHtcclxuICAgICAgICB0aGlzLl9taXBtYXBzID0gW107XHJcbiAgICAgICAgcmV0dXJuIHN1cGVyLmRlc3Ryb3koKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOmHiuaUvuWNoOeUqOeahCBHUFUg6LWE5rqQ44CCXHJcbiAgICAgKiBAZGVwcmVjYXRlZCDor7fovaznlKggYHRoaXMuZGVzdHJveSgpYOOAglxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgcmVsZWFzZVRleHR1cmUgKCkge1xyXG4gICAgICAgIHRoaXMubWlwbWFwcyA9IFtdO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBfc2VyaWFsaXplIChleHBvcnRpbmc/OiBhbnkpIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBiYXNlOiBzdXBlci5fc2VyaWFsaXplKCksXHJcbiAgICAgICAgICAgIG1pcG1hcHM6IHRoaXMuX21pcG1hcHMubWFwKChtaXBtYXApID0+IGV4cG9ydGluZyA/IHtcclxuICAgICAgICAgICAgICAgIGZyb250OiBFZGl0b3JFeHRlbmRzLlV1aWRVdGlscy5jb21wcmVzc1V1aWQobWlwbWFwLmZyb250Ll91dWlkLCB0cnVlKSxcclxuICAgICAgICAgICAgICAgIGJhY2s6IEVkaXRvckV4dGVuZHMuVXVpZFV0aWxzLmNvbXByZXNzVXVpZChtaXBtYXAuYmFjay5fdXVpZCwgdHJ1ZSksXHJcbiAgICAgICAgICAgICAgICBsZWZ0OiBFZGl0b3JFeHRlbmRzLlV1aWRVdGlscy5jb21wcmVzc1V1aWQobWlwbWFwLmxlZnQuX3V1aWQsIHRydWUpLFxyXG4gICAgICAgICAgICAgICAgcmlnaHQ6IEVkaXRvckV4dGVuZHMuVXVpZFV0aWxzLmNvbXByZXNzVXVpZChtaXBtYXAucmlnaHQuX3V1aWQsIHRydWUpLFxyXG4gICAgICAgICAgICAgICAgdG9wOiBFZGl0b3JFeHRlbmRzLlV1aWRVdGlscy5jb21wcmVzc1V1aWQobWlwbWFwLnRvcC5fdXVpZCwgdHJ1ZSksXHJcbiAgICAgICAgICAgICAgICBib3R0b206IEVkaXRvckV4dGVuZHMuVXVpZFV0aWxzLmNvbXByZXNzVXVpZChtaXBtYXAuYm90dG9tLl91dWlkLCB0cnVlKSxcclxuICAgICAgICAgICAgfSA6IHtcclxuICAgICAgICAgICAgICAgIGZyb250OiBtaXBtYXAuZnJvbnQuX3V1aWQsXHJcbiAgICAgICAgICAgICAgICBiYWNrOiBtaXBtYXAuYmFjay5fdXVpZCxcclxuICAgICAgICAgICAgICAgIGxlZnQ6IG1pcG1hcC5sZWZ0Ll91dWlkLFxyXG4gICAgICAgICAgICAgICAgcmlnaHQ6IG1pcG1hcC5yaWdodC5fdXVpZCxcclxuICAgICAgICAgICAgICAgIHRvcDogbWlwbWFwLnRvcC5fdXVpZCxcclxuICAgICAgICAgICAgICAgIGJvdHRvbTogbWlwbWFwLmJvdHRvbS5fdXVpZCxcclxuICAgICAgICAgICAgfSksXHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgX2Rlc2VyaWFsaXplIChzZXJpYWxpemVkRGF0YTogSVRleHR1cmVDdWJlU2VyaWFsaXplRGF0YSwgaGFuZGxlOiBhbnkpIHtcclxuICAgICAgICBjb25zdCBkYXRhID0gc2VyaWFsaXplZERhdGEgYXMgSVRleHR1cmVDdWJlU2VyaWFsaXplRGF0YTtcclxuICAgICAgICBzdXBlci5fZGVzZXJpYWxpemUoZGF0YS5iYXNlLCBoYW5kbGUpO1xyXG5cclxuICAgICAgICB0aGlzLl9taXBtYXBzID0gbmV3IEFycmF5KGRhdGEubWlwbWFwcy5sZW5ndGgpO1xyXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZGF0YS5taXBtYXBzLmxlbmd0aDsgKytpKSB7XHJcbiAgICAgICAgICAgIC8vIFByZXZlbnQgcmVzb3VyY2UgbG9hZCBmYWlsZWRcclxuICAgICAgICAgICAgdGhpcy5fbWlwbWFwc1tpXSA9IHtcclxuICAgICAgICAgICAgICAgIGZyb250OiBuZXcgSW1hZ2VBc3NldCgpLFxyXG4gICAgICAgICAgICAgICAgYmFjazogbmV3IEltYWdlQXNzZXQoKSxcclxuICAgICAgICAgICAgICAgIGxlZnQ6IG5ldyBJbWFnZUFzc2V0KCksXHJcbiAgICAgICAgICAgICAgICByaWdodDogbmV3IEltYWdlQXNzZXQoKSxcclxuICAgICAgICAgICAgICAgIHRvcDogbmV3IEltYWdlQXNzZXQoKSxcclxuICAgICAgICAgICAgICAgIGJvdHRvbTogbmV3IEltYWdlQXNzZXQoKSxcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgY29uc3QgbWlwbWFwID0gZGF0YS5taXBtYXBzW2ldO1xyXG4gICAgICAgICAgICBoYW5kbGUucmVzdWx0LnB1c2godGhpcy5fbWlwbWFwc1tpXSwgYGZyb250YCwgbWlwbWFwLmZyb250KTtcclxuICAgICAgICAgICAgaGFuZGxlLnJlc3VsdC5wdXNoKHRoaXMuX21pcG1hcHNbaV0sIGBiYWNrYCwgbWlwbWFwLmJhY2spO1xyXG4gICAgICAgICAgICBoYW5kbGUucmVzdWx0LnB1c2godGhpcy5fbWlwbWFwc1tpXSwgYGxlZnRgLCBtaXBtYXAubGVmdCk7XHJcbiAgICAgICAgICAgIGhhbmRsZS5yZXN1bHQucHVzaCh0aGlzLl9taXBtYXBzW2ldLCBgcmlnaHRgLCBtaXBtYXAucmlnaHQpO1xyXG4gICAgICAgICAgICBoYW5kbGUucmVzdWx0LnB1c2godGhpcy5fbWlwbWFwc1tpXSwgYHRvcGAsIG1pcG1hcC50b3ApO1xyXG4gICAgICAgICAgICBoYW5kbGUucmVzdWx0LnB1c2godGhpcy5fbWlwbWFwc1tpXSwgYGJvdHRvbWAsIG1pcG1hcC5ib3R0b20pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcm90ZWN0ZWQgX2dldEdmeFRleHR1cmVDcmVhdGVJbmZvIChwcmVzdW1lZDogUHJlc3VtZWRHRlhUZXh0dXJlSW5mbykge1xyXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9ICBPYmplY3QuYXNzaWduKHtcclxuICAgICAgICAgICAgdHlwZTogR0ZYVGV4dHVyZVR5cGUuVEVYMkQsXHJcbiAgICAgICAgICAgIHdpZHRoOiB0aGlzLl93aWR0aCxcclxuICAgICAgICAgICAgaGVpZ2h0OiB0aGlzLl9oZWlnaHQsXHJcbiAgICAgICAgICAgIGFycmF5TGF5ZXI6IDYsXHJcbiAgICAgICAgfSwgcHJlc3VtZWQpO1xyXG4gICAgICAgIHJlc3VsdC5mbGFncyA9IChyZXN1bHQuZmxhZ3MgfHwgMCkgfCBHRlhUZXh0dXJlRmxhZ0JpdC5DVUJFTUFQO1xyXG4gICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICB9XHJcblxyXG4gICAgcHJvdGVjdGVkIF9nZXRHZnhUZXh0dXJlVmlld0NyZWF0ZUluZm8gKHByZXN1bWVkOiBQcmVzdW1lZEdGWFRleHR1cmVWaWV3SW5mbykge1xyXG4gICAgICAgIHJldHVybiBPYmplY3QuYXNzaWduKHtcclxuICAgICAgICAgICAgdHlwZTogR0ZYVGV4dHVyZVZpZXdUeXBlLkNVQkUsXHJcbiAgICAgICAgICAgIGxheWVyQ291bnQ6IDYsXHJcbiAgICAgICAgfSwgcHJlc3VtZWQpO1xyXG4gICAgfVxyXG5cclxufVxyXG5cclxuY2MuVGV4dHVyZUN1YmUgPSBUZXh0dXJlQ3ViZTtcclxuXHJcbmludGVyZmFjZSBJVGV4dHVyZUN1YmVTZXJpYWxpemVEYXRhIHtcclxuICAgIGJhc2U6IHN0cmluZztcclxuICAgIG1pcG1hcHM6IHtcclxuICAgICAgICBmcm9udDogc3RyaW5nO1xyXG4gICAgICAgIGJhY2s6IHN0cmluZztcclxuICAgICAgICBsZWZ0OiBzdHJpbmc7XHJcbiAgICAgICAgcmlnaHQ6IHN0cmluZztcclxuICAgICAgICB0b3A6IHN0cmluZztcclxuICAgICAgICBib3R0b206IHN0cmluZztcclxuICAgIH1bXTtcclxufVxyXG5cclxuLyoqXHJcbiAqIEBwYXJhbSB7TWlwbWFwfSBtaXBtYXBcclxuICogQHBhcmFtIHsoZmFjZTogSW1hZ2VBc3NldCkgPT4gdm9pZH0gY2FsbGJhY2tcclxuICovXHJcbmZ1bmN0aW9uIF9mb3JFYWNoRmFjZSAobWlwbWFwOiBJVGV4dHVyZUN1YmVNaXBtYXAsIGNhbGxiYWNrOiAoZmFjZTogSW1hZ2VBc3NldCwgZmFjZUluZGV4OiBudW1iZXIpID0+IHZvaWQpIHtcclxuICAgIGNhbGxiYWNrKG1pcG1hcC5mcm9udCwgRmFjZUluZGV4LmZyb250KTtcclxuICAgIGNhbGxiYWNrKG1pcG1hcC5iYWNrLCBGYWNlSW5kZXguYmFjayk7XHJcbiAgICBjYWxsYmFjayhtaXBtYXAubGVmdCwgRmFjZUluZGV4LmxlZnQpO1xyXG4gICAgY2FsbGJhY2sobWlwbWFwLnJpZ2h0LCBGYWNlSW5kZXgucmlnaHQpO1xyXG4gICAgY2FsbGJhY2sobWlwbWFwLnRvcCwgRmFjZUluZGV4LnRvcCk7XHJcbiAgICBjYWxsYmFjayhtaXBtYXAuYm90dG9tLCBGYWNlSW5kZXguYm90dG9tKTtcclxufVxyXG4iXX0=