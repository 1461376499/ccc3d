(function (global, factory) {
  if (typeof define === "function" && define.amd) {
    define(["exports", "../../core/data/class-decorator.js", "../../core/math/index.js", "../animator/curve-range.js", "../enum.js", "../particle-general-function.js"], factory);
  } else if (typeof exports !== "undefined") {
    factory(exports, require("../../core/data/class-decorator.js"), require("../../core/math/index.js"), require("../animator/curve-range.js"), require("../enum.js"), require("../particle-general-function.js"));
  } else {
    var mod = {
      exports: {}
    };
    factory(mod.exports, global.classDecorator, global.index, global.curveRange, global._enum, global.particleGeneralFunction);
    global.shapeModule = mod.exports;
  }
})(typeof globalThis !== "undefined" ? globalThis : typeof self !== "undefined" ? self : this, function (_exports, _classDecorator, _index, _curveRange, _enum, _particleGeneralFunction) {
  "use strict";

  Object.defineProperty(_exports, "__esModule", {
    value: true
  });
  _exports.default = void 0;
  _curveRange = _interopRequireDefault(_curveRange);

  var _dec, _dec2, _dec3, _dec4, _dec5, _dec6, _dec7, _dec8, _dec9, _dec10, _dec11, _dec12, _dec13, _dec14, _dec15, _dec16, _dec17, _dec18, _dec19, _dec20, _dec21, _class, _class2, _descriptor, _descriptor2, _descriptor3, _descriptor4, _descriptor5, _descriptor6, _descriptor7, _descriptor8, _descriptor9, _descriptor10, _descriptor11, _descriptor12, _descriptor13, _descriptor14, _descriptor15, _descriptor16, _descriptor17, _descriptor18, _descriptor19, _temp;

  function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

  function _initializerDefineProperty(target, property, descriptor, context) { if (!descriptor) return; Object.defineProperty(target, property, { enumerable: descriptor.enumerable, configurable: descriptor.configurable, writable: descriptor.writable, value: descriptor.initializer ? descriptor.initializer.call(context) : void 0 }); }

  function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

  function _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }

  function _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }

  function _initializerWarningHelper(descriptor, context) { throw new Error('Decorating class property failed. Please ensure that ' + 'proposal-class-properties is enabled and runs after the decorators transform.'); }

  function _applyDecoratedDescriptor(target, property, decorators, descriptor, context) { var desc = {}; Object.keys(descriptor).forEach(function (key) { desc[key] = descriptor[key]; }); desc.enumerable = !!desc.enumerable; desc.configurable = !!desc.configurable; if ('value' in desc || desc.initializer) { desc.writable = true; } desc = decorators.slice().reverse().reduce(function (desc, decorator) { return decorator(target, property, desc) || desc; }, desc); if (context && desc.initializer !== void 0) { desc.value = desc.initializer ? desc.initializer.call(context) : void 0; desc.initializer = undefined; } if (desc.initializer === void 0) { Object.defineProperty(target, property, desc); desc = null; } return desc; }

  var _intermediVec = new _index.Vec3(0, 0, 0);

  var _intermediArr = new Array();

  var _unitBoxExtent = new _index.Vec3(0.5, 0.5, 0.5);

  var ShapeModule = (_dec = (0, _classDecorator.ccclass)('cc.ShapeModule'), _dec2 = (0, _classDecorator.property)({
    displayOrder: 13,
    tooltip: '粒子发射器位置'
  }), _dec3 = (0, _classDecorator.property)({
    displayOrder: 14,
    tooltip: '粒子发射器旋转角度'
  }), _dec4 = (0, _classDecorator.property)({
    displayOrder: 15,
    tooltip: '粒子发射器缩放比例'
  }), _dec5 = (0, _classDecorator.property)({
    displayOrder: 6,
    tooltip: '粒子发射器在一个扇形范围内发射'
  }), _dec6 = (0, _classDecorator.property)({
    displayOrder: 5,
    tooltip: '圆锥的轴与母线的夹角\n决定圆锥发射器的开合程度'
  }), _dec7 = (0, _classDecorator.property)({
    displayOrder: 0
  }), _dec8 = (0, _classDecorator.property)({
    type: _enum.ShapeType,
    displayOrder: 1,
    formerlySerializedAs: 'shapeType'
  }), _dec9 = (0, _classDecorator.property)({
    type: _enum.ShapeType,
    tooltip: '粒子发射器类型'
  }), _dec10 = (0, _classDecorator.property)({
    type: _enum.EmitLocation,
    displayOrder: 2,
    tooltip: '粒子从发射器哪个部位发射'
  }), _dec11 = (0, _classDecorator.property)({
    displayOrder: 16,
    tooltip: '根据粒子的初始方向决定粒子的移动方向'
  }), _dec12 = (0, _classDecorator.property)({
    displayOrder: 17,
    tooltip: '粒子生成方向随机设定'
  }), _dec13 = (0, _classDecorator.property)({
    displayOrder: 18,
    tooltip: '表示当前发射方向与当前位置到结点中心连线方向的插值'
  }), _dec14 = (0, _classDecorator.property)({
    displayOrder: 19,
    tooltip: '粒子生成位置随机设定（设定此值为非 0 会使粒子生成位置超出生成器大小范围）'
  }), _dec15 = (0, _classDecorator.property)({
    displayOrder: 3,
    tooltip: '粒子发射器半径'
  }), _dec16 = (0, _classDecorator.property)({
    displayOrder: 4,
    tooltip: '粒子发射器发射位置（对 Box 类型的发射器无效）:\n - 0 表示从表面发射；\n - 1 表示从中心发射；\n - 0 ~ 1 之间表示在中心到表面之间发射。'
  }), _dec17 = (0, _classDecorator.property)({
    type: _enum.ArcMode,
    displayOrder: 7,
    tooltip: '粒子在扇形范围内的发射方式'
  }), _dec18 = (0, _classDecorator.property)({
    displayOrder: 9,
    tooltip: '控制可能产生粒子的弧周围的离散间隔'
  }), _dec19 = (0, _classDecorator.property)({
    type: _curveRange.default,
    displayOrder: 10,
    tooltip: '粒子沿圆周发射的速度'
  }), _dec20 = (0, _classDecorator.property)({
    displayOrder: 11,
    tooltip: '圆锥顶部截面距离底部的轴长\n决定圆锥发射器的高度'
  }), _dec21 = (0, _classDecorator.property)({
    displayOrder: 12,
    tooltip: '粒子发射器发射位置（针对 Box 类型的粒子发射器）'
  }), _dec(_class = (_class2 = (_temp = /*#__PURE__*/function () {
    _createClass(ShapeModule, [{
      key: "position",

      /**
       * @zh 粒子发射器位置。
       */
      get: function get() {
        return this._position;
      },
      set: function set(val) {
        this._position = val;
        this.constructMat();
      }
      /**
       * @zh 粒子发射器旋转角度。
       */

    }, {
      key: "rotation",
      get: function get() {
        return this._rotation;
      },
      set: function set(val) {
        this._rotation = val;
        this.constructMat();
      }
      /**
       * @zh 粒子发射器缩放比例。
       */

    }, {
      key: "scale",
      get: function get() {
        return this._scale;
      },
      set: function set(val) {
        this._scale = val;
        this.constructMat();
      }
      /**
       * @zh 粒子发射器在一个扇形范围内发射。
       */

    }, {
      key: "arc",
      get: function get() {
        return (0, _index.toDegree)(this._arc);
      },
      set: function set(val) {
        this._arc = (0, _index.toRadian)(val);
      }
      /**
       * @zh 圆锥的轴与母线的夹角<bg>。
       * 决定圆锥发射器的开合程度。
       */

    }, {
      key: "angle",
      get: function get() {
        return Math.round((0, _index.toDegree)(this._angle) * 100) / 100;
      },
      set: function set(val) {
        this._angle = (0, _index.toRadian)(val);
      }
    }, {
      key: "enable",

      /**
       * @zh 是否启用。
       */
      get: function get() {
        return this._enable;
      },
      set: function set(val) {
        this._enable = val;
      }
      /**
       * @zh 粒子发射器类型 [[ShapeType]]。
       */

    }, {
      key: "shapeType",
      get: function get() {
        return this._shapeType;
      },
      set: function set(val) {
        this._shapeType = val;

        switch (this._shapeType) {
          case _enum.ShapeType.Box:
            if (this.emitFrom === _enum.EmitLocation.Base) {
              this.emitFrom = _enum.EmitLocation.Volume;
            }

            break;

          case _enum.ShapeType.Cone:
            if (this.emitFrom === _enum.EmitLocation.Edge) {
              this.emitFrom = _enum.EmitLocation.Base;
            }

            break;

          case _enum.ShapeType.Sphere:
          case _enum.ShapeType.Hemisphere:
            if (this.emitFrom === _enum.EmitLocation.Base || this.emitFrom === _enum.EmitLocation.Edge) {
              this.emitFrom = _enum.EmitLocation.Volume;
            }

            break;
        }
      }
      /**
       * @zh 粒子从发射器哪个部位发射 [[EmitLocation]]。
       */

    }]);

    function ShapeModule() {
      _classCallCheck(this, ShapeModule);

      _initializerDefineProperty(this, "_enable", _descriptor, this);

      _initializerDefineProperty(this, "_shapeType", _descriptor2, this);

      _initializerDefineProperty(this, "emitFrom", _descriptor3, this);

      _initializerDefineProperty(this, "alignToDirection", _descriptor4, this);

      _initializerDefineProperty(this, "randomDirectionAmount", _descriptor5, this);

      _initializerDefineProperty(this, "sphericalDirectionAmount", _descriptor6, this);

      _initializerDefineProperty(this, "randomPositionAmount", _descriptor7, this);

      _initializerDefineProperty(this, "radius", _descriptor8, this);

      _initializerDefineProperty(this, "radiusThickness", _descriptor9, this);

      _initializerDefineProperty(this, "arcMode", _descriptor10, this);

      _initializerDefineProperty(this, "arcSpread", _descriptor11, this);

      _initializerDefineProperty(this, "arcSpeed", _descriptor12, this);

      _initializerDefineProperty(this, "length", _descriptor13, this);

      _initializerDefineProperty(this, "boxThickness", _descriptor14, this);

      _initializerDefineProperty(this, "_position", _descriptor15, this);

      _initializerDefineProperty(this, "_rotation", _descriptor16, this);

      _initializerDefineProperty(this, "_scale", _descriptor17, this);

      _initializerDefineProperty(this, "_arc", _descriptor18, this);

      _initializerDefineProperty(this, "_angle", _descriptor19, this);

      this.mat = void 0;
      this.quat = void 0;
      this.particleSystem = void 0;
      this.lastTime = void 0;
      this.totalAngle = void 0;
      this.mat = new _index.Mat4();
      this.quat = new _index.Quat();
      this.particleSystem = null;
      this.lastTime = 0;
      this.totalAngle = 0;
    }

    _createClass(ShapeModule, [{
      key: "onInit",
      value: function onInit(ps) {
        this.particleSystem = ps;
        this.constructMat();
        this.lastTime = this.particleSystem._time;
      }
    }, {
      key: "emit",
      value: function emit(p) {
        switch (this.shapeType) {
          case _enum.ShapeType.Box:
            boxEmit(this.emitFrom, this.boxThickness, p.position, p.velocity);
            break;

          case _enum.ShapeType.Circle:
            circleEmit(this.radius, this.radiusThickness, this.generateArcAngle(), p.position, p.velocity);
            break;

          case _enum.ShapeType.Cone:
            coneEmit(this.emitFrom, this.radius, this.radiusThickness, this.generateArcAngle(), this._angle, this.length, p.position, p.velocity);
            break;

          case _enum.ShapeType.Sphere:
            sphereEmit(this.emitFrom, this.radius, this.radiusThickness, p.position, p.velocity);
            break;

          case _enum.ShapeType.Hemisphere:
            hemisphereEmit(this.emitFrom, this.radius, this.radiusThickness, p.position, p.velocity);
            break;

          default:
            console.warn(this.shapeType + ' shapeType is not supported by ShapeModule.');
        }

        if (this.randomPositionAmount > 0) {
          p.position.x += (0, _index.randomRange)(-this.randomPositionAmount, this.randomPositionAmount);
          p.position.y += (0, _index.randomRange)(-this.randomPositionAmount, this.randomPositionAmount);
          p.position.z += (0, _index.randomRange)(-this.randomPositionAmount, this.randomPositionAmount);
        }

        _index.Vec3.transformQuat(p.velocity, p.velocity, this.quat);

        _index.Vec3.transformMat4(p.position, p.position, this.mat);

        if (this.sphericalDirectionAmount > 0) {
          var sphericalVel = _index.Vec3.normalize(_intermediVec, p.position);

          _index.Vec3.lerp(p.velocity, p.velocity, sphericalVel, this.sphericalDirectionAmount);
        }

        this.lastTime = this.particleSystem._time;
      }
    }, {
      key: "constructMat",
      value: function constructMat() {
        _index.Quat.fromEuler(this.quat, this._rotation.x, this._rotation.y, this._rotation.z);

        _index.Mat4.fromRTS(this.mat, this.quat, this._position, this._scale);
      }
    }, {
      key: "generateArcAngle",
      value: function generateArcAngle() {
        if (this.arcMode === _enum.ArcMode.Random) {
          return (0, _index.randomRange)(0, this._arc);
        }

        var angle = this.totalAngle + 2 * Math.PI * this.arcSpeed.evaluate(this.particleSystem._time, 1) * (this.particleSystem._time - this.lastTime);
        this.totalAngle = angle;

        if (this.arcSpread !== 0) {
          angle = Math.floor(angle / (this._arc * this.arcSpread)) * this._arc * this.arcSpread;
        }

        switch (this.arcMode) {
          case _enum.ArcMode.Loop:
            return (0, _index.repeat)(angle, this._arc);

          case _enum.ArcMode.PingPong:
            return (0, _index.pingPong)(angle, this._arc);
        }
      }
    }]);

    return ShapeModule;
  }(), _temp), (_applyDecoratedDescriptor(_class2.prototype, "position", [_dec2], Object.getOwnPropertyDescriptor(_class2.prototype, "position"), _class2.prototype), _applyDecoratedDescriptor(_class2.prototype, "rotation", [_dec3], Object.getOwnPropertyDescriptor(_class2.prototype, "rotation"), _class2.prototype), _applyDecoratedDescriptor(_class2.prototype, "scale", [_dec4], Object.getOwnPropertyDescriptor(_class2.prototype, "scale"), _class2.prototype), _applyDecoratedDescriptor(_class2.prototype, "arc", [_dec5], Object.getOwnPropertyDescriptor(_class2.prototype, "arc"), _class2.prototype), _applyDecoratedDescriptor(_class2.prototype, "angle", [_dec6], Object.getOwnPropertyDescriptor(_class2.prototype, "angle"), _class2.prototype), _descriptor = _applyDecoratedDescriptor(_class2.prototype, "_enable", [_classDecorator.property], {
    configurable: true,
    enumerable: true,
    writable: true,
    initializer: function initializer() {
      return false;
    }
  }), _applyDecoratedDescriptor(_class2.prototype, "enable", [_dec7], Object.getOwnPropertyDescriptor(_class2.prototype, "enable"), _class2.prototype), _descriptor2 = _applyDecoratedDescriptor(_class2.prototype, "_shapeType", [_dec8], {
    configurable: true,
    enumerable: true,
    writable: true,
    initializer: function initializer() {
      return _enum.ShapeType.Cone;
    }
  }), _applyDecoratedDescriptor(_class2.prototype, "shapeType", [_dec9], Object.getOwnPropertyDescriptor(_class2.prototype, "shapeType"), _class2.prototype), _descriptor3 = _applyDecoratedDescriptor(_class2.prototype, "emitFrom", [_dec10], {
    configurable: true,
    enumerable: true,
    writable: true,
    initializer: function initializer() {
      return _enum.EmitLocation.Volume;
    }
  }), _descriptor4 = _applyDecoratedDescriptor(_class2.prototype, "alignToDirection", [_dec11], {
    configurable: true,
    enumerable: true,
    writable: true,
    initializer: function initializer() {
      return false;
    }
  }), _descriptor5 = _applyDecoratedDescriptor(_class2.prototype, "randomDirectionAmount", [_dec12], {
    configurable: true,
    enumerable: true,
    writable: true,
    initializer: function initializer() {
      return 0;
    }
  }), _descriptor6 = _applyDecoratedDescriptor(_class2.prototype, "sphericalDirectionAmount", [_dec13], {
    configurable: true,
    enumerable: true,
    writable: true,
    initializer: function initializer() {
      return 0;
    }
  }), _descriptor7 = _applyDecoratedDescriptor(_class2.prototype, "randomPositionAmount", [_dec14], {
    configurable: true,
    enumerable: true,
    writable: true,
    initializer: function initializer() {
      return 0;
    }
  }), _descriptor8 = _applyDecoratedDescriptor(_class2.prototype, "radius", [_dec15], {
    configurable: true,
    enumerable: true,
    writable: true,
    initializer: function initializer() {
      return 1;
    }
  }), _descriptor9 = _applyDecoratedDescriptor(_class2.prototype, "radiusThickness", [_dec16], {
    configurable: true,
    enumerable: true,
    writable: true,
    initializer: function initializer() {
      return 1;
    }
  }), _descriptor10 = _applyDecoratedDescriptor(_class2.prototype, "arcMode", [_dec17], {
    configurable: true,
    enumerable: true,
    writable: true,
    initializer: function initializer() {
      return _enum.ArcMode.Random;
    }
  }), _descriptor11 = _applyDecoratedDescriptor(_class2.prototype, "arcSpread", [_dec18], {
    configurable: true,
    enumerable: true,
    writable: true,
    initializer: function initializer() {
      return 0;
    }
  }), _descriptor12 = _applyDecoratedDescriptor(_class2.prototype, "arcSpeed", [_dec19], {
    configurable: true,
    enumerable: true,
    writable: true,
    initializer: function initializer() {
      return new _curveRange.default();
    }
  }), _descriptor13 = _applyDecoratedDescriptor(_class2.prototype, "length", [_dec20], {
    configurable: true,
    enumerable: true,
    writable: true,
    initializer: function initializer() {
      return 5;
    }
  }), _descriptor14 = _applyDecoratedDescriptor(_class2.prototype, "boxThickness", [_dec21], {
    configurable: true,
    enumerable: true,
    writable: true,
    initializer: function initializer() {
      return new _index.Vec3(0, 0, 0);
    }
  }), _descriptor15 = _applyDecoratedDescriptor(_class2.prototype, "_position", [_classDecorator.property], {
    configurable: true,
    enumerable: true,
    writable: true,
    initializer: function initializer() {
      return new _index.Vec3(0, 0, 0);
    }
  }), _descriptor16 = _applyDecoratedDescriptor(_class2.prototype, "_rotation", [_classDecorator.property], {
    configurable: true,
    enumerable: true,
    writable: true,
    initializer: function initializer() {
      return new _index.Vec3(0, 0, 0);
    }
  }), _descriptor17 = _applyDecoratedDescriptor(_class2.prototype, "_scale", [_classDecorator.property], {
    configurable: true,
    enumerable: true,
    writable: true,
    initializer: function initializer() {
      return new _index.Vec3(1, 1, 1);
    }
  }), _descriptor18 = _applyDecoratedDescriptor(_class2.prototype, "_arc", [_classDecorator.property], {
    configurable: true,
    enumerable: true,
    writable: true,
    initializer: function initializer() {
      return (0, _index.toRadian)(360);
    }
  }), _descriptor19 = _applyDecoratedDescriptor(_class2.prototype, "_angle", [_classDecorator.property], {
    configurable: true,
    enumerable: true,
    writable: true,
    initializer: function initializer() {
      return (0, _index.toRadian)(25);
    }
  })), _class2)) || _class);
  _exports.default = ShapeModule;

  function sphereEmit(emitFrom, radius, radiusThickness, pos, dir) {
    switch (emitFrom) {
      case _enum.EmitLocation.Volume:
        (0, _particleGeneralFunction.randomPointBetweenSphere)(pos, radius * (1 - radiusThickness), radius);

        _index.Vec3.normalize(dir, pos);

        break;

      case _enum.EmitLocation.Shell:
        (0, _particleGeneralFunction.randomUnitVector)(pos);

        _index.Vec3.multiplyScalar(pos, pos, radius);

        _index.Vec3.normalize(dir, pos);

        break;

      default:
        console.warn(emitFrom + ' is not supported for sphere emitter.');
    }
  }

  function hemisphereEmit(emitFrom, radius, radiusThickness, pos, dir) {
    switch (emitFrom) {
      case _enum.EmitLocation.Volume:
        (0, _particleGeneralFunction.randomPointBetweenSphere)(pos, radius * (1 - radiusThickness), radius);

        if (pos.z > 0) {
          pos.z *= -1;
        }

        _index.Vec3.normalize(dir, pos);

        break;

      case _enum.EmitLocation.Shell:
        (0, _particleGeneralFunction.randomUnitVector)(pos);

        _index.Vec3.multiplyScalar(pos, pos, radius);

        if (pos.z > 0) {
          pos.z *= -1;
        }

        _index.Vec3.normalize(dir, pos);

        break;

      default:
        console.warn(emitFrom + ' is not supported for hemisphere emitter.');
    }
  }

  function coneEmit(emitFrom, radius, radiusThickness, theta, angle, length, pos, dir) {
    switch (emitFrom) {
      case _enum.EmitLocation.Base:
        (0, _particleGeneralFunction.randomPointBetweenCircleAtFixedAngle)(pos, radius * (1 - radiusThickness), radius, theta);

        _index.Vec2.multiplyScalar(dir, pos, Math.sin(angle));

        dir.z = -Math.cos(angle) * radius;

        _index.Vec3.normalize(dir, dir);

        pos.z = 0;
        break;

      case _enum.EmitLocation.Shell:
        (0, _particleGeneralFunction.fixedAngleUnitVector2)(pos, theta);

        _index.Vec2.multiplyScalar(dir, pos, Math.sin(angle));

        dir.z = -Math.cos(angle);

        _index.Vec3.normalize(dir, dir);

        _index.Vec2.multiplyScalar(pos, pos, radius);

        pos.z = 0;
        break;

      case _enum.EmitLocation.Volume:
        (0, _particleGeneralFunction.randomPointBetweenCircleAtFixedAngle)(pos, radius * (1 - radiusThickness), radius, theta);

        _index.Vec2.multiplyScalar(dir, pos, Math.sin(angle));

        dir.z = -Math.cos(angle) * radius;

        _index.Vec3.normalize(dir, dir);

        pos.z = 0;

        _index.Vec3.add(pos, pos, _index.Vec3.multiplyScalar(_intermediVec, dir, length * (0, _index.random)() / -dir.z));

        break;

      default:
        console.warn(emitFrom + ' is not supported for cone emitter.');
    }
  }

  function boxEmit(emitFrom, boxThickness, pos, dir) {
    switch (emitFrom) {
      case _enum.EmitLocation.Volume:
        (0, _particleGeneralFunction.randomPointInCube)(pos, _unitBoxExtent); // randomPointBetweenCube(pos, vec3.multiply(_intermediVec, _unitBoxExtent, boxThickness), _unitBoxExtent);

        break;

      case _enum.EmitLocation.Shell:
        _intermediArr.splice(0, _intermediArr.length);

        _intermediArr.push((0, _index.randomRange)(-0.5, 0.5));

        _intermediArr.push((0, _index.randomRange)(-0.5, 0.5));

        _intermediArr.push((0, _particleGeneralFunction.randomSign)() * 0.5);

        (0, _particleGeneralFunction.randomSortArray)(_intermediArr);
        applyBoxThickness(_intermediArr, boxThickness);

        _index.Vec3.set(pos, _intermediArr[0], _intermediArr[1], _intermediArr[2]);

        break;

      case _enum.EmitLocation.Edge:
        _intermediArr.splice(0, _intermediArr.length);

        _intermediArr.push((0, _index.randomRange)(-0.5, 0.5));

        _intermediArr.push((0, _particleGeneralFunction.randomSign)() * 0.5);

        _intermediArr.push((0, _particleGeneralFunction.randomSign)() * 0.5);

        (0, _particleGeneralFunction.randomSortArray)(_intermediArr);
        applyBoxThickness(_intermediArr, boxThickness);

        _index.Vec3.set(pos, _intermediArr[0], _intermediArr[1], _intermediArr[2]);

        break;

      default:
        console.warn(emitFrom + ' is not supported for box emitter.');
    }

    _index.Vec3.copy(dir, _particleGeneralFunction.particleEmitZAxis);
  }

  function circleEmit(radius, radiusThickness, theta, pos, dir) {
    (0, _particleGeneralFunction.randomPointBetweenCircleAtFixedAngle)(pos, radius * (1 - radiusThickness), radius, theta);

    _index.Vec3.normalize(dir, pos);
  }

  function applyBoxThickness(pos, thickness) {
    if (thickness.x > 0) {
      pos[0] += 0.5 * (0, _index.randomRange)(-thickness.x, thickness.x);
      pos[0] = (0, _index.clamp)(pos[0], -0.5, 0.5);
    }

    if (thickness.y > 0) {
      pos[1] += 0.5 * (0, _index.randomRange)(-thickness.y, thickness.y);
      pos[1] = (0, _index.clamp)(pos[1], -0.5, 0.5);
    }

    if (thickness.z > 0) {
      pos[2] += 0.5 * (0, _index.randomRange)(-thickness.z, thickness.z);
      pos[2] = (0, _index.clamp)(pos[2], -0.5, 0.5);
    }
  } // CCClass.fastDefine('cc.ShapeModule', ShapeModule, {
  //     enable: false,
  //     shapeType: ShapeType.Box,
  //     emitFrom: EmitLocation.Base,
  //     _position: new Vec3(0, 0, 0),
  //     _rotation: new Vec3(0, 0, 0),
  //     _scale: new Vec3(0, 0, 0),
  //     alignToDirection: false,
  //     randomDirectionAmount: 0,
  //     sphericalDirectionAmount: 0,
  //     randomPositionAmount: 0,
  //     radius: 0,
  //     radiusThickness: 1,
  //     arc: 0,
  //     arcMode: ArcMode.Random,
  //     arcSpread: 0,
  //     arcSpeed: null,
  //     angle: 0,
  //     length: 0,
  //     boxThickness: new Vec3(0, 0, 0)
  // });

});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkY6L2plbmtpbnMvd29ya3NwYWNlL0NyZWF0b3JfM0QvZWRpdG9yLTNkL3Jlc291cmNlcy8zZC9lbmdpbmUvY29jb3MvcGFydGljbGUvZW1pdHRlci9zaGFwZS1tb2R1bGUudHMiXSwibmFtZXMiOlsiX2ludGVybWVkaVZlYyIsIlZlYzMiLCJfaW50ZXJtZWRpQXJyIiwiQXJyYXkiLCJfdW5pdEJveEV4dGVudCIsIlNoYXBlTW9kdWxlIiwiZGlzcGxheU9yZGVyIiwidG9vbHRpcCIsInR5cGUiLCJTaGFwZVR5cGUiLCJmb3JtZXJseVNlcmlhbGl6ZWRBcyIsIkVtaXRMb2NhdGlvbiIsIkFyY01vZGUiLCJDdXJ2ZVJhbmdlIiwiX3Bvc2l0aW9uIiwidmFsIiwiY29uc3RydWN0TWF0IiwiX3JvdGF0aW9uIiwiX3NjYWxlIiwiX2FyYyIsIk1hdGgiLCJyb3VuZCIsIl9hbmdsZSIsIl9lbmFibGUiLCJfc2hhcGVUeXBlIiwiQm94IiwiZW1pdEZyb20iLCJCYXNlIiwiVm9sdW1lIiwiQ29uZSIsIkVkZ2UiLCJTcGhlcmUiLCJIZW1pc3BoZXJlIiwibWF0IiwicXVhdCIsInBhcnRpY2xlU3lzdGVtIiwibGFzdFRpbWUiLCJ0b3RhbEFuZ2xlIiwiTWF0NCIsIlF1YXQiLCJwcyIsIl90aW1lIiwicCIsInNoYXBlVHlwZSIsImJveEVtaXQiLCJib3hUaGlja25lc3MiLCJwb3NpdGlvbiIsInZlbG9jaXR5IiwiQ2lyY2xlIiwiY2lyY2xlRW1pdCIsInJhZGl1cyIsInJhZGl1c1RoaWNrbmVzcyIsImdlbmVyYXRlQXJjQW5nbGUiLCJjb25lRW1pdCIsImxlbmd0aCIsInNwaGVyZUVtaXQiLCJoZW1pc3BoZXJlRW1pdCIsImNvbnNvbGUiLCJ3YXJuIiwicmFuZG9tUG9zaXRpb25BbW91bnQiLCJ4IiwieSIsInoiLCJ0cmFuc2Zvcm1RdWF0IiwidHJhbnNmb3JtTWF0NCIsInNwaGVyaWNhbERpcmVjdGlvbkFtb3VudCIsInNwaGVyaWNhbFZlbCIsIm5vcm1hbGl6ZSIsImxlcnAiLCJmcm9tRXVsZXIiLCJmcm9tUlRTIiwiYXJjTW9kZSIsIlJhbmRvbSIsImFuZ2xlIiwiUEkiLCJhcmNTcGVlZCIsImV2YWx1YXRlIiwiYXJjU3ByZWFkIiwiZmxvb3IiLCJMb29wIiwiUGluZ1BvbmciLCJwcm9wZXJ0eSIsInBvcyIsImRpciIsIlNoZWxsIiwibXVsdGlwbHlTY2FsYXIiLCJ0aGV0YSIsIlZlYzIiLCJzaW4iLCJjb3MiLCJhZGQiLCJzcGxpY2UiLCJwdXNoIiwiYXBwbHlCb3hUaGlja25lc3MiLCJzZXQiLCJjb3B5IiwicGFydGljbGVFbWl0WkF4aXMiLCJ0aGlja25lc3MiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFjQSxNQUFNQSxhQUFhLEdBQUcsSUFBSUMsV0FBSixDQUFTLENBQVQsRUFBWSxDQUFaLEVBQWUsQ0FBZixDQUF0Qjs7QUFDQSxNQUFNQyxhQUFhLEdBQUcsSUFBSUMsS0FBSixFQUF0Qjs7QUFDQSxNQUFNQyxjQUFjLEdBQUcsSUFBSUgsV0FBSixDQUFTLEdBQVQsRUFBYyxHQUFkLEVBQW1CLEdBQW5CLENBQXZCOztNQUdxQkksVyxXQURwQiw2QkFBUSxnQkFBUixDLFVBTUksOEJBQVM7QUFDTkMsSUFBQUEsWUFBWSxFQUFFLEVBRFI7QUFFTkMsSUFBQUEsT0FBTyxFQUFDO0FBRkYsR0FBVCxDLFVBZUEsOEJBQVM7QUFDTkQsSUFBQUEsWUFBWSxFQUFFLEVBRFI7QUFFTkMsSUFBQUEsT0FBTyxFQUFDO0FBRkYsR0FBVCxDLFVBZUEsOEJBQVM7QUFDTkQsSUFBQUEsWUFBWSxFQUFFLEVBRFI7QUFFTkMsSUFBQUEsT0FBTyxFQUFDO0FBRkYsR0FBVCxDLFVBZUEsOEJBQVM7QUFDTkQsSUFBQUEsWUFBWSxFQUFFLENBRFI7QUFFTkMsSUFBQUEsT0FBTyxFQUFDO0FBRkYsR0FBVCxDLFVBZ0JBLDhCQUFTO0FBQ05ELElBQUFBLFlBQVksRUFBRSxDQURSO0FBRU5DLElBQUFBLE9BQU8sRUFBQztBQUZGLEdBQVQsQyxV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U0FBUyxDQUFDbkMsQ0FBVixHQUFjLENBQWxCLEVBQXFCO0FBQ2pCb0IsTUFBQUEsR0FBRyxDQUFDLENBQUQsQ0FBSCxJQUFVLE1BQU0sd0JBQVksQ0FBQ2UsU0FBUyxDQUFDbkMsQ0FBdkIsRUFBMEJtQyxTQUFTLENBQUNuQyxDQUFwQyxDQUFoQjtBQUNBb0IsTUFBQUEsR0FBRyxDQUFDLENBQUQsQ0FBSCxHQUFTLGtCQUFNQSxHQUFHLENBQUMsQ0FBRCxDQUFULEVBQWMsQ0FBQyxHQUFmLEVBQW9CLEdBQXBCLENBQVQ7QUFDSDtBQUNKLEcsQ0FFRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VzQ29udGVudCI6WyJcclxuLyoqXHJcbiAqIEBjYXRlZ29yeSBwYXJ0aWNsZVxyXG4gKi9cclxuXHJcbmltcG9ydCB7IGNjY2xhc3MsIHByb3BlcnR5IH0gZnJvbSAnLi4vLi4vY29yZS9kYXRhL2NsYXNzLWRlY29yYXRvcic7XHJcbmltcG9ydCB7IE1hdDQsIFF1YXQsIFZlYzIsIFZlYzMgfSBmcm9tICcuLi8uLi9jb3JlL21hdGgnO1xyXG5pbXBvcnQgeyBjbGFtcCwgcGluZ1BvbmcsIHJhbmRvbSwgcmFuZG9tUmFuZ2UsIHJlcGVhdCwgdG9EZWdyZWUsIHRvUmFkaWFuIH0gZnJvbSAnLi4vLi4vY29yZS9tYXRoJztcclxuaW1wb3J0IEN1cnZlUmFuZ2UgZnJvbSAnLi4vYW5pbWF0b3IvY3VydmUtcmFuZ2UnO1xyXG5pbXBvcnQgeyBBcmNNb2RlLCBFbWl0TG9jYXRpb24sIFNoYXBlVHlwZSB9IGZyb20gJy4uL2VudW0nO1xyXG5pbXBvcnQgeyBmaXhlZEFuZ2xlVW5pdFZlY3RvcjIsIHBhcnRpY2xlRW1pdFpBeGlzLCByYW5kb21Qb2ludEJldHdlZW5DaXJjbGVBdEZpeGVkQW5nbGUsIHJhbmRvbVBvaW50QmV0d2VlblNwaGVyZSxcclxuICAgIHJhbmRvbVBvaW50SW5DdWJlLCByYW5kb21TaWduLCByYW5kb21Tb3J0QXJyYXksIHJhbmRvbVVuaXRWZWN0b3IgfSBmcm9tICcuLi9wYXJ0aWNsZS1nZW5lcmFsLWZ1bmN0aW9uJztcclxuaW1wb3J0IHsgUGFydGljbGVTeXN0ZW1Db21wb25lbnQgfSBmcm9tICcuLi9wYXJ0aWNsZS1zeXN0ZW0tY29tcG9uZW50JztcclxuXHJcbmNvbnN0IF9pbnRlcm1lZGlWZWMgPSBuZXcgVmVjMygwLCAwLCAwKTtcclxuY29uc3QgX2ludGVybWVkaUFyciA9IG5ldyBBcnJheSgpO1xyXG5jb25zdCBfdW5pdEJveEV4dGVudCA9IG5ldyBWZWMzKDAuNSwgMC41LCAwLjUpO1xyXG5cclxuQGNjY2xhc3MoJ2NjLlNoYXBlTW9kdWxlJylcclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgU2hhcGVNb2R1bGUge1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogQHpoIOeykuWtkOWPkeWwhOWZqOS9jee9ruOAglxyXG4gICAgICovXHJcbiAgICBAcHJvcGVydHkoe1xyXG4gICAgICAgIGRpc3BsYXlPcmRlcjogMTMsXHJcbiAgICAgICAgdG9vbHRpcDon57KS5a2Q5Y+R5bCE5Zmo5L2N572uJyxcclxuICAgIH0pXHJcbiAgICBnZXQgcG9zaXRpb24gKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9wb3NpdGlvbjtcclxuICAgIH1cclxuICAgIHNldCBwb3NpdGlvbiAodmFsKSB7XHJcbiAgICAgICAgdGhpcy5fcG9zaXRpb24gPSB2YWw7XHJcbiAgICAgICAgdGhpcy5jb25zdHJ1Y3RNYXQoKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEB6aCDnspLlrZDlj5HlsITlmajml4vovazop5LluqbjgIJcclxuICAgICAqL1xyXG4gICAgQHByb3BlcnR5KHtcclxuICAgICAgICBkaXNwbGF5T3JkZXI6IDE0LFxyXG4gICAgICAgIHRvb2x0aXA6J+eykuWtkOWPkeWwhOWZqOaXi+i9rOinkuW6picsXHJcbiAgICB9KVxyXG4gICAgZ2V0IHJvdGF0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fcm90YXRpb247XHJcbiAgICB9XHJcbiAgICBzZXQgcm90YXRpb24gKHZhbCkge1xyXG4gICAgICAgIHRoaXMuX3JvdGF0aW9uID0gdmFsO1xyXG4gICAgICAgIHRoaXMuY29uc3RydWN0TWF0KCk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBAemgg57KS5a2Q5Y+R5bCE5Zmo57yp5pS+5q+U5L6L44CCXHJcbiAgICAgKi9cclxuICAgIEBwcm9wZXJ0eSh7XHJcbiAgICAgICAgZGlzcGxheU9yZGVyOiAxNSxcclxuICAgICAgICB0b29sdGlwOifnspLlrZDlj5HlsITlmajnvKnmlL7mr5TkvosnLFxyXG4gICAgfSlcclxuICAgIGdldCBzY2FsZSAoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3NjYWxlO1xyXG4gICAgfVxyXG4gICAgc2V0IHNjYWxlICh2YWwpIHtcclxuICAgICAgICB0aGlzLl9zY2FsZSA9IHZhbDtcclxuICAgICAgICB0aGlzLmNvbnN0cnVjdE1hdCgpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogQHpoIOeykuWtkOWPkeWwhOWZqOWcqOS4gOS4quaJh+W9ouiMg+WbtOWGheWPkeWwhOOAglxyXG4gICAgICovXHJcbiAgICBAcHJvcGVydHkoe1xyXG4gICAgICAgIGRpc3BsYXlPcmRlcjogNixcclxuICAgICAgICB0b29sdGlwOifnspLlrZDlj5HlsITlmajlnKjkuIDkuKrmiYflvaLojIPlm7TlhoXlj5HlsIQnLFxyXG4gICAgfSlcclxuICAgIGdldCBhcmMgKCkge1xyXG4gICAgICAgIHJldHVybiB0b0RlZ3JlZSh0aGlzLl9hcmMpO1xyXG4gICAgfVxyXG5cclxuICAgIHNldCBhcmMgKHZhbCkge1xyXG4gICAgICAgIHRoaXMuX2FyYyA9IHRvUmFkaWFuKHZhbCk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBAemgg5ZyG6ZSl55qE6L205LiO5q+N57q/55qE5aS56KeSPGJnPuOAglxyXG4gICAgICog5Yaz5a6a5ZyG6ZSl5Y+R5bCE5Zmo55qE5byA5ZCI56iL5bqm44CCXHJcbiAgICAgKi9cclxuICAgIEBwcm9wZXJ0eSh7XHJcbiAgICAgICAgZGlzcGxheU9yZGVyOiA1LFxyXG4gICAgICAgIHRvb2x0aXA6J+WchumUpeeahOi9tOS4juavjee6v+eahOWkueinklxcbuWGs+WumuWchumUpeWPkeWwhOWZqOeahOW8gOWQiOeoi+W6picsXHJcbiAgICB9KVxyXG4gICAgZ2V0IGFuZ2xlICgpIHtcclxuICAgICAgICByZXR1cm4gTWF0aC5yb3VuZCh0b0RlZ3JlZSh0aGlzLl9hbmdsZSkgKiAxMDApIC8gMTAwO1xyXG4gICAgfVxyXG5cclxuICAgIHNldCBhbmdsZSAodmFsKSB7XHJcbiAgICAgICAgdGhpcy5fYW5nbGUgPSB0b1JhZGlhbih2YWwpO1xyXG4gICAgfVxyXG5cclxuICAgIEBwcm9wZXJ0eVxyXG4gICAgcHJpdmF0ZSBfZW5hYmxlID0gZmFsc2U7XHJcbiAgICAvKipcclxuICAgICAqIEB6aCDmmK/lkKblkK/nlKjjgIJcclxuICAgICAqL1xyXG4gICAgQHByb3BlcnR5KHtcclxuICAgICAgICBkaXNwbGF5T3JkZXI6IDAsXHJcbiAgICB9KVxyXG4gICAgcHVibGljIGdldCBlbmFibGUgKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9lbmFibGU7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHNldCBlbmFibGUgKHZhbCkge1xyXG4gICAgICAgIHRoaXMuX2VuYWJsZSA9IHZhbDtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEB6aCDnspLlrZDlj5HlsITlmajnsbvlnosgW1tTaGFwZVR5cGVdXeOAglxyXG4gICAgICovXHJcbiAgICBAcHJvcGVydHkoe1xyXG4gICAgICAgIHR5cGU6IFNoYXBlVHlwZSxcclxuICAgICAgICBkaXNwbGF5T3JkZXI6IDEsXHJcbiAgICAgICAgZm9ybWVybHlTZXJpYWxpemVkQXM6ICdzaGFwZVR5cGUnLFxyXG4gICAgfSlcclxuICAgIHB1YmxpYyBfc2hhcGVUeXBlID0gU2hhcGVUeXBlLkNvbmU7XHJcblxyXG4gICAgQHByb3BlcnR5KHtcclxuICAgICAgICB0eXBlOiBTaGFwZVR5cGUsXHJcbiAgICAgICAgdG9vbHRpcDon57KS5a2Q5Y+R5bCE5Zmo57G75Z6LJyxcclxuICAgIH0pXHJcbiAgICBwdWJsaWMgZ2V0IHNoYXBlVHlwZSAoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3NoYXBlVHlwZTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgc2V0IHNoYXBlVHlwZSAodmFsKSB7XHJcbiAgICAgICAgdGhpcy5fc2hhcGVUeXBlID0gdmFsO1xyXG4gICAgICAgIHN3aXRjaCAodGhpcy5fc2hhcGVUeXBlKSB7XHJcbiAgICAgICAgICAgIGNhc2UgU2hhcGVUeXBlLkJveDpcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmVtaXRGcm9tID09PSBFbWl0TG9jYXRpb24uQmFzZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZW1pdEZyb20gPSBFbWl0TG9jYXRpb24uVm9sdW1lO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgU2hhcGVUeXBlLkNvbmU6XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5lbWl0RnJvbSA9PT0gRW1pdExvY2F0aW9uLkVkZ2UpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmVtaXRGcm9tID0gRW1pdExvY2F0aW9uLkJhc2U7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSBTaGFwZVR5cGUuU3BoZXJlOlxyXG4gICAgICAgICAgICBjYXNlIFNoYXBlVHlwZS5IZW1pc3BoZXJlOlxyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuZW1pdEZyb20gPT09IEVtaXRMb2NhdGlvbi5CYXNlIHx8IHRoaXMuZW1pdEZyb20gPT09IEVtaXRMb2NhdGlvbi5FZGdlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5lbWl0RnJvbSA9IEVtaXRMb2NhdGlvbi5Wb2x1bWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBAemgg57KS5a2Q5LuO5Y+R5bCE5Zmo5ZOq5Liq6YOo5L2N5Y+R5bCEIFtbRW1pdExvY2F0aW9uXV3jgIJcclxuICAgICAqL1xyXG4gICAgQHByb3BlcnR5KHtcclxuICAgICAgICB0eXBlOiBFbWl0TG9jYXRpb24sXHJcbiAgICAgICAgZGlzcGxheU9yZGVyOiAyLFxyXG4gICAgICAgIHRvb2x0aXA6J+eykuWtkOS7juWPkeWwhOWZqOWTquS4qumDqOS9jeWPkeWwhCcsXHJcbiAgICB9KVxyXG4gICAgcHVibGljIGVtaXRGcm9tID0gRW1pdExvY2F0aW9uLlZvbHVtZTtcclxuXHJcbiAgICAvKipcclxuICAgICAqIEB6aCDmoLnmja7nspLlrZDnmoTliJ3lp4vmlrnlkJHlhrPlrprnspLlrZDnmoTnp7vliqjmlrnlkJHjgIJcclxuICAgICAqL1xyXG4gICAgQHByb3BlcnR5KHtcclxuICAgICAgICBkaXNwbGF5T3JkZXI6IDE2LFxyXG4gICAgICAgIHRvb2x0aXA6J+agueaNrueykuWtkOeahOWIneWni+aWueWQkeWGs+WumueykuWtkOeahOenu+WKqOaWueWQkScsXHJcbiAgICB9KVxyXG4gICAgcHVibGljIGFsaWduVG9EaXJlY3Rpb24gPSBmYWxzZTtcclxuXHJcbiAgICAvKipcclxuICAgICAqIEB6aCDnspLlrZDnlJ/miJDmlrnlkJHpmo/mnLrorr7lrprjgIJcclxuICAgICAqL1xyXG4gICAgQHByb3BlcnR5KHtcclxuICAgICAgICBkaXNwbGF5T3JkZXI6IDE3LFxyXG4gICAgICAgIHRvb2x0aXA6J+eykuWtkOeUn+aIkOaWueWQkemaj+acuuiuvuWumicsXHJcbiAgICB9KVxyXG4gICAgcHVibGljIHJhbmRvbURpcmVjdGlvbkFtb3VudCA9IDA7XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBAemgg6KGo56S65b2T5YmN5Y+R5bCE5pa55ZCR5LiO5b2T5YmN5L2N572u5Yiw57uT54K55Lit5b+D6L+e57q/5pa55ZCR55qE5o+S5YC844CCXHJcbiAgICAgKi9cclxuICAgIEBwcm9wZXJ0eSh7XHJcbiAgICAgICAgZGlzcGxheU9yZGVyOiAxOCxcclxuICAgICAgICB0b29sdGlwOifooajnpLrlvZPliY3lj5HlsITmlrnlkJHkuI7lvZPliY3kvY3nva7liLDnu5PngrnkuK3lv4Pov57nur/mlrnlkJHnmoTmj5LlgLwnLFxyXG4gICAgfSlcclxuICAgIHB1YmxpYyBzcGhlcmljYWxEaXJlY3Rpb25BbW91bnQgPSAwO1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogQHpoIOeykuWtkOeUn+aIkOS9jee9rumaj+acuuiuvuWumu+8iOiuvuWumuatpOWAvOS4uumdniAwIOS8muS9v+eykuWtkOeUn+aIkOS9jee9rui2heWHuueUn+aIkOWZqOWkp+Wwj+iMg+WbtO+8ieOAglxyXG4gICAgICovXHJcbiAgICBAcHJvcGVydHkoe1xyXG4gICAgICAgIGRpc3BsYXlPcmRlcjogMTksXHJcbiAgICAgICAgdG9vbHRpcDon57KS5a2Q55Sf5oiQ5L2N572u6ZqP5py66K6+5a6a77yI6K6+5a6a5q2k5YC85Li66Z2eIDAg5Lya5L2/57KS5a2Q55Sf5oiQ5L2N572u6LaF5Ye655Sf5oiQ5Zmo5aSn5bCP6IyD5Zu077yJJyxcclxuICAgIH0pXHJcbiAgICBwdWJsaWMgcmFuZG9tUG9zaXRpb25BbW91bnQgPSAwO1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogQHpoIOeykuWtkOWPkeWwhOWZqOWNiuW+hOOAglxyXG4gICAgICovXHJcbiAgICBAcHJvcGVydHkoe1xyXG4gICAgICAgIGRpc3BsYXlPcmRlcjogMyxcclxuICAgICAgICB0b29sdGlwOifnspLlrZDlj5HlsITlmajljYrlvoQnLFxyXG4gICAgfSlcclxuICAgIHB1YmxpYyByYWRpdXMgPSAxO1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogQHpoIOeykuWtkOWPkeWwhOWZqOWPkeWwhOS9jee9ru+8iOWvuSBCb3gg57G75Z6L55qE5Y+R5bCE5Zmo5peg5pWI77yJ77yaPGJnPlxyXG4gICAgICogLSAwIOihqOekuuS7juihqOmdouWPkeWwhO+8m1xyXG4gICAgICogLSAxIOihqOekuuS7juS4reW/g+WPkeWwhO+8m1xyXG4gICAgICogLSAwIH4gMSDkuYvpl7TooajnpLrlnKjkuK3lv4PliLDooajpnaLkuYvpl7Tlj5HlsITjgIJcclxuICAgICAqL1xyXG4gICAgQHByb3BlcnR5KHtcclxuICAgICAgICBkaXNwbGF5T3JkZXI6IDQsXHJcbiAgICAgICAgdG9vbHRpcDon57KS5a2Q5Y+R5bCE5Zmo5Y+R5bCE5L2N572u77yI5a+5IEJveCDnsbvlnovnmoTlj5HlsITlmajml6DmlYjvvIk6XFxuIC0gMCDooajnpLrku47ooajpnaLlj5HlsITvvJtcXG4gLSAxIOihqOekuuS7juS4reW/g+WPkeWwhO+8m1xcbiAtIDAgfiAxIOS5i+mXtOihqOekuuWcqOS4reW/g+WIsOihqOmdouS5i+mXtOWPkeWwhOOAgicsXHJcbiAgICB9KVxyXG4gICAgcHVibGljIHJhZGl1c1RoaWNrbmVzcyA9IDE7XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBAemgg57KS5a2Q5Zyo5omH5b2i6IyD5Zu05YaF55qE5Y+R5bCE5pa55byPIFtbQXJjTW9kZV1d44CCXHJcbiAgICAgKi9cclxuICAgIEBwcm9wZXJ0eSh7XHJcbiAgICAgICAgdHlwZTogQXJjTW9kZSxcclxuICAgICAgICBkaXNwbGF5T3JkZXI6IDcsXHJcbiAgICAgICAgdG9vbHRpcDon57KS5a2Q5Zyo5omH5b2i6IyD5Zu05YaF55qE5Y+R5bCE5pa55byPJyxcclxuICAgIH0pXHJcbiAgICBwdWJsaWMgYXJjTW9kZSA9IEFyY01vZGUuUmFuZG9tO1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogQHpoIOaOp+WItuWPr+iDveS6p+eUn+eykuWtkOeahOW8p+WRqOWbtOeahOemu+aVo+mXtOmalOOAglxyXG4gICAgICovXHJcbiAgICBAcHJvcGVydHkoe1xyXG4gICAgICAgIGRpc3BsYXlPcmRlcjogOSxcclxuICAgICAgICB0b29sdGlwOifmjqfliLblj6/og73kuqfnlJ/nspLlrZDnmoTlvKflkajlm7TnmoTnprvmlaPpl7TpmpQnLFxyXG4gICAgfSlcclxuICAgIHB1YmxpYyBhcmNTcHJlYWQgPSAwO1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogQHpoIOeykuWtkOayv+WchuWRqOWPkeWwhOeahOmAn+W6puOAglxyXG4gICAgICovXHJcbiAgICBAcHJvcGVydHkoe1xyXG4gICAgICAgIHR5cGU6IEN1cnZlUmFuZ2UsXHJcbiAgICAgICAgZGlzcGxheU9yZGVyOiAxMCxcclxuICAgICAgICB0b29sdGlwOifnspLlrZDmsr/lnIblkajlj5HlsITnmoTpgJ/luqYnLFxyXG4gICAgfSlcclxuICAgIHB1YmxpYyBhcmNTcGVlZCA9IG5ldyBDdXJ2ZVJhbmdlKCk7XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBAemgg5ZyG6ZSl6aG26YOo5oiq6Z2i6Led56a75bqV6YOo55qE6L206ZW/PGJnPuOAglxyXG4gICAgICog5Yaz5a6a5ZyG6ZSl5Y+R5bCE5Zmo55qE6auY5bqm44CCXHJcbiAgICAgKi9cclxuICAgIEBwcm9wZXJ0eSh7XHJcbiAgICAgICAgZGlzcGxheU9yZGVyOiAxMSxcclxuICAgICAgICB0b29sdGlwOiflnIbplKXpobbpg6jmiKrpnaLot53nprvlupXpg6jnmoTovbTplb9cXG7lhrPlrprlnIbplKXlj5HlsITlmajnmoTpq5jluqYnLFxyXG4gICAgfSlcclxuICAgIHB1YmxpYyBsZW5ndGggPSA1O1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogQHpoIOeykuWtkOWPkeWwhOWZqOWPkeWwhOS9jee9ru+8iOmSiOWvuSBCb3gg57G75Z6L55qE57KS5a2Q5Y+R5bCE5Zmo77yJ44CCXHJcbiAgICAgKi9cclxuICAgIEBwcm9wZXJ0eSh7XHJcbiAgICAgICAgZGlzcGxheU9yZGVyOiAxMixcclxuICAgICAgICB0b29sdGlwOifnspLlrZDlj5HlsITlmajlj5HlsITkvY3nva7vvIjpkojlr7kgQm94IOexu+Wei+eahOeykuWtkOWPkeWwhOWZqO+8iScsXHJcbiAgICB9KVxyXG4gICAgcHVibGljIGJveFRoaWNrbmVzcyA9IG5ldyBWZWMzKDAsIDAsIDApO1xyXG5cclxuICAgIEBwcm9wZXJ0eVxyXG4gICAgcHJpdmF0ZSBfcG9zaXRpb24gPSBuZXcgVmVjMygwLCAwLCAwKTtcclxuXHJcbiAgICBAcHJvcGVydHlcclxuICAgIHByaXZhdGUgX3JvdGF0aW9uID0gbmV3IFZlYzMoMCwgMCwgMCk7XHJcblxyXG4gICAgQHByb3BlcnR5XHJcbiAgICBwcml2YXRlIF9zY2FsZSA9IG5ldyBWZWMzKDEsIDEsIDEpO1xyXG5cclxuICAgIEBwcm9wZXJ0eVxyXG4gICAgcHJpdmF0ZSBfYXJjID0gdG9SYWRpYW4oMzYwKTtcclxuXHJcbiAgICBAcHJvcGVydHlcclxuICAgIHByaXZhdGUgX2FuZ2xlID0gdG9SYWRpYW4oMjUpO1xyXG5cclxuICAgIHByaXZhdGUgbWF0OiBNYXQ0O1xyXG4gICAgcHJpdmF0ZSBxdWF0OiBRdWF0O1xyXG4gICAgcHJpdmF0ZSBwYXJ0aWNsZVN5c3RlbTogYW55O1xyXG4gICAgcHJpdmF0ZSBsYXN0VGltZTogbnVtYmVyO1xyXG4gICAgcHJpdmF0ZSB0b3RhbEFuZ2xlOiBudW1iZXI7XHJcblxyXG4gICAgY29uc3RydWN0b3IgKCkge1xyXG4gICAgICAgIHRoaXMubWF0ID0gbmV3IE1hdDQoKTtcclxuICAgICAgICB0aGlzLnF1YXQgPSBuZXcgUXVhdCgpO1xyXG4gICAgICAgIHRoaXMucGFydGljbGVTeXN0ZW0gPSBudWxsO1xyXG4gICAgICAgIHRoaXMubGFzdFRpbWUgPSAwO1xyXG4gICAgICAgIHRoaXMudG90YWxBbmdsZSA9IDA7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIG9uSW5pdCAocHM6IFBhcnRpY2xlU3lzdGVtQ29tcG9uZW50KSB7XHJcbiAgICAgICAgdGhpcy5wYXJ0aWNsZVN5c3RlbSA9IHBzO1xyXG4gICAgICAgIHRoaXMuY29uc3RydWN0TWF0KCk7XHJcbiAgICAgICAgdGhpcy5sYXN0VGltZSA9IHRoaXMucGFydGljbGVTeXN0ZW0uX3RpbWU7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGVtaXQgKHApIHtcclxuICAgICAgICBzd2l0Y2ggKHRoaXMuc2hhcGVUeXBlKSB7XHJcbiAgICAgICAgICAgIGNhc2UgU2hhcGVUeXBlLkJveDpcclxuICAgICAgICAgICAgICAgIGJveEVtaXQodGhpcy5lbWl0RnJvbSwgdGhpcy5ib3hUaGlja25lc3MsIHAucG9zaXRpb24sIHAudmVsb2NpdHkpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgU2hhcGVUeXBlLkNpcmNsZTpcclxuICAgICAgICAgICAgICAgIGNpcmNsZUVtaXQodGhpcy5yYWRpdXMsIHRoaXMucmFkaXVzVGhpY2tuZXNzLCB0aGlzLmdlbmVyYXRlQXJjQW5nbGUoKSwgcC5wb3NpdGlvbiwgcC52ZWxvY2l0eSk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSBTaGFwZVR5cGUuQ29uZTpcclxuICAgICAgICAgICAgICAgIGNvbmVFbWl0KHRoaXMuZW1pdEZyb20sIHRoaXMucmFkaXVzLCB0aGlzLnJhZGl1c1RoaWNrbmVzcywgdGhpcy5nZW5lcmF0ZUFyY0FuZ2xlKCksIHRoaXMuX2FuZ2xlLCB0aGlzLmxlbmd0aCwgcC5wb3NpdGlvbiwgcC52ZWxvY2l0eSk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSBTaGFwZVR5cGUuU3BoZXJlOlxyXG4gICAgICAgICAgICAgICAgc3BoZXJlRW1pdCh0aGlzLmVtaXRGcm9tLCB0aGlzLnJhZGl1cywgdGhpcy5yYWRpdXNUaGlja25lc3MsIHAucG9zaXRpb24sIHAudmVsb2NpdHkpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgU2hhcGVUeXBlLkhlbWlzcGhlcmU6XHJcbiAgICAgICAgICAgICAgICBoZW1pc3BoZXJlRW1pdCh0aGlzLmVtaXRGcm9tLCB0aGlzLnJhZGl1cywgdGhpcy5yYWRpdXNUaGlja25lc3MsIHAucG9zaXRpb24sIHAudmVsb2NpdHkpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4odGhpcy5zaGFwZVR5cGUgKyAnIHNoYXBlVHlwZSBpcyBub3Qgc3VwcG9ydGVkIGJ5IFNoYXBlTW9kdWxlLicpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGhpcy5yYW5kb21Qb3NpdGlvbkFtb3VudCA+IDApIHtcclxuICAgICAgICAgICAgcC5wb3NpdGlvbi54ICs9IHJhbmRvbVJhbmdlKC10aGlzLnJhbmRvbVBvc2l0aW9uQW1vdW50LCB0aGlzLnJhbmRvbVBvc2l0aW9uQW1vdW50KTtcclxuICAgICAgICAgICAgcC5wb3NpdGlvbi55ICs9IHJhbmRvbVJhbmdlKC10aGlzLnJhbmRvbVBvc2l0aW9uQW1vdW50LCB0aGlzLnJhbmRvbVBvc2l0aW9uQW1vdW50KTtcclxuICAgICAgICAgICAgcC5wb3NpdGlvbi56ICs9IHJhbmRvbVJhbmdlKC10aGlzLnJhbmRvbVBvc2l0aW9uQW1vdW50LCB0aGlzLnJhbmRvbVBvc2l0aW9uQW1vdW50KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgVmVjMy50cmFuc2Zvcm1RdWF0KHAudmVsb2NpdHksIHAudmVsb2NpdHksIHRoaXMucXVhdCk7XHJcbiAgICAgICAgVmVjMy50cmFuc2Zvcm1NYXQ0KHAucG9zaXRpb24sIHAucG9zaXRpb24sIHRoaXMubWF0KTtcclxuICAgICAgICBpZiAodGhpcy5zcGhlcmljYWxEaXJlY3Rpb25BbW91bnQgPiAwKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHNwaGVyaWNhbFZlbCA9IFZlYzMubm9ybWFsaXplKF9pbnRlcm1lZGlWZWMsIHAucG9zaXRpb24pO1xyXG4gICAgICAgICAgICBWZWMzLmxlcnAocC52ZWxvY2l0eSwgcC52ZWxvY2l0eSwgc3BoZXJpY2FsVmVsLCB0aGlzLnNwaGVyaWNhbERpcmVjdGlvbkFtb3VudCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMubGFzdFRpbWUgPSB0aGlzLnBhcnRpY2xlU3lzdGVtIS5fdGltZTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGNvbnN0cnVjdE1hdCAoKSB7XHJcbiAgICAgICAgUXVhdC5mcm9tRXVsZXIodGhpcy5xdWF0LCB0aGlzLl9yb3RhdGlvbi54LCB0aGlzLl9yb3RhdGlvbi55LCB0aGlzLl9yb3RhdGlvbi56KTtcclxuICAgICAgICBNYXQ0LmZyb21SVFModGhpcy5tYXQsIHRoaXMucXVhdCwgdGhpcy5fcG9zaXRpb24sIHRoaXMuX3NjYWxlKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGdlbmVyYXRlQXJjQW5nbGUgKCkge1xyXG4gICAgICAgIGlmICh0aGlzLmFyY01vZGUgPT09IEFyY01vZGUuUmFuZG9tKSB7XHJcbiAgICAgICAgICAgIHJldHVybiByYW5kb21SYW5nZSgwLCB0aGlzLl9hcmMpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBsZXQgYW5nbGUgPSB0aGlzLnRvdGFsQW5nbGUgKyAyICogTWF0aC5QSSAqIHRoaXMuYXJjU3BlZWQuZXZhbHVhdGUodGhpcy5wYXJ0aWNsZVN5c3RlbSEuX3RpbWUsIDEpISAqICh0aGlzLnBhcnRpY2xlU3lzdGVtIS5fdGltZSAtIHRoaXMubGFzdFRpbWUpO1xyXG4gICAgICAgIHRoaXMudG90YWxBbmdsZSA9IGFuZ2xlO1xyXG4gICAgICAgIGlmICh0aGlzLmFyY1NwcmVhZCAhPT0gMCkge1xyXG4gICAgICAgICAgICBhbmdsZSA9IE1hdGguZmxvb3IoYW5nbGUgLyAodGhpcy5fYXJjICogdGhpcy5hcmNTcHJlYWQpKSAqIHRoaXMuX2FyYyAqIHRoaXMuYXJjU3ByZWFkO1xyXG4gICAgICAgIH1cclxuICAgICAgICBzd2l0Y2ggKHRoaXMuYXJjTW9kZSkge1xyXG4gICAgICAgICAgICBjYXNlIEFyY01vZGUuTG9vcDpcclxuICAgICAgICAgICAgICAgIHJldHVybiByZXBlYXQoYW5nbGUsIHRoaXMuX2FyYyk7XHJcbiAgICAgICAgICAgIGNhc2UgQXJjTW9kZS5QaW5nUG9uZzpcclxuICAgICAgICAgICAgICAgIHJldHVybiBwaW5nUG9uZyhhbmdsZSwgdGhpcy5fYXJjKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHNwaGVyZUVtaXQgKGVtaXRGcm9tLCByYWRpdXMsIHJhZGl1c1RoaWNrbmVzcywgcG9zLCBkaXIpIHtcclxuICAgIHN3aXRjaCAoZW1pdEZyb20pIHtcclxuICAgICAgICBjYXNlIEVtaXRMb2NhdGlvbi5Wb2x1bWU6XHJcbiAgICAgICAgICAgIHJhbmRvbVBvaW50QmV0d2VlblNwaGVyZShwb3MsIHJhZGl1cyAqICgxIC0gcmFkaXVzVGhpY2tuZXNzKSwgcmFkaXVzKTtcclxuICAgICAgICAgICAgVmVjMy5ub3JtYWxpemUoZGlyLCBwb3MpO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlIEVtaXRMb2NhdGlvbi5TaGVsbDpcclxuICAgICAgICAgICAgcmFuZG9tVW5pdFZlY3Rvcihwb3MpO1xyXG4gICAgICAgICAgICBWZWMzLm11bHRpcGx5U2NhbGFyKHBvcywgcG9zLCByYWRpdXMpO1xyXG4gICAgICAgICAgICBWZWMzLm5vcm1hbGl6ZShkaXIsIHBvcyk7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgIGNvbnNvbGUud2FybihlbWl0RnJvbSArICcgaXMgbm90IHN1cHBvcnRlZCBmb3Igc3BoZXJlIGVtaXR0ZXIuJyk7XHJcbiAgICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGhlbWlzcGhlcmVFbWl0IChlbWl0RnJvbSwgcmFkaXVzLCByYWRpdXNUaGlja25lc3MsIHBvcywgZGlyKSB7XHJcbiAgICBzd2l0Y2ggKGVtaXRGcm9tKSB7XHJcbiAgICAgICAgY2FzZSBFbWl0TG9jYXRpb24uVm9sdW1lOlxyXG4gICAgICAgICAgICByYW5kb21Qb2ludEJldHdlZW5TcGhlcmUocG9zLCByYWRpdXMgKiAoMSAtIHJhZGl1c1RoaWNrbmVzcyksIHJhZGl1cyk7XHJcbiAgICAgICAgICAgIGlmIChwb3MueiA+IDApIHtcclxuICAgICAgICAgICAgICAgIHBvcy56ICo9IC0xO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIFZlYzMubm9ybWFsaXplKGRpciwgcG9zKTtcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSBFbWl0TG9jYXRpb24uU2hlbGw6XHJcbiAgICAgICAgICAgIHJhbmRvbVVuaXRWZWN0b3IocG9zKTtcclxuICAgICAgICAgICAgVmVjMy5tdWx0aXBseVNjYWxhcihwb3MsIHBvcywgcmFkaXVzKTtcclxuICAgICAgICAgICAgaWYgKHBvcy56ID4gMCkge1xyXG4gICAgICAgICAgICAgICAgcG9zLnogKj0gLTE7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgVmVjMy5ub3JtYWxpemUoZGlyLCBwb3MpO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICBjb25zb2xlLndhcm4oZW1pdEZyb20gKyAnIGlzIG5vdCBzdXBwb3J0ZWQgZm9yIGhlbWlzcGhlcmUgZW1pdHRlci4nKTtcclxuICAgIH1cclxufVxyXG5cclxuZnVuY3Rpb24gY29uZUVtaXQgKGVtaXRGcm9tLCByYWRpdXMsIHJhZGl1c1RoaWNrbmVzcywgdGhldGEsIGFuZ2xlLCBsZW5ndGgsIHBvcywgZGlyKSB7XHJcbiAgICBzd2l0Y2ggKGVtaXRGcm9tKSB7XHJcbiAgICAgICAgY2FzZSBFbWl0TG9jYXRpb24uQmFzZTpcclxuICAgICAgICAgICAgcmFuZG9tUG9pbnRCZXR3ZWVuQ2lyY2xlQXRGaXhlZEFuZ2xlKHBvcywgcmFkaXVzICogKDEgLSByYWRpdXNUaGlja25lc3MpLCByYWRpdXMsIHRoZXRhKTtcclxuICAgICAgICAgICAgVmVjMi5tdWx0aXBseVNjYWxhcihkaXIsIHBvcywgTWF0aC5zaW4oYW5nbGUpKTtcclxuICAgICAgICAgICAgZGlyLnogPSAtTWF0aC5jb3MoYW5nbGUpICogcmFkaXVzO1xyXG4gICAgICAgICAgICBWZWMzLm5vcm1hbGl6ZShkaXIsIGRpcik7XHJcbiAgICAgICAgICAgIHBvcy56ID0gMDtcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSBFbWl0TG9jYXRpb24uU2hlbGw6XHJcbiAgICAgICAgICAgIGZpeGVkQW5nbGVVbml0VmVjdG9yMihwb3MsIHRoZXRhKTtcclxuICAgICAgICAgICAgVmVjMi5tdWx0aXBseVNjYWxhcihkaXIsIHBvcywgTWF0aC5zaW4oYW5nbGUpKTtcclxuICAgICAgICAgICAgZGlyLnogPSAtTWF0aC5jb3MoYW5nbGUpO1xyXG4gICAgICAgICAgICBWZWMzLm5vcm1hbGl6ZShkaXIsIGRpcik7XHJcbiAgICAgICAgICAgIFZlYzIubXVsdGlwbHlTY2FsYXIocG9zLCBwb3MsIHJhZGl1cyk7XHJcbiAgICAgICAgICAgIHBvcy56ID0gMDtcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSBFbWl0TG9jYXRpb24uVm9sdW1lOlxyXG4gICAgICAgICAgICByYW5kb21Qb2ludEJldHdlZW5DaXJjbGVBdEZpeGVkQW5nbGUocG9zLCByYWRpdXMgKiAoMSAtIHJhZGl1c1RoaWNrbmVzcyksIHJhZGl1cywgdGhldGEpO1xyXG4gICAgICAgICAgICBWZWMyLm11bHRpcGx5U2NhbGFyKGRpciwgcG9zLCBNYXRoLnNpbihhbmdsZSkpO1xyXG4gICAgICAgICAgICBkaXIueiA9IC1NYXRoLmNvcyhhbmdsZSkgKiByYWRpdXM7XHJcbiAgICAgICAgICAgIFZlYzMubm9ybWFsaXplKGRpciwgZGlyKTtcclxuICAgICAgICAgICAgcG9zLnogPSAwO1xyXG4gICAgICAgICAgICBWZWMzLmFkZChwb3MsIHBvcywgVmVjMy5tdWx0aXBseVNjYWxhcihfaW50ZXJtZWRpVmVjLCBkaXIsIGxlbmd0aCAqIHJhbmRvbSgpIC8gLWRpci56KSk7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgIGNvbnNvbGUud2FybihlbWl0RnJvbSArICcgaXMgbm90IHN1cHBvcnRlZCBmb3IgY29uZSBlbWl0dGVyLicpO1xyXG4gICAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiBib3hFbWl0IChlbWl0RnJvbSwgYm94VGhpY2tuZXNzLCBwb3MsIGRpcikge1xyXG4gICAgc3dpdGNoIChlbWl0RnJvbSkge1xyXG4gICAgICAgIGNhc2UgRW1pdExvY2F0aW9uLlZvbHVtZTpcclxuICAgICAgICAgICAgcmFuZG9tUG9pbnRJbkN1YmUocG9zLCBfdW5pdEJveEV4dGVudCk7XHJcbiAgICAgICAgICAgIC8vIHJhbmRvbVBvaW50QmV0d2VlbkN1YmUocG9zLCB2ZWMzLm11bHRpcGx5KF9pbnRlcm1lZGlWZWMsIF91bml0Qm94RXh0ZW50LCBib3hUaGlja25lc3MpLCBfdW5pdEJveEV4dGVudCk7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgRW1pdExvY2F0aW9uLlNoZWxsOlxyXG4gICAgICAgICAgICBfaW50ZXJtZWRpQXJyLnNwbGljZSgwLCBfaW50ZXJtZWRpQXJyLmxlbmd0aCk7XHJcbiAgICAgICAgICAgIF9pbnRlcm1lZGlBcnIucHVzaChyYW5kb21SYW5nZSgtMC41LCAwLjUpKTtcclxuICAgICAgICAgICAgX2ludGVybWVkaUFyci5wdXNoKHJhbmRvbVJhbmdlKC0wLjUsIDAuNSkpO1xyXG4gICAgICAgICAgICBfaW50ZXJtZWRpQXJyLnB1c2gocmFuZG9tU2lnbigpICogMC41KTtcclxuICAgICAgICAgICAgcmFuZG9tU29ydEFycmF5KF9pbnRlcm1lZGlBcnIpO1xyXG4gICAgICAgICAgICBhcHBseUJveFRoaWNrbmVzcyhfaW50ZXJtZWRpQXJyLCBib3hUaGlja25lc3MpO1xyXG4gICAgICAgICAgICBWZWMzLnNldChwb3MsIF9pbnRlcm1lZGlBcnJbMF0sIF9pbnRlcm1lZGlBcnJbMV0sIF9pbnRlcm1lZGlBcnJbMl0pO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlIEVtaXRMb2NhdGlvbi5FZGdlOlxyXG4gICAgICAgICAgICBfaW50ZXJtZWRpQXJyLnNwbGljZSgwLCBfaW50ZXJtZWRpQXJyLmxlbmd0aCk7XHJcbiAgICAgICAgICAgIF9pbnRlcm1lZGlBcnIucHVzaChyYW5kb21SYW5nZSgtMC41LCAwLjUpKTtcclxuICAgICAgICAgICAgX2ludGVybWVkaUFyci5wdXNoKHJhbmRvbVNpZ24oKSAqIDAuNSk7XHJcbiAgICAgICAgICAgIF9pbnRlcm1lZGlBcnIucHVzaChyYW5kb21TaWduKCkgKiAwLjUpO1xyXG4gICAgICAgICAgICByYW5kb21Tb3J0QXJyYXkoX2ludGVybWVkaUFycik7XHJcbiAgICAgICAgICAgIGFwcGx5Qm94VGhpY2tuZXNzKF9pbnRlcm1lZGlBcnIsIGJveFRoaWNrbmVzcyk7XHJcbiAgICAgICAgICAgIFZlYzMuc2V0KHBvcywgX2ludGVybWVkaUFyclswXSwgX2ludGVybWVkaUFyclsxXSwgX2ludGVybWVkaUFyclsyXSk7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgIGNvbnNvbGUud2FybihlbWl0RnJvbSArICcgaXMgbm90IHN1cHBvcnRlZCBmb3IgYm94IGVtaXR0ZXIuJyk7XHJcbiAgICB9XHJcbiAgICBWZWMzLmNvcHkoZGlyLCBwYXJ0aWNsZUVtaXRaQXhpcyk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGNpcmNsZUVtaXQgKHJhZGl1cywgcmFkaXVzVGhpY2tuZXNzLCB0aGV0YSwgcG9zLCBkaXIpIHtcclxuICAgIHJhbmRvbVBvaW50QmV0d2VlbkNpcmNsZUF0Rml4ZWRBbmdsZShwb3MsIHJhZGl1cyAqICgxIC0gcmFkaXVzVGhpY2tuZXNzKSwgcmFkaXVzLCB0aGV0YSk7XHJcbiAgICBWZWMzLm5vcm1hbGl6ZShkaXIsIHBvcyk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGFwcGx5Qm94VGhpY2tuZXNzIChwb3MsIHRoaWNrbmVzcykge1xyXG4gICAgaWYgKHRoaWNrbmVzcy54ID4gMCkge1xyXG4gICAgICAgIHBvc1swXSArPSAwLjUgKiByYW5kb21SYW5nZSgtdGhpY2tuZXNzLngsIHRoaWNrbmVzcy54KTtcclxuICAgICAgICBwb3NbMF0gPSBjbGFtcChwb3NbMF0sIC0wLjUsIDAuNSk7XHJcbiAgICB9XHJcbiAgICBpZiAodGhpY2tuZXNzLnkgPiAwKSB7XHJcbiAgICAgICAgcG9zWzFdICs9IDAuNSAqIHJhbmRvbVJhbmdlKC10aGlja25lc3MueSwgdGhpY2tuZXNzLnkpO1xyXG4gICAgICAgIHBvc1sxXSA9IGNsYW1wKHBvc1sxXSwgLTAuNSwgMC41KTtcclxuICAgIH1cclxuICAgIGlmICh0aGlja25lc3MueiA+IDApIHtcclxuICAgICAgICBwb3NbMl0gKz0gMC41ICogcmFuZG9tUmFuZ2UoLXRoaWNrbmVzcy56LCB0aGlja25lc3Mueik7XHJcbiAgICAgICAgcG9zWzJdID0gY2xhbXAocG9zWzJdLCAtMC41LCAwLjUpO1xyXG4gICAgfVxyXG59XHJcblxyXG4vLyBDQ0NsYXNzLmZhc3REZWZpbmUoJ2NjLlNoYXBlTW9kdWxlJywgU2hhcGVNb2R1bGUsIHtcclxuLy8gICAgIGVuYWJsZTogZmFsc2UsXHJcbi8vICAgICBzaGFwZVR5cGU6IFNoYXBlVHlwZS5Cb3gsXHJcbi8vICAgICBlbWl0RnJvbTogRW1pdExvY2F0aW9uLkJhc2UsXHJcbi8vICAgICBfcG9zaXRpb246IG5ldyBWZWMzKDAsIDAsIDApLFxyXG4vLyAgICAgX3JvdGF0aW9uOiBuZXcgVmVjMygwLCAwLCAwKSxcclxuLy8gICAgIF9zY2FsZTogbmV3IFZlYzMoMCwgMCwgMCksXHJcbi8vICAgICBhbGlnblRvRGlyZWN0aW9uOiBmYWxzZSxcclxuLy8gICAgIHJhbmRvbURpcmVjdGlvbkFtb3VudDogMCxcclxuLy8gICAgIHNwaGVyaWNhbERpcmVjdGlvbkFtb3VudDogMCxcclxuLy8gICAgIHJhbmRvbVBvc2l0aW9uQW1vdW50OiAwLFxyXG4vLyAgICAgcmFkaXVzOiAwLFxyXG4vLyAgICAgcmFkaXVzVGhpY2tuZXNzOiAxLFxyXG4vLyAgICAgYXJjOiAwLFxyXG4vLyAgICAgYXJjTW9kZTogQXJjTW9kZS5SYW5kb20sXHJcbi8vICAgICBhcmNTcHJlYWQ6IDAsXHJcbi8vICAgICBhcmNTcGVlZDogbnVsbCxcclxuLy8gICAgIGFuZ2xlOiAwLFxyXG4vLyAgICAgbGVuZ3RoOiAwLFxyXG4vLyAgICAgYm94VGhpY2tuZXNzOiBuZXcgVmVjMygwLCAwLCAwKVxyXG4vLyB9KTtcclxuIl19